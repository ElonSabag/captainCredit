"use strict";define("Wit/Common/WorkItemDialogs",["require","exports","VSS/Platform/Context","VSS/Platform/RestClientBase","Tfs/Platform/Page","VSS/Core/Observable","VSS/Core/Util/String","Wit/Clients/Work/RestClient/Work","Wit/Common/Generated/Constants","react","VSS/Platform/Layout","VSSUI/Button","VSSUI/EditableDropdown","VSSUI/FormItem","VSSUI/Observer","VSSUI/Status","VSSUI/Table","Wit/Common/BulkUpdateUtils/TagUtils","Wit/Common/WorkItemControls/WorkItemFieldControl","Tfs/Platform/TfsComponent","VSSUI/Dialog","Wit/Common/BulkUpdateUtils/BulkUpdateInterfaces","Wit/Common/BulkUpdateUtils/BulkUpdateUtils","Wit/HtmlEditor/Components/HtmlEditor","VSSUI/Components/Panel/Panel","VSSUI/Dropdown","VSSUI/MessageCard","VSSUI/Panel","VSSUI/Spinner","Wit/DirectoryView/Components/DirectoryDropdown","Wit/UI/Data","Wit/UI/WorkItemTypeIcon","VSSUI/Icon","VSSUI/Link","VSS/Platform/Trace","VSSUI/Checkbox","VSSUI/Utilities/DropdownSelection","Wit/Common/WorkItemTypesService/IWorkItemTypesService","VSS/Platform/Location","VSSUI/TextField","VSSUI/Utils/ClipboardUtils","Wit/Common/WiqlOperators","Wit/Identity/Utilities/WorkItemIdentityHelper","VSS/Features/Identities/IdentityPickerProvider","VSSUI/IdentityPicker","VSSUI/Util","Wit/Common/QueryUtils/QueryUtils","VSSUI/List","Wit/Clients/Wit/RestClient/WorkItemTracking","Wit/Common/WorkItemControls/AreaPathDropdown","Wit/UI/Services/WorkItemTypeIconMetadataService","VSSUI/Components/MessageCard/MessageCard","Wit/Common/WorkItemControls/IterationDropdown","Wit/Common/WorkItemControls/NodeUtils"],(function(e,t,s,o,i,r,a,l,n,c,m,d,u,p,h,v,g,I,C,f,k,y,S,b,w,T,N,W,E,D,x,R,F,P,V,A,j,L,M,O,B,_,U,H,z,q,Q,K,$,G,Y,J,X,Z){var ee,te,se,oe,ie,re,ae;ee=t.Resources={},t.Resources.AddAutocompleteComment="Add a comment.  Use # to link a work item, ! to link a pull request, or @ to mention a person.",t.Resources.AddField="Add new field",t.Resources.AddTagsFormat="{0} (Add)",t.Resources.AreaPathLabel="Area path",t.Resources.AreaPathSearchLabel="Area path to search under",t.Resources.Backlogs="backlogs",t.Resources.Cancel="Cancel",t.Resources.CaptureTemplateHeader="Capture Template",t.Resources.ChangeParentErrorLoadingParentWorkItemsMessage="Error loading parent work items: {0}",t.Resources.ChangeParentNoViableBacklogLevel="No parent backlog level found for selected work item(s)",t.Resources.ChangeParentMaxLevel="Cannot change parent of the selected work item(s) because they are already at the highest backlog level ({0})",t.Resources.ChangeParentNoAvailableParents="No potential parent work items found for selected work item(s)",t.Resources.ChangeParentOfWorkItems="Change Parent of Work Item(s)",t.Resources.ChangeParentOfSelectedWorkItems="Change parent of selected work item(s)",t.Resources.ChangeParentPanelDescription="This will replace any existing parent of the {0} selected item(s).",t.Resources.ChangeParentSelectNewParent="Select a new parent...",t.Resources.ChangeTypeLink="Learn more about changing the type",t.Resources.ChangeTypeReason="Add a reason for changing the type",t.Resources.ChangeWorkItemInvalidTypeMessage="Work item type(s) {0} cannot be moved because it is disabled, hidden or not supported.",t.Resources.ChangeWorkItemType="Change work item type",t.Resources.CharacterCount="{0}/{1} characters",t.Resources.CloneWorkItemError="Error cloning work item",t.Resources.CloningWorkItem="Cloning work item...",t.Resources.CloseLabel="Close",t.Resources.Copying="Copying work item...",t.Resources.Copy="Copy",t.Resources.CopyLink="Copy link",t.Resources.CopyTemplateLinkMessage="Copy the URL to add a work item using this template.",t.Resources.CopyWorkItemDialogTitle="Copy Work Item",t.Resources.CopyWorkItemDialogText="Creating a copy of {0} {1}: {2}",t.Resources.CreatingTemplateSpinnerAriaLabel="Creating template...",t.Resources.DeleteSelectedWorkItems="Delete",t.Resources.DeleteWorkItems="Delete work item(s)",t.Resources.DeleteWorkItemsConfirmation="Are you sure you want to delete the selected work item(s)?",t.Resources.DeleteWorkItemsRestore="You can restore deleted work items from the Recycle Bin.",t.Resources.DeletingWorkItems="Deleting work item(s)",t.Resources.DeletingFailedMessage="Failed to delete work item(s): {0}",t.Resources.DescriptionLabel="Description",t.Resources.DuplicateFieldsErrorMessage="You cannot edit the same field with multiple values.",t.Resources.EditWorkItems="Edit work items",t.Resources.EditWorkItemsNotes="Click to add Notes for History",t.Resources.EditWorkItemsNotesAriaLabel="Work item history notes",t.Resources.EmailWorkItemsLimit="* Only the first {0} work items are retrieved for the email.",t.Resources.ErrorSendingEmail="Error sending email",t.Resources.FalseString="False",t.Resources.FieldColumn="Field*",t.Resources.IterationPathLabel="Iteration path",t.Resources.KeepCurrentTypesOption="Keep current type(s)",t.Resources.Loading="Loading",t.Resources.IncludeAttachments="Include existing attachments",t.Resources.IncludeChildren="Include child work items",t.Resources.IncludeLinks="Include existing links",t.Resources.InsertNewField="Insert new field",t.Resources.InsertSharedSteps="Insert Shared Steps",t.Resources.MoveWorkItem="Move work item",t.Resources.MoveSourceWorkItemBlockedCase="Work item type {0} cannot be moved because it is disabled, hidden or not supported in the source project {1}.",t.Resources.MoveTargetWorkItemBlockedCase="Work item type {0} cannot be moved because it is disabled, hidden or not supported in the destination project {1}.",t.Resources.MoveToPositionTitle="Move to column position",t.Resources.MoveWorkItemBulkTypeError="Work item type(s) {0} may not exist in {1}.  Change the type of all selected work items below, or exit the dialog and move work items separately.",t.Resources.MoveToProjectReasonLabel="Add a reason for moving the work item",t.Resources.MovingWorkItems="Moving work items...",t.Resources.NameLabel="Name",t.Resources.Note="Note",t.Resources.NoWorkItems="The query you selected does not return any work items. Select a query that contains at least one work item, and try again.",t.Resources.OK="OK",t.Resources.Project="Project",t.Resources.SelectAWorkItemType="Select a work item type",t.Resources.ProjectDropdownLabel="Destination project",t.Resources.ProjectDropdownPlaceholder="Select a project",t.Resources.RemoveField="Remove this field",t.Resources.RemoveFieldsButtonLabel="Remove unmodified fields",t.Resources.RemoveTagsFormat="{0} (Remove)",t.Resources.RequiredLabel="Required",t.Resources.InvalidPosition="Invalid position. Choose a value between 1 and {0}",t.Resources.SaveLabel="Save",t.Resources.SaveTemplateMessage="Save the template in order to enable Copy link.",t.Resources.Search="Search",t.Resources.SelectAPositionPrompt="Select a position between 1 and {0}",t.Resources.SelectedWorkItems="Selected Work Items",t.Resources.Send="Send",t.Resources.Sending="Sending",t.Resources.SendMailNotEnabled="Sending email is not enabled. Please contact your administrator.",t.Resources.SendWorkItems="Send work items in email",t.Resources.Subject="Subject",t.Resources.TeamLabel="Team",t.Resources.TitleLabel="Title",t.Resources.TitleSearchTooltip="You can enter a partial title or exact match",t.Resources.To="To",t.Resources.TrueString="True",t.Resources.Type="Type",t.Resources.UnsavedChanges="Unsaved Changes",t.Resources.UnsavedChangesMessage="Leaving this page will discard the email.  Are you sure you want to discard these changes",t.Resources.UnsavedQueryMessage="You have unsaved changes made to the query. Save the modified query before proceeding.",t.Resources.UpdatingWorkItems="Updating work items...",t.Resources.ValueColumn="Value",t.Resources.WorkItemTemplate="Templates",t.Resources.WorkItemTemplateCapture="Capture...",t.Resources.WorkItemType="Work item type",t.Resources.UnsavedChangesDirtyDialog="You have unsaved changes that will be lost:",t.Resources.EditorDirtyDialog="Are you sure you want to leave the page?",t.Resources.EditorDirtyDialogMessage="You can save your changes, discard your changes, or cancel to continue editing.",t.Resources.DiscardChanges="Discard changes",t.Resources.SaveChanges="Save changes",t.Resources.RevertQuery="Query: {0}",t.Resources.UntitledQuery="Untitled query",t.Resources.NoProjectSpecifiedMessage="No project is available",function(e){te=t[e]={};class i extends o.RestClientBase{constructor(e){super(e)}async sendMail(e,t){return this.beginRequest({apiVersion:"5.0-preview.1",method:"POST",routeTemplate:"{project}/_apis/wit/sendMail",routeValues:{project:t},body:e})}}t[e].WorkItemTrackingClientName="WorkItemDialogs-Wit.IWorkItemTrackingRestClient",t[e].getWorkItemTrackingClient=function(s,o){return s.getRestClient(t[e].WorkItemTrackingClientName,o)},s.RestClients.add(t[e].WorkItemTrackingClientName,{factory:i,options:{serviceInstanceType:"00025394-6065-48ca-87d9-7f5672854ef7"}})}("clientsWorkItemTracking"),function(e){se=t[e]={};class o extends s.VssService{constructor(){super(...arguments),this.teamId=new r.ObservableValue(""),this.parentBacklogLevel=new r.ObservableValue(""),this.errorText=new r.ObservableValue(""),this.isBusy=new r.ObservableValue(!1),this.topLevelWorkItems=new r.ObservableValue([]),this.parentWorkItems=new r.ObservableValue([]),this.newParentId=new r.ObservableValue(void 0),this.backlogLevels={},this.workItems=[],this.busyCount=0,this.getErrorText=()=>this.errorText,this.getTeamId=()=>this.teamId,this.getIsBusy=()=>this.isBusy,this.setTeamId=e=>{this.teamId.value=e,this.updateObservables()},this.getParentBacklogLevelId=()=>this.parentBacklogLevel,this.getTopLevelWorkItems=()=>this.topLevelWorkItems,this.getParentWorkItems=()=>this.parentWorkItems,this.initialize=(e,t)=>{this.increaseBusyCount(),this.teamId.value=t,this.workItems=e,this.updateObservables(),this.decreaseBusyCount()},this.setWorkItems=e=>{this.workItems=e,this.updateObservables()},this.getNewParentId=()=>this.newParentId,this.setNewParentId=e=>{this.newParentId.value=e},this.updateObservables=()=>{this.getBacklogLevels().then((e=>{this.updateTopLevelWorkItems().then((()=>{this.updateParentWorkItems()}))}))},this.updateParentWorkItems=async()=>{var e,t;this.increaseBusyCount();const s=this.pageContext.getService("work-item-service"),o=null!==(t=null===(e=(0,i.getTFSProject)(this.pageContext))||void 0===e?void 0:e.id)&&void 0!==t?t:"",r={team:"",teamId:this.teamId.value,project:o,projectId:o},c=(0,l.getWorkClient)(this.pageContext);try{const e=await c.getBacklogLevelWorkItems(r,this.parentBacklogLevel.value);if(e&&e.workItems){const t=e.workItems.map((e=>e.target.id)),i=[n.CoreFieldRefNames.TeamProject,n.CoreFieldRefNames.Title,n.CoreFieldRefNames.WorkItemType],r=(await Promise.all(s.loadWorkItems(o,t,i))).flat();this.parentWorkItems.value=r,this.newParentId.value=void 0}}catch(e){this.parentWorkItems.value=[],this.newParentId.value=void 0,this.errorText.value=(0,a.format)(ee.ChangeParentErrorLoadingParentWorkItemsMessage,e)}this.decreaseBusyCount()},this.getBacklogLevels=()=>{if(this.teamId.value&&!this.backlogLevels[this.teamId.value]){this.increaseBusyCount();const e=(0,l.getWorkClient)(this.pageContext),t=(0,i.getTFSProject)(this.pageContext);this.backlogLevels[this.teamId.value]=e.getBacklogs({project:"",projectId:null==t?void 0:t.id,team:"",teamId:this.teamId.value}).then((e=>e.sort(((e,t)=>t.rank-e.rank)))),this.decreaseBusyCount()}return this.backlogLevels[this.teamId.value]},this.updateTopLevelWorkItems=async()=>{this.increaseBusyCount(),this.getBacklogLevels().then((e=>{let t=e.length,s=[];for(const o of this.workItems){const i=c(e,o[n.CoreFieldRefNames.WorkItemType]);i<t&&(s=[],t=i),i==t&&s.push(o)}this.topLevelWorkItems.value=s,t>0&&t<e.length?this.parentBacklogLevel.value=e[t-1].id:(this.parentBacklogLevel.value="",this.errorText.value=ee.ChangeParentNoViableBacklogLevel)}),(e=>{this.parentBacklogLevel.value="",this.topLevelWorkItems.value=[],this.errorText.value=(0,a.format)(ee.ChangeParentErrorLoadingParentWorkItemsMessage,e)})),this.decreaseBusyCount()},this.increaseBusyCount=()=>{this.busyCount++,this.busyCount>0&&(this.isBusy.value=!0)},this.decreaseBusyCount=()=>{this.busyCount--,this.busyCount<=0&&(this.isBusy.value=!1)}}}function c(e,t){for(let s=0;s<e.length;s++)for(let o=0;o<e[s].workItemTypes.length;o++)if(e[s].workItemTypes[o].name===t)return s;return e.length}s.Services.add("IChangeParentService",{serviceFactory:o}),t[e].getChangeParentService=function(e){return e.getService("IChangeParentService")}}("ServicesChangeParentService"),function(e){oe=t[e]={};const s=new Set([n.CoreFieldRefNames.AreaId,n.CoreFieldRefNames.AttachedFileCount,n.CoreFieldRefNames.AuthorizedAs,n.CoreFieldRefNames.AuthorizedDate,n.CoreFieldRefNames.BoardColumn,n.CoreFieldRefNames.BoardColumnDone,n.CoreFieldRefNames.BoardLane,n.CoreFieldRefNames.ChangedBy,n.CoreFieldRefNames.CreatedBy,n.CoreFieldRefNames.ChangedDate,n.CoreFieldRefNames.CreatedDate,n.CoreFieldRefNames.ExternalLinkCount,n.CoreFieldRefNames.History,n.CoreFieldRefNames.HyperLinkCount,n.CoreFieldRefNames.Id,n.CoreFieldRefNames.IterationId,n.CoreFieldRefNames.LinkType,n.CoreFieldRefNames.NodeName,n.CoreFieldRefNames.RelatedLinkCount,n.CoreFieldRefNames.Rev,n.CoreFieldRefNames.RevisedDate,n.CoreFieldRefNames.TeamProject,n.CoreFieldRefNames.Watermark,n.CoreFieldRefNames.WorkItemType,n.CoreFieldRefNames.IsDeleted,n.OobFieldRefNames.BacklogPriority,n.OobFieldRefNames.StackRank,n.OobFieldRefNames.ActivatedBy,n.OobFieldRefNames.ActivatedDate,n.OobFieldRefNames.ClosedBy,n.OobFieldRefNames.ClosedDate,n.OobFieldRefNames.ResolvedBy,n.OobFieldRefNames.ResolvedDate,n.OobFieldRefNames.StateChangeDate,"System.PersonId"]);class o extends m.VssComponent{constructor(e,t){super(e,t),this.fields=new r.ObservableArray([]),this.fieldToAllowedValues=new Map,this.onClausesChanged=()=>{this.validate()},this.columns=[{id:"add-remove",readonly:!0,width:76,renderCell:(e,t,s,o)=>c.createElement(g.SimpleTableCell,{columnIndex:t,tableColumn:s,key:o.id+"-col-"+t},c.createElement(d.Button,{ariaLabel:ee.InsertNewField,className:"add-line-button",iconProps:{iconName:"Add"},tooltipProps:{text:ee.InsertNewField},onClick:()=>{this.props.clauses.splice(e,0,{allowedValues:new r.ObservableArray([]),field:new r.ObservableValue(void 0),id:(0,a.newGuid)(),value:new r.ObservableValue("")}),this.validate()}}),c.createElement(d.Button,{ariaLabel:ee.RemoveField,className:"remove-line-button",iconProps:{iconName:"Cancel"},tooltipProps:{text:ee.RemoveField},onClick:()=>{this.props.clauses.splice(e,1),this.validate()}}))},{id:"field",name:ee.FieldColumn,width:-40,renderCell:(e,t,s,o)=>{var i,r;return c.createElement(g.SimpleTableCell,{columnIndex:t,key:"field-"+o.id},c.createElement(p.FormItem,{className:"field-form-item"},c.createElement(u.EditableDropdown,{allowTextSelection:!0,className:"field-editable-dropdown",items:this.fields,onValueChange:e=>this.onFieldValueChange(o,e),selectedText:null!==(r=null===(i=o.field.value)||void 0===i?void 0:i.name)&&void 0!==r?r:""})))}},{id:"operator",width:34,renderCell:(e,t,s,o)=>c.createElement(g.SimpleTableCell,{columnIndex:t,key:"operator-"+o.id,contentClassName:"justify-center"},"=")},{id:"value",name:ee.ValueColumn,width:-60,renderCell:(e,t,s,o)=>c.createElement(g.SimpleTableCell,{columnIndex:t,key:"value-"+o.id},c.createElement(p.FormItem,{className:"flex-grow"},c.createElement(h.Observer,{allowedValues:o.allowedValues,selectedField:o.field},(e=>c.createElement(C.WorkItemFieldControl,{allowedValues:e.allowedValues,disabled:!e.selectedField,fieldEntry:e.selectedField,initialValue:o.value.value,key:o.id,onChange:e=>{e!==o.value.value&&(o.value.value=e,o.dirty=!0,this.validate())}})))))}],this.updateAvailableFields(),this.state={}}componentDidMount(){this.validate(),this.props.clauses.subscribe(this.onClausesChanged)}componentDidUpdate(e){this.props.fields!==e.fields&&this.updateAvailableFields()}componentWillUnmount(){this.props.clauses.unsubscribe(this.onClausesChanged)}render(){return c.createElement("div",{className:"flex-grow bulk-edit-table-container rhythm-vertical-16"},this.state.errorMessage&&c.createElement("div",{className:"flex-row flex-center rhythm-horizontal-8"},c.createElement(v.Status,Object.assign({},v.Statuses.Failed,{key:"error",size:"16"})),c.createElement("span",{className:"error-text"},this.state.errorMessage)),c.createElement(g.Table,{className:"bulk-edit-table",columns:this.columns,itemProvider:this.props.clauses,spacerWidth:0}),c.createElement("div",{className:"padding-bottom-16"},c.createElement(d.Button,{iconProps:{iconName:"Add"},onClick:()=>{this.props.clauses.push({allowedValues:new r.ObservableArray([]),id:(0,a.newGuid)(),field:new r.ObservableValue(void 0),value:new r.ObservableValue("")}),this.validate()},text:ee.AddField})))}updateAvailableFields(){const e=this.props.fields.filter((e=>!i(e))),t=this.addTagFields(e);t.sort(((e,t)=>(0,a.localeIgnoreCaseComparer)(e.name,t.name))),this.fields.value=t.map((e=>({id:e.id.toString(),text:e.name,data:e})))}async onFieldValueChange(e,t){const s=null==t?void 0:t.data;if(e.field.value=t?t.data:void 0,e.value.value="",e.dirty=!0,s){let t=this.fieldToAllowedValues.get(s.referenceName);!t&&this.props.getAllowedValues&&(t=this.props.getAllowedValues(s));const o=await t;if(o){const t=e.allowedValues;t.splice(0,t.length,...o)}}this.validate()}validate(){let e,t=!!this.props.clauses.length;const s=new Set;for(const o of this.props.clauses.value)if(o.field.value){if(s.has(o.field.value.referenceName)){t=!1,e=ee.DuplicateFieldsErrorMessage;break}s.add(o.field.value.referenceName)}else t=!1;return e!==this.state.errorMessage&&this.setState({errorMessage:e}),this.props.onValidate&&this.props.onValidate(t),t}addTagFields(e){const t=[];for(const s of e)s.referenceName===n.CoreFieldRefNames.Tags?(t.push(Object.assign(Object.assign({},s),{name:(0,a.format)(ee.AddTagsFormat,s.name),referenceName:I.AddTagsPseudoRefName})),t.push(Object.assign(Object.assign({},s),{name:(0,a.format)(ee.RemoveTagsFormat,s.name),referenceName:I.RemoveTagsPseudoRefName}))):t.push(s);return t}}function i(e){const t=e.referenceName,o=e.usages&n.FieldUsages.WorkItem;if(!function(e){if(e.referenceName===n.CoreFieldRefNames.AreaPath||e.referenceName===n.CoreFieldRefNames.IterationPath)return!0;return!function(e){return l(e,n.FieldFlags.Computed)}(e)}(e)||!o||l(e,n.FieldFlags.Ignored))return!0;if(s.has(t))return!0;if(["Microsoft.VSTS.TCM.ReproSteps","Microsoft.VSTS.TCM.SystemInfo","Microsoft.VSTS.Common","Microsoft.VSTS.CMMI"].some((e=>(0,a.startsWith)(t,e,!0))))return!1;return!!["System.AreaLevel","System.IterationLevel","Microsoft.VSTS.TCM","Microsoft.VSTS.Build","Microsoft.VSTS.CodeReview","Microsoft.VSTS.Feedback"].some((e=>(0,a.startsWith)(t,e,!0)))||!!["ExtensionMarker"].some((e=>(0,a.endsWith)(t,e,!0)))}function l(e,t){return(e.flags&+t)!==n.FieldFlags.None}t[e].BulkEditFieldsTable=o,t[e].isExcludedFromBulkEdit=i}("ComponentsBulkEditFieldsTable"),function(e){t[e]={};class s extends f.TfsComponent{constructor(e,t){super(e,t),this.clauses=new r.ObservableArray([{allowedValues:new r.ObservableArray([]),id:(0,a.newGuid)(),field:new r.ObservableValue(void 0),value:new r.ObservableValue("")}]),this.historyNotes=new r.ObservableValue(""),this.projectToTypes=new Map,this.allowedValuesProjectId="",this.getAllowedValues=async e=>{if(e.referenceName===n.CoreFieldRefNames.AreaPath||e.referenceName===n.CoreFieldRefNames.IterationPath)return Promise.resolve([]);if(e.type===n.FieldType.Boolean)return Promise.resolve([ee.TrueString,ee.FalseString]);const t=[];for(const[s,o]of this.projectToTypes)t.push(this.getAllowedValuesForTypes(s,[...o],e.referenceName));const s=(await Promise.all(t)).reduce(((e,t)=>e.concat(t)));return[...new Set(s)].sort()},this.onSave=async()=>{if(!(this.state.isValid||this.state.hasComments))return;const e=new Map,t=[];if(this.state.isValid)for(const e of this.clauses.value)e.field.value&&t.push({fieldName:e.field.value.referenceName,value:e.value.value});""!==this.historyNotes.value&&t.push({fieldName:n.CoreFieldRefNames.History,value:this.historyNotes.value}),e.set(y.BulkUpdateConstants.AllTypes,t),this.setState({working:!0});const s=this.props.selectedItems.map((e=>Number(e[n.CoreFieldRefNames.Id]))).filter((e=>e)),o=await(0,S.performBulkUpdate)(this.context.pageContext,s,e);this.setState({working:!1}),this.props.onModifyItems&&this.props.onModifyItems(o),this.props.onDismiss()},this.onValidate=e=>{e!==this.state.isValid&&this.setState({isValid:e})},this.state={selectedTypeFields:[],isValid:!1,working:!0,hasComments:!1}}async componentDidMount(){var e;const t=this.context.pageContext.getService("ITfsProjectService"),s=await t.getAllProjectsLoadedPromise(),o=new Map;for(const e of s)o.set(e.name,e.id);for(const e of this.props.selectedItems){const t=e[n.CoreFieldRefNames.TeamProject],s=e[n.CoreFieldRefNames.WorkItemType],i=o.get(t);if(i){const e=this.projectToTypes.get(i);e?e.add(s):this.projectToTypes.set(i,new Set([s]))}}const i=null===(e=this.projectData)||void 0===e?void 0:e.id;i&&this.projectToTypes.has(i)?this.allowedValuesProjectId=i:this.projectToTypes.size>0?this.allowedValuesProjectId=this.projectToTypes.keys().next().value:this.allowedValuesProjectId="";const r=[],a=this.context.pageContext.getService("IWorkItemTypesService");for(const[e,t]of this.projectToTypes)r.push(a.getWorkItemTypeData(e,[...t]));const l=await Promise.all(r),c=new Set(l.reduce(((e,t)=>e.concat(t)),[]).map((e=>e.fields)).reduce(((e,t)=>e.concat(t)),[])),m=this.props.fields.filter((e=>c.has(e.id)));this.setState({selectedTypeFields:m,working:!1})}render(){const{onDismiss:e}=this.props,{selectedTypeFields:t,isValid:s,working:o,hasComments:i}=this.state,r=!o&&(s||i);return c.createElement(k.Dialog,{calloutContentClassName:"work-item-dialog",titleProps:{text:ee.EditWorkItems},onDismiss:e,footerButtonProps:[{text:ee.Cancel,onClick:e},{text:ee.OK,disabled:!r,onClick:this.onSave,primary:!0}],overlay:o?{spinnerAriaLabel:ee.UpdatingWorkItems}:void 0,resizable:!0,showCloseButton:!0},c.createElement(oe.BulkEditFieldsTable,{clauses:this.clauses,fields:t,getAllowedValues:this.getAllowedValues,onValidate:this.onValidate,projectId:this.allowedValuesProjectId}),c.createElement(b.HtmlEditor,{className:"history-input",ariaLabel:ee.EditWorkItemsNotesAriaLabel,placeholder:ee.EditWorkItemsNotes,htmlContent:this.historyNotes.value,onChange:e=>{var t;this.historyNotes.value=e;const s=(null===(t=this.historyNotes.value)||void 0===t?void 0:t.length)>0;this.setState({hasComments:s})},telemetryContext:{controlName:"HtmlEditor"},showChromeBorder:!0}))}async getAllowedValuesForTypes(e,t,s){const o=this.context.pageContext.getService("IWorkItemFieldService"),i=[];for(const r of t){const t=o.getAllowedValues(s,e,r);i.push(t)}return(await Promise.all(i)).filter((e=>e)).reduce(((e,t)=>e.concat(t)))}}t[e].BulkEditDialog=s}("ComponentsBulkEditDialog"),function(e){function s(e){e&&e()}t[e]={},t[e].ChangeParentPanel=function(e){var t,o,r;const l="workItemType.",m=null!==(o=null===(t=(0,i.getTFSProject)(e.pageContext))||void 0===t?void 0:t.id)&&void 0!==o?o:"",d=t=>{const s=t.indexOf(l),o=s+l.length;let i=t.indexOf(" ",o);-1==i&&(i=t.length);const r=t.slice(o,i);return t=t.slice(0,Math.max(0,s-1))+t.slice(i,t.length),c.createElement("div",{className:t},c.createElement(x.WorkItemTypeIconProvider,{dataProvider:new x.WorkItemTrackingDataProvider(e.pageContext),dataSource:{projectIdOrName:m,workItemTypeName:r}},(e=>c.createElement(R.WorkItemTypeIcon,{data:e,className:"icon-margin font-size-m"}))))},u=(0,se.getChangeParentService)(e.pageContext);return u.initialize(e.workItemsToChange||[],(null===(r=e.currentDirectory)||void 0===r?void 0:r.id)||""),c.createElement(h.Observer,{errorText:u.getErrorText(),topLevelWorkItems:u.getTopLevelWorkItems(),newParentId:u.getNewParentId(),isBusy:u.getIsBusy()},(t=>c.createElement(w.Panel,{titleProps:{text:ee.ChangeParentOfWorkItems},onDismiss:()=>s(e.onDismiss),description:(0,a.format)(ee.ChangeParentPanelDescription,t.topLevelWorkItems.length),footerButtonProps:[{text:ee.Cancel,onClick:()=>s(e.onDismiss)},{text:ee.ChangeParentOfSelectedWorkItems,onClick:()=>(async()=>{const t=u.getNewParentId().value;e.onChangeParent&&void 0!==t&&e.onChangeParent(u.getTopLevelWorkItems().value,t),s(e.onDismiss)})(),primary:!0,disabled:!!t.errorText||void 0===t.newParentId}]},t.isBusy&&c.createElement(W.PanelOverlay,{overlayContent:c.createElement(E.Spinner,null)}),c.createElement("div",{className:"flex-column flex-grow"},t.errorText&&c.createElement(N.MessageCard,{severity:"Error",className:"flex-noshrink margin-bottom-16"},c.createElement("div",{className:"flex-column font-size-ms"},t.errorText)),c.createElement(D.DirectoryDropdown,{selectedItem:e.currentDirectory,itemProvider:e.directoryDropdownProvider,onSelect:(e,t)=>{var s,o;u.setTeamId((null===(o=null===(s=t.data)||void 0===s?void 0:s.directory)||void 0===o?void 0:o.id)||"")}}),c.createElement(h.Observer,{teamId:u.getTeamId(),backlogLevelId:u.getParentBacklogLevelId(),parentWorkItems:u.getParentWorkItems()},(e=>c.createElement(c.Fragment,null,e.teamId&&e.backlogLevelId&&c.createElement(T.Dropdown,{items:e.parentWorkItems.map((e=>({id:e.id.toString(),text:e.fields[n.CoreFieldRefNames.Title],data:e,iconProps:{className:l+e.fields[n.CoreFieldRefNames.WorkItemType],render:d}}))),onSelect:(e,t)=>{t.data&&u.setNewParentId(t.data.id)},placeholder:ee.ChangeParentSelectNewParent,noItemsText:ee.ChangeParentNoAvailableParents}))))))))}}("ComponentsChangeParentPanel"),function(e){t[e]={};const s={id:"loading",text:ee.Loading,type:4};class o extends m.VssComponent{constructor(e,t){super(e,t),this.historyNotes=new r.ObservableValue(""),this.types=new r.ObservableArray([s]),this.selectedType="",this.validWorkItemTypes=[],this.changeWorkItemType=async()=>{this.validate();const e=(0,S.getWorkItemTypes)(this.props.selectedItems);if(!this.validatePayload(e,this.validWorkItemTypes))return;const t=new Map,s=[{fieldName:n.CoreFieldRefNames.WorkItemType,value:this.selectedType}];""!==this.historyNotes.value&&s.push({fieldName:n.CoreFieldRefNames.History,value:this.historyNotes.value}),t.set(y.BulkUpdateConstants.AllTypes,s);const o=this.props.selectedItems.map((e=>Number(e[n.CoreFieldRefNames.Id]))).filter((e=>e)),i=await(0,S.performBulkUpdate)(this.context.pageContext,o,t);this.props.onModifyItems&&this.props.onModifyItems(i),this.props.onDismiss()},this.validate=()=>{const e=!!this.selectedType;e!==this.state.isValid&&this.setState({isValid:e})},this.validatePayload=(e,t)=>{const s=e.filter((e=>t.indexOf(e)<0));return!s.length||(this.setState({errorMessage:(0,a.format)(ee.ChangeWorkItemInvalidTypeMessage,s.join(", ")),isValid:!1}),!1)},this.state={errorMessage:void 0,isValid:!1}}async componentDidMount(){var e,t,s,o;let r="";for(const e of this.props.selectedItems)if(r){if(r!==e[n.CoreFieldRefNames.WorkItemType]){r="";break}}else r=e[n.CoreFieldRefNames.WorkItemType];const a=null!==(s=null===(t=null===(e=(0,i.getTFSPageData)(this.context.pageContext))||void 0===e?void 0:e.project)||void 0===t?void 0:t.id)&&void 0!==s?s:null===(o=this.props)||void 0===o?void 0:o.workItemProjectId;if(!a)throw new Error(ee.NoProjectSpecifiedMessage);const l=this.context.pageContext.getService("IWorkItemTypesService");this.validWorkItemTypes=await l.getVisibleWorkItemTypes(a),this.types.value=this.validWorkItemTypes.filter((e=>e!==r)).map((e=>({id:e,text:e})))}render(){const{errorMessage:e,isValid:t}=this.state;return c.createElement(k.Dialog,{titleProps:{text:ee.ChangeWorkItemType},onDismiss:this.props.onDismiss,footerButtonProps:[{text:ee.Cancel,onClick:this.props.onDismiss},{disabled:!t,text:ee.OK,onClick:()=>this.changeWorkItemType(),primary:!0}],resizable:!0,showCloseButton:!0},c.createElement("div",{className:"rhythm-vertical-16"},e&&c.createElement(N.MessageCard,{severity:"Error"},e),c.createElement(p.FormItem,{label:ee.Type},c.createElement(T.Dropdown,{items:this.types,className:"change-type-dialog-dropdown",placeholder:ee.SelectAWorkItemType,onSelect:(e,t)=>{this.selectedType=t.text||"",this.validate()}})),c.createElement(p.FormItem,{label:ee.ChangeTypeReason},c.createElement(b.HtmlEditor,{className:"history-input",ariaLabel:ee.EditWorkItemsNotesAriaLabel,placeholder:ee.EditWorkItemsNotes,htmlContent:this.historyNotes.value,onChange:e=>{this.historyNotes.value=e},telemetryContext:{controlName:"HtmlEditor"},showChromeBorder:!0})),c.createElement(P.Link,{href:"https://go.microsoft.com/fwlink/p/?LinkID=746668",target:"_blank"},ee.ChangeTypeLink,c.createElement(F.Icon,{iconName:"NavigateExternalInline"}))))}}t[e].ChangeTypeDialog=o}("ComponentsChangeTypeDialog"),function(e){ie=t[e]={};const s="WorkItemForm/WifDialog/FullScreen";class o extends f.TfsComponent{constructor(e,t){var o;super(e,t),this._setPreviousId=async()=>{this._activeWorkItemService=this.context.pageContext.getService("ms.vss-work-web.active-work-item-service"),this._activeWorkItemService.activeWorkItem&&(this._previousActiveId=await this._activeWorkItemService.activeWorkItem.id)},this._onRegisterTryShowSaveDialog=e=>{this.tryShowSaveDialog=e},this._onDismiss=async()=>{if(this.tryShowSaveDialog){if(!(await this.tryShowSaveDialog()).canDismiss)return}await this._onInternalDismiss()},this._onInternalDismiss=async()=>{if(this.props.onDismiss(),this._activeWorkItemService&&void 0!==this._previousActiveId){const e=this.context.pageContext.getService("IWorkItemModelService"),t=await e.getWorkItem(this._previousActiveId);this._activeWorkItemService.setActiveWorkItem(t)}},this.onToggleFullscreen=()=>{const e=this.state.fullscreen;this.setState({fullscreen:!e}),this._settingsService.setEntries({[s]:!e},0)},this._settingsService=this.context.pageContext.getService("ISettingsService"),this.state={fullscreen:null!==(o=this._settingsService.getEntry(s,0))&&void 0!==o&&o,defaultFocusableElementAriaLabel:""},this._setPreviousId(),this._setCurrentWorkItem()}componentDidMount(){this._setAriaLabelForDefaultFocusableElement()}render(){return c.createElement(k.CustomDialog,{calloutContentClassName:(0,m.css)("work-item-form-dialog",this.state.fullscreen&&"fullscreen"),contentSize:3,escDismiss:!0,lightDismiss:!1,resizable:!this.state.fullscreen,onDismiss:this._onDismiss,defaultFocusableElementAriaLabel:this.state.defaultFocusableElementAriaLabel,selectInputTextOnFocus:!0},c.createElement(i,Object.assign({},this.props,{onDismiss:this._onInternalDismiss,onRegisterTryShowSaveDialog:this._onRegisterTryShowSaveDialog,onToggleFullscreen:this.onToggleFullscreen})))}async _setAriaLabelForDefaultFocusableElement(){if(!this._currentWorkItem)return;const e=await this._currentWorkItem;e&&this.setState({defaultFocusableElementAriaLabel:`${e.getCaption()} ${e.getTitle()}`})}_setCurrentWorkItem(){const{workItem:e}=this.props,{workItemId:t}=this.props,s=this.context.pageContext.getService("IWorkItemModelService");e?this._currentWorkItem=e:t&&(this._currentWorkItem=s.getWorkItem(t))}}t[e].WorkItemFormDialog=o;const i=e=>c.createElement(m.WrappedComponent,Object.assign({},e,{dependencies:["ms.vss-work-web.work-item-form-dependencies"],loadingComponent:()=>c.createElement("div",{className:"work-item-form-loading-placeholder flex-column justify-center"},c.createElement("div",{className:"full-width flex-row justify-end"},c.createElement(d.Button,{ariaLabel:ee.CloseLabel,iconProps:{iconName:"ChromeClose"},onClick:()=>e.onDismiss(),subtle:!0,tooltipProps:{text:ee.CloseLabel}})),c.createElement("div",{className:"flex-grow flex-row justify-center"},c.createElement(E.Spinner,null))),wrappedType:"work-item-form-view-component"}));m.Components.add("work-item-form-dialog",o)}("ComponentsWorkItemFormDialog"),function(e){t[e]={};class s extends m.VssComponent{constructor(e,t){super(e,t),this._observable=new r.ObservableValue(void 0),this._error=new r.ObservableValue(void 0),this._initialize()}async _initialize(){const e=this.props.selectedItem[n.CoreFieldRefNames.Id];try{const t=this.context.pageContext.getService("ITfsProjectService"),s=await t.getAllProjectsLoadedPromise(),o=this.context.pageContext.getService("IWorkItemModelService"),i=this.context.pageContext.getService("IWorkItemTypesService"),[r]=await o.getWorkItems([e]),a=s.find((e=>e.name===this.props.selectedItem[n.CoreFieldRefNames.TeamProject])),l=a&&await i.getWorkItemTypeData(a.id,[this.props.selectedItem[n.CoreFieldRefNames.WorkItemType]]);if(a&&l){const e=await r.copy(this.context.pageContext,a.id,l[0],!1,!1,!1,[n.DalFields.TitleId]);this._observable.value=e}}catch(t){console.error("%O",t),this._error.value=t.message||String(t),(0,V.traceException)(this.context.pageContext,"WIT","CloneWorkItem",t,{workItemId:e})}}render(){return c.createElement(h.Observer,{error:this._error,item:this._observable},(({error:e,item:t})=>t?c.createElement(ie.WorkItemFormDialog,{workItem:t,onDismiss:this.props.onDismiss}):e?c.createElement(k.Dialog,{footerButtonProps:[{text:ee.OK,onClick:()=>this.props.onDismiss()}],lightDismiss:!1,titleProps:{text:ee.CloneWorkItemError},onDismiss:this.props.onDismiss},e):c.createElement(k.Dialog,{lightDismiss:!1,titleProps:{text:ee.CloningWorkItem},onDismiss:this.props.onDismiss},c.createElement(E.Spinner,{size:"large"}))))}}t[e].CloneWorkItemDialog=s}("ComponentsCloneWorkItemDialog"),function(e){t[e]={};function s({title:e,message:t,primaryButtonText:s,onConfirm:o,onDismiss:i}){return c.createElement(k.Dialog,{showCloseButton:!0,titleProps:{text:e},lightDismiss:!1,onDismiss:i,footerButtonProps:[{primary:!0,className:"ok-button",onClick:o,text:s}]},t)}t[e].ConfirmButtonDialog=s,t[e].showConfirmationDialog=function(e,t,o,i,r){e.getService("IVssLayoutManager").renderCallout((e=>s({title:i,message:t,primaryButtonText:o,onConfirm:()=>{r&&r(),e()},onDismiss:e})))}}("ComponentsConfirmationDialog"),function(e){t[e]={};class s extends m.VssComponent{constructor(e,t){super(e,t),this._projectSelection=new j.DropdownSelection,this._workItemTypeSelection=new j.DropdownSelection,this._includeLinks=new r.ObservableValue(!1),this._includeAttachments=new r.ObservableValue(!1),this._includeChildren=new r.ObservableValue(!1),this._projectWorkItemTypes={},this.copyWorkItemExcludedCategories=[L.WorkItemCategoryConstants.hidden,L.WorkItemCategoryConstants.testPlan,L.WorkItemCategoryConstants.testSuite,L.WorkItemCategoryConstants.testSharedStep,L.WorkItemCategoryConstants.testSharedParameter],this._copyWorkItem=async()=>{const e=this.props.selectedItem[n.CoreFieldRefNames.Id],t=this._includeLinks.value,s=this._includeAttachments.value,i=this._includeChildren.value;this.setState({working:!0});try{const r=this.context.pageContext.getService("IWorkItemModelService"),a=this.context.pageContext.getService("IWorkItemTypesService"),[l]=await r.getWorkItems([e]),n=o(this._projectSelection),m=void 0!==n&&this._projects.value[n].id,d=o(this._workItemTypeSelection),u=void 0!==d&&this.state.workItemTypes&&this.state.workItemTypes[d].id,p=u&&m&&await a.getWorkItemTypeData(m,[u]);if(m&&p){let e;e=i?await l.copyWithChildren(this.context.pageContext,m,p[0],t,s):await l.copy(this.context.pageContext,m,p[0],t,s);this.context.pageContext.getService("IVssLayoutManager").renderCallout((t=>c.createElement(ie.WorkItemFormDialog,{workItem:e,onDismiss:t}))),this.props.onDismiss()}}catch(o){console.error("%O",o),this.setState({error:o.message||String(o),working:!1}),(0,V.traceException)(this.context.pageContext,"WIT","CopyWorkItem",o,{workItemId:e,includeChildren:i,includeLinks:t,includeAttachments:s})}},this._initialize(),this.state={loadingTypes:!0,working:!1,workItemTypes:void 0}}async _initialize(){const e=this.context.pageContext.getService("ITfsProjectService");this._projects=e.getAllProjects(),await e.getAllProjectsLoadedPromise();const t=this._projects.value.findIndex((e=>e.name===this.props.selectedItem[n.CoreFieldRefNames.TeamProject]));this._projectSelection.select(t>=0?t:0),this._getWorkItemTypes(this._projects.value[t].id)}render(){return c.createElement(k.Dialog,{className:"copy-work-item-dialog",escDismiss:!0,footerButtonProps:[{disabled:this.state.working,text:ee.Cancel,onClick:this.props.onDismiss},{disabled:this.state.loadingTypes||this.state.working,primary:!0,text:ee.Copy,onClick:this._copyWorkItem}],lightDismiss:!1,overlay:this.state.working?{spinnerAriaLabel:ee.Copying}:void 0,resizable:!0,showCloseButton:!0,titleProps:{text:ee.CopyWorkItemDialogTitle},onDismiss:this.props.onDismiss},c.createElement(h.Observer,{ready:this._projects.ready},(({ready:e})=>e?c.createElement("div",{className:"rhythm-vertical-16"},this.state.error&&c.createElement(N.MessageCard,{severity:"Error"},this.state.error),c.createElement("div",null,(0,a.format)(ee.CopyWorkItemDialogText,this.props.selectedItem[n.CoreFieldRefNames.WorkItemType],this.props.selectedItem[n.CoreFieldRefNames.Id],this.props.selectedItem[n.CoreFieldRefNames.Title])),c.createElement(p.FormItem,{label:ee.Project},c.createElement(T.Dropdown,{ariaLabel:ee.Project,disabled:this.state.loadingTypes,items:this._projects.value.map((e=>({text:e.name,id:e.id}))),selection:this._projectSelection,onSelect:(e,t)=>{this._getWorkItemTypes(t.id)}})),c.createElement(p.FormItem,{label:ee.WorkItemType},c.createElement(T.Dropdown,{ariaLabel:ee.WorkItemType,disabled:this.state.loadingTypes,items:this.state.workItemTypes||[],selection:this._workItemTypeSelection,onSelect:(e,t)=>{this._lastSelectedWorkItemType=t.id}})),c.createElement("div",null,c.createElement("div",null,c.createElement(A.Checkbox,{checked:this._includeLinks,label:ee.IncludeLinks,onChange:(e,t)=>this._includeLinks.value=t})),c.createElement("div",null,c.createElement(A.Checkbox,{checked:this._includeAttachments,label:ee.IncludeAttachments,onChange:(e,t)=>this._includeAttachments.value=t})),c.createElement("div",null,c.createElement(A.Checkbox,{checked:this._includeChildren,label:ee.IncludeChildren,onChange:(e,t)=>this._includeChildren.value=t})))):c.createElement(E.Spinner,null))))}async _getWorkItemTypes(e){if(!this._projectWorkItemTypes[e]){this.state.loadingTypes||this.setState({loadingTypes:!0});const t=this.context.pageContext.getService("IWorkItemTypesService"),s=await t.getWorkItemTypes(e,this.copyWorkItemExcludedCategories);this._projectWorkItemTypes[e]=s}this._setWorkItemTypes()}_setWorkItemTypes(){const e=o(this._projectSelection);if(void 0!==e){const t=this._projects.value[e].id,s=this._projectWorkItemTypes[t];if(s){this.setState({loadingTypes:!1,workItemTypes:s.map((e=>({id:e,text:e})))});const e=this._lastSelectedWorkItemType||this.props.selectedItem[n.CoreFieldRefNames.WorkItemType],t=s.indexOf(e);this._workItemTypeSelection.select(t>=0?t:0)}}}}function o(e){return e.value&&e.value.length>0?e.value[0].beginIndex:void 0}t[e].CopyWorkItemDialog=s}("ComponentsCopyWorkItemDialog"),t[ae="ComponentsDeleteDialog"]={},t[ae].DeleteDialog=function({onDeleteItems:e,onDeleteFinished:t,onDeletionFailed:s,onDismiss:o,selectedItems:i}){const r=(0,m.usePageContext)(),[l,d]=(0,c.useState)(!1),u=(0,c.useRef)([]),[p,h]=(0,c.useState)(void 0),v=async()=>{d(!0);const l=function(e,t){const s=[];for(let o=0;o<e.length;o+=t)s.push(e.slice(o,o+t));return s}(i,200).map((async t=>{const{successes:o,failures:i}=await async function(e,t){const s=t.map((e=>e[n.CoreFieldRefNames.Id])).filter((e=>!!e)),o=e.getService("IVssContributionService"),i=await o.getDataAsync("ms.vss-work-web.delete-work-items-data-provider",{ids:s});return i?{successes:i.successes.map((e=>t.find((t=>t[n.CoreFieldRefNames.Id]===e)))).filter((e=>!!e)),failures:i.failures.map((e=>t.find((t=>t[n.CoreFieldRefNames.Id]===e)))).filter((e=>!!e))}:{successes:[],failures:t}}(r,t);null==e||e(o),i.length>0&&(s?s(i):u.current.push(...i.map((e=>e[n.CoreFieldRefNames.Id])).filter((e=>!!e))))}));await Promise.all(l),null==t||t(),d(!1),u.current.length>0?h((0,a.format)(ee.DeletingFailedMessage,u.current.join(", "))):null==o||o()};return c.createElement(k.Dialog,{titleProps:{text:ee.DeleteWorkItems},onDismiss:()=>null==o?void 0:o(),footerButtonProps:[{text:ee.Cancel,onClick:()=>null==o?void 0:o()},{text:ee.DeleteSelectedWorkItems,onClick:()=>v(),primary:!0,disabled:l||!!p}],showCloseButton:!0,overlay:l?{spinnerLabel:ee.DeletingWorkItems}:void 0},p?c.createElement(N.MessageCard,{severity:"Warning"},p):null,c.createElement("div",{className:"scroll-auto flex-grow flex-row"},c.createElement(F.Icon,{className:"delete-dialog-warning-icon",iconName:"IncidentTriangle",size:"large"}),c.createElement("div",null,c.createElement("p",null,ee.DeleteWorkItemsConfirmation),c.createElement("p",null,ee.DeleteWorkItemsRestore))))},function(e){t[e]={};t[e].EditorDirtyDialog=({onDismiss:e,onLeave:t,onSave:s,query:o})=>{const[i,r]=c.useState(void 0);return c.createElement(k.Dialog,{footerButtonProps:[{text:ee.Cancel,onClick:e},{text:ee.DiscardChanges,onClick:t},{text:ee.SaveChanges,onClick:()=>{try{s()}catch(e){r(e.message)}},primary:!0}],onDismiss:e,resizable:!0,titleProps:{text:ee.EditorDirtyDialog}},c.createElement("div",{className:"flex-column rhythm-vertical-8"},i&&c.createElement(N.MessageCard,{severity:"Error"},i),c.createElement("span",null,ee.UnsavedChangesDirtyDialog),c.createElement("span",null,(0,a.format)(ee.RevertQuery,o?o.name:ee.UntitledQuery)),c.createElement("span",null,ee.EditorDirtyDialogMessage)))}}("ComponentsEditorDirtyDialog"),function(e){t[e]={};class s extends f.TfsComponent{constructor(e,t){var s,o,i,a;super(e,t),this.team=new r.ObservableValue(""),this.teams=new r.ObservableArray([]),this.clauses=new r.ObservableArray([]),this.historyNotes=new r.ObservableValue(""),this.isNewTemplate=!1,this.isTableValid=!0,this.getAllowedValues=async e=>{var t,s;if(!this.projectData||e.referenceName===n.CoreFieldRefNames.AreaPath||e.referenceName===n.CoreFieldRefNames.IterationPath)return;const o=null!==(s=null===(t=this.props.workItemTemplate)||void 0===t?void 0:t.workItemTypeName)&&void 0!==s?s:this.props.selectedItem[n.CoreFieldRefNames.WorkItemType],i=this.context.pageContext.getService("IWorkItemFieldService");return await i.getAllowedValues(e.referenceName,this.projectData.id,o)},this.removeUnmodifiedClauses=()=>{this.clauses.removeAll((e=>!e.dirty))},this.onSave=async()=>{var e,t,s,o,i,r,a;if(!this.state.isValid||!this.props.selectedItem&&!this.state.workItemTemplate)return;const l={};for(const t of this.clauses.value)if(t.field.value){const s=(0,U.isWorkItemIdentityRef)(t.value.value)?t.value.value.distinctDisplayName:null===(e=t.value.value)||void 0===e?void 0:e.toString();l[t.field.value.referenceName]=null!=s?s:""}""!==this.historyNotes.value&&(l[n.CoreFieldRefNames.History]=this.historyNotes.value);const c=null!==(s=null===(t=this.state.workItemTemplate)||void 0===t?void 0:t.workItemTypeName)&&void 0!==s?s:this.props.selectedItem[n.CoreFieldRefNames.WorkItemType],m={description:this.templateDescription.value,fields:l,id:null===(o=this.state.workItemTemplate)||void 0===o?void 0:o.id,name:this.templateName.value,workItemTypeName:c};this.setState({working:!0});const d=this.context.pageContext.getService("IWorkItemTemplateService");try{const e=null!==(r=null===(i=this.projectData)||void 0===i?void 0:i.id)&&void 0!==r?r:"",t=this.state.workItemTemplate?await d.replaceTemplate(e,null!==(a=this.props.teamId)&&void 0!==a?a:this.team.value,m):await d.createTemplate(e,this.team.value,m);this.setState({working:!1,workItemTemplate:Object.assign(Object.assign({},t),{fields:m.fields}),isValid:!1}),this.props.onSave&&this.props.onSave()}catch(e){this.setState({errorMessage:e.message,working:!1,isValid:!1})}},this.onValidateTable=e=>{this.isTableValid=e,this.validate()},this.isNewTemplate=!e.workItemTemplate,this.templateDescription=new r.ObservableValue(null!==(o=null===(s=e.workItemTemplate)||void 0===s?void 0:s.description)&&void 0!==o?o:""),this.templateName=new r.ObservableValue(null!==(a=null===(i=e.workItemTemplate)||void 0===i?void 0:i.name)&&void 0!==a?a:""),this.state={isValid:!0,selectedTypeFields:[],working:!0,workItemTemplate:e.workItemTemplate}}async componentDidMount(){var e;if(this.isNewTemplate&&this.projectData){const e=this.context.pageContext.getService("ITfsTeamService"),t=await e.getAllTeams(this.projectData.id);this.teams.value=t.sort(((e,t)=>(0,a.localeIgnoreCaseComparer)(e.name,t.name))).map((e=>({text:e.name,id:e.id})))}let t=null===(e=this.props.workItemTemplate)||void 0===e?void 0:e.fields,s=[];if(!t&&this.props.selectedItem&&this.props.selectedItem[n.CoreFieldRefNames.Id]){const e=Number(this.props.selectedItem[n.CoreFieldRefNames.Id]),o=this.context.pageContext.getService("IWorkItemModelService"),i=await o.getWorkItem(e),r=i.getFieldData();s=i.fields.map((e=>e.fieldDefinition));const a={};for(const e of Object.keys(r)){const t=Number(e),o=r[t],i=s.find((e=>e.id===Number(t)));i&&(i.id===n.CoreField.Tags?a[I.AddTagsPseudoRefName]=o:(0,oe.isExcludedFromBulkEdit)(i)||(a[i.referenceName]=o))}t=a}t&&(this.clauses.value=await this.getClausesFromFieldValues(t,!this.isNewTemplate)),this.validate(),this.setState({selectedTypeFields:s,working:!1})}render(){var e,t;const{onDismiss:s}=this.props,{errorMessage:i,isValid:r,selectedTypeFields:a,working:l,workItemTemplate:n}=this.state;return c.createElement(k.Dialog,{calloutContentClassName:"work-item-dialog",titleProps:{text:ee.CaptureTemplateHeader},onDismiss:s,footerButtonProps:[{text:ee.CloseLabel,onClick:s},{text:ee.SaveLabel,disabled:!r||l,onClick:this.onSave,primary:!0}],overlay:l?{spinnerAriaLabel:ee.CreatingTemplateSpinnerAriaLabel}:void 0,resizable:!0,showCloseButton:!0},c.createElement("div",{className:"rhythm-vertical-16"},i&&c.createElement(N.MessageCard,{severity:"Error"},i),this.isNewTemplate&&c.createElement(p.FormItem,{label:c.createElement(o,{text:ee.TeamLabel,required:!0})},c.createElement(T.Dropdown,{disabled:!!n,items:this.teams,onSelect:(e,t)=>{this.team.value=t.id,this.validate()}})),c.createElement(p.FormItem,{label:c.createElement(o,{text:ee.NameLabel,required:!0})},c.createElement(O.TextField,{value:this.templateName,onChange:(e,t)=>{this.templateName.value=t,this.validate()}})),c.createElement(p.FormItem,{label:c.createElement(o,{text:ee.DescriptionLabel})},c.createElement(O.TextField,{value:this.templateDescription,onChange:(e,t)=>{this.templateDescription.value=t,this.validate()}})),c.createElement("div",{className:"margin-bottom-16"},c.createElement(oe.BulkEditFieldsTable,{clauses:this.clauses,fields:a,getAllowedValues:this.getAllowedValues,onValidate:this.onValidateTable,projectId:null!==(t=null===(e=this.projectData)||void 0===e?void 0:e.id)&&void 0!==t?t:""}),c.createElement(d.Button,{iconProps:{iconName:"Cancel"},onClick:this.removeUnmodifiedClauses,text:ee.RemoveFieldsButtonLabel}))),c.createElement(b.HtmlEditor,{className:"history-input",ariaLabel:ee.EditWorkItemsNotesAriaLabel,placeholder:ee.EditWorkItemsNotes,htmlContent:this.historyNotes.value,onChange:e=>{this.historyNotes.value=e},telemetryContext:{controlName:"HtmlEditor"},showChromeBorder:!0}),c.createElement("div",{className:"margin-top-16"},c.createElement(d.Button,{disabled:!n,iconProps:{iconName:"Copy"},onClick:e=>{n&&(0,B.copyToClipboard)(this.getCreateWorkItemWithTemplateRoute(n))},text:ee.CopyLink,tooltipProps:{text:n?ee.CopyTemplateLinkMessage:ee.SaveTemplateMessage}})))}validate(){const e=!!this.team.value&&!!this.templateName.value&&!!this.clauses.length&&this.isTableValid;e!==this.state.isValid&&this.setState({isValid:e})}async getClausesFromFieldValues(e,t=!1){const s=[];for(const o of this.sortNamespacesByName(Object.keys(e))){const i=e[o];let r=this.props.fields.find((e=>e.referenceName===o));o===I.AddTagsPseudoRefName&&(r=this.props.fields.find((e=>e.referenceName===n.CoreFieldRefNames.Tags))),r&&(t||i)&&(r.id===n.CoreField.Tags&&(r=Object.assign(Object.assign({},r),{name:(0,a.format)(ee.AddTagsFormat,r.name),referenceName:I.AddTagsPseudoRefName})),s.push(this.createClauseWithAllowedValues(r,i)))}return Promise.all(s)}async createClauseWithAllowedValues(e,t){const s=await this.getAllowedValues(e);return{allowedValues:new r.ObservableArray(null!=s?s:[]),field:new r.ObservableValue(e),id:(0,a.newGuid)(),value:new r.ObservableValue(t)}}getCreateWorkItemWithTemplateRoute(e){var t,s;const o=this.props.teamId||this.team.value,{id:i,workItemTypeName:r}=e,a={project:null!==(s=null===(t=this.projectData)||void 0===t?void 0:t.id)&&void 0!==s?s:"",workItemTypeName:r,templateId:i,ownerId:o};return`${window.location.origin}${(0,M.routeUrl)(this.context.pageContext,"ms.vss-work-web.new-work-item-form-route",a)}`}sortNamespacesByName(e){return e.sort(((e,t)=>{const s=e.split(".").pop()||"",o=t.split(".").pop()||"";return s<o?-1:s>o?1:0}))}}function o({text:e,required:t}){return c.createElement("div",{className:"flex-row"},c.createElement("div",{className:"flex-grow"},e),t&&c.createElement("div",{className:"secondary-text"},ee.RequiredLabel))}async function i(e,t,o,a,l,m,d,u){if(!d){const e=t.getService("IWorkItemFieldService"),s=await e.getFieldsAsync();d=new r.ObservableArray(s||[])}const p=o[0][n.CoreFieldRefNames.WorkItemType],v=[{groupKey:"capture-template",id:"capture-work-item",onActivate:()=>{a((r=>c.createElement(h.Observer,{fields:d},(n=>c.createElement(s,{fields:n.fields,onDismiss:r,onSave:()=>i(e,t,o,a,l,m,d),selectedItem:o[0]})))))},text:ee.WorkItemTemplateCapture,iconProps:{iconName:"Camera"},disabled:o.length>1}];if(m&&p){const e=t.getService("IWorkItemTemplateService"),s=await e.getMyTemplateReferences(l,m.id,p);v.push(...s.map((e=>({id:e.id,onActivate:()=>{!async function(e,t,s,o,i,r,a){if(!r)return;const l=s.map((e=>Number(e[n.CoreFieldRefNames.Id]))),c=t.getService("IWorkItemTemplateService"),m=await c.getTemplate(o,r.id,e),d=[];for(const e in m.fields){let s=m.fields[e];const o=i.value.find((t=>t.referenceName===e));if(o)if(o.type===n.FieldType.DateTime)s=new Date(s);else if(o.type===n.FieldType.Integer||o.type===n.FieldType.Boolean)s=Number(s);else if(o.isIdentity&&s){if((0,_.isMeMacro)(s,!1)){const e=t.getService("IVssPageService").getData().user;s=(0,U.getDistinctDisplayName)(e.displayName,e.uniqueName)}s=(0,U.convertWorkItemIdentityRefFromFieldValue)(t,s)}d.push({fieldName:e,value:s})}const u=new Map([[y.BulkUpdateConstants.AllTypes,d]]),p=await(0,S.performBulkUpdate)(t,l,u);a&&a(p)}(e.id,t,o,l,d,m,u)},text:e.name}))).sort(((e,t)=>e.text.localeCompare(t.text))))}e.value=v}t[e].EditTemplateDialog=s,t[e].getTemplateMenuItem=function(e,t,s,o,a,l,n){const c=new r.ObservableArray;return i(c,e,t,s,o,a,l,n),{rank:70,id:"work-item-templates",text:ee.WorkItemTemplate,iconProps:{iconName:"AutoFillTemplate"},groupKey:"modify",subMenuProps:{id:"work-item-templates-sub-menu",items:c}}}}("ComponentsEditTemplateDialog"),function(e){t[e]={};const s=1024;class o extends m.VssComponent{constructor(e,t){var s,o,a,l;super(e,t),this.selectedIdentities=new r.ObservableArray([]),this.note=new r.ObservableValue(""),this.subject=new r.ObservableValue(""),this.sending=new r.ObservableValue(!1),this.errorMessage=new r.ObservableValue(""),this.showConfirmationDialog=new r.ObservableValue(!1),this.renderTable=()=>c.createElement("table",{style:{fontFamily:"Calibri, sans-serif",borderCollapse:"collapse",border:0,maxHeight:"180px",width:"100%"},"aria-label":ee.SelectedWorkItems},c.createElement("tbody",null,c.createElement("tr",{style:{background:"#106EBE",color:"white",verticalAlign:"top"}},this.props.columnFieldNames.map((e=>c.createElement("th",{style:{border:"none",borderRight:"solid white 1.0pt",padding:"1.45pt .05in 1.45pt .05in",fontFamily:"Segoe UI, Helvetica Neue, Helvetica, Arial, Verdana",fontSize:"12px"},key:e},e)))),this.props.selectedItems.filter((e=>e[n.CoreFieldRefNames.WorkItemType])).map(((e,t)=>c.createElement("tr",{key:t,style:{background:t%2==0?"rgba(124, 124, 124, 0.5)":"inherit",verticalAlign:"top"}},this.props.referenceFieldNames.map((t=>c.createElement("td",{key:t,style:{border:"none",borderRight:"solid white 1.0pt",padding:"1.45pt .05in 1.45pt .05in",fontFamily:"Segoe UI, Helvetica Neue, Helvetica, Arial, Verdana",fontSize:"12px",maxWidth:"50px"}},t===n.CoreFieldRefNames.Id?c.createElement("a",{href:this.workItemService.getWorkItemUrl(e[n.CoreFieldRefNames.Id],this.projectId),target:"_blank",tabIndex:0},e[t]):(0,Q.convertValueToDisplayString)(e[t]))))))))),this.onSend=async()=>{var e;this.sending.value=!0;const t=this.context.pageContext.getService("IVssPageService").getData(),s=(null==t?void 0:t.user.id)||"",o=(0,te.getWorkItemTrackingClient)(this.context.pageContext),i=this.selectedIdentities.value.map((e=>e.localId)),r=this.projectId;let a=[];this.props.wiql||(a=this.props.selectedItems.map((e=>e[n.CoreFieldRefNames.Id])));let l=this.props.tempQueryId;!l&&this.props.getTempQueryId&&(l=await this.props.getTempQueryId());try{await o.sendMail({message:{body:this.note.value,to:{tfIds:i,emailAddresses:[],unresolvedEntityIds:[]},subject:this.subject.value,cc:{tfIds:[s],emailAddresses:[],unresolvedEntityIds:[]},replyTo:{tfIds:[s],emailAddresses:[],unresolvedEntityIds:[]},inReplyTo:"",messageId:""},fields:this.props.referenceFieldNames,wiql:this.props.wiql||"",persistenceId:this.props.queryId||"",ids:a,projectId:r,sortFields:this.props.sortFields||[],tempQueryId:l||""},r),this.props.onDismiss()}catch(t){this.errorMessage.value=null!==(e=t.message)&&void 0!==e?e:t}finally{this.sending.value=!1}},this.onIdentityAdded=e=>{this.selectedIdentities.push(e)},this.onIdentityRemoved=e=>{this.selectedIdentities.value=this.selectedIdentities.value.filter((t=>t.entityId!==e.entityId))},this.onIdentitiesRemoved=e=>{this.selectedIdentities.value=this.selectedIdentities.value.filter((t=>0===e.filter((e=>e.entityId===t.entityId)).length))},this.onDismiss=()=>{this.subject.value&&this.subject.value!==this.props.defaultSubject||this.note.value?this.showConfirmationDialog.value=!0:this.props.onDismiss()},this.onConfirmationDismiss=()=>{this.showConfirmationDialog.value=!1},this.workItemService=t.pageContext.getService("work-item-service"),this.pickerProvider=new H.PeoplePickerProvider(this.context.pageContext,{identityTypes:["user","group"]}),this.props.defaultSubject&&(this.subject.value=this.props.defaultSubject);const m=null!==(a=null===(o=null===(s=(0,i.getTFSPageData)(this.context.pageContext))||void 0===s?void 0:s.project)||void 0===o?void 0:o.id)&&void 0!==a?a:null===(l=this.props)||void 0===l?void 0:l.workItemProjectId;if(!m)throw new Error(ee.NoProjectSpecifiedMessage);this.projectId=m;const d=this.context.pageContext.getService("IMailConfigurationService");this.isMailEnabled=d.isEnabled()}render(){return this.props.isQueryDirty||!this.isMailEnabled?c.createElement(k.Dialog,{titleProps:{text:ee.ErrorSendingEmail},footerButtonProps:[{text:ee.OK,primary:!0,onClick:this.props.onDismiss}],onDismiss:this.onDismiss},this.isMailEnabled?ee.UnsavedQueryMessage:ee.SendMailNotEnabled):c.createElement(c.Fragment,null,c.createElement(h.Observer,{subject:this.subject,selectedIdentities:this.selectedIdentities,note:this.note,errorMessage:this.errorMessage},(({errorMessage:e,subject:t,selectedIdentities:o})=>c.createElement(k.Dialog,{contentSize:4,titleProps:{text:ee.SendWorkItems},onDismiss:this.onDismiss,footerButtonProps:[{text:ee.Cancel,onClick:this.onDismiss},{text:ee.Send,onClick:this.onSend,primary:!0,disabled:!t||0===o.length||this.note.value.length>s}],showCloseButton:!0},c.createElement("div",{className:"flex-grow flex-column rhythm-vertical-16"},this.props.loading?c.createElement(E.Spinner,{label:ee.Loading}):0===this.props.selectedItems.length?c.createElement(N.MessageCard,{severity:"Error"},ee.NoWorkItems):c.createElement(c.Fragment,null,e&&c.createElement(N.MessageCard,{onDismiss:()=>this.errorMessage.value="",severity:"Error"},e),c.createElement(p.FormItem,{label:ee.To},c.createElement(z.IdentityPicker,{className:"email-dialog-item",onIdentityAdded:this.onIdentityAdded,onIdentitiesRemoved:this.onIdentitiesRemoved,onIdentityRemoved:this.onIdentityRemoved,pickerProvider:this.pickerProvider,selectedIdentities:this.selectedIdentities})),c.createElement(p.FormItem,{label:ee.Subject},c.createElement(O.TextField,{containerClassName:"email-dialog-item",value:this.subject,onChange:(e,t)=>{this.subject.value=t}})),c.createElement(p.FormItem,{label:c.createElement("div",{className:"flex-row"},c.createElement("span",{className:"flex-grow email-dialog-label"},ee.Note),c.createElement("span",{className:(0,q.css)(this.note.value.length>s&&"character-count-error")},(0,a.format)(ee.CharacterCount,this.note.value.length,s)))},c.createElement(O.TextField,{containerClassName:"email-dialog-item",multiline:!0,value:this.note,onChange:(e,t)=>{this.note.value=t}})),c.createElement("div",{className:"flex-column email-read-only-body"},c.createElement("span",{className:"margin-bottom-16"},ee.SelectedWorkItems),this.renderTable()),c.createElement("div",{className:"flex-column"},this.props.selectedItems.length>200&&c.createElement("span",null,(0,a.format)(ee.EmailWorkItemsLimit,200))),c.createElement(h.Observer,{sending:this.sending},(({sending:e})=>e&&c.createElement(E.Spinner,{label:ee.Sending})))))))),c.createElement(h.Observer,{showConfirmationDialog:this.showConfirmationDialog},(({showConfirmationDialog:e})=>e&&c.createElement(k.Dialog,{titleProps:{text:ee.UnsavedChanges},onDismiss:this.props.onDismiss,lightDismiss:!1,modal:!0,footerButtonProps:[{text:ee.Cancel,onClick:this.onConfirmationDismiss},{text:ee.OK,onClick:this.props.onDismiss,primary:!0}]},ee.UnsavedChangesMessage))))}}t[e].EmailWorkItemsDialog=o}("ComponentsEmailWorkItemsDialog"),function(e){re=t[e]={};const s=[n.CoreFieldRefNames.Id,n.CoreFieldRefNames.WorkItemType,n.CoreFieldRefNames.Title,n.CoreFieldRefNames.AreaPath,n.CoreFieldRefNames.IterationPath],o="SELECT [System.Id], [System.WorkItemType], [System.Title], [System.AreaPath], [System.IterationPath] FROM WorkItems WHERE ([System.TeamProject] = @project AND [System.WorkItemType] IN GROUP '{0}' AND [System.AreaPath] UNDER '{1}')",l="SELECT [System.Id], [System.WorkItemType], [System.Title], [System.AreaPath], [System.IterationPath] FROM WorkItems WHERE ([System.TeamProject] = @project AND [System.WorkItemType] IN GROUP '{0}' AND [System.AreaPath] UNDER '{1}' AND [System.Title] CONTAINS '{2}')";t[e].SelectTestItemForm=({testItemType:e,multipleSelect:t,onSelectionChanged:u,onMultiSelectionChanged:h})=>{var v,I;const C=(0,m.usePageContext)(),f=null!==(I=null===(v=(0,i.getTFSProject)(C))||void 0===v?void 0:v.id)&&void 0!==I?I:"",[k]=(0,r.useObservable)(""),[y]=(0,r.useObservable)(""),[S]=(0,r.useObservableArray)([]),[b,w]=c.useState({loading:!1}),T=c.useRef(new K.ListSelection({multiSelect:t})),N=(e,t,s,o)=>{const i=o.fields[n.CoreFieldRefNames.WorkItemType],r=o.fields[n.CoreFieldRefNames.Title],a=(0,Y.getIconDataObservable)(f,i,C);return c.createElement(g.SimpleTableCell,{className:s.className,columnIndex:t,key:`results-${s.id}-${e}`,tableColumn:s},c.createElement(R.WorkItemTypeIcon,{className:"icon-margin",data:a}),c.createElement(P.Link,{className:"text-ellipsis",tooltipProps:{overflowOnly:!0},onClick:e=>{C.getService("work-item-service").openWorkItem(Number(o.fields[n.CoreFieldRefNames.Id]))}},r))},W=(e,t,s,o)=>({id:e,name:t.get(s),renderCell:(e,t,o,i)=>function(e,t,s,o,i){return c.createElement(g.SimpleTableCell,{className:s.className,columnIndex:t,key:`results-${s.id}-${e}`,tableColumn:s},(0,K.renderListCell)(i))}(e,t,o,0,i.fields[s]),width:o});return c.createElement("div",{className:"flex-column flex-grow rhythm-vertical-8"},c.createElement(p.FormItem,{label:c.createElement("span",{className:"flex-row"},ee.TitleLabel,c.createElement(F.Icon,{className:"margin-left-4",iconName:"Info",size:"small",tooltipProps:{text:ee.TitleSearchTooltip}}))},c.createElement(O.TextField,{onChange:(e,t)=>k.value=t,value:k})),c.createElement(p.FormItem,{label:ee.AreaPathSearchLabel},c.createElement(G.AreaPathDropdown,{onSetPath:e=>y.value=e,selectDefaultValue:!0,selectedText:y})),c.createElement("span",{className:"flex-row"},c.createElement(d.Button,{iconProps:{iconName:"Search"},onClick:async()=>{w({loading:!0});const{columns:t,workItems:i}=await async function(e,t,i,r,n){const c=(0,$.getWorkItemTrackingClient)(e),m={query:n?(0,a.format)(l,i,r,n):(0,a.format)(o,i,r)},{workItems:d,columns:u}=await c.queryByWiql(m,t,void 0,void 0,1e3),p=d.map((e=>e.id)),h=e.getService("work-item-service"),v=(await Promise.all(h.loadWorkItems(t,p,s))).flat();return{columns:u,workItems:v}}(C,f,e,y.value,k.value),r=new Map;for(const e of t)r.set(e.referenceName,e.name);w({columns:r,loading:!1}),S.value=i},primary:!0,text:ee.Search}),b.loading&&c.createElement(E.Spinner,{className:"margin-left-8"})),b.columns&&c.createElement(g.Table,{columns:(D=b.columns,[W("id-column",D,n.CoreFieldRefNames.Id,-15),W("type-column",D,n.CoreFieldRefNames.WorkItemType,-20),{id:"title-column",name:D.get(n.CoreFieldRefNames.Title),renderCell:N,width:-25},W("area-path-column",D,n.CoreFieldRefNames.AreaPath,-20),W("iteration-column",D,n.CoreFieldRefNames.IterationPath,-20)]),itemProvider:S,onSelect:(e,s)=>{if(t){const e=function(e,t){const s=new Set;for(const o of e){const e=o.beginIndex,i=o.endIndex;for(let o=e;o<=i;o++)s.add(t[o].id)}return Array.from(s)}(T.current.value,S.value);h&&h(e)}else u&&u(s.data)},selection:T.current}));var D}}("ComponentsSelectTestItemForm"),function(e){t[e]={};t[e].InsertSharedStepsDialog=({onDismiss:e,onInsertSharedSteps:t})=>{const[s,o]=c.useState(void 0);return c.createElement(k.Dialog,{className:"insert-shared-steps-dialog",footerButtonProps:[{onClick:e,text:ee.Cancel},{disabled:!s,onClick:()=>{s&&t(s),e()},primary:!0,text:ee.InsertSharedSteps}],onDismiss:e,titleProps:{text:ee.InsertSharedSteps},contentSize:2},c.createElement(re.SelectTestItemForm,{testItemType:"Microsoft.SharedStepCategory",onMultiSelectionChanged:e=>{o(e)},multipleSelect:!0}))},m.Components.add("insert-shared-steps-dialog",t[e].InsertSharedStepsDialog)}("ComponentsInsertSharedStepsDialog"),function(e){t[e]={},t[e].MoveToPositionDialog=function({items:e,onDismiss:t,onMoveToPosition:s}){const[o,i]=c.useState(void 0),[r,l]=c.useState(void 0),[n,m]=c.useState("");return c.createElement(k.Dialog,{defaultActiveElement:".position-textbox",footerButtonProps:[{onClick:t,text:ee.Cancel},{disabled:!!o||!n,onClick:()=>{try{null==s||s(Number(n)-1),t()}catch(e){l(e.message)}},primary:!0,text:ee.SaveChanges}],onDismiss:t,resizable:!0,titleProps:{text:ee.MoveToPositionTitle},showCloseButton:!0},c.createElement("div",{className:"flex-column rhythm-vertical-8"},r&&c.createElement(J.MessageCard,{severity:"Error"},r),c.createElement(p.FormItem,{label:(0,a.format)(ee.SelectAPositionPrompt,e.length),error:!!o,message:o},c.createElement(O.TextField,{inputClassName:"position-textbox",inputType:"number",onChange:(t,s)=>{m(s);const r=Number(s);r<1||r>e.length?i((0,a.format)(ee.InvalidPosition,e.length)):o&&i(void 0)},value:n}))))}}("ComponentsMoveToPositionDialog"),function(e){t[e]={};t[e].MoveToProjectDialog=({onModifyItems:e,onDismiss:t,selectedItems:a})=>{const{pageContext:u}=(0,m.useComponentContext)(),h=u.getService("IWorkItemTypesService"),v=u.getService("ITfsProjectService"),[g,I]=c.useState(!1),[C,f]=c.useState(!1),[y,w]=c.useState(void 0),W=c.useRef([]),[E]=(0,r.useObservable)(""),[D,x]=c.useState(),R=c.useRef(),F=c.useRef(new j.DropdownSelection),P=c.useRef(new j.DropdownSelection),[V]=(0,r.useObservable)(""),[A]=(0,r.useObservable)(""),[L]=(0,r.useObservableArray)([d]),[M]=(0,r.useObservableArray)([]),[O]=(0,r.useObservableArray)([]),[B]=(0,r.useObservableArray)([]),_=async e=>{M.value=[d];const t=await h.getVisibleWorkItemTypes(e);M.value=[o,...t.map((e=>({id:e,text:e})))],P.current.select(0),R.current=s;const i=u.getService("IWorkItemNodeService");O.value=[d];const r=await i.getAreaPathNodes(e);r&&(O.value=(0,Z.convertNodesToListBoxItems)(r),V.value=(0,Z.normalizePath)(r.path)),B.value=[d];const a=await i.getIterationNodes(e);a&&(B.value=(0,Z.convertNodesToListBoxItems)(a),A.value=(0,Z.normalizePath)(a.path)),U()},U=()=>{const e=!!(D&&V.value&&A.value&&R.current);e!==g&&I(e)};return c.useEffect((()=>{D&&_(D)}),[D]),c.useEffect((()=>{(async()=>{const e=await v.getAllProjectsLoadedPromise();L.value=e.map((e=>({id:e.id,text:e.name}))),W.current=e})()}),[]),c.createElement(k.Dialog,{calloutContentClassName:"work-item-dialog",defaultActiveElement:".bolt-dialog-focus-element-cancel-button",footerButtonProps:[{className:"bolt-dialog-focus-element-cancel-button",text:ee.Cancel,onClick:t},{text:ee.OK,disabled:!g||C,onClick:async()=>{var o;const r=null===(o=W.current.find((e=>e.id===D)))||void 0===o?void 0:o.name;if(D&&V.value&&A.value&&R.current&&r)try{f(!0);const o=await async function(e,t,s){const{sourceProjects:o,targetProjectId:r,targetProjectName:a,targetType:c}=s,m=e.getService("IWorkItemTypesService"),d=function(e,t){const s=new Map;for(const o of e){const e=o[n.CoreFieldRefNames.WorkItemType],i=o[n.CoreFieldRefNames.TeamProject],r=t.find((e=>e.name===i));if(!r)continue;let a=s.get(r.id);a||(a=new Set,s.set(r.id,a)),a.add(e)}return s}(t,o),u=await async function(e,t,s,o){var i;const r=e.getService("IWorkItemTypesService");for(const e of[...t.keys()]){const a=await r.getVisibleWorkItemTypes(e),n=(await r.getWorkItemTypes(e)).filter((e=>a.indexOf(e)<0)),c=t.get(e),m=null===(i=s.find((t=>t.id===e)))||void 0===i?void 0:i.name;if(!c)continue;const d=l([...c.keys()],a,n,null!=m?m:e,o,!0);if(!d.success)return d}return{success:!0}}(e,d,o,!c);if(!u.success)return u;const p=t.map((e=>Number(e[n.CoreFieldRefNames.Id]))),h=(0,S.getWorkItemTypes)(t),v=await m.getVisibleWorkItemTypes(r),g=(await m.getWorkItemTypes(r)).filter((e=>v.indexOf(e)<0)),I=l(c?[c]:h,v,g,a,!c);if(!I.success)return I;const C=c?await async function(e,t,s){const o=e.getService("IWorkItemTypesService"),i=await o.getWorkItemTypeData(t,[s]);if(1===i.length&&i[0].orderedStates&&i[0].orderedStates.length>0){return i[0].orderedStates[0]}}(e,r,c):void 0,f=new Map;for(const e of h)f.set(e,i(e,s,C));return{success:!0,workItems:await(0,S.performBulkUpdate)(e,p,f)}}(u,a,{areaPath:V.value,historyValue:E.value,iterationPath:A.value,sourceProjects:W.current,targetProjectId:D,targetProjectName:r,targetType:R.current!==s?R.current:void 0});o.workItems&&o.success?(e&&e(o.workItems),t()):(w(o.errorMessage),f(!1))}catch(e){w(e.message),f(!1)}},primary:!0}],onDismiss:t,overlay:C?{spinnerAriaLabel:ee.MovingWorkItems}:void 0,resizable:!0,showCloseButton:!0,titleProps:{text:ee.MoveWorkItem}},c.createElement("div",{className:"rhythm-vertical-16"},y&&c.createElement(N.MessageCard,{severity:"Error"},y),c.createElement(p.FormItem,{label:ee.ProjectDropdownLabel},c.createElement(T.Dropdown,{items:L,placeholder:ee.ProjectDropdownPlaceholder,selection:F.current,onSelect:(e,t)=>{x(t.id)}})),c.createElement(p.FormItem,{label:ee.AreaPathLabel},c.createElement(G.AreaPathDropdown,{items:O,onSetPath:e=>{V.value=e,U()},projectId:D,selectedText:V})),c.createElement(p.FormItem,{label:ee.IterationPathLabel},c.createElement(X.IterationDropdown,{items:B,onSetPath:e=>{A.value=e,U()},projectId:D,selectedText:A})),c.createElement(p.FormItem,{label:ee.WorkItemType},c.createElement(T.Dropdown,{items:M,selection:P.current,onSelect:(e,t)=>{R.current=t.id===s?t.id:t.text,U()}})),c.createElement(p.FormItem,{label:ee.MoveToProjectReasonLabel},c.createElement(b.HtmlEditor,{className:"history-input",ariaLabel:ee.EditWorkItemsNotesAriaLabel,placeholder:ee.EditWorkItemsNotes,htmlContent:E.value,onChange:e=>{E.value=e},telemetryContext:{controlName:"HtmlEditor"},showChromeBorder:!0}))))};const s="keepCurrentType",o={id:s,text:ee.KeepCurrentTypesOption};function i(e,t,s){const{areaPath:o,historyValue:i,iterationPath:r,targetProjectId:a,targetType:l}=t,c=[{fieldName:n.CoreFieldRefNames.WorkItemType,value:null!=l?l:e},{fieldName:n.CoreFieldRefNames.TeamProject,value:a},{fieldName:n.CoreFieldRefNames.AreaPath,value:o},{fieldName:n.CoreFieldRefNames.IterationPath,value:r}];return s&&c.push({fieldName:n.CoreFieldRefNames.State,value:s}),i&&i.trim().length>0&&c.push({fieldName:n.CoreFieldRefNames.History,value:i}),c}function l(e,t,s,o,i,r=!1){const l=[];let n;for(const i of e){const e=s.indexOf(i)>=0,c=t.indexOf(i)>=0;e?n=(0,a.format)(r?ee.MoveSourceWorkItemBlockedCase:ee.MoveTargetWorkItemBlockedCase,i,o):c||l.push(i)}return l.length>0&&i&&(n=(0,a.format)(ee.MoveWorkItemBulkTypeError,l.join(", "),o)),{errorMessage:n,success:!n}}const d={id:"loading",type:4}}("ComponentsMoveToProjectDialog"),function(e){t.ServicesIWorkItemFormDialogService={};class o extends s.VssService{constructor(){super(...arguments),this.historyServiceListener=e=>{var t,s;const o=Number(null===(t=e.newState)||void 0===t?void 0:t.state.workitem);o!==this.currentWorkItemFormItemId&&(this.currentWorkItemFormItemId&&(null===(s=this.dismissWorkItemForm)||void 0===s||s.call(this,!1)),isNaN(o)||this.showWorkItemFormDialog(o,this.saveCompleteListener,{updateHistory:!1}))}}_serviceStart(e){super._serviceStart(e),this.historyService=this.pageContext.getService("IVssHistoryService")}_serviceEnd(e){super._serviceEnd(e),this.historyService.unsubscribe(this.historyServiceListener)}subscribeToHistoryService(e){this.historyService.unsubscribe(this.historyServiceListener),this.saveCompleteListener=e;const t=this.pageContext.getService("IVssHistoryService").getState();if(t.workitem){const e=Number(t.workitem);isNaN(e)||this.showWorkItemFormDialog(e,this.saveCompleteListener,{updateHistory:!1})}this.historyService.subscribe(this.historyServiceListener)}showWorkItemFormDialog(e,t,s){let o,i;"number"==typeof e?i=e:(o=e,i=o.id);const r=this.pageContext.getService("IVssLayoutManager");if(null==s?void 0:s.updateHistory){const e=this.historyService.getState();e.workitem!==""+i&&this.historyService.pushState(Object.assign(Object.assign({},e),{workitem:""+i}))}this.currentWorkItemFormItemId=i,r.renderCallout((e=>{const r=(t=!0)=>{var o;if(this.currentWorkItemFormItemId=void 0,this.dismissWorkItemForm=void 0,t){const e=this.historyService.getState();delete e.workitem,this.historyService.pushState(e)}null===(o=null==s?void 0:s.onDismiss)||void 0===o||o.call(s),e()};this.dismissWorkItemForm=r;const a={onDelete:null==s?void 0:s.onDelete,onDismiss:r,shouldRefresh:null==s?void 0:s.shouldRefresh,onSaveComplete:(e,s)=>null==t?void 0:t(this.pageContext,e,s)};return o?c.createElement(ie.WorkItemFormDialog,Object.assign({},a,{workItem:o})):c.createElement(ie.WorkItemFormDialog,Object.assign({},a,{workItemId:i}))}))}}s.Services.add("IWorkItemFormDialogService",{serviceFactory:o})}()}),["Resources","clients/WorkItemTracking","Services/ChangeParentService","Components/BulkEditFieldsTable","Components/BulkEditDialog","Components/ChangeParentPanel","Components/ChangeTypeDialog","Components/WorkItemFormDialog","Components/CloneWorkItemDialog","Components/ConfirmationDialog","Components/CopyWorkItemDialog","Components/DeleteDialog","Components/EditorDirtyDialog","Components/EditTemplateDialog","Components/EmailWorkItemsDialog","Components/SelectTestItemForm","Components/InsertSharedStepsDialog","Components/MoveToPositionDialog","Components/MoveToProjectDialog","Services/IWorkItemFormDialogService"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-work-web.work-item-dialogs"}}));