"use strict";define("Test/TestPlansHubRefresh/Pivots/AuthorPivot",["require","exports","Reselect","Test/TestPlansHubRefresh/Pivots/ColumnOptions/DefineColumnOptionUtils","Test/TestPlansHubRefresh/TestHub/Constants","Test/TestPlansHubRefresh/TestHub/Redux/TestHubRefresh/TestHubRefreshSelector","Test/TestPlansHubRefresh/TestHub/Resources","VSS/Core/Observable","redux/Utils/ActionHelper","immer","redux-saga","Test/TestPlansHubRefresh/TestHub/Redux/TelemetryActions","VSS/Redux/Modules/ContentViewObserver/index","Test/TestPlansHubRefresh/TestHub/Redux/Suites/SuitesActions","Test/TestPlansHubRefresh/Pivots/ColumnOptions/ColumnOptionsCommonUtils","Test/TestPlansHubRefresh/TestHub/Util","react","VSS/Core/Util/Accessibility","Test/TestPlansHubRefresh/TestHub/Redux/Suites/SuitesSelector","Test/TestPlansHubRefresh/TestHub/Redux/TestHubRefresh/TestHubRefreshActions","Test/TestPlansHubRefresh/TestHub/Utils/TestPlansHubRefreshLocalContextProvider","VSS/Core/Util/String","VSS/Legacy/Legacy","VSSUI/Spinner","Test/TestPlansHubRefresh/TestHub/Redux/Suites/SuitesReducer","Test/TestPlansHubRefresh/TestHub/Redux/TestHubRefresh/TestHubRefreshReducer","react-redux","VSS/Platform/Layout","redux-dynamic-modules","Test/TestPlansHubRefresh/TestHub/Utils/TestHubRefreshFilterCommon","VSS/Features/PlatformUI/ContributedMenu","VSS/Platform/Feature","VSS/Platform/Location","VSS/Redux/Modules/TTIMonitor/index","VSSUI/Button","VSSUI/Card","VSSUI/Header","VSSUI/HeaderCommandBar","VSSUI/List","VSSUI/Menu","VSSUI/Observer","VSSUI/SplitButton","VSSUI/Splitter","VSSUI/Table","VSSUI/Utilities/Dispatch","VSSUI/ZeroData","Wit/WorkItemForm/WorkItemFormView"],(function(e,t,s,a,o,i,n,r,l,d,c,u,p,f,h,C,T,m,S,y,I,g,A,b,_,R,E,v,x,F,P,w,O,H,k,D,L,N,V,W,M,U,G,K,B,j,z){var Y,Z,X,q,Q,$,J,ee,te,se,ae,oe,ie,ne;Y=t.Resources={},t.Resources.TestCases="Test Cases",t.Resources.Title="Title",t.Resources.Order="Order",t.Resources.AssignedTo="Assigned To",t.Resources.AddTestCase="Add Test Case",t.Resources.StateText="State",t.Resources.ZeroDataPrimaryText="Add a test case",t.Resources.ZeroDataSecondaryText="Use this tab to collate, add and manage test cases",t.Resources.ZeroDataButtonText="Add Test Case",t.Resources.ZeroDataImageText="Add Test Case",t.Resources.ZeroDataEditQueryPrimaryText="Edit query to add test cases",t.Resources.NewTestCase="New Test Case",t.Resources.AddExistingTestCases="Add Existing Test Cases",t.Resources.TextFilterPlaceholderText="Search Title, Test case id and Tags columns",t.Resources.AssignedToFilterPlaceholderText="Assigned To",t.Resources.StateFilterPlaceholderText="State",t.Resources.AddNewTestCaseUsingForm="Add a new test case using a form",t.Resources.EditQuery="Edit Query",t.Resources.ClearFilter="Clear filter to reorder test cases",t.Resources.SortByOrderAscending="Sort order by ascending to reorder test cases",t.Resources.TestCaseId="Test Case Id",t.Resources.TestCaseCountText="Showing {0} test cases",t.Resources.ZeroTestCaseText="No test cases match your filter criteria",t.Resources.TestStep="Test Step",t.Resources.StepAction="Step Action",t.Resources.StepExpected="Step Expected",t.Resources.Id="ID",t.Resources.WorkItemType="Work Item Type",t.Resources.Revision="Revision",t.Resources.AddTestCaseMenuButtonAriaLabel="See options",t.Resources.TestCaseWorkItemType="Test Case",t.Resources.SharedStepWorkItemType="Shared Steps",t.Resources.RemoveTestCaseViaDeleteKeyConfirmDialogText="This will remove selected tests across all configuration from the suite.\n Do you want to continue?",t.Resources.RemoveTestCase="Remove Test Case(s)",Z=t.AuthorConstants={},t.AuthorConstants.TestCaseWorkItemType="Test Case",t.AuthorConstants.TestCaseCreationMode=1,t.AuthorConstants.AuthorTabZeroDataImagePath="ms.vss-test-web/testplan-hub-refresh-assets/zero-data-author-tab.png",t.AuthorConstants.AuthorPivotName="Define",t.AuthorConstants.AssignConfigToTestCasesDialog="AssignConfigToTestCases",t.AuthorConstants.DragTestCasesText=" test cases",t.AuthorConstants.OrderColumn="order",t.AuthorConstants.AssignedToColumn="assignedTo",t.AuthorConstants.NameColumn="name",t.AuthorConstants.StateColumn="state",t.AuthorConstants.TestCaseIdColumn="id",t.AuthorConstants.WorkItemId="System.Id",t.AuthorConstants.WorkItemCreatedDate="System.CreatedDate",t.AuthorConstants.WorkItemChangedDate="System.ChangedDate",t.AuthorConstants.contributionId="ms.vss-test-web.testplans-hub-refresh-route",t.AuthorConstants.queryParams="?planId={0}&suiteId={1}",t.AuthorConstants.TOAST_MESSAGE_DURATION=5e3,t.AuthorConstants.WorkItemTypeCategoryTestCase="Microsoft.TestCaseCategory",function(e){X=t[e]={};t[e].getTestCaseItemsComparator=function(e,t){const s=0===t||void 0===t?1:-1;return e===Z.OrderColumn?(e,t)=>s*(e.order-t.order):e===Z.NameColumn?(e,t)=>s*e.name.localeCompare(t.name):e===Z.AssignedToColumn?(e,t)=>s*e.assignedTo.displayName.localeCompare(t.assignedTo.displayName):e===Z.StateColumn?(e,t)=>s*e.state.localeCompare(t.state):e===Z.TestCaseIdColumn?(e,t)=>s*(e.id-t.id):e?(t,a)=>{const o=t.columnOptionValues[e],i=a.columnOptionValues[e];return s*(o>i?1:o==i?0:-1)}:void 0}}("TestCaseItemsSortingUtility"),function(e){q=t.ReduxAuthorSelector={};t.ReduxAuthorSelector.getTestCasesMapFromState=e=>e.authorState.testCases;const l=e=>e.workItem.name;t.ReduxAuthorSelector.getColumnAndSortOrder=e=>{if(e&&e.authorState)return e.authorState.columnAndSortOrder};t.ReduxAuthorSelector.isAnyAuthorFilterValueSet=e=>{let t=!1;const s=[o.TestHubRefreshConstants.AUTHOR_TEXT_FILTER_ITEM_KEY,o.TestHubRefreshConstants.AUTHOR_ASSIGNEDTO_FILTER_ITEM_KEY,o.TestHubRefreshConstants.AUTHOR_STATE_FILTER_ITEM_KEY];if(e)for(const a of s){const s=e[a];if(s&&s.value&&s.value.length){t=!0;break}}return t};t.ReduxAuthorSelector.getFilteredTestCases=e=>{if(e&&e.authorFilterState)return e.authorFilterState.filteredTestCaseIds};t.ReduxAuthorSelector.getTestCasesFromState=e=>{let t=[];if(e.authorState&&e.authorState.testCases){t=Object.keys(e.authorState.testCases).map((e=>parseInt(e))).map((t=>e.authorState.testCases[t]))}return t};t.ReduxAuthorSelector.getTestCaseItemsFromState=(e,s)=>{if(e.authorState&&e.authorState.testCases){return d((0,t.ReduxAuthorSelector.getTestCasesFromState)(e),s)}};function d(e,t){const s=[];if(e)for(let n=0;n<e.length;n++)s.push({id:(i=e[n],i.workItem.id),name:l(e[n]),assignedTo:u(e[n]),order:p(e[n]),state:c(e[n],o.TestHubRefreshConstants.WorkItemField_State),pointAssignments:e[n].pointAssignments}),t&&(s[n].columnOptionValues=(0,a.getAllColumnValues)([o.TestHubRefreshConstants.WorkItemField_Tags],e[n]));var i;return s}function c(e,t){let s,a="";if(e&&e.workItem&&e.workItem.workItemFields){s=e.workItem;const o=s.workItemFields.find((e=>e.hasOwnProperty(t)));o&&(a=o[t])}return a}function u(e){let t;const s={id:"00000000-0000-0000-0000-000000000000",displayName:n.UnassignedString};if(e&&e.workItem&&e.workItem.workItemFields){t=e.workItem;const a=t.workItemFields.find((e=>e.hasOwnProperty(o.TestHubRefreshConstants.WorkItemField_AssignedTo)));if(a){const e=a[o.TestHubRefreshConstants.WorkItemField_AssignedTo];e&&e.identityRef&&(s.id=e.identityRef.id,s.displayName=e.identityRef.displayName?e.identityRef.displayName:e.identityRef.uniqueName)}}return s}function p(e){let t=1;return e&&e.order&&(t=e.order+1),t}t.ReduxAuthorSelector.getTestCasesCount=e=>{if(e.authorState.testCases)return Object.keys(e.authorState.testCases).length},t.ReduxAuthorSelector.getTestCaseItemsFromTestCase=d;t.ReduxAuthorSelector.getWITColumnOptionFields=e=>{const t=[o.TestHubRefreshConstants.WorkItemField_Ttile];return e&&e.testHubRefreshState&&e.testHubRefreshState.defineColumnOptionFields&&t.push(...(0,a.getWITColumnFields)(e.testHubRefreshState.defineColumnOptionFields)),t.join(",")};t.ReduxAuthorSelector.getWITColumnOptionFieldsArray=e=>{let t=[];return e&&e.testHubRefreshState&&e.testHubRefreshState.defineColumnOptionFields&&(t=(0,a.getWITColumnFields)(e.testHubRefreshState.defineColumnOptionFields)),t},t.ReduxAuthorSelector.getTestCasesToRender=s.createSelector(t.ReduxAuthorSelector.getTestCasesMapFromState,t.ReduxAuthorSelector.getTestCaseItemsFromState,t.ReduxAuthorSelector.getFilteredTestCases,t.ReduxAuthorSelector.getColumnAndSortOrder,i.getDefineColumnOptionFields,((e,t,s,o,i)=>{const n=[],r=[];let l=[];if(!s){if(t){if(e&&i)for(const s of t)s.columnOptionValues=(0,a.getAllColumnValues)(i,e[s.id]);t=t.sort((0,X.getTestCaseItemsComparator)(o.columnId,o.sortOrder))}return t}if(s&&0===s.length)return n;for(let t=0;t<s.length;t++)e[s[t]]&&r.push(e[s[t]]);if(r&&(l=d(r),l)){if(e&&i)for(const t of l)t.columnOptionValues=(0,a.getAllColumnValues)(i,e[t.id]);l=l.sort((0,X.getTestCaseItemsComparator)(o.columnId,o.sortOrder))}return l})),t.ReduxAuthorSelector.getUniqueFilterValuesToRender=s.createSelector(t.ReduxAuthorSelector.getTestCaseItemsFromState,(e=>{const t=new r.ObservableArray,s=new r.ObservableArray;if(e&&e.length>0){const a=new Map,o=new Map;for(const i of e){if(!a.has(i.assignedTo.id)){a.set(i.assignedTo.id,i.id);const e={id:i.assignedTo.displayName,text:i.assignedTo.displayName,data:{key:i.assignedTo.displayName,value:i.assignedTo}};t.push(e)}if(!o.has(i.state)){o.set(i.state,i.id);const e={id:i.state,text:i.state,data:{key:i.state,value:i.state}};s.push(e)}}}const a={};return a[o.TestHubRefreshConstants.AUTHOR_ASSIGNEDTO_FILTER_ITEM_KEY]=t,a[o.TestHubRefreshConstants.AUTHOR_STATE_FILTER_ITEM_KEY]=s,a}))}(),Q=t.ReduxAuthorActions={},t.ReduxAuthorActions.AuthorActions={initializeAuthorPivot:()=>(0,l.createAction)("AuthorPivot/initializeAuthorPivot"),loadInitialTestCases:()=>(0,l.createAction)("AuthorPivot/loadInitialTestCases"),loadInitialTestCasesSucceeded:e=>(0,l.createAction)("AuthorPivot/loadInitialTestCasesSucceeded",e),loadTestCasesForSelectedSuite:(e,t,s)=>(0,l.createAction)("AuthorPivot/loadTestCasesForSelectedSuite",{testPlanId:e,testSuiteId:t,continuationToken:s}),unloadPreviousTestCases:()=>(0,l.createAction)("AuthorPivot/unloadPreviousTestCases"),loadTestCasesForSelectedSuiteSucceeded:(e,t)=>(0,l.createAction)("AuthorPivot/loadTestCasesForSelectedSuiteSucceeded",{testCases:e,reload:t}),openNewTestCaseWitForm:(e,t,s,a)=>(0,l.createAction)("AuthorPivot/openNewTestCaseWitForm",{testplanId:e,testSuiteId:t,areaPath:s,iterationPath:a}),addExistingTestCases:(e,t,s)=>(0,l.createAction)("AuthorPivot/addExistingTestCases",{planId:e,suiteId:t,areaPath:s}),addOrEditTestCasesUsingGrid:(e,t,s,a,o,i)=>(0,l.createAction)("AuthorPivot/addOrEditTestCasesUsingGrid",{testCaseIds:e,planId:t,suiteId:s,planName:a,planAreaPath:o,planIteration:i}),openExistingTestCaseWitForm:(e,t,s,a,o,i)=>(0,l.createAction)("AuthorPivot/openExistingTestCaseWitForm",{planId:e,suiteId:t,testCaseId:s,testCaseTitle:a,testCaseState:o,testCaseAssignedTo:i}),updateTestCase:(e,t,s,a,o)=>(0,l.createAction)("AuthorPivot/updateTestCase",{testCaseId:e,testCaseTitle:t,testCaseState:s,testCaseAssignedTo:a,columnOptions:o}),assignConfigurationToTestCases:(e,t,s)=>(0,l.createAction)("AuthorPivot/assignConfigurationToTestCases",{planId:e,suiteId:t,testCaseIds:s}),updateFilteredTestCases:e=>(0,l.createAction)("AuthorPivot/updateFilteredTestCases",{filteredTestCases:e}),getTestCasesFromServer:(e,t,s)=>(0,l.createAction)("AuthorPivot/getTestCasesFromServer",{planId:e,suiteId:t,testCaseIds:s}),getTestCasesFromServerSucceeded:e=>(0,l.createAction)("AuthorPivot/getTestCasesFromServerSucceeded",{testCases:e}),removeTestCasesFromSuite:(e,t,s,a)=>(0,l.createAction)("AuthorPivot/removeTestCasesFromSuite",{planId:e,suiteId:t,testCaseIds:s,selection:a}),removeTestCasesFromSuiteSucceeded:(e,t,s)=>(0,l.createAction)("AuthorPivot/removeTestCasesFromSuiteSucceeded",{planId:e,suiteId:t,testCaseIds:s}),updateColumnAndSortOrder:(e,t)=>(0,l.createAction)("AuthorPivot/updateColumnAndSortOrder",{columnId:e,proposedSortOrder:t}),reorderTestCases:(e,t,s,a,o)=>(0,l.createAction)("AuthorPivot/reorderTestCases",{planId:e,suiteId:t,draggedtestCaseIds:s,startTestCaseOrder:a,shiftedTestCaseIds:o}),reorderTestCasesSucceeded:e=>(0,l.createAction)("AuthorPivot/reorderTestCasesSucceeded",{suiteEntries:e}),bulkEditTestCases:(e,t,s)=>(0,l.createAction)("AuthorPivot/bulkEditTestCases",{planId:e,suiteId:t,testCaseIds:s}),saveColumnWidths:e=>(0,l.createAction)("AuthorPivot/saveColumnWidths",{columnAndWidthMap:e}),fetchColumnWidths:()=>(0,l.createAction)("AuthorPivot/fetchColumnWidths",{}),getTestCasesCloneOpState:(e,t,s,a,o,i,n,r)=>(0,l.createAction)("AuthorPivot/getTestCasesCloneOpState",{sourcePlanId:e,sourceSuiteId:t,destinationPlanId:s,destinationSuiteId:a,destinationProject:o,opId:i,initialCall:n,project:r}),openSuiteInNewWindow:(e,t,s)=>(0,l.createAction)("AuthorPivot/openSuiteInNewWindow",{project:e,planId:t,suiteId:s}),filterTestCasesInState:()=>(0,l.createAction)("AuthorPivot/filterTestCasesInState",{}),fetchSuiteTestCasesCount:()=>(0,l.createAction)("AuthorPivot/fetchSuiteTestCasesCount",{})},$=t[ne="ReduxAuthorFilterReducer"]={},t[ne].AuthorFilterReducer=function(e,t){return e=e||{},(0,d.default)(e,(e=>{"AuthorPivot/updateFilteredTestCases"===t.type&&(e.filteredTestCaseIds=t.payload.filteredTestCases)}))},function(e){function s(e){const t={};if(e)for(const s of e)t[s.workItem.id]=s;return t}J=t.ReduxAuthorReducer={},t.ReduxAuthorReducer.AuthorReducer=function(e,t){return e=e||{},(0,d.default)(e,(e=>{switch(t.type){case"AuthorPivot/loadInitialTestCasesSucceeded":e.testCases=s(t.payload),e.columnAndSortOrder={columnId:Z.OrderColumn,sortOrder:void 0};break;case"AuthorPivot/loadTestCasesForSelectedSuiteSucceeded":if(e.columnAndSortOrder=Object.assign({},e.columnAndSortOrder),!e.testCases||t.payload.reload)e.testCases=s(t.payload.testCases);else{const a=s(t.payload.testCases);e.testCases=Object.assign(Object.assign({},e.testCases),a)}break;case"AuthorPivot/unloadPreviousTestCases":e.testCases=void 0;break;case"AuthorPivot/updateTestCase":const a=e.testCases[t.payload.testCaseId],i=a.workItem;i.name=t.payload.testCaseTitle;const n=i.workItemFields.findIndex((e=>e.hasOwnProperty(o.TestHubRefreshConstants.WorkItemField_State)));i.workItemFields[n]={[o.TestHubRefreshConstants.WorkItemField_State]:t.payload.testCaseState};const r=i.workItemFields.findIndex((e=>e.hasOwnProperty(o.TestHubRefreshConstants.WorkItemField_AssignedTo)));if(-1!=r?i.workItemFields[r]={[o.TestHubRefreshConstants.WorkItemField_AssignedTo]:{identityRef:{displayName:t.payload.testCaseAssignedTo}}}:i.workItemFields.push({[o.TestHubRefreshConstants.WorkItemField_AssignedTo]:{identityRef:{displayName:t.payload.testCaseAssignedTo}}}),t.payload.columnOptions)for(const e in t.payload.columnOptions){const s=i.workItemFields.findIndex((t=>t.hasOwnProperty(e)));i.workItemFields[s]={[e]:t.payload.columnOptions[e]}}e.testCases[t.payload.testCaseId]=a;break;case"AuthorPivot/getTestCasesFromServerSucceeded":for(let s=0;s<t.payload.testCases.length;s++){const a=t.payload.testCases[s].workItem.id,o=t.payload.testCases[s];e.testCases&&(e.testCases[a]=o)}break;case"AuthorPivot/removeTestCasesFromSuiteSucceeded":const l=t.payload.testCaseIds;for(let t=0;t<l.length;t++)delete e.testCases[l[t]];break;case"AuthorPivot/updateColumnAndSortOrder":const{columnId:d,proposedSortOrder:c}=t.payload;e.columnAndSortOrder.columnId=d,e.columnAndSortOrder.sortOrder=c;break;case"AuthorPivot/reorderTestCasesSucceeded":for(let s=0;s<t.payload.suiteEntries.length;s++)if(0===t.payload.suiteEntries[s].suiteEntryType){const a=t.payload.suiteEntries[s].id,o=e.testCases[a];o&&(o.order=t.payload.suiteEntries[s].sequenceNumber)}break;case"Suites/moveTestCaseToSuiteSucceeded":for(let s=0;s<t.payload.testCaseIds.length;s++)delete e.testCases[t.payload.testCaseIds[s]]}}))},t.ReduxAuthorReducer.generateTestCaseMap=s,t.ReduxAuthorReducer.getTestCasesLength=function(e){return Object.keys(e).length}}(),function(e){function s(e,t){if(t){const s=t[o.TestHubRefreshConstants.AUTHOR_TEXT_FILTER_ITEM_KEY];if(r(s)&&s.value.trim().length>0){const t=s.value.trim();if(e&&e.name&&t){const s=-1!==e.name.toLocaleLowerCase().indexOf(t.toLocaleLowerCase()),a=-1!==e.id.toString().indexOf(t);let i=!1;if(e.columnOptionValues&&e.columnOptionValues[o.TestHubRefreshConstants.WorkItemField_Tags]){const s=e.columnOptionValues[o.TestHubRefreshConstants.WorkItemField_Tags].split("; ");for(const e of s)if(-1!==e.toLocaleLowerCase().indexOf(t.toLocaleLowerCase())){i=!0;break}}return s||a||i}return!1}}return!0}function a(e,t){let s=!0,a=!0;if(e&&t){let i="";e.assignedTo&&e.assignedTo.displayName&&(i=e.assignedTo.displayName),s=n(i,t[o.TestHubRefreshConstants.AUTHOR_ASSIGNEDTO_FILTER_ITEM_KEY]),a=n(e.state,t[o.TestHubRefreshConstants.AUTHOR_STATE_FILTER_ITEM_KEY])}return s&&a}function n(e,t){if(r(t)){for(const s of t.value)if(s.key===e)return!0;return!1}return!0}function r(e){return e&&e.value&&e.value.length>0}ee=t[e]={},t[e].fetchFilteredSuiteTestCaseCounts=function*(e){const t=function(e){const t=[],s=[];if(r(e[o.TestHubRefreshConstants.AUTHOR_STATE_FILTER_ITEM_KEY]))for(const s of e[o.TestHubRefreshConstants.AUTHOR_STATE_FILTER_ITEM_KEY].value){const e=s.value;t.push(e)}if(r(e[o.TestHubRefreshConstants.AUTHOR_ASSIGNEDTO_FILTER_ITEM_KEY]))for(const t of e[o.TestHubRefreshConstants.AUTHOR_ASSIGNEDTO_FILTER_ITEM_KEY].value){const e=t.value.id;s.push(e)}return{states:t,assignedTo:s}}(yield c.effects.select(p.getCurrentFilterState));yield c.effects.put(f.SuitesActions.getSuiteTestCasesCount(e,t.states,t.assignedTo))},t[e].filterTestCases=function*(e){let t;const n=yield c.effects.select(p.getCurrentFilterState);if(!e)return t;t=[];for(const o of e){const e=s(o,n),i=a(o,n);e&&i&&t.push(o.id)}const l={pivot:o.TestHubRefreshConstants.DEFINE_TAB_ID,resultsCount:t.length,isAdvancedLicenseEnabled:yield c.effects.select(i.isAdvancedLicenseEnabled),textFilterHasValue:r(n[o.TestHubRefreshConstants.AUTHOR_TEXT_FILTER_ITEM_KEY]),assignedToFilterHasValue:r(n[o.TestHubRefreshConstants.AUTHOR_ASSIGNEDTO_FILTER_ITEM_KEY]),stateFilterHasValue:r(n[o.TestHubRefreshConstants.AUTHOR_STATE_FILTER_ITEM_KEY])};return yield c.effects.put(u.TelemetryActions.publishTelemetry(o.TelemetryConstants.FILTER_VALUES_CHANGED,l)),t}}("ReduxAuthorFilterHelper"),function(e){te=t[e]={};t[e].TestCaseCSVExporterUtility=class{constructor(e){this.c_newlineChar="\n",this.c_commaDelimiter=",",this.csvFileName=e}formatTestCaseData(e,t){let s={testCaseIds:t,rows:[],columns:[]};s.testCaseIds=t;const a=this._populateColumns(e);s.columns=a.columns;const o=a.referenceNames;return s.rows=this._populateRows(e,o),this.testCaseData=s,this.downloadCSV(),this.testCaseData}downloadCSV(){const e=this.csvFileName;this._getCSVContent(this.testCaseData).then((t=>{if(t&&t.length>0){const s=new Blob(["\ufeff"+t],{type:"text/csv;charset=utf-8;"});if((0,C.checkIfIsIE)())window.navigator.msSaveBlob(s,this.csvFileName);else{const t=window.document.createElement("a"),a=window.URL.createObjectURL(s);t.href=a,t.download=e,document.body.appendChild(t),t.click(),document.body.removeChild(t),window.URL.revokeObjectURL(a)}}})).catch((e=>{e&&console.error(e)}))}_populateColumns(e){let t=[],s=[];t.push(Y.Id),t.push(Y.WorkItemType),t.push(Y.Title),t.push(Y.TestStep),t.push(Y.StepAction),t.push(Y.StepExpected);let a=Object.keys(e[0].additionalFields);for(let e=0;e<a.length;e++)h.WorkItemColumnOptions[a[e]]&&a[e]!=o.TestHubRefreshConstants.WorkItemField_Id?(t.push(h.WorkItemColumnOptions[a[e]].name),s.push(a[e])):(0,h.isCustomField)(a[e])&&(t.push(a[e]),s.push(a[e]));return{columns:t,referenceNames:s}}_populateRows(e,t){let s=[];for(let a=0,i=e.length;a<i;a++){let i=[];e[a].isSharedStep?(i.push(String(e[a].refId)),i.push(Y.SharedStepWorkItemType)):e[a].isTestCase?(i.push(String(e[a].additionalFields[o.TestHubRefreshConstants.WorkItemField_Id])),i.push(Y.TestCaseWorkItemType)):(i.push(""),i.push("")),i.push(String(e[a].testCaseTitle)),i.push(0!=e[a].actionId?String(e[a].actionId):""),i.push(String(e[a].action)),i.push(String(e[a].expectedResult));for(let s=0,o=t.length;s<o;s++)e[a].isTestCase?i.push(e[a].additionalFields[t[s]]?String(e[a].additionalFields[t[s]]):""):i.push("");s[a]=i}return s}_getCSVContent(e){return new Promise(((t,s)=>{e&&(a=>{e&&e.testCaseIds&&e.testCaseIds.length>0?this._getCSVContentHelper(e).then((e=>{t(e)})).catch((e=>{s(e)})):t("")})()}))}async _getCSVContentHelper(e){const t=this._deduplicate(e.testCaseIds),s=[this._getEscapedCSVRows(this.testCaseData.rows)],a=await Promise.all(s);a.unshift([e.columns]);const o=this._getIndentationsData(t,[]),i=this._getCSVTextsFromRows(a,0,o);return Promise.resolve(i.filter((e=>e.length>0)).join(this.c_newlineChar))}_deduplicate(e){const t=[],s={};return e.forEach((e=>{s[e]||(s[e]=!0,t.push(e))})),t}_getCSVTextsFromRows(e,t,s){const a=s.maxIndentation;return e.map(((e,s)=>{if(0===e.length)return"";let o="";for(let i=0,n=e.length;i<n;i++){const n=0==s&&0==i,r=0;for(let s=0;s<t;s++)o+=e[i][s]+this.c_commaDelimiter;for(let s=0;s<=a;s++)n?o+=e[i][t]+(a>0?" "+String(s+1):""):s===r&&(o+=e[i][t]),o+=s<a||t<e[i].length-1?this.c_commaDelimiter:"";for(let s=t+1;s<e[i].length;s++)o+=e[i][s]+(s<e[i].length-1?this.c_commaDelimiter:"");o+=i<e.length-1?this.c_newlineChar:""}return o}))}_getIndentationsData(e,t){const s={maxIndentation:0,indentationsMap:{}};return e.forEach(((e,a)=>{let o=0;t.length>0&&0!==t[a]&&(o=s.indentationsMap[t[a]]+1),s.indentationsMap[e]=o,s.maxIndentation=Math.max(s.maxIndentation,o)})),s}_getEscapedCSVRows(e){if(!e||0===e.length)return[];const t=[];for(let s=0;s<e.length;s++){if(!(e[s]instanceof Array))continue;const a=new Array(e[s].length);for(let t=0;t<e[s].length;t++)a[t]=this._escapeForCSV(e[s][t]);t.push(a)}return t}_escapeForCSV(e){let t="";if("boolean"==typeof e)t=e?"1":"0";else{if(e instanceof Date){const t=e;e=`${t.toLocaleDateString()} ${t.toLocaleTimeString()}`}const s=null==e?"":String(e).replace(/"/g,'""');""!==s&&(t+=`"${s}"`)}return t}}}("TestCaseCSVExporterUtility"),function(e){function*s(e){const t=yield c.effects.getContext("pageContext"),s=yield c.effects.call([t,t.getService],"ITfsPageService"),a=yield c.effects.call([s,s.getData]);if(!a||!a.project)throw new Error("Project missing");let i={projectId:a.project.id,filterState:{},filterVisible:!1,filterKey:"testPlansHubFilterKey"};const n=yield c.effects.select(p.getFilterDetails);if(n){if(i=n,n.filterState&&n.filterState[o.TestHubRefreshConstants.EXECUTE_TEXT_FILTER_ITEM_KEY]){const e=n.filterState[o.TestHubRefreshConstants.EXECUTE_TEXT_FILTER_ITEM_KEY].value;e&&e.trim().length>0&&(i.filterState[o.TestHubRefreshConstants.AUTHOR_TEXT_FILTER_ITEM_KEY]=n.filterState[o.TestHubRefreshConstants.EXECUTE_TEXT_FILTER_ITEM_KEY])}n.filterState&&n.filterState[o.TestHubRefreshConstants.EXECUTE_STATE_FILTER_ITEM_KEY]&&(i.filterState[o.TestHubRefreshConstants.AUTHOR_STATE_FILTER_ITEM_KEY]=n.filterState[o.TestHubRefreshConstants.EXECUTE_STATE_FILTER_ITEM_KEY]),n.filterState&&n.filterState[o.TestHubRefreshConstants.EXECUTE_ASSIGNEDTO_FILTER_ITEM_KEY]&&(i.filterState[o.TestHubRefreshConstants.AUTHOR_ASSIGNEDTO_FILTER_ITEM_KEY]=n.filterState[o.TestHubRefreshConstants.EXECUTE_ASSIGNEDTO_FILTER_ITEM_KEY])}yield c.effects.put(p.ContentViewObserverActions.initializeFilterState(i)),yield c.effects.put(f.SuitesActions.updateLoadingStatus(!0))}function*r(){const e=yield c.effects.call(_);let t=yield c.effects.select(i.getDefineColumnOptionFields),s=!1;if(t)for(const e of t)if(e===o.TestHubRefreshConstants.WorkItemField_Tags){s=!0;break}const a=yield c.effects.select(q.getTestCaseItemsFromState,s);if(e){I.testHubRefreshLocalContextData.setIsAuthorFilterActiveOrSet(!0);const e=yield c.effects.call(ee.filterTestCases,a),t=e&&e.length>0?(0,g.format)(Y.TestCaseCountText,e.length):Y.ZeroTestCaseText;(0,m.announce)(t),yield c.effects.put(Q.AuthorActions.updateFilteredTestCases(e))}else{I.testHubRefreshLocalContextData.setIsAuthorFilterActiveOrSet(!1);const e=a&&a.length>0?(0,g.format)(Y.TestCaseCountText,a.length):Y.ZeroTestCaseText;(0,m.announce)(e),yield c.effects.put(Q.AuthorActions.updateFilteredTestCases(void 0))}}function*l(){const e=yield c.effects.select(i.getPlanId);(yield c.effects.call(_))?yield c.effects.call(ee.fetchFilteredSuiteTestCaseCounts,e):yield c.effects.put(f.SuitesActions.getSuiteTestCasesCount(e,[],[]))}function*d(e){const t=yield c.effects.call(_),s={isFilterVisible:yield c.effects.select(p.isFilterVisible),isFilterActive:t,pivot:o.TestHubRefreshConstants.DEFINE_TAB_ID,isAdvancedLicenseEnabled:yield c.effects.select(i.isAdvancedLicenseEnabled)};yield c.effects.put(u.TelemetryActions.publishTelemetry(o.TelemetryConstants.FILTER_TOGGLED,s))}function*_(){const e=yield c.effects.select(p.isFilterActive),t=yield c.effects.select(p.getCurrentFilterState),s=yield c.effects.call(q.isAnyAuthorFilterValueSet,t);return e||s}function*R(e){const t=yield c.effects.getContext("pageContext"),s=yield c.effects.call(C.getDataProviderContent,t);yield c.effects.put(Q.AuthorActions.loadInitialTestCasesSucceeded(s.testCases)),s.testCases&&(yield c.effects.put(f.SuitesActions.updateLoadingStatus(!1))),yield c.effects.put(y.TestHubRefreshActions.updateDefineTabCustomColumnFieldMap(s.defineTabCustomColumnFieldMap)),(yield c.effects.select(i.getDefineColumnOptionFields))||(yield c.effects.put(y.TestHubRefreshActions.loadDefineColumnOptionFieldsSucceeded(s.defineColumnOptionFields))),yield c.effects.put(Q.AuthorActions.fetchColumnWidths())}function*E(e){const t=yield c.effects.getContext("pageContext");let s={SelectedSuiteId:e.payload.selectedSuiteId.toString()};const a=yield c.effects.call([t,t.getService],"ISettingsService"),o=yield c.effects.call([t,t.getService],"ITfsPageService"),i=yield c.effects.call([o,o.getData]);yield c.effects.call([a,a.setEntries],s,0,"project",i.project.id),yield c.effects.put(Q.AuthorActions.updateFilteredTestCases(void 0)),yield c.effects.put(Q.AuthorActions.unloadPreviousTestCases()),yield c.effects.put(Q.AuthorActions.loadTestCasesForSelectedSuite(e.payload.planId,e.payload.selectedSuiteId))}function*v(e){const t=yield c.effects.getContext("pageContext"),s=yield c.effects.select(i.getDefineColumnOptionFields),n=yield c.effects.call([t,t.getService],"IVssLayoutManager"),r=(0,a.getAllPossibleFields)(),l=yield c.effects.call(c.channel),d={onSuccess:(e,t,s)=>{!function(e,t,s,a){e.put({displayColumns:t,displayColumnNames:s,newColumnsAdded:a})}(l,e,t,s)},existingColumnFields:s,allColumnFields:r.map((e=>({referenceName:e.key,displayName:e.name})))};yield c.effects.call([n,n.renderCallout],(e=>{const t={modules:["TestManagement/Scripts/Shared/ColumnOptionsPanelProxy"],wrappedType:"column-options-panel-proxy",wrappedProps:d};return T.createElement(A.LegacyComponent,t)}));const p=yield c.effects.take(l),f=yield c.effects.select(i.getDefineColumnOptionFields),C=p.displayColumns;let m={};p.displayColumns.forEach(((e,t)=>{(0,h.isCustomField)(e)&&(m[e]=p.displayColumnNames[t])})),yield c.effects.put(y.TestHubRefreshActions.updateDefineTabCustomColumnFieldMap(m)),yield c.effects.put(y.TestHubRefreshActions.loadDefineColumnOptionFieldsSucceeded(p.displayColumns)),p.newColumnsAdded&&(yield c.effects.put(Q.AuthorActions.loadTestCasesForSelectedSuite(e.payload.planId,e.payload.suiteId)));const S={NewDefineColumnOptions:p.displayColumns&&p.displayColumns.length>0?p.displayColumns.join(","):""},I=yield c.effects.call([t,t.getService],"ISettingsService"),g=yield c.effects.call([t,t.getService],"ITfsPageService"),b=yield c.effects.call([g,g.getData]);yield c.effects.call([I,I.setEntries],S,0,"project",b.project.id);const _={planId:e.payload.planId,suiteId:e.payload.suiteId,oldColumnOptionFields:f,newColumnOptionFields:C,isAdvancedLicenseEnabled:yield c.effects.select(i.isAdvancedLicenseEnabled),pivot:o.TestHubRefreshConstants.DEFINE_TAB_ID};yield c.effects.put(u.TelemetryActions.publishTelemetry(o.TelemetryConstants.COLUMN_OPTIONS_EDIT,_))}function*x(e){const t=yield c.effects.getContext("pageContext"),s=yield c.effects.call([t,t.getService],"ITestHubDataService"),a=yield c.effects.call(C.getDataProviderContent,t);let n,r=!1,l=e.payload.continuationToken;l||(r=!0,n=yield c.effects.select(q.getTestCasesCount),l=(0,g.format)("0;{0}",o.TestHubRefreshConstants.INITIAL_PAGE_SIZE)),r&&!n&&(yield c.effects.put(f.SuitesActions.updateLoadingStatus(!0)));(yield c.effects.select(i.getDefineColumnOptionFields))||(yield c.effects.put(y.TestHubRefreshActions.updateDefineTabCustomColumnFieldMap(a.defineTabCustomColumnFieldMap)),yield c.effects.put(y.TestHubRefreshActions.loadDefineColumnOptionFieldsSucceeded(a.defineColumnOptionFields))),yield c.effects.put(y.TestHubRefreshActions.updatePagingStatus(!0));const d=yield c.effects.select(q.getWITColumnOptionFields),p=yield c.effects.call([s,s.getTestCasesForSuite],e.payload.testPlanId,e.payload.testSuiteId,void 0,void 0,d,l,!0,d?1:3,!!d);yield c.effects.put(Q.AuthorActions.loadTestCasesForSelectedSuiteSucceeded(p.results,r));(yield c.effects.call(_))&&(yield c.effects.put(Q.AuthorActions.filterTestCasesInState())),r&&(yield c.effects.put(f.SuitesActions.updateLoadingStatus(!1)));const h=yield c.effects.select(i.getTestCasePageSize);if(p.continuationToken){const t=p.continuationToken.split(";");t&&2==t.length&&(t[1]=h.toString(),p.continuationToken=t.join(";")),yield c.effects.put(Q.AuthorActions.loadTestCasesForSelectedSuite(e.payload.testPlanId,e.payload.testSuiteId,p.continuationToken))}if(yield c.effects.put(y.TestHubRefreshActions.updatePagingStatus(!1)),!p.continuationToken){const t={planId:e.payload.testPlanId,suiteId:e.payload.testSuiteId,testCasesCount:yield c.effects.select(q.getTestCasesCount),isAdvancedLicenseEnabled:yield c.effects.select(i.isAdvancedLicenseEnabled),testCasePageSize:h};yield c.effects.put(u.TelemetryActions.publishTelemetry(o.TelemetryConstants.GET_TEST_CASES_FOR_SUITE,t))}}function*F(e){for(;;){const t=yield c.effects.take(e);yield c.effects.put(y.TestHubRefreshActions.updateBusyViewStatus(t))}}function*P(e){const t=yield c.effects.getContext("pageContext"),s=yield c.effects.call([t,t.getService],"IVssLayoutManager"),a=yield c.effects.call(c.channel),n=yield c.effects.call(c.channel),r=yield c.effects.select(q.getTestCasesFromState),l={areaPath:e.payload.areaPath,okCallback:s=>L(t,a,e.payload.planId,e.payload.suiteId,s,r,n)};yield c.effects.call([s,s.renderCallout],(e=>{const t={modules:["TestManagement/Scripts/Shared/AddToExistingTestCasesProxy"],wrappedType:"add-to-existing-dialog-proxy",wrappedProps:l,loadingComponent:()=>T.createElement(b.Spinner,{className:"spinner-pos",size:"medium"})};return T.createElement(A.LegacyComponent,t)}));const[d,p]=yield c.effects.all([c.effects.fork(F,n),c.effects.take(a)]);yield c.effects.put(Q.AuthorActions.loadTestCasesForSelectedSuite(p.planId,p.suiteId)),yield c.effects.put(y.TestHubRefreshActions.updateBusyViewStatus(!1)),yield c.effects.put(Q.AuthorActions.fetchSuiteTestCasesCount());(yield c.effects.select(i.getInitiallySelectedSuiteId))===p.suiteId&&I.testHubRefreshLocalContextData.makeJsonIslandDataDirty();const f={suiteId:e.payload.suiteId,planId:e.payload.planId,testCaseIds:p.testCaseIds,isAdvancedLicenseEnabled:yield c.effects.select(i.isAdvancedLicenseEnabled)};yield c.effects.put(u.TelemetryActions.publishTelemetry(o.TelemetryConstants.ADD_EXISTING_TEST_CASES,f))}function*w(e){let t=[];const s=yield c.effects.select(q.getColumnAndSortOrder),o=yield c.effects.select(q.getTestCasesMapFromState),n=yield c.effects.select(i.getDefineColumnOptionFields);let r=yield c.effects.select(q.getTestCaseItemsFromState);if(o&&n)for(const e of r)e.columnOptionValues=(0,a.getAllColumnValues)(n,o[e.id]);if(r){r=s&&void 0!==s.sortOrder?r.sort((0,X.getTestCaseItemsComparator)(s.columnId,s.sortOrder)):r.sort((0,X.getTestCaseItemsComparator)(Z.OrderColumn,0));for(let e=0;e<r.length;e++)t[e]=r[e].id}yield c.effects.put(Q.AuthorActions.addOrEditTestCasesUsingGrid(t,e.payload.planId,e.payload.suiteId,e.payload.planName,e.payload.areaPath,e.payload.iterationPath))}function*O(e){const t=yield c.effects.getContext("pageContext");yield c.effects.put(y.TestHubRefreshActions.setGridView(!0));const s=yield c.effects.select(S.getTestSuiteById,e.payload.suiteId);let a=yield c.effects.select(q.getWITColumnOptionFieldsArray);const n=yield c.effects.call(c.channel);a=a.filter((e=>e!==Z.WorkItemId));const r={gridOption:2,selectedSuite:s,plan:{id:e.payload.planId,name:e.payload.planName,iteration:e.payload.planIteration,areaPath:e.payload.planAreaPath,buildUri:""},testCaseIds:e.payload.testCaseIds,columnOptions:a,isDirtyCallback:e=>{!function(e,t){e.put({isDirty:t})}(n,e)}},l=yield c.effects.call([t,t.getService],"IVssLayoutManager");yield c.effects.call([l,l.renderCallout],(e=>{const t={modules:["TestManagement/Scripts/Shared/GridViewProxyComponent"],wrappedType:"grid-view-proxy-component",wrappedProps:r};return T.createElement(A.LegacyComponent,t)}));const d={suiteId:e.payload.suiteId,planId:e.payload.planId,gridViewSelected:!0,isAdvancedLicenseEnabled:yield c.effects.select(i.isAdvancedLicenseEnabled)};for(yield c.effects.put(u.TelemetryActions.publishTelemetry(o.TelemetryConstants.GRID_VIEW_SELECTED,d));;){const e=yield c.effects.take(n);yield c.effects.put(y.TestHubRefreshActions.setIsGridDirty(e.isDirty))}}function*H(e){const t=yield c.effects.getContext("pageContext");yield c.effects.put(y.TestHubRefreshActions.setGridView(!1));const s={gridOption:3},a=yield c.effects.call([t,t.getService],"IVssLayoutManager");yield c.effects.call([a,a.renderCallout],(e=>{const t={modules:["TestManagement/Scripts/Shared/GridViewProxyComponent"],wrappedType:"grid-view-proxy-component",wrappedProps:s};return T.createElement(A.LegacyComponent,t)})),yield c.effects.put(f.SuitesActions.getSuiteTestCasesCount(e.payload.planId,[],[]))}function*k(e){const t=yield c.effects.getContext("pageContext"),s=yield c.effects.call([t,t.getService],"IVssLayoutManager"),a=yield c.effects.call(c.channel),r={suite:{id:e.payload.suiteId},planId:e.payload.planId,dialogType:Z.AssignConfigToTestCasesDialog,testCaseIds:e.payload.testCaseIds,onSuccess:()=>{a.put({duration:o.TestHubRefreshConstants.TOAST_MESSAGE_DURATION})}};yield c.effects.call([s,s.renderCallout],(e=>{const t={modules:["TestManagement/Scripts/Shared/AssignConfigDialogProxy"],wrappedType:"assign-config-dialog-proxy",wrappedProps:r,loadingComponent:()=>T.createElement(b.Spinner,{className:"spinner-pos",size:"medium"})};return T.createElement(A.LegacyComponent,t)}));const l=yield c.effects.take(a);yield c.effects.put(f.SuitesActions.showToastNotifications(n.ConfigurationUpdated,l.duration));const d={suiteId:e.payload.suiteId,planId:e.payload.planId,testCaseIds:e.payload.testCaseIds,isAdvancedLicenseEnabled:yield c.effects.select(i.isAdvancedLicenseEnabled)};yield c.effects.put(u.TelemetryActions.publishTelemetry(o.TelemetryConstants.ASSIGN_CONFIGURATION_TO_TEST_CASE,d))}function*D(e){const t=yield c.effects.getContext("pageContext"),s=yield c.effects.call([t,t.getService],"ITfsPageService"),a=yield c.effects.call([s,s.getData]),n=yield c.effects.call([t,t.getService],"IVssContributionService");yield c.effects.call([n,n.getContributionsAsync],["ms.vss-features.ui-responsive-viewport-content","ms.vss-work-web.common-content"]);const r=yield c.effects.call(c.channel),l=yield c.effects.call([t,t.getRestClient],"IWorkItemTrackingRestClient"),d=yield c.effects.call([l,l.getWorkItemTypeCategory],a.project.id,Z.WorkItemTypeCategoryTestCase),p=d?d.defaultWorkItemType.name:Y.TestCaseWorkItemType,f=yield c.effects.call([t,t.getService],"work-item-service");if(!f)throw new Error("Unable to fetch workitem service instance.");yield c.effects.call([f,f.createWorkItem],p,Z.TestCaseCreationMode,{save:s=>{L(t,r,e.payload.testplanId,e.payload.testSuiteId,[s.id])}},{"System.AreaPath":e.payload.areaPath,"System.IterationPath":e.payload.iterationPath});const h=yield c.effects.take(r);yield c.effects.put(Q.AuthorActions.loadTestCasesForSelectedSuite(h.planId,h.suiteId)),yield c.effects.put(Q.AuthorActions.fetchSuiteTestCasesCount());(yield c.effects.select(i.getInitiallySelectedSuiteId))===h.suiteId&&I.testHubRefreshLocalContextData.makeJsonIslandDataDirty();const C={suiteId:e.payload.testSuiteId,planId:e.payload.testplanId,testCaseIds:h.testCaseIds,isAdvancedLicenseEnabled:yield c.effects.select(i.isAdvancedLicenseEnabled)};yield c.effects.put(u.TelemetryActions.publishTelemetry(o.TelemetryConstants.ADD_TEST_CASE_USING_FORM,C))}function L(e,t,s,a,o,i,n){const r=e.getService("ITestHubDataService");if(!r)throw new Error("Unable to fetch hub data service instance.");{const l=[],d=o.length;n&&n.put(!0);for(let e=0;e<d;e++){if(i&&i.length>0){const t=i.filter((t=>t.workItem.id===o[e]));if(t&&t.length>0)continue}const t={pointAssignments:[],workItem:{id:o[e]}};l.push(t)}l.length>0?r.addTestCasesToSelectedSuite(l,s,a).then((()=>{t.put({planId:s,suiteId:a,testCaseIds:o})})).catch((t=>{n&&n.put(!1),(0,C.showErrorToast)(e,t.message,t.message)})):n&&n.put(!1)}}function*N(e){const t=yield c.effects.call(c.channel),s=yield c.effects.getContext("pageContext"),a=yield c.effects.call([s,s.getService],"IVssContributionService");yield c.effects.call([a,a.getContributionsAsync],["ms.vss-features.ui-responsive-viewport-content","ms.vss-work-web.common-content"]);const n=yield c.effects.call([s,s.getService],"work-item-service"),r=yield c.effects.select(q.getWITColumnOptionFieldsArray);if(!n)throw new Error("Unable to fetch workitem service instance.");yield c.effects.call([n,n.openWorkItem],e.payload.testCaseId,{save:s=>{const a=s.getTitle(),n=s.getState();let l=s.getFieldValue(o.TestHubRefreshConstants.WorkItemField_AssignedTo);l=(0,i.getIdentityDisplayString)(l);const d={};for(const e of r)d[e]=s.getFieldValue(e);t.put({testCaseId:e.payload.testCaseId,testCaseTitle:a,testCaseState:n,testCaseAssignedTo:l,columnOptions:d})}});const l=yield c.effects.take(t);yield c.effects.put(Q.AuthorActions.updateTestCase(l.testCaseId,l.testCaseTitle,l.testCaseState,l.testCaseAssignedTo,l.columnOptions));(yield c.effects.select(i.getInitiallySelectedSuiteId))===e.payload.suiteId&&I.testHubRefreshLocalContextData.makeJsonIslandDataDirty(),yield c.effects.put(Q.AuthorActions.getTestCasesFromServer(e.payload.planId,e.payload.suiteId,[e.payload.testCaseId]));(yield c.effects.call(_))&&(yield c.effects.put(Q.AuthorActions.filterTestCasesInState()),yield c.effects.put(Q.AuthorActions.fetchSuiteTestCasesCount()));const d={suiteId:e.payload.suiteId,planId:e.payload.planId,testCaseId:l.testCaseId,isAdvancedLicenseEnabled:yield c.effects.select(i.isAdvancedLicenseEnabled)};yield c.effects.put(u.TelemetryActions.publishTelemetry(o.TelemetryConstants.EDIT_TEST_CASE_USING_FORM,d))}function*V(e){const t=yield c.effects.getContext("pageContext"),s=yield c.effects.call([t,t.getService],"ITestHubDataService"),a=yield c.effects.select(q.getWITColumnOptionFields),o=yield c.effects.call([s,s.getTestCasesForSuite],e.payload.planId,e.payload.suiteId,e.payload.testCaseIds.join(","),void 0,a,void 0,!0,a?1:3,!!a);o.results&&(yield c.effects.put(Q.AuthorActions.getTestCasesFromServerSucceeded(o.results)))}function*W(e){const t=yield c.effects.getContext("pageContext"),s=yield c.effects.call([t,t.getService],"ITestHubDataService");yield c.effects.put(y.TestHubRefreshActions.updateBusyViewStatus(!0)),yield c.effects.call([s,s.removeTestCasesFromSuite],e.payload.planId,e.payload.suiteId,e.payload.testCaseIds.join(",")),e.payload.selection&&e.payload.selection.clear(),yield c.effects.put(Q.AuthorActions.removeTestCasesFromSuiteSucceeded(e.payload.planId,e.payload.suiteId,e.payload.testCaseIds)),yield c.effects.put(y.TestHubRefreshActions.updateBusyViewStatus(!1)),yield c.effects.put(Q.AuthorActions.fetchSuiteTestCasesCount());(yield c.effects.select(i.getInitiallySelectedSuiteId))===e.payload.suiteId&&I.testHubRefreshLocalContextData.makeJsonIslandDataDirty();const a={suiteId:e.payload.suiteId,planId:e.payload.planId,testCaseIds:e.payload.testCaseIds,isAdvancedLicenseEnabled:yield c.effects.select(i.isAdvancedLicenseEnabled)};yield c.effects.put(u.TelemetryActions.publishTelemetry(o.TelemetryConstants.REMOVE_TEST_CASES,a))}function*M(e){const t=yield c.effects.getContext("pageContext"),s=yield c.effects.call([t,t.getService],"ITestHubDataService");yield c.effects.put(y.TestHubRefreshActions.updateBusyViewStatus(!0));let a=e.payload.startTestCaseOrder-1;const n=[];for(let t=0;t<e.payload.shiftedTestCaseIds.length;t++)e.payload.shiftedTestCaseIds[t]>0&&(n.push({id:e.payload.shiftedTestCaseIds[t],sequenceNumber:a,suiteEntryType:0}),a++);const r=yield c.effects.call([s,s.reorderSuiteEntries],n,e.payload.suiteId);r&&(yield c.effects.put(Q.AuthorActions.reorderTestCasesSucceeded(r))),yield c.effects.put(y.TestHubRefreshActions.updateBusyViewStatus(!1));const l={planId:e.payload.planId,suiteId:e.payload.suiteId,testCaseIds:e.payload.draggedtestCaseIds,isAdvancedLicenseEnabled:yield c.effects.select(i.isAdvancedLicenseEnabled)};yield c.effects.put(u.TelemetryActions.publishTelemetry(o.TelemetryConstants.REORDER_TEST_CASES,l))}function*U(e){const t=yield c.effects.call(c.channel),s=yield c.effects.getContext("pageContext"),a=yield c.effects.call([s,s.getService],"ITfsPageService"),n=yield c.effects.call([a,a.getData]),r=yield c.effects.call([s,s.getRestClient],"IWorkItemTrackingRestClient"),l=yield c.effects.call([r,r.getWorkItemTypeCategory],n.project.id,Z.WorkItemTypeCategoryTestCase),d=l?l.defaultWorkItemType.name:Y.TestCaseWorkItemType;let p=new Array;p[n.project.name]=[d];const f={testCaseIds:e.payload.testCaseIds,projectTypeMapping:p,okCallback:e=>function(e,t){e&&t.put({dialogResult:e})}(e,t)},h=yield c.effects.call([s,s.getService],"IVssLayoutManager");yield c.effects.call([h,h.renderCallout],(e=>{const t={modules:["TestManagement/Scripts/Shared/TestCaseBulkEditProxy"],wrappedType:"testcase-bulk-edit-proxy",wrappedProps:f,loadingComponent:()=>T.createElement(b.Spinner,{className:"spinner-pos",size:"medium"})};return T.createElement(A.LegacyComponent,t)}));if(yield c.effects.take(t)){e.payload.testCaseIds.length>250?yield c.effects.put(Q.AuthorActions.loadTestCasesForSelectedSuite(e.payload.planId,e.payload.suiteId)):yield c.effects.put(Q.AuthorActions.getTestCasesFromServer(e.payload.planId,e.payload.suiteId,e.payload.testCaseIds));const t={planId:e.payload.planId,suiteId:e.payload.suiteId,testCaseIds:e.payload.testCaseIds,isAdvancedLicenseEnabled:yield c.effects.select(i.isAdvancedLicenseEnabled)};yield c.effects.put(u.TelemetryActions.publishTelemetry(o.TelemetryConstants.BULK_EDIT_TEST_CASES,t))}}function*G(e){const t=yield c.effects.getContext("pageContext"),s=yield c.effects.call([t,t.getService],"ISettingsService"),a=yield c.effects.call([t,t.getService],"ITfsPageService"),o=yield c.effects.call([a,a.getData]);if(e.payload&&e.payload.columnAndWidthMap){let t;t={DefineColumnWidths:e.payload.columnAndWidthMap},yield c.effects.call([s,s.setEntries],t,0,"project",o.project.id)}}function*K(e){const t=yield c.effects.getContext("pageContext"),s=yield c.effects.call([t,t.getService],"ISettingsService"),a=yield c.effects.call([t,t.getService],"ITfsPageService"),o=yield c.effects.call([a,a.getData]);let i=yield c.effects.call([s,s.getEntriesAsync],"",0,"project",o.project.id);i&&i.DefineColumnWidths&&(yield c.effects.put(y.TestHubRefreshActions.changeDefineColumnWidths(void 0,void 0,i.DefineColumnWidths)))}function*B(e){let t=[];if(e.payload.testCaseIds)t=e.payload.testCaseIds;else{const e=yield c.effects.select(q.getTestCaseItemsFromState);e&&e.length>0&&(t=e.map((e=>e.id)))}if(t.length>0){yield c.effects.put(y.TestHubRefreshActions.updateBusyViewStatus(!0));const s=yield c.effects.select(i.getDefineColumnOptionFields);let a=s.filter((e=>!h.OtherColumnOptions[e]));const n=yield c.effects.getContext("pageContext"),r=e.payload.planName+"_"+e.payload.suiteName+".csv",l={testCaseIds:t,columnOptions:a,okCallBack:e=>{new te.TestCaseCSVExporterUtility(r).formatTestCaseData(e,t)}},d=yield c.effects.call([n,n.getService],"IVssLayoutManager");yield c.effects.call([d,d.renderCallout],(e=>{const t={modules:["TestManagement/Scripts/Shared/TestCaseExportProxyComponent"],wrappedType:"testcases-export-proxy-component",wrappedProps:l};return T.createElement(A.LegacyComponent,t)})),yield c.effects.put(y.TestHubRefreshActions.updateBusyViewStatus(!1));const p={testCaseIdsCount:t.length,planId:e.payload.planId,suiteId:e.payload.suiteId,columnOptions:s,isAdvancedLicenseEnabled:yield c.effects.select(i.isAdvancedLicenseEnabled)};yield c.effects.put(u.TelemetryActions.publishTelemetry(o.TelemetryConstants.EXPORT_TESTCASES,p))}}function*j(e){try{const t=yield c.effects.getContext("pageContext"),s=yield c.effects.call([t,t.getService],"ITestHubDataService");e.payload.initialCall&&(yield c.effects.put(f.SuitesActions.showToastNotifications(n.TestCasesCloneInitiated,o.TestHubRefreshConstants.TOAST_MESSAGE_DURATION)));let a=yield c.effects.call([s,s.getTestCaseCloneInformation],e.payload.opId,e.payload.project),i=0;if(a&&a.cloneOperationResponse&&(i=a.cloneOperationResponse.state),3!==i)yield c.effects.delay(5e3),yield c.effects.put(Q.AuthorActions.getTestCasesCloneOpState(e.payload.sourcePlanId,e.payload.sourceSuiteId,e.payload.destinationPlanId,e.payload.destinationSuiteId,e.payload.destinationProject,e.payload.opId,!1,e.payload.project));else{const t=yield c.effects.call(c.channel);if(e.payload.sourcePlanId===e.payload.destinationPlanId)for(yield c.effects.put(f.SuitesActions.showToastNotifications(n.TestCasesCloneCompleted,Z.TOAST_MESSAGE_DURATION,n.Refresh,(()=>{$(t,e.payload.sourcePlanId,void 0,void 0,!0)})));;){const e=yield c.effects.take(t);yield c.effects.put(f.SuitesActions.reloadTestPlanAndSuites(e.sourcePlanId))}else for(yield c.effects.put(f.SuitesActions.showToastNotifications(n.TestCasesCloneCompleted,Z.TOAST_MESSAGE_DURATION,n.GoToDestinationSuite,(()=>{$(t,e.payload.destinationPlanId,e.payload.destinationSuiteId,e.payload.destinationProject,!1)})));;){const e=yield c.effects.take(t);yield c.effects.put(Q.AuthorActions.openSuiteInNewWindow(e.destinationProject,e.destinationPlanId,e.destinationSuiteId))}}}catch(e){yield c.effects.put(f.SuitesActions.showToastNotifications(e.message,Z.TOAST_MESSAGE_DURATION))}}function*z(e){const t=yield c.effects.getContext("pageContext"),s=yield c.effects.call([t,t.getService],"IVssLocationService"),a={project:e.payload.project,pivots:o.TestHubRefreshConstants.DEFINE_TAB_ID};let i=yield c.effects.call([s,s.routeUrl],Z.contributionId,a);i+=(0,g.format)(Z.queryParams,e.payload.planId,e.payload.suiteId);let n=yield c.effects.call([window,window.open],i,"_blank");n&&(n.opener=null)}function $(e,t,s,a,o){o?e.put({sourcePlanId:t}):e.put({destinationPlanId:t,destinationSuiteId:s,destinationProject:a})}se=t.ReduxAuthorSaga={},t.ReduxAuthorSaga.AuthorSaga=function*(){yield c.effects.takeLatest("AuthorPivot/initializeAuthorPivot",J),yield c.effects.debounce(100,"ContentViewObserver/FilterStateChanged",ae),yield c.effects.debounce(200,"ContentViewObserver/FilterStateChanged",oe),yield c.effects.takeLatest("AuthorPivot/filterTestCasesInState",ae),yield c.effects.takeLatest("AuthorPivot/fetchSuiteTestCasesCount",oe),yield c.effects.takeLatest("Suites/moveTestCaseToSuiteSucceeded",oe),yield c.effects.takeLatest("ContentViewObserver/FilterToggled",ie),yield c.effects.takeLatest("AuthorPivot/loadInitialTestCases",ne),yield c.effects.takeLatest("Suites/changeSelectedSuite",re),yield c.effects.takeLatest("TestHubRefreshActions/editColumnOptionFieldsClicked",le),yield c.effects.takeLatest("AuthorPivot/loadTestCasesForSelectedSuite",de),yield c.effects.takeLatest("AuthorPivot/addExistingTestCases",ce),yield c.effects.takeLatest("TestHubRefreshActions/showSuiteLevelGrid",ue),yield c.effects.takeLatest("AuthorPivot/addOrEditTestCasesUsingGrid",pe),yield c.effects.takeLatest("TestHubRefreshActions/closeGrid",fe),yield c.effects.takeLatest("AuthorPivot/assignConfigurationToTestCases",he),yield c.effects.takeLatest("AuthorPivot/openNewTestCaseWitForm",Ce),yield c.effects.takeLatest("AuthorPivot/openExistingTestCaseWitForm",Te),yield c.effects.takeLatest("AuthorPivot/getTestCasesFromServer",me),yield c.effects.takeLatest("AuthorPivot/removeTestCasesFromSuite",Se),yield c.effects.takeLatest("AuthorPivot/reorderTestCases",ye),yield c.effects.takeLatest("AuthorPivot/bulkEditTestCases",Ie),yield c.effects.takeLatest("AuthorPivot/saveColumnWidths",ge),yield c.effects.takeLatest("AuthorPivot/fetchColumnWidths",Ae),yield c.effects.takeLatest("Suites/exportTestCasesToCSV",be),yield c.effects.takeLatest("AuthorPivot/getTestCasesCloneOpState",_e),yield c.effects.takeLatest("AuthorPivot/openSuiteInNewWindow",Re)},t.ReduxAuthorSaga.initializeAuthorPivot=s,t.ReduxAuthorSaga.filterTestCasesInState=r,t.ReduxAuthorSaga.fetchSuiteTestCaseCounts=l,t.ReduxAuthorSaga.filterToggled=d,t.ReduxAuthorSaga.isFilterActiveOrFilterValueSet=_,t.ReduxAuthorSaga.loadInitialTestCases=R,t.ReduxAuthorSaga.changeSelectedSuite=E,t.ReduxAuthorSaga.editColumnOptionFieldsClicked=v,t.ReduxAuthorSaga.loadTestCasesForSelectedSuite=x,t.ReduxAuthorSaga.updateBusyViewSpinnerStatus=F,t.ReduxAuthorSaga.addExistingTestCases=P,t.ReduxAuthorSaga.showSuiteLevelGrid=w,t.ReduxAuthorSaga.addOrEditTestCasesUsingGrid=O,t.ReduxAuthorSaga.closeGrid=H,t.ReduxAuthorSaga.assignConfigurationToTestCases=k,t.ReduxAuthorSaga.openNewTestCaseWitForm=D,t.ReduxAuthorSaga.openExistingTestCaseWitForm=N,t.ReduxAuthorSaga.getTestCasesFromServer=V,t.ReduxAuthorSaga.removeTestCasesFromSuite=W,t.ReduxAuthorSaga.reorderTestCases=M,t.ReduxAuthorSaga.bulkEditTestCases=U,t.ReduxAuthorSaga.saveColumnWidths=G,t.ReduxAuthorSaga.fetchColumnWidths=K,t.ReduxAuthorSaga.exportTestCasesToCSV=B,t.ReduxAuthorSaga.getTestCasesCloneOpState=j,t.ReduxAuthorSaga.openSuiteInNewWindow=z;const J=(0,C.errorHandledSaga)((function*(e){yield c.effects.call(s,e)})),ae=(0,C.errorHandledSaga)((function*(){yield c.effects.call(r)})),oe=(0,C.errorHandledSaga)((function*(){yield c.effects.call(l)})),ie=(0,C.errorHandledSaga)((function*(e){yield c.effects.call(d,e)})),ne=(0,C.errorHandledSaga)((function*(e){yield c.effects.call(R,e)})),re=(0,C.errorHandledSaga)((function*(e){yield c.effects.call(E,e)})),le=(0,C.errorHandledSaga)((function*(e){yield c.effects.call(v,e)})),de=(0,C.errorHandledSaga)((function*(e){yield c.effects.call(x,e)})),ce=(0,C.errorHandledSaga)((function*(e){yield c.effects.call(P,e)})),ue=(0,C.errorHandledSaga)((function*(e){yield c.effects.call(w,e)})),pe=(0,C.errorHandledSaga)((function*(e){yield c.effects.call(O,e)})),fe=(0,C.errorHandledSaga)((function*(e){yield c.effects.call(H,e)})),he=(0,C.errorHandledSaga)((function*(e){yield c.effects.call(k,e)})),Ce=(0,C.errorHandledSaga)((function*(e){yield c.effects.call(D,e)})),Te=(0,C.errorHandledSaga)((function*(e){yield c.effects.call(N,e)})),me=(0,C.errorHandledSaga)((function*(e){yield c.effects.call(V,e)})),Se=(0,C.errorHandledSaga)((function*(e){yield c.effects.call(W,e)})),ye=(0,C.errorHandledSaga)((function*(e){yield c.effects.call(M,e)})),Ie=(0,C.errorHandledSaga)((function*(e){yield c.effects.call(U,e)})),ge=(0,C.errorHandledSaga)((function*(e){yield c.effects.call(G,e)})),Ae=(0,C.errorHandledSaga)((function*(e){yield c.effects.call(K,e)})),be=(0,C.errorHandledSaga)((function*(e){yield c.effects.call(B,e)})),_e=(0,C.errorHandledSaga)((function*(e){yield c.effects.call(j,e)})),Re=(0,C.errorHandledSaga)((function*(e){yield c.effects.call(z,e)}))}(),ae=t.ReduxAuthorModule={},t.ReduxAuthorModule.getAuthorModule=function(e,t,s,a){const o=[];return o.push(Q.AuthorActions.initializeAuthorPivot()),e&&0!=e.length||(s!==a||I.testHubRefreshLocalContextData.isJsonIslandDataDirty()?o.push(Q.AuthorActions.loadTestCasesForSelectedSuite(t,a)):o.push(Q.AuthorActions.loadInitialTestCases())),{id:"author",reducerMap:{authorState:J.AuthorReducer,testHubRefreshState:R.TestHubRefreshReducer,authorFilterState:$.AuthorFilterReducer,suiteState:_.SuitesReducer},sagas:[se.AuthorSaga],initialActions:o}},function(e){oe=t[e]={};class s extends v.VssComponent{constructor(e,t){super(e,t),this._context=t.pageContext}componentDidMount(){const e=this._context.getService("IVssLayoutManager"),t={gridOption:1};e.renderCallout((e=>{const s={modules:["TestManagement/Scripts/Shared/GridViewProxyComponent"],wrappedType:"grid-view-proxy-component",wrappedProps:t};return T.createElement(A.LegacyComponent,s)}))}render(){return T.createElement("div",{className:"testplans-hub-refresh-author-pivot-for-grid"},T.createElement("hr",{className:"testplans-hub-refresh-hr"}),T.createElement("div",{className:"hub-pivot-toolbar"}),T.createElement("hr",{className:"testplans-hub-refresh-hr"}),T.createElement("div",{className:"testplans-hub-refresh-grid-area"}))}}t[e].GridViewComponent=s,t[e].GridViewConnectedComponent=(0,E.connect)(null,null)(s),v.VssComponent.register("gridView",t[e].GridViewConnectedComponent)}("ComponentGridViewConnectedComponent"),function(e){ie=t[e]={};t[e].TestCasesTableItemProvider=class{constructor(){this._items=new r.ObservableArray}getTestCaseItems(e,t,s){if(!e||0==e.length)return this._items.removeAll(),this._items;const a=[];if(t&&t.value&&t.value.length>0){const e=t.value.length;for(let s=0;s<e;s++){const e=t.value[s];if(e)for(let t=e.beginIndex;t<=e.endIndex;t++)a.push(t)}}if(this._items.removeAll(),s&&0===s.length)return this._items;for(let t=0;t<e.length;t++){const s=Object.assign(Object.assign({},e[t]),e[t].columnOptionValues);this._items.push(s)}if(t&&a&&a.length>0)for(const e of a)t.select(e,1,!0);return this._items}}}("ComponentTestCasesTableItemProvider"),function(e){t[e]={};class s extends v.VssComponent{constructor(e,t){var s;super(e,t),this._lastFocusedTestCaseId=new r.ObservableValue(void 0),this._loadingWorkItem=new r.ObservableValue(!1),this._columnsVersionKey=1,this._onDragStart=e=>{e.detail.dataTransfer.secondaryData&&this._testCasesTableSelection.selectedCount<=1&&this._testCasesTableSelection.select(e.detail.dataTransfer.secondaryData.index);const t=this._testCasesTableSelection.value.length,s=[];for(let e=0;e<t;e++)for(let t=this._testCasesTableSelection.value[e].beginIndex;t<=this._testCasesTableSelection.value[e].endIndex;t++)s.push(this.props.testCases[t].id);this.props.testhubRefreshContext&&this.props.testhubRefreshContext.setSelectedTestCaseIds(s)},this._onDrop=(e,t)=>{if(this.props.filteredTestCases&&this.props.filteredTestCases.length>0)e.detail.dataTransfer.effectAllowed="none",this.props.showToastNotifications(Y.ClearFilter,o.TestHubRefreshConstants.TOAST_MESSAGE_DURATION);else{let s=!1;for(let e=0;e<this._tableColumns.length;e++){let t=this._tableColumns[e].sortProps;if(t&&void 0!==t.sortOrder){if(this._tableColumns[e]&&"order"===this._tableColumns[e].id&&0===t.sortOrder)break;s=!0;break}}if(s)e.detail.dataTransfer.effectAllowed="none",this.props.showToastNotifications(Y.SortByOrderAscending,o.TestHubRefreshConstants.TOAST_MESSAGE_DURATION);else{let e=[];this.props.testhubRefreshContext&&(e=this.props.testhubRefreshContext.getSelectedTestCaseIds());const s=[],a=this._testCasesTableSelection.value.length;let o=this._testCasesTableSelection.value[0].beginIndex,i=this._testCasesTableSelection.value[a-1].endIndex;t.index<o&&(o=t.index),t.index>i&&(i=t.index);const n=this.props.testCases[o].order;for(let e=o;e<=i;e++)this.props.testCases[e]&&s.push(this.props.testCases[e].id);const r=t.index-o;for(let t=0;t<e.length;t++){const a=e[t],o=s.indexOf(a);s[o]>0&&(s[o]*=-1),s.splice(r+t,0,a)}this.props.reorderTestCases(this.props.planId,this.props.suiteId,e,n,s),this._testCasesTableSelection.clear()}}},this._addTestCase=()=>{this.props.onAddTestCaseClick(this.props.planId,this.props.suiteId,this.props.areaPath,this.props.iterationPath)},this._editQuery=()=>{this.props.onEditQueryClick(this.props.areaPath,!1,this.props.queryText,this.props.planId,this.props.suiteId,this.props.suiteTitle,0)},this._openTestCaseWITForm=()=>{const e=this._testCasesTableSelection.value[0].beginIndex,t=this.props.testCases[e].id,s=this.props.testCases[e].name,a=this.props.testCases[e].state,o=this.props.testCases[e].assignedTo.displayName;this.props.openTestCase(this.props.planId,this.props.suiteId,t,s,a,o)},this._getSubMenuItemsForAddingTestCase=()=>{const e=new r.ObservableCollection,t={planId:this.props.planId,planName:this.props.plan,suiteId:this.props.suiteId,suiteType:this.props.suiteType,areaPath:this.props.areaPath,iterationPath:this.props.iterationPath,dispatch:this.props.dispatch};return e.push((0,P.getMenuItems)(this.context.pageContext,"ms.vss-test-web.add-test-case-options-menu",t)),e},this._getTestCaseContextMenuItemsFromProvider=()=>{const e=new r.ObservableCollection,t={selection:this._testCasesTableSelection,planId:this.props.planId,planName:this.props.planName,suiteId:this.props.suiteId,suiteName:this.props.suiteTitle,testCases:this.props.testCases,suiteType:this.props.suiteType,areaPath:this.props.areaPath,iterationPath:this.props.iterationPath,dispatch:this.props.dispatch,linkedItemsPanelOpen:this._openLinkedItemsPanel,cloneTestCasesPanelOpen:this._openCloneTestCasesPanel};return e.push((0,P.getMenuItems)(this.context.pageContext,"ms.vss-test-web.test-case-context-menu",t)),e},this._onColumnSize=(e,t,s)=>{this._tableColumns[t].width.value=s,this._columnId=this._tableColumns[t].id,this._columnWidth=s},this._columnSizeEnd=()=>{this.props.changeColumnWidths(this._columnId,this._columnWidth),this.props.saveColumnWidths(this.props.columnAndWidthMap)},this._openLinkedItemsPanel=()=>{this._showLinkedItemsPanel.value=!0},this._updateSelection=e=>{const t=this._testCasesTableSelection.value[0].beginIndex;e?this.props.testCases.length===t+1?this._testCasesTableSelection.select(0):this._testCasesTableSelection.select(t+1):0===t?this._testCasesTableSelection.select(this.props.testCases.length-1):this._testCasesTableSelection.select(t-1)},this._openCloneTestCasesPanel=()=>{this._showCloneTestCasesPanel.value=!0},this._focusFirstTestCase=e=>{let t;this._testCasesTableSelection.select(0),e&&(t=e[0]),t&&this._onFocusItem(t.id)},this._setIfSelected=(e,t)=>{if(t){const{data:e,index:s}=t;this._onFocusItem(e[o.TestHubRefreshConstants.WorkItemField_Id])}},this._onFocusItem=async e=>{this._lastFocusedTestCaseId.value!==e&&(this._lastFocusedTestCaseId.value=e)},this._areNonZeroTestCasesDisplayed=()=>!!(this.props.testCases&&this.props.testCases.length>0||this.props.filteredTestCases&&this.props.filteredTestCases.length>0),this._onSplitterSizeChange=e=>{this._splitterSize=e;const t=this.context.pageContext.getService("ISettingsService"),s={[`${o.TestHubRefreshConstants.PREVIEW_SPLITTER_SIZE_KEY}/${o.TestHubRefreshConstants.SETTINGS_KEY}`]:e};t.setEntries(s,0)},this._onSavePreview=e=>{const t=e.getTitle(),s=e.getFieldValueByName(o.TestHubRefreshConstants.WorkItemField_AssignedTo);let a=e.getFieldValueByName(o.TestHubRefreshConstants.WorkItemField_AssignedTo);a=this._getIdentityDisplayString(a);const i={};if(this.props.columnOptionFields)for(const t of this.props.columnOptionFields)i[t]=e.getFieldValueByName(t);this.props.updateTestCase(e.id,t,s,a,i)},this._testCasesTableSelection=new V.ListSelection(!0),this._registerKeyboardShortcuts(this.props),this._columnSelect=new K.ColumnSelect,this._eventDispatch=new B.EventDispatch,this._context=t.pageContext,this._asyncLoadInitiated=!1,this._ttiTelemetrySent=!1,this._provider=new ie.TestCasesTableItemProvider,this._showLinkedItemsPanel=new r.ObservableValue(!1),this._showCloneTestCasesPanel=new r.ObservableValue(!1),this._tableColumns=this._getColumns(),this._onRightClick=this._onRightClick.bind(this),this._eventDispatch.addEventListener("contextmenu",this._onRightClick),this._dragDropBehavior=new V.ListDragDropBehavior({allowedTypes:[o.SuitesConstants.TestCaseDragItemType],id:"test-case-table",onDragStart:this._onDragStart,onDrop:this._onDrop,renderDragImage:e=>{if(this._testCasesTableSelection.selectedCount>1)return T.createElement(V.ListDragImage,{text:this._testCasesTableSelection.selectedCount+Z.DragTestCasesText});{const t=e.detail.dataTransfer.data;return T.createElement(V.ListDragImage,{text:t.name})}},type:o.SuitesConstants.TestCaseDragItemType}),this._sortingBehavior=new K.ColumnSorting(((e,t,s)=>{if(this._tableColumns[e].sortProps){const s=(0,X.getTestCaseItemsComparator)(this._tableColumns[e].id,t),a=s?[s]:[null];(0,K.sortItems)(e,t,a,this._tableColumns,[]),this.props.updateColumnAndSortOrder(this._tableColumns[e].id,t)}}));const a=this.context.pageContext.getService("ISettingsService").getEntry(o.TestHubRefreshConstants.PREVIEW_SPLITTER_SIZE_KEY,0);a&&a[o.TestHubRefreshConstants.SETTINGS_KEY]&&(this._splitterSize=null!==(s=Number(a[o.TestHubRefreshConstants.SETTINGS_KEY]))&&void 0!==s?s:void 0)}shouldComponentUpdate(e){return this.props.suiteId!==e.suiteId&&this._registerKeyboardShortcuts(e),this.props.columnOptionFields!==e.columnOptionFields&&(this._tableColumns=this._getColumns(e.columnAndWidthMap,e.columnOptionFields,e.customColumnFieldMap),this._columnsVersionKey++),(0,C.compareColumnWidthsMaps)(this.props.columnAndWidthMap,e.columnAndWidthMap)||(this._tableColumns=this._getColumns(e.columnAndWidthMap,e.columnOptionFields,e.customColumnFieldMap),this._columnsVersionKey++),this._items=this._provider.getTestCaseItems(e.testCases,this._testCasesTableSelection,e.filteredTestCases),this.props.testCases&&e.testCases&&this.props.testCases[0]&&e.testCases[0]?this.props.testCases[0].id!==e.testCases[0].id&&(this._lastFocusedTestCaseId.value=void 0):this._lastFocusedTestCaseId.value=void 0,this.props.testCases&&this._testCasesTableSelection&&this._registerKeyboardShortcuts(this.props),e.previewStatus===o.PreviewSplitterOptions.RIGHT&&this._items.value.length>0&&(this._lastFocusedTestCaseId.value||this._focusFirstTestCase(e.testCases)),!0}componentWillUnmount(){this.context.pageContext.getService("AuthorTabKeyboardShortcutProvider").unregisterKeyboardShortcuts()}render(){var e;let t,s=!1;1==this.props.suiteType&&(s=!0),this.props.isLoading?(this._ttiTelemetrySent=!1,t=T.createElement(b.Spinner,{className:"spinner-pos flex-grow",size:"large"})):this.props.testCases&&(t=this.props.testCases.length>0||this.props.filteredTestCases?T.createElement(T.Fragment,null,this._getCustomCard(this.props.isInGridView)):T.createElement(T.Fragment,null,this._getZeroDataCard(this.props.isInGridView,s)));const a=T.createElement("div",{className:"test-plan-author-tab"},T.createElement("div",{className:"grid-view-component",style:this.props.isInGridView?{}:{display:"none"}},T.createElement(oe.GridViewConnectedComponent,null)),T.createElement(x.DynamicModuleLoader,{modules:[(0,ae.getAuthorModule)(this.props.testCases,this.props.planId,this.props.initialSelectedSuiteId,this.props.suiteId)]},T.createElement("div",{className:"testplans-hub-author-tab-testcase-table-container flex-grow"},t)),T.createElement(M.Observer,{showPanel:this._showLinkedItemsPanel},(e=>e.showPanel&&T.createElement(v.WrappedComponent,{dependencies:["ms.vss-test-web.testcase-linked-items"],wrappedType:"testcase-linked-items-panel",wrappedProps:{showPanel:this._showLinkedItemsPanel,testCases:this.props.testCases,selectedIndex:this._testCasesTableSelection.value[0].beginIndex,planId:this.props.planId,updateSelection:this._updateSelection}}))),T.createElement(M.Observer,{showPanel:this._showCloneTestCasesPanel},(e=>e.showPanel&&T.createElement(v.WrappedComponent,{dependencies:["ms.vss-test-web.testcases-clone-panel"],wrappedType:"testcases-clone-panel",wrappedProps:{showPanel:this._showCloneTestCasesPanel,sourceTestCaseIds:this._getSelectedTestCaseIds(this._testCasesTableSelection,this.props.testCases),sourcePlanId:this.props.planId,sourcePlanName:this.props.planName,sourceSuiteId:this.props.suiteId}}))));return(0,w.isFeatureEnabled)(this._context,"ms.vss-work-web.new-boards-hub-feature",!1)&&this.props.previewStatus===o.PreviewSplitterOptions.RIGHT&&this._areNonZeroTestCasesDisplayed()?T.createElement(G.Splitter,{className:"scroll-hidden",farElementClassName:"flex-column",nearElementClassName:"flex-column",initialFixedSize:null!==(e=this._splitterSize)&&void 0!==e?e:320,onFixedSizeChanged:e=>{this._onSplitterSizeChange(e)},onRenderNearElement:()=>a,onRenderFarElement:()=>T.createElement(M.Observer,{lastFocusedTestCaseId:this._lastFocusedTestCaseId,loadingWorkItem:this._loadingWorkItem},(({lastFocusedTestCaseId:e,loadingWorkItem:t})=>t?T.createElement(b.Spinner,{className:"flex-grow",size:"large"}):e?T.createElement(z.WorkItemFormView,{className:"themed full-height",workItemId:e,onSaveComplete:this._onSavePreview}):null)),splitterDirection:0}):a}componentDidUpdate(){if(this._markTTIPerf(),!this._asyncLoadInitiated&&this.props.initialSelectedSuiteId===this.props.suiteId){const e=(0,C.getDataProviderContent)(this._context);if(e){if(e.testCasesContinuationToken){const t=e.testCasesContinuationToken.split(";");t&&2==t.length&&(t[1]=e.testCasePageSize.toString(),e.testCasesContinuationToken=t.join(";"))}let t="";if(t=this.props.columnOptionFields?"":e.testCasesContinuationToken,I.testHubRefreshLocalContextData.isJsonIslandDataDirty()&&(t=""),(!e.testCases||e.testCases.length>0)&&this.props.loadAllTestCases(this.props.planId,this.props.suiteId,t),e.testCases)for(const t of e.testCases)if(t&&t.workItem&&!t.workItem.workItemFields){const e={Id:t.workItem.id,Name:t.workItem.name};this.props.publishTelemetry(o.TelemetryConstants.AUTHOR_PIVOT_TEST_CASE_FIELDS_MISSING,e)}}}this._asyncLoadInitiated=!0}_getZeroDataCard(e,t){const s=(0,O.getAssetLocation)(this.context.pageContext,Z.AuthorTabZeroDataImagePath);return T.createElement(T.Fragment,null,T.createElement("div",{className:"testplans-hub-refresh-author-pivot-zerodata",style:e?{display:"none"}:{}},T.createElement(j.ZeroData,{imagePath:s,className:"testplans-hub-author-tab-zero-data",imageAltText:t?Y.EditQuery:Y.ZeroDataImageText,primaryText:t?Y.ZeroDataEditQueryPrimaryText:Y.ZeroDataPrimaryText,secondaryText:Y.ZeroDataSecondaryText}),T.createElement("div",{className:"zero-data-split-button flex-row justify-center"},this._getButtonToRender(!0))))}_getCustomCard(e){let t={};if((0,C.checkIfIsIE)()){t={height:document.getElementsByClassName("testplans-hub-refresh-rhs-container")[0].clientHeight-98+"px"}}let s=T.createElement(T.Fragment,null);if(this.props.isPagingInProgress){let e=[];for(let t=0;t<3;t++)e.push(T.createElement("span",{className:"testplans-paging-indication",key:t}));s=T.createElement(T.Fragment,null,e)}return T.createElement(T.Fragment,null,T.createElement("div",{className:"testplans-hub-refresh-author-pivot-table-view",style:e?{display:"none"}:{}},T.createElement(v.WrappedComponent,{dependencies:["ms.vss-test-web.testplans-hub-refresh-filter-component"],wrappedType:"testplans-hub-refresh-filter-component",className:"author-pivot-filter-bar bolt-filterbar-white depth-8",filterBarItems:this._getFilterBarItems()}),T.createElement("div",{className:"flex-row",style:t},T.createElement(D.CustomCard,{className:"testplans-hub-author-card bolt-card-with-header",headerClassName:"bolt-card-header bolt-header-with-commandbar"},T.createElement(L.CustomHeader,{className:"bolt-card-header bolt-header-with-commandbar"},T.createElement(L.HeaderTitle,{titleSize:0,className:"bolt-header-title-area flex-grow scroll-hidden bolt-header-title body-xl m header-title"},this._getCardTitle(this.props.testCases),s),T.createElement(N.CustomHeaderCommandBar,{className:"bolt-header-commandbar flex-noshrink bolt-header-commandbar-no-right-padding"},this._getButtonToRender(!1))),T.createElement(K.Table,{className:"testplans-hub-author-tab-testcase-table",containerClassName:"custom-scrollbar",columns:this._tableColumns,eventDispatch:this._eventDispatch,showLines:!0,scrollable:!0,itemProvider:this._items,onSelect:this._setIfSelected,singleClickActivation:!1,onActivate:this._openTestCaseWITForm,selection:this._testCasesTableSelection,behaviors:[this._sortingBehavior,this._dragDropBehavior],key:"AuthorTableVersionKey_"+this._columnsVersionKey})))))}_getCardTitle(e){let t="",s=n.Items;return e&&e.length>=0&&(1===e.length&&(s=n.Item),t=Y.TestCases+` (${e.length} ${s})`),t}_getButtonToRender(e){let t=!1;return 1==this.props.suiteType&&(t=!0),t?T.createElement(k.Button,{text:Y.EditQuery,primary:e,onClick:this._editQuery}):T.createElement(U.SplitButton,{primary:e,buttonProps:{text:Y.NewTestCase,onClick:()=>{this._addTestCase()},tooltipProps:{text:Y.AddNewTestCaseUsingForm}},menuButtonProps:{ariaLabel:Y.AddTestCaseMenuButtonAriaLabel,contextualMenuProps:{menuProps:{id:"add-existing-test-case-menu",items:this._getSubMenuItemsForAddingTestCase()}}}})}_getFilterBarItems(){let e;return e=[{filterItemType:1,key:"author-filter-text",filterItemKey:o.TestHubRefreshConstants.AUTHOR_TEXT_FILTER_ITEM_KEY,placeholder:Y.TextFilterPlaceholderText,items:{}},{filterItemType:2,key:"author-assignedto-filter",filterItemKey:o.TestHubRefreshConstants.AUTHOR_ASSIGNEDTO_FILTER_ITEM_KEY,placeholder:Y.AssignedToFilterPlaceholderText,items:this._getDropdownItems(F.TestHubRefreshFilterCommon.assignedToFilterValues,this.props.assignedToFilterValues),selection:F.TestHubRefreshFilterCommon.assignedToFilterSelection,width:220},{filterItemType:2,key:"author-state-filter",filterItemKey:o.TestHubRefreshConstants.AUTHOR_STATE_FILTER_ITEM_KEY,placeholder:Y.StateFilterPlaceholderText,items:this._getDropdownItems(F.TestHubRefreshFilterCommon.stateFilterValues,this.props.stateFilterValues),selection:F.TestHubRefreshFilterCommon.stateFilterSelection,width:160}],e}_getDropdownItems(e,t){if(e&&t)for(const s of t.value)-1===e.value.findIndex((e=>e.text===s.text))&&e.push(s);return e}_markTTIPerf(){if(this.props.testCases&&this.props.testhubRefreshContext)if(this.props.testhubRefreshContext.isPageLoad())this.props.markTTI(o.TelemetryConstants.TEST_HUB_FEATURE_AREA_NAME,o.TelemetryConstants.AUTHOR_PIVOT_PAGE_LOAD_TTI_SCENARIO,{ttiScenario:"PageLoad"}),this.props.testhubRefreshContext.setPageLoad(!1),this._ttiTelemetrySent=!0;else if(!1===this.props.isLoading&&!1===this._ttiTelemetrySent){const e=this.context.pageContext.getService("IVssPerformanceService");e.getActiveScenario(o.TelemetryConstants.AUTHOR_PIVOT_PAGE_LOAD_TTI_SCENARIO)&&(e.endScenario(o.TelemetryConstants.TEST_HUB_FEATURE_AREA_NAME,o.TelemetryConstants.AUTHOR_PIVOT_PAGE_LOAD_TTI_SCENARIO,!0),this._ttiTelemetrySent=!0)}}_getColumns(e,t,s){const o=[],i=new K.ColumnMore((()=>({id:"test-case-context-menu-column",items:this._getTestCaseContextMenuItemsFromProvider()})),void 0,((e,t)=>{this._testCasesTableSelection.selected(e)||this._testCasesTableSelection.select(e,1,!1)}));if(o.push(this._columnSelect,{id:Z.NameColumn,name:Y.Title,width:this._getWidth(500,Z.NameColumn,e),minWidth:10,onSize:this._onColumnSize,onSizeEnd:this._columnSizeEnd,renderCell:K.renderSimpleCell,sortProps:this.props.columnAndSortOrder&&this.props.columnAndSortOrder.columnId===Z.NameColumn?{sortOrder:this.props.columnAndSortOrder.sortOrder}:{}},i,{id:Z.OrderColumn,name:Y.Order,width:this._getWidth(70,Z.OrderColumn,e),minWidth:10,onSize:this._onColumnSize,onSizeEnd:this._columnSizeEnd,renderCell:K.renderSimpleCell,sortProps:this.props.columnAndSortOrder&&this.props.columnAndSortOrder.columnId===Z.OrderColumn?{sortOrder:this.props.columnAndSortOrder.sortOrder}:{}}),t){const i=(0,a.getAllColumnFields)(t,s);for(const t of i)o.push({id:t.id,name:t.name,width:this._getWidth(100,t.id,e),minWidth:10,onSize:this._onColumnSize,onSizeEnd:this._columnSizeEnd,renderCell:t.id===Z.WorkItemCreatedDate||t.id===Z.WorkItemChangedDate?(e,s,a,o)=>o.columnOptionValues[t.id]?T.createElement(K.SimpleTableCell,{columnIndex:s,key:s,tableColumn:a},o.columnOptionValues[t.id].toLocaleString()):T.createElement("div",null):K.renderSimpleCell,className:"body-m",sortProps:this.props.columnAndSortOrder&&this.props.columnAndSortOrder.columnId===t.id?{sortOrder:this.props.columnAndSortOrder.sortOrder}:{}})}return o}_onRightClick(e){if(e.button===o.TestHubRefreshConstants.RIGHT_MOUSE_BUTTON){e.preventDefault();const{cellElement:t,rowIndex:s}=(0,V.cellFromEvent)(e);if(s>=0){this._testCasesTableSelection.selected(s)||this._testCasesTableSelection.select(s,1,!1);this.context.pageContext.getService("IVssLayoutManager").renderCallout((t=>T.createElement(W.ContextualMenu,{menuProps:{id:"test-case-context-menu-column",items:this._getTestCaseContextMenuItemsFromProvider()},anchorElement:e.currentTarget,anchorPoint:{x:e.pageX,y:e.pageY},onDismiss:t},null)))}}}_getWidth(e,t,s){return s&&void 0!==s[t]?new r.ObservableValue(s[t]):new r.ObservableValue(e)}_registerKeyboardShortcuts(e){const t={planId:e.planId,planName:e.planName,suiteId:e.suiteId,suiteType:e.suiteType,areaPath:e.areaPath,iterationPath:e.iterationPath,dispatch:e.dispatch,suiteName:e.suiteTitle,testCases:this.props.testCases,selection:this._testCasesTableSelection};this.context.pageContext.getService("IVssContributionService").getContributionAsync("ms.vss-test-web.keyboard-shortcuts-module").then((()=>{this.context.pageContext.getService("AuthorTabKeyboardShortcutProvider").registerKeyboardShortcuts(t)}))}_getSelectedTestCaseIds(e,t){let s=[];const a=e.value.length;for(let o=0;o<a;o++)for(let a=this._testCasesTableSelection.value[o].beginIndex;a<=e.value[o].endIndex;a++)s.push(t[a].id);return s}_getIdentityDisplayString(e){let t=n.UnassignedString;if(!e||e.trim().length<=0)return t;t=e;const s=e.indexOf("<");return e&&s>0&&(t=e.substr(0,s-1)),t}}function l(e){const t=T.useContext(I.TestHubRefreshLocalContext);return T.createElement(s,Object.assign({},e,{testhubRefreshContext:t}))}t[e].AuthorTabContentComponent=s,t[e].AuthorTabFunctionalComponent=l,t[e].AuthorTabConnectedComponent=(0,E.connect)((function(e){let t,s,a,n,r,l,d,c,u,p=new Map;if(e.authorState&&e.authorState.testCases){t=(0,q.getTestCasesToRender)(e),s=(0,q.getFilteredTestCases)(e),c=(0,i.getDefineColumnOptionFields)(e),u=(0,i.getDefineTabCustomColumnFieldMap)(e);const r=(0,q.getUniqueFilterValuesToRender)(e);a=r[o.TestHubRefreshConstants.AUTHOR_ASSIGNEDTO_FILTER_ITEM_KEY],n=r[o.TestHubRefreshConstants.AUTHOR_STATE_FILTER_ITEM_KEY]}if(e.suiteState){p=(0,S.getIdToTestSuiteMap)(e);const t=p.get(e.testHubRefreshState.selectedSuiteId);t&&(r=t.suiteType,l=t.queryString,d=t.name)}return{planId:e.testHubRefreshState.testPlanId,planName:e.testHubRefreshState.testPlanName,areaPath:e.testHubRefreshState.testPlanAreaPath,columnOptionFields:c,customColumnFieldMap:u,iterationPath:e.testHubRefreshState.testPlanIteration,suiteId:e.testHubRefreshState.selectedSuiteId,suiteType:r,queryText:l,suiteTitle:d,initialSelectedSuiteId:e.testHubRefreshState.initialSelectedSuiteId,isLoading:e.testHubRefreshState.isLoading,testCases:t,filteredTestCases:s,assignedToFilterValues:a,stateFilterValues:n,isInGridView:e.testHubRefreshState.isInGridView,isPagingInProgress:e.testHubRefreshState.isPagingInProgress,columnAndWidthMap:e.testHubRefreshState.defineColumnAndWidthMap,columnAndSortOrder:e.authorState&&e.authorState.columnAndSortOrder?e.authorState.columnAndSortOrder:void 0,previewStatus:e.testHubRefreshState.testCasePreviewStatus}}),(function(e){return{markTTI:(t,s,a)=>e(H.TTIMonitorActions.markTTI(t,s,a)),onAddTestCaseClick:(t,s,a,o)=>e(Q.AuthorActions.openNewTestCaseWitForm(t,s,a,o)),onAddExistingTestCaseClick:(t,s,a)=>e(Q.AuthorActions.addExistingTestCases(t,s,a)),openTestCase:(t,s,a,o,i,n)=>e(Q.AuthorActions.openExistingTestCaseWitForm(t,s,a,o,i,n)),loadAllTestCases:(t,s,a)=>e(Q.AuthorActions.loadTestCasesForSelectedSuite(t,s,a)),onEditQueryClick:(t,s,a,o,i,n,r)=>e(f.SuitesActions.openCreateEditSuiteQueryForm(t,s,a,o,i,n,r,void 0)),publishTelemetry:(t,s)=>e(u.TelemetryActions.publishTelemetry(t,s)),updateColumnAndSortOrder:(t,s)=>e(Q.AuthorActions.updateColumnAndSortOrder(t,s)),reorderTestCases:(t,s,a,o,i)=>e(Q.AuthorActions.reorderTestCases(t,s,a,o,i)),showToastNotifications:(t,s)=>e(f.SuitesActions.showToastNotifications(t,s)),changeColumnWidths:(t,s)=>e(y.TestHubRefreshActions.changeDefineColumnWidths(t,s,void 0)),saveColumnWidths:t=>e(Q.AuthorActions.saveColumnWidths(t)),updateTestCase:(t,s,a,o,i)=>e(Q.AuthorActions.updateTestCase(t,s,a,o,i)),dispatch:e}}))(l),v.VssComponent.register("authorPivot",t[e].AuthorTabConnectedComponent)}("ComponentAuthorTabConnectedComponent")}),["Resources","AuthorConstants","TestCaseItemsSortingUtility","Redux/AuthorSelector","Redux/AuthorActions","Redux/AuthorFilterReducer","Redux/AuthorReducer","Redux/AuthorFilterHelper","TestCaseCSVExporterUtility","Redux/AuthorSaga","Redux/AuthorModule","Component/GridViewConnectedComponent","Component/TestCasesTableItemProvider","Component/AuthorTabConnectedComponent"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-test-web.author-component"}}));