"use strict";define("Wit/LinkedWorkItemsDropdown",["require","exports","VSS/Platform/Context","VSS/Platform/RestClientBase","VSS/Core/Util/String","VSS/Platform/Util/Linking","Tfs/Platform/Page","VSS/Platform/Feature","Wit/Clients/Wit/RestClient/WorkItemTracking","Wit/Common/Generated/Constants","Wit/UI/Data","react","VSS/Platform/Layout","Wit/UI/WorkItemTypeIcon","VSS/Features/FuzzySearch","VSSUI/Dropdown","VSSUI/EditableDropdown","VSSUI/ListBox","VSSUI/Table","VSSUI/TooltipEx","VSSUI/Util","VSS/Platform/FPS","VSS/Platform/Location","VSS/Core/Observable","VSS/Platform/Trace","Wit/UI/WorkItemState","VSSUI/Ago","VSSUI/Button","VSSUI/Utilities/Date","VSSUI/VssPersona","Wit/Common/DateUtils","VSSUI/Card","VSSUI/Observer","VSSUI/FormItem","VSSUI/Link","VSSUI/MessageCard","VSSUI/Pill","VSSUI/Utilities/DropdownSelection","Wit/Common/Constants/FeatureFlags","VSS/Platform/UserClaims","VSSUI/Header"],(function(e,t,s,r,i,o,n,a,l,m,d,c,h,k,u,I,p,g,C,W,v,f,w,S,L,x,y,R,b,T,D,P,B,A,E,F,N,V,q,O,U){var j,M,$,H,G,z,_,J,Z,K,Q,X,Y,ee,te,se;j=t.Resources={},t.Resources.Clear="Clear",t.Resources.ClearAll="Clear all",t.Resources.ClearAllTooltip="Clear the list of associated work items.",t.Resources.ClearPullRequestWorkItemsTooltip="Clear the list of work items associated with changes being merged in this pull request.",t.Resources.CreatePullRequestWarningFormat="{0} work items were associated with the changes being merged and will be associated with the pull request.",t.Resources.DescriptionWithRelatedWorkItems="{0}\n\nRelated work items: {1}",t.Resources.DropdownPlaceholder="Search work items by ID or title",t.Resources.Id="Id",t.Resources.FailedToAddWorkItem="Failed to add work item {0} because the work item's links may have been modified at the same time.",t.Resources.FailedToRemoveWorkItem="Failed to remove work item {0} because the work item's links may have been modified at the same time.",t.Resources.LastUpdatedDateFormat="Updated {0},",t.Resources.LinkWorkItem="Link work item",t.Resources.Loading="Loading...",t.Resources.NoWorkItems="No work items",t.Resources.PullRequestLinkError="Failed to associate one or more work items with the pull request: {0}.",t.Resources.RemoveButtonText="Remove",t.Resources.State="State",t.Resources.Title="Title",t.Resources.UpdatedBy="Updated by",t.Resources.UpdatedDate="Updated date",t.Resources.WorkItems="Work items",t.Resources.WorkItemsToLinkLabel="Work items to link",t.Resources.SearchButtonText="Search",t.Resources.BatchWorkItemsAddError="Error adding work items batch",t.Resources.BatchWorkItemsRemoveError="Error removing work items batch",t.Resources.NoProjectSpecifiedMessage="No project is available",function(e){M=t[e]={};const i="4.0-preview";class o extends r.RestClientBase{updateWorkItemsBatch(e){const t=e.map((e=>this._createBatchRequest(e[0],"PATCH","workItems",e[1])));return this._beginBatchRequest(t)}_createBatchRequest(e,t,s,r){return{method:t,uri:`/_apis/wit/${s}/${e}?api-version=4.0-preview`,headers:{"Content-Type":"application/json-patch+json"},body:r}}_beginBatchRequest(e){return this.beginRequest({method:"POST",routeTemplate:"_apis/{area}/${resource}",routeValues:{area:"wit",resource:"batch"},apiVersion:i,body:e})}}function n(e,t){return{op:5,path:"/relations/"+e+"/url",value:t}}function a(e){return{op:1,path:"/relations/"+e}}t[e].WorkItemTrackingHttpBatchClient=o,t[e].getWorkItemPatchAddOperation=function(e,t){return{op:0,path:"/relations/-",value:{attributes:{name:t},rel:"ArtifactLink",url:e}}},t[e].getWorkItemPatchTestOperation=n,t[e].getWorkItemRemoveLinkOperation=a,t[e].getWorkItemPatchRemoveDocument=function(e,t){return[n(e,t),a(e)]};const l="Repos.FilesHubActions.IWorkItemTrackingHttpBatchClient";t[e].getWitBatchClient=function(e,t){return e.getRestClient(l,t)},s.RestClients.add(l,{factory:o,options:{serviceInstanceType:"00025394-6065-48ca-87d9-7f5672854ef7"}})}("RestClientWitBatchRestClient"),function(e){$=t.RestClientGit={};class i extends r.RestClientBase{constructor(e){super(e)}async getPullRequestWorkItemRefs(e,t,s){return this.beginRequest({apiVersion:"5.0-preview.1",routeTemplate:"{project}/_apis/git/repositories/{repositoryId}/pullRequests/{pullRequestId}/workitems",routeValues:{project:s,repositoryId:e,pullRequestId:t}})}}t.RestClientGit.GitClientName="WIT.PRDetails.Extensions.IGitRestClient",t.RestClientGit.getGitClient=function(e,s){return e.getRestClient(t.RestClientGit.GitClientName,s)},s.RestClients.add(t.RestClientGit.GitClientName,{factory:i,options:{resourceAreaId:"4e080c62-fa21-4fbc-8fef-2a10a2b38049",serviceInstanceType:"00025394-6065-48ca-87d9-7f5672854ef7"}})}(),function(e){H=t.UtilArtifact={},t.UtilArtifact.ArtifactLinkNames={ChangesetToWorkItem:"Fixed in Changeset",CommitToWorkItem:"Fixed in Commit",BranchToWorkItem:"Branch",PullRequestToWorkItem:"Pull Request"};const s="{0}/{1}/{2}",r="Git";function n(e,t,o){return{id:(0,i.format)(s,e,t,o),tool:r,type:"Commit"}}function a(e){return{id:e.toString(),tool:"VersionControl",type:"Changeset"}}function l(e,t,o){return function(e,t,o){return{id:(0,i.format)(s,e,t,o),tool:r,type:"Ref"}}(e,t,`GB${o}`)}function m(e,t){return{name:e,uri:(0,o.encodeUri)(t)}}t.UtilArtifact.getCommitArtifact=n,t.UtilArtifact.getChangesetArtifact=a,t.UtilArtifact.getChangesetArtifactLink=function(e){return m(t.UtilArtifact.ArtifactLinkNames.ChangesetToWorkItem,a(e))},t.UtilArtifact.getCommitArtifactLink=function(e,t,s,r){return m(r,n(e,t,s))},t.UtilArtifact.getBranchArtifact=l,t.UtilArtifact.getBranchArtifactLink=function(e,t,s,r){return m(r,l(e,t,s))},t.UtilArtifact.getPullRequestArtifactLink=function(e,o,n){return m(t.UtilArtifact.ArtifactLinkNames.PullRequestToWorkItem,{id:(0,i.format)(s,e,o,n),tool:r,type:"PullRequestId"})}}(),function(e){G=t[e]={};class r extends s.VssService{_serviceStart(e){super._serviceStart(e),this.dataProvider=new d.WorkItemTrackingDataProvider(e),this.gitClient=(0,$.getGitClient)(e),this.witClient=(0,l.getWorkItemTrackingClient)(e),(0,a.isFeatureFlagEnabled)(e,"WebAccess.WorkItemTracking.UseReadReplicaForWebUI")?this.witReadOnlyClient=(0,l.getWorkItemTrackingClient)(e,{readConsistencyLevel:s.IVssReadConsistencyLevel.Eventual}):this.witReadOnlyClient=this.witClient,this.project=(0,n.getTFSPageData)(this.pageContext).project}async addWorkItemsBatchAsync(e,t){const s=(0,M.getWitBatchClient)(this.pageContext),r=e.map((e=>[e,t.map((e=>this.getWorkItemPatchAddOperation(e)))]));return s.updateWorkItemsBatch(r).then((e=>{const t=e.filter((e=>e.code>=400));if(t.length){const e=JSON.parse(t[0].body);throw new Error(this.tryGetErrorMessage(e)||j.BatchWorkItemsAddError)}}))}async getAssignedWorkItems(e){var t,s;const r=await this.getWorkItemTypes(e),i=this.generateWiqlForCurrentUsersItems(r);return this.witReadOnlyClient.queryByWiql(i,null!==(s=null===(t=this.project)||void 0===t?void 0:t.id)&&void 0!==s?s:e)}async searchWorkItems(e,t,s){var r,i;const o=this.generateWiqlForTitleSearch(e,t);return this.witReadOnlyClient.queryByWiql(o,null!==(i=null===(r=this.project)||void 0===r?void 0:r.id)&&void 0!==i?i:s,void 0,void 0,50)}getDataProvider(){return this.dataProvider}async getLinkedPullRequestWorkItemIds(e,t){return this.gitClient.getPullRequestWorkItemRefs(e,t,this.project.id).then((e=>e.map((e=>parseInt(e.id)))))}async getLinkedChangesetWorkItemIds(e){const t=(0,H.getChangesetArtifactLink)(e);return this.getLinkedArtifactWorkItemIds(t)}async getLinkedShelvesetWorkItemIds(e){return this.pageContext.getService("IVssContributionService").getDataAsync("ms.vss-code-web.associated-workitems-data-provider",{repositoryId:"",versions:[`S${e}`]},!0).then((e=>e?e.map((e=>e.id)):[]))}async getLinkedCommitWorkItemIds(e,t,s){const r=(0,H.getCommitArtifactLink)(e,t,s,"commit");return this.getLinkedArtifactWorkItemIds(r)}async getWorkItem(e,t,s){return this.witReadOnlyClient.getWorkItem(e,t,void 0,void 0,s)}async getWorkItems(e,t,s){const r=[];let i=0;for(;i<e.length;)r.push(...await this.witReadOnlyClient.getWorkItems(e.slice(i,i+200),t,void 0,void 0,s)),i+=200;return r}async removeWorkItemsBatchAsync(e,t){const s=(0,M.getWitBatchClient)(this.pageContext),r=e.map((e=>[e.id,t.map((t=>this.getWorkItemPatchRemoveOperation(t,e)))]));return s.updateWorkItemsBatch(r).then((e=>{const t=e.filter((e=>e.code>=400));if(t.length){const e=JSON.parse(t[0].body);throw new Error(this.tryGetErrorMessage(e)||j.BatchWorkItemsRemoveError)}}))}async getLinkedArtifactWorkItemIds(e){const t=[e.uri];return this.witReadOnlyClient.queryWorkItemsForArtifactUris({artifactUris:t}).then((t=>{const s=t.artifactUrisQueryResult[e.uri];return s?s.map((e=>e.id)):[]}))}async getWorkItemTypes(e){var t,s;return this.workItemTypesPromise||(this.workItemTypesPromise=this.witReadOnlyClient.getWorkItemTypes(null!==(s=null===(t=this.project)||void 0===t?void 0:t.id)&&void 0!==s?s:e)),this.workItemTypesPromise}generateWiqlForCurrentUsersItems(e){const t=[];e.forEach((e=>{const s=e.states.filter((e=>"Completed"===e.category||"Removed"===e.category));s.length&&t.push(`AND NOT ([${m.CoreFieldRefNames.WorkItemType}] = '${e.name}' AND [${m.CoreFieldRefNames.State}] IN (${s.map((e=>`'${e.name}'`)).join(",")}))`)}));return{query:`SELECT [${m.CoreFieldRefNames.Id}]\n            FROM WorkItems \n            WHERE (([${m.CoreFieldRefNames.AuthorizedAs}] = @me AND [${m.CoreFieldRefNames.AuthorizedDate}] >= @today - 30)\n                   OR ([${m.CoreFieldRefNames.CreatedBy}] = @me AND [${m.CoreFieldRefNames.CreatedDate}] >= @today - 30)\n                   OR ([${m.CoreFieldRefNames.AssignedTo}] = @me AND [${m.CoreFieldRefNames.AuthorizedDate}] >= @today - 30)\n                  ) ${t.length?t.join("\n"):""}\n            ORDER BY [${m.CoreFieldRefNames.AuthorizedDate}] DESC`}}generateWiqlForTitleSearch(e,t){const s=e.replace("'",'"');return{query:`SELECT [${m.CoreFieldRefNames.Id}] \n            FROM WorkItems \n            WHERE [${m.CoreFieldRefNames.Title}] CONTAINS '${s}'\n            ${t&&t.length>0?`AND [${m.CoreFieldRefNames.Id}] NOT IN (${t.join(",")})`:""}`}}getWorkItemPatchAddOperation(e){return{op:0,path:"/relations/-",value:{attributes:{name:e.name},rel:"ArtifactLink",url:e.uri}}}getWorkItemPatchRemoveOperation(e,t){return{op:1,path:`/relations/${t.relations&&t.relations.findIndex((t=>0===(0,i.localeIgnoreCaseComparer)(t.url,e.uri)))}`}}tryGetErrorMessage(e){return e&&e.value&&e.Message||e&&e.errorMessage}}const o="ILinkedWorkItemsService";t[e].getLinkedWorkItemsService=function(e){return e.getService(o)},s.Services.add(o,{serviceFactory:r})}("LinkedWorkItemsService"),function(e){z=t[e]={};class s extends h.VssComponent{render(){const{workItem:e}=this.props;return c.createElement(d.WorkItemTypeIconProvider,{dataProvider:(0,G.getLinkedWorkItemsService)(this.context.pageContext).getDataProvider(),dataSource:{projectIdOrName:e.fields[m.CoreFieldRefNames.TeamProject],workItemTypeName:e.fields[m.CoreFieldRefNames.WorkItemType]}},(e=>c.createElement("span",{className:"padding-right-8"},c.createElement(k.WorkItemTypeIcon,{data:e}))))}}t[e].WorkItemIcon=s}("ComponentsWorkItemIcon"),function(e){_=t[e]={};class s extends c.Component{constructor(){super(...arguments),this.dropdown=c.createRef(),this.filterMatches=[],this.preventCollapseOnBlur=!1,this.collapse=()=>{this.dropdown.current&&this.dropdown.current.collapse()},this.expand=()=>{this.dropdown.current&&this.dropdown.current.expand()},this.onSearchClick=()=>{var e,t;this.preventCollapseOnBlur=!0,setTimeout((()=>{this.preventCollapseOnBlur=!1}),100),null===(t=(e=this.props).onSearchClick)||void 0===t||t.call(e)},this.onBlur=()=>{var e,t;null===(t=(e=this.props).onBlur)||void 0===t||t.call(e),this.preventCollapseOnBlur?this.focus():this.collapse()},this.filterItems=e=>{const{excludedSearchIds:t,workItems:s}=this.props;1===(null==s?void 0:s.value.length)&&4===s.value[0].type&&(e="");let r=[];const i=[],o=[],n=[],a=e.replace(/\s+/g,"");for(let e=0,r=s.length;e<r;e++){const r=s.value[e],i=u.Scorer.isMatch(r.text,a.toLowerCase(),a.toUpperCase()),o=t&&t.has(r.id);i&&!o&&n.push({item:r,index:e})}for(const t of n)if(t.item.text){const s=t.item.id===e?Number.MAX_SAFE_INTEGER:u.Scorer.score(t.item.text,a);o.push({item:t.item,index:t.index,score:s})}o.sort(((e,t)=>t.score-e.score)),r=o.map((t=>(i.push(u.Fuzzaldrin.match(t.item.text,e)),t.item)));const l=o.map((e=>e.index));return this.filterMatches=i,{filteredItems:r,filteredIndexMap:l,filterMatches:i}},this.renderWorkItem=(e,t,s,r)=>{if(4===r.type)return c.createElement(g.LoadingCell,{columnIndex:t,key:t,tableColumn:s,tableItem:r});const i=this.filterMatches[e]||[],o=r.text||"";return c.createElement(C.SimpleTableCell,{className:(0,v.css)(r.className,s.className,"scroll-hidden"),columnIndex:t,key:t},c.createElement(z.WorkItemIcon,{workItem:r.data}),c.createElement(W.Tooltip,{overflowOnly:!0},(0,I.getHighlightedText)(o,i,"text-ellipsis")))}}render(){const{onTextChanged:e,onValueChanged:t,onSearchClick:s,selection:r,text:i,workItems:o}=this.props,n={className:"linked-work-items-dropdown-search-button",iconProps:{iconName:"Search"},text:j.SearchButtonText,onClick:this.onSearchClick};return c.createElement(p.CustomEditableDropdown,{actions:s?[n]:void 0,items:o,filterByText:!1,filterItems:this.filterItems,onTextChange:e,onValueChange:t,placeholder:j.DropdownPlaceholder,ref:this.dropdown,selection:r,text:i,calloutContentClassName:"linked-work-items-dropdown-callout",renderExpandable:e=>c.createElement(I.DropdownExpandableTextField,Object.assign({},e,{onBlur:this.onBlur,blurDismiss:!1})),renderItem:this.renderWorkItem})}componentDidMount(){this.props.focusOnMount&&(this.focus(),this.expand())}focus(){this.dropdown.current&&this.dropdown.current.focus()}}t[e].ControlledLinkedWorkItemsDropdown=s}("ComponentsControlledLinkedWorkItemsDropdown"),function(e){function s(e,t){const s={};return s.project=t.fields[m.CoreFieldRefNames.TeamProject],s.id=t.id.toString(),(0,w.routeUrl)(e,"ms.vss-work-web.work-items-form-route",s)}J=t.UtilData={},t.UtilData.WorkItemFormat="{0} {1}: {2}",t.UtilData.getWorkItemFormUrl=s,t.UtilData.workItemToListBoxItem=function(e,r){const o=s(e,r);return{data:r,id:r.id.toString(),linkProps:{href:o,onClick:t=>{t.defaultPrevented||(0,f.onClickFPS)(e,o,!0,t)}},text:(0,i.format)(t.UtilData.WorkItemFormat,r.fields[m.CoreFieldRefNames.WorkItemType],r.id,r.fields[m.CoreFieldRefNames.Title])}}}(),function(e){Z=t[e]={};class r extends s.VssService{constructor(){super(...arguments),this.linkedWorkItemIds=new Set,this.linkedWorkItems=new S.ReadyableObservableArray([])}_serviceStart(e){super._serviceStart(e),this.project=(0,n.getTFSProject)(e)}getLinkedWorkItems(e,t,s){if(!this.linkedWorkItems.ready.value){const r=(0,G.getLinkedWorkItemsService)(this.pageContext),i=this.getLinkedWorkItemPromise(e,t,s);i&&i.then((e=>(this.linkedWorkItemIds.clear(),e.length>0?(e.forEach((e=>this.linkedWorkItemIds.add(e.toString()))),r.getWorkItems(e,this.project.name,1)):[]))).then((e=>{this.linkedWorkItems.value=e.map((e=>(0,J.workItemToListBoxItem)(this.pageContext,e))),this.linkedWorkItems.ready.value=!0})).catch((e=>{console.error(e),(0,L.traceException)(this.pageContext,"Repos","LinkedWorkItemsBaseDetailViewService.getLinkedWorkItems",e),this.linkedWorkItems.value=[],this.linkedWorkItems.ready.value=!0}))}return this.linkedWorkItems}}t[e].LinkedWorkItemsBaseDetailViewService=r}("LinkedWorkItemsBaseDetailViewService"),function(e){K=t[e]={};class r extends Z.LinkedWorkItemsBaseDetailViewService{getLinkedWorkItems(e,t,s){return super.getLinkedWorkItems(e,t,s)}getLinkedWorkItemPromise(e,t,s){return(0,G.getLinkedWorkItemsService)(this.pageContext).getLinkedChangesetWorkItemIds(s)}}const i="ILinkedWorkItemsChangesetDetailViewService";t[e].getLinkedWorkItemsChangesetDetailViewService=function(e){return e.getService(i)},s.Services.add(i,{serviceFactory:r})}("LinkedWorkItemsChangesetDetailViewService"),function(e){Q=t[e]={};class s extends h.VssComponent{render(){const{workItem:e}=this.props;return c.createElement(d.WorkItemStateProvider,{dataProvider:(0,G.getLinkedWorkItemsService)(this.context.pageContext).getDataProvider(),dataSource:{projectIdOrName:e.fields[m.CoreFieldRefNames.TeamProject],workItemTypeName:e.fields[m.CoreFieldRefNames.WorkItemType],stateName:e.fields[m.CoreFieldRefNames.State]}},(e=>c.createElement(x.WorkItemState,{data:e,hideText:!1})))}}t[e].WorkItemState=s}("ComponentsWorkItemState"),function(e){X=t[e]={};const s=[{breakpoint:1,columnWidths:[80,-250,0,0,0]},{breakpoint:600,columnWidths:[80,200,180,-100,0]},{breakpoint:1024,columnWidths:[80,400,270,250,-100]}];function r(e){const t=[{id:"main-column",width:-100,renderCell:(e,t,s,r)=>c.createElement(C.TwoLineTableCell,{columnIndex:t,key:t,line1:c.createElement(c.Fragment,null,c.createElement(z.WorkItemIcon,{workItem:r.data}),c.createElement(W.Tooltip,{overflowOnly:!0},c.createElement("span",{className:"flex-grow text-ellipsis"},(0,i.format)(J.WorkItemFormat,r.data.fields[m.CoreFieldRefNames.WorkItemType],r.id,r.data.fields[m.CoreFieldRefNames.Title])))),line2:c.createElement("span",{className:"flex-row flex-center secondary-text"},c.createElement("span",{className:"padding-right-8"},(0,i.format)(j.LastUpdatedDateFormat,(0,b.ago)(r.data.fields[m.CoreFieldRefNames.ChangedDate]))),c.createElement(Q.WorkItemState,{workItem:r.data}))})}];return e.readonly||t.push({id:"delete-column",width:56,renderCell:(t,s,r,i)=>c.createElement(C.SimpleTableCell,{columnIndex:s,key:s},c.createElement(R.Button,{ariaLabel:j.RemoveButtonText,iconProps:{iconName:"Cancel"},onClick:t=>{e.onRemoveItem&&(e.onRemoveItem(i),t.preventDefault())},subtle:!0,tooltipProps:{text:j.RemoveButtonText}}))}),t}t[e].LinkedWorkItemsTable=e=>{const{itemProvider:t,renderNoItemsContent:i}=e;return t.length>0?e.expanded?c.createElement(C.Table,{className:e.className,columns:[{id:"idColumn",renderCell:(e,t,s,r)=>c.createElement(C.SimpleTableCell,{columnIndex:t,key:t,tableColumn:s},r.id),name:j.Id,width:new S.ObservableValue(80)},{id:"titleColumn",renderCell:(e,t,s,r)=>c.createElement(C.SimpleTableCell,{columnIndex:t,key:t,tableColumn:s},c.createElement(c.Fragment,null,c.createElement(z.WorkItemIcon,{workItem:r.data}),c.createElement(W.Tooltip,{overflowOnly:!0},c.createElement("span",{className:"margin-left-4"},r.data.fields[m.CoreFieldRefNames.Title])))),name:j.Title,width:new S.ObservableValue(400)},{id:"updatedByColumn",renderCell:(e,t,s,r)=>{const i=r.data.fields[m.CoreFieldRefNames.ChangedBy];return c.createElement(C.SimpleTableCell,{columnIndex:t,key:t,tableColumn:s},c.createElement(c.Fragment,null,c.createElement(T.VssPersona,{className:"icon-margin",displayName:i.displayName,imageUrl:i.imageUrl,size:"extra-small-plus"}),c.createElement(W.Tooltip,{overflowOnly:!0},c.createElement("span",{className:"text-ellipsis"},i.displayName))))},name:j.UpdatedBy,width:new S.ObservableValue(270)},{id:"dateColumn",renderCell:(e,t,s,r)=>c.createElement(C.SimpleTableCell,{columnIndex:t,key:t,tableColumn:s},c.createElement(y.Ago,{date:(0,D.getDateInUserTimeZone)(r.data.fields[m.CoreFieldRefNames.ChangedDate]),currentDate:(0,D.getDateInUserTimeZone)(),format:0,tooltipTimeFormat:D.tooltipTimeFormat})),name:j.UpdatedDate,width:new S.ObservableValue(250)},{id:"stateColumn",renderCell:(e,t,s,r)=>c.createElement(C.SimpleTableCell,{columnIndex:t,key:t,tableColumn:s},c.createElement(Q.WorkItemState,{workItem:r.data})),name:j.State,width:new S.ObservableValue(-100)}],itemProvider:t,onActivate:e.onActivate,tableBreakpoints:s}):c.createElement(C.Table,{className:e.className,columns:r(e),itemProvider:t,onActivate:e.onActivate,showHeader:!1,spacerWidth:2}):i?i():null}}("ComponentsLinkedWorkItemsTable"),function(e){t[e]={};class s extends h.VssComponent{constructor(){super(...arguments),this.renderDataComponent=()=>{const e=(0,K.getLinkedWorkItemsChangesetDetailViewService)(this.context.pageContext);return c.createElement(P.Card,{className:"bolt-table-card",titleProps:{text:j.WorkItems}},c.createElement(X.LinkedWorkItemsTable,{expanded:!0,itemProvider:e.getLinkedWorkItems("","",this.props.changesetId),onActivate:(e,t)=>{e.defaultPrevented||(0,f.onClickFPS)(this.context.pageContext,t.data.linkProps.href,!0,e)}}))}}render(){const e=(0,K.getLinkedWorkItemsChangesetDetailViewService)(this.context.pageContext);return c.createElement("div",{className:"flex-column rhythm-vertical-8"},c.createElement(B.ReadyableArrayObserver,{data:e.getLinkedWorkItems("","",this.props.changesetId),dataComponent:this.renderDataComponent}))}}t[e].LinkedWorkItemsChangesetDetails=s,h.Components.add("WIT.LinkedWorkItemsChangesetDetails",s)}("ComponentsLinkedWorkItemsChangesetDetails"),function(e){Y=t[e]={};class s extends h.VssComponent{constructor(e,t){var s,i,o;if(super(e,t),this.hasIdBasedItem=!1,this.initialItemsLoading=new S.ObservableValue(!1),this.selection=new V.DropdownSelection,this.workItemSuggestions=new S.ObservableArray,this.previousSuggestions=new Array,this.selectedWorkItems=new S.ObservableArray,this.selectedWorkItemIds=new Set,this.text=new S.ObservableValue(""),this.disableSuggestions=!1,this.debouncedSearchById=r(((e,t)=>(0,a.isFeatureFlagEnabled)(this.context.pageContext,q.FeatureFlags.DisableRelatedWitLoadingIndicator,!1)?this.searchById(e):this.loadingPlaceholderWrapper(this.filterSuggestionsById(e,[...t.value]))),300),this.debouncedSearchByTitle=r(((e,t)=>(0,a.isFeatureFlagEnabled)(this.context.pageContext,q.FeatureFlags.DisableRelatedWitLoadingIndicator,!1)?this.searchByTitle(e):this.loadingPlaceholderWrapper(this.filterSuggestionsByTitle(e,[...t.value]))),300),this.onSearchClick=()=>{this.setState({searchOnType:!0}),(0,a.isFeatureFlagEnabled)(this.context.pageContext,q.FeatureFlags.DisableRelatedWitLoadingIndicator,!1)?this.searchByTitle(this.text.value):this.loadingPlaceholderWrapper(this.filterSuggestionsByTitle(this.text.value,[...this.workItemSuggestions.value]))},this.linkWorkItems=async e=>{if(!this.selectedWorkItems.length)return;const t=this.selectedWorkItems.value.map((e=>parseInt(e.id)));return this.linkedWorkItemsService.addWorkItemsBatchAsync(t,e)},this.onTextChange=(e,t)=>{this.text.value=t;const s=this.workItemSuggestions.value.some((e=>t===e.id)),r=parseInt(t);isNaN(r)||s?this.state.searchOnType&&this.props.withLiveTextSearch?this.debouncedSearchByTitle(t,this.workItemSuggestions):(this.hasIdBasedItem&&this.workItemSuggestions.splice(0,1),this.hasIdBasedItem=!1):this.debouncedSearchById(r,this.workItemSuggestions)},this.addLinkedWorkItem=e=>{e&&(this.selection.value=[],this.selectedWorkItems.push(e),this.selectedWorkItemIds.add(e.id),this.triggerWorkItemsChanged())},this.removeWorkItem=e=>{this.selectedWorkItems.removeAll((t=>t.id===e.id)),this.selectedWorkItemIds.delete(e.id),this.triggerWorkItemsChanged()},this.workItemSuggestionFilter=e=>!this.props.workItemSuggestionFilter||this.props.workItemSuggestionFilter(e),this.state={searchOnType:!1},this.project=null!==(s=(0,n.getTFSProject)(this.context.pageContext))&&void 0!==s?s:null===(i=this.props)||void 0===i?void 0:i.workItemProjectData,!this.project)throw new Error(j.NoProjectSpecifiedMessage);this.linkedWorkItemsService=this.context.pageContext.getService("ILinkedWorkItemsService"),this.disableSuggestions=(0,a.isFeatureFlagEnabled)(this.context.pageContext,q.FeatureFlags.DisableSuggestions,!1),this.setInitialWorkItems(null!==(o=e.initialWorkItems)&&void 0!==o?o:[]),this.initializeSuggestions(),e.artifactChangesContext.addArtifactCompleteListener(this.linkWorkItems)}render(){return c.createElement(B.Observer,{initialItemsLoading:this.initialItemsLoading,message:this.props.message,selectedWorkItems:this.selectedWorkItems,workItems:this.workItemSuggestions},(e=>c.createElement("div",{className:"flex-column rhythm-vertical-8"},c.createElement(A.FormItemContext.Provider,{value:{ariaLabelledById:"pr-linked-workitems-label"}},c.createElement("div",{className:"flex-row flex-center rhythm-horizontal-8"},c.createElement("label",{className:"body-m",id:(0,v.getSafeId)("pr-linked-workitems-label")},j.WorkItemsToLinkLabel),(this.selectedWorkItems.value.length>0||e.initialItemsLoading)&&c.createElement(N.Pill,{size:0,tabIndex:-1},e.initialItemsLoading?j.Loading:this.selectedWorkItems.value.length),c.createElement("span",{className:"flex-grow"}),c.createElement(E.Link,{className:(0,h.css)(!this.selectedWorkItems.value.length&&"invisible"),onClick:()=>{this.selectedWorkItems.value=[],this.selectedWorkItemIds.clear(),this.triggerWorkItemsChanged()},subtle:!0,tooltipProps:{text:j.ClearAllTooltip}},j.ClearAll)),c.createElement(_.ControlledLinkedWorkItemsDropdown,{excludedSearchIds:this.selectedWorkItemIds,onTextChanged:this.onTextChange,onValueChanged:this.addLinkedWorkItem,selection:this.selection,text:this.text,workItems:this.workItemSuggestions,onSearchClick:this.state.searchOnType||!this.props.withLiveTextSearch?void 0:this.onSearchClick})),e.message&&c.createElement(F.MessageCard,Object.assign({},e.message)),c.createElement(X.LinkedWorkItemsTable,{expanded:!1,itemProvider:this.selectedWorkItems,onActivate:(e,t)=>{e.defaultPrevented||(0,f.onClickFPS)(this.context.pageContext,t.data.linkProps.href,!0,e)},onRemoveItem:this.removeWorkItem}))))}removeWorkItems(e){this.selectedWorkItems.removeAll((t=>e.indexOf(t.data.id)>=0)),e.forEach((e=>this.selectedWorkItemIds.delete(e.toString()))),this.triggerWorkItemsChanged()}loadingPlaceholderWrapper(e){const t="loading-row";this.workItemSuggestions.value.some((e=>e.id===t))||(this.previousSuggestions=[...this.workItemSuggestions.value]),this.workItemSuggestions.value=[{id:t,type:4,text:t}],e.then((e=>{this.workItemSuggestions.value=e||this.previousSuggestions})).catch((()=>{this.workItemSuggestions.value=this.previousSuggestions}))}async setInitialWorkItems(e){const t=await e;if(0===t.length)return;const s=await this.linkedWorkItemsService.getWorkItems(t,this.project.name);for(const e of s){const t=(0,J.workItemToListBoxItem)(this.context.pageContext,e);this.addLinkedWorkItem(t)}this.initialItemsLoading.value=!1}async initializeSuggestions(){this.workItemSuggestions.push({id:"loading-row",type:4,text:"loading-row"});try{const{workItems:e}=this.disableSuggestions?{workItems:[]}:await this.linkedWorkItemsService.getAssignedWorkItems(this.project.id);if(0===e.length)return void this.workItemSuggestions.removeAll();const t=e.map((e=>e.id)),s=await this.linkedWorkItemsService.getWorkItems(t,this.project.name),r=[];for(const e of s.filter(this.workItemSuggestionFilter)){const t=(0,J.workItemToListBoxItem)(this.context.pageContext,e);r.push(t)}this.workItemSuggestions.value=this.previousSuggestions=r}catch(e){this.workItemSuggestions.removeAll()}}triggerWorkItemsChanged(){this.props.onSelectedWorkItemsChanged&&this.props.onSelectedWorkItemsChanged(this.selectedWorkItems.value.map((e=>e.data)))}async filterSuggestionsById(e,t){try{const s=await this.linkedWorkItemsService.getWorkItem(e,this.project.name);if(e!==parseInt(this.text.value))return;if(!this.workItemSuggestionFilter(s))return;const r=(0,J.workItemToListBoxItem)(this.context.pageContext,s);return t.splice(0,this.hasIdBasedItem?1:0,r),this.hasIdBasedItem=!0,t}catch(e){return this.hasIdBasedItem&&t.splice(0,1),void(this.hasIdBasedItem=!1)}}async filterSuggestionsByTitle(e,t){var s;if(0===e.trim().length)return;const r=t.map((e=>parseInt(e.id))),i=await this.linkedWorkItemsService.searchWorkItems(e,r,this.project.id);if(!(null===(s=null==i?void 0:i.workItems)||void 0===s?void 0:s.length))return t;if(e!==this.text.value)return;const o=await this.linkedWorkItemsService.getWorkItems(i.workItems.map((e=>e.id)),this.project.name);if(e!==this.text.value)return;const n=t.map((e=>parseInt(e.id))),a=o.filter(this.workItemSuggestionFilter).filter((e=>!n.includes(e.id))).map((e=>(0,J.workItemToListBoxItem)(this.context.pageContext,e)));return t.splice(0,0,...a),t}async searchById(e){try{const t=await this.linkedWorkItemsService.getWorkItem(e,this.project.name);if(e!==parseInt(this.text.value))return;if(!this.workItemSuggestionFilter(t))return;const s=(0,J.workItemToListBoxItem)(this.context.pageContext,t);this.workItemSuggestions.splice(0,this.hasIdBasedItem?1:0,s),this.hasIdBasedItem=!0}catch(e){this.hasIdBasedItem&&this.workItemSuggestions.splice(0,1),this.hasIdBasedItem=!1}}async searchByTitle(e){if(0===e.trim().length)return;const t=this.workItemSuggestions.value.map((e=>parseInt(e.id))),s=await this.linkedWorkItemsService.searchWorkItems(e,t,this.project.id);if(e!==this.text.value)return;const r=await this.linkedWorkItemsService.getWorkItems(s.workItems.map((e=>e.id)),this.project.name);if(e!==this.text.value)return;const i=this.workItemSuggestions.value.map((e=>parseInt(e.id))),o=r.filter(this.workItemSuggestionFilter).filter((e=>!i.includes(e.id))).map((e=>(0,J.workItemToListBoxItem)(this.context.pageContext,e)));this.workItemSuggestions.splice(0,0,...o)}}function r(e,t){let s=null;return(...r)=>{null!==s&&clearTimeout(s),s=setTimeout((()=>{s=null,e(...r)}),t)}}t[e].LinkedWorkItemsDropdown=s,h.Components.add("WIT.LinkedWorkItemsDropdown",s)}("ComponentsLinkedWorkItemsDropdown"),function(e){t[e]={};class s extends c.Component{constructor(){super(...arguments),this.linkWorkItems=e=>{if(this.artifactListener){const t=[];return t.push((0,H.getChangesetArtifactLink)(e.changesetId)),this.artifactListener(t)}}}render(){const e={artifactChangesContext:{addArtifactCompleteListener:e=>{this.artifactListener=e,this.props.checkinChangesContext.addCheckinCompleteListener(this.linkWorkItems)}}};return c.createElement(Y.LinkedWorkItemsDropdown,Object.assign({},e))}}t[e].LinkedWorkItemsCheckinChanges=s,h.Components.add("WIT.LinkedWorkItemsCheckinChanges",s)}("ComponentsLinkedWorkItemsCheckinChanges"),function(e){t[e]={};class s extends c.Component{constructor(){super(...arguments),this.linkWorkItems=(e,t)=>{if(this.artifactListener){const s=e.repository.project.id,r=e.repository.id,i=[];return i.push((0,H.getCommitArtifactLink)(s,r,e.commits[0].commitId,H.ArtifactLinkNames.CommitToWorkItem)),t&&i.push((0,H.getBranchArtifactLink)(s,r,t,H.ArtifactLinkNames.BranchToWorkItem)),this.artifactListener(i)}}}render(){const e={artifactChangesContext:{addArtifactCompleteListener:e=>{this.artifactListener=e,this.props.commitChangesContext.addPushCompleteListener(this.linkWorkItems)}}};return c.createElement(Y.LinkedWorkItemsDropdown,Object.assign({},e))}}t[e].LinkedWorkItemsCommitChanges=s,h.Components.add("WIT.LinkedWorkItemsCommitChanges",s)}("ComponentsLinkedWorkItemsCommitChanges"),function(e){ee=t[e]={};class r extends Z.LinkedWorkItemsBaseDetailViewService{getLinkedWorkItemPromise(e,t,s){return(0,G.getLinkedWorkItemsService)(this.pageContext).getLinkedCommitWorkItemIds(e,t,s)}getLinkedWorkItems(e,t,s){return super.getLinkedWorkItems(e,t,s)}}const i="ILinkedWorkItemsCommitDetailViewService";t[e].getLinkedWorkItemsCommitDetailViewService=function(e){return e.getService(i)},s.Services.add(i,{serviceFactory:r})}("LinkedWorkItemsCommitDetailViewService"),function(e){t[e]={};class s extends h.VssComponent{constructor(){super(...arguments),this.renderDataComponent=()=>{const{commitId:e,repository:t}=this.props,s=(0,ee.getLinkedWorkItemsCommitDetailViewService)(this.context.pageContext);return c.createElement(P.Card,{className:"bolt-table-card",titleProps:{text:j.WorkItems}},c.createElement(X.LinkedWorkItemsTable,{expanded:!0,itemProvider:s.getLinkedWorkItems(t.project.id,t.id,e),onActivate:(e,t)=>{e.defaultPrevented||(0,f.onClickFPS)(this.context.pageContext,t.data.linkProps.href,!0,e)}}))}}render(){const{commitId:e,repository:t}=this.props,s=(0,ee.getLinkedWorkItemsCommitDetailViewService)(this.context.pageContext);return c.createElement("div",{className:"flex-column rhythm-vertical-8"},c.createElement(B.ReadyableArrayObserver,{data:s.getLinkedWorkItems(t.project.id,t.id,e),dataComponent:this.renderDataComponent}))}}t[e].LinkedWorkItemsCommitDetails=s,h.Components.add("WIT.LinkedWorkItemsCommitDetails",s)}("ComponentsLinkedWorkItemsCommitDetails"),function(e){t[e]={};class s extends c.Component{constructor(){super(...arguments),this.linkWorkItems=(e,t)=>{if(this.artifactListener){const s=e.project.id,r=e.id,i=[(0,H.getBranchArtifactLink)(s,r,t,H.ArtifactLinkNames.BranchToWorkItem)];return this.artifactListener(i)}}}render(){const e={artifactChangesContext:{addArtifactCompleteListener:e=>{this.artifactListener=e,this.props.createBranchContext.addBranchCreateListener(this.linkWorkItems)}},initialWorkItems:this.props.initialWorkItemIds};return c.createElement(Y.LinkedWorkItemsDropdown,Object.assign({},e))}}t[e].LinkedWorkItemsCreateBranch=s,h.Components.add("WIT.LinkedWorkItemsCreateBranch",s)}("ComponentsLinkedWorkItemsCreateBranch"),function(e){t.ComponentsLinkedWorkItemsCreatePullRequest={};class r extends s.VssService{constructor(){super(...arguments),this.workItemsByPullRequest={}}getAssociatedWorkItems(e){return this.workItemsByPullRequest[e]}setAssociatedWorkItems(e,t){this.workItemsByPullRequest[e]=t}}s.Services.add("ILinkedWorkItemsCreatePullRequestService",{serviceFactory:r});class o extends h.VssComponent{constructor(){super(...arguments),this.message=new S.ObservableValue(void 0),this.dropdownRef=c.createRef(),this.linkWorkItems=async e=>{if(this.artifactListener)try{return await this.artifactListener([(0,H.getPullRequestArtifactLink)(e.repository.project.id,e.repository.id,e.pullRequestId)])}catch(e){throw new Error((0,i.format)(j.PullRequestLinkError,e.message))}}}render(){const{createPullRequestContext:e}=this.props,t=this.context.pageContext.getService("ILinkedWorkItemsCreatePullRequestService"),s={artifactChangesContext:{addArtifactCompleteListener:t=>{this.artifactListener=t,e.addPullRequestCreateListener(this.linkWorkItems)}},message:this.message,onSelectedWorkItemsChanged:s=>t.setAssociatedWorkItems(e.pullRequestCreationId,s.map((e=>e.id)))},r=t.getAssociatedWorkItems(e.pullRequestCreationId);if(r)s.initialWorkItems=r;else{const t=this.context.pageContext.getService("IVssContributionService");s.initialWorkItems=t.getDataAsync("ms.vss-code-web.associated-workitems-data-provider",{repositoryId:e.repository.id,versions:[e.sourceVersion,...e.commits.map((e=>"GC"+e.commit.commitId))]}).then((e=>{const t=e?e.map((e=>e.id)):[];return t.length>=10&&(this.message.value={buttonProps:[{onClick:()=>{this.dropdownRef.current&&(this.dropdownRef.current.removeWorkItems(t),this.message.value=void 0)},text:j.Clear,tooltipProps:{text:j.ClearPullRequestWorkItemsTooltip}}],children:(0,i.format)(j.CreatePullRequestWarningFormat,t.length),onDismiss:()=>this.message.value=void 0,severity:"Warning"}),t}))}return c.createElement(Y.LinkedWorkItemsDropdown,Object.assign({},s,{ref:this.dropdownRef}))}}h.Components.add("WIT.LinkedWorkItemsCreatePullRequest",o)}(),function(e){te=t[e]={};class r extends Z.LinkedWorkItemsBaseDetailViewService{constructor(){super(...arguments),this.availableWorkItems=new S.ReadyableObservableArray([{id:"loading-row",type:4,text:"loading-row",linkProps:{}}]),this.baseAvailableWorkItems=[],this.linkedWorkItemsHasIdBasedItem=!1}addLinkedWorkItem(e,t,s,r){const i=(0,G.getLinkedWorkItemsService)(this.pageContext);return i.addWorkItemsBatchAsync([e.id],[(0,H.getPullRequestArtifactLink)(t,s,r)]).then((()=>{i.getWorkItem(e.id,this.project.name,1).then((e=>{this.linkedWorkItems.push((0,J.workItemToListBoxItem)(this.pageContext,e)),this.linkedWorkItemIds.add(e.id.toString())}))}))}getAvailableWorkItems(){return this.availableWorkItems}getLinkedWorkItemIds(){return this.linkedWorkItemIds}getLinkedWorkItems(e,t,s){return super.getLinkedWorkItems(e,t,s)}getWorkItemFormUrl(e){const t={};return t.project=e.fields[m.CoreFieldRefNames.TeamProject],t.id=e.id.toString(),(0,w.routeUrl)(this.pageContext,"ms.vss-work-web.work-items-form-route",t)}hydrateAvailableWorkItems(){if(!this.availableWorkItems.ready.value){const e=(0,G.getLinkedWorkItemsService)(this.pageContext);e.getAssignedWorkItems().then((t=>{const s=t.workItems.map((e=>e.id));return s.length>0?e.getWorkItems(s,this.project.name,1):[]})).then((e=>{this.baseAvailableWorkItems=e.map((e=>(0,J.workItemToListBoxItem)(this.pageContext,e))),this.availableWorkItems.value=this.baseAvailableWorkItems,this.availableWorkItems.ready.value=!0}))}}removeLinkedWorkItem(e,t,s,r){const i=e.id;return(0,G.getLinkedWorkItemsService)(this.pageContext).removeWorkItemsBatchAsync([e],[(0,H.getPullRequestArtifactLink)(t,s,r)]).then((()=>{this.linkedWorkItemIds.delete(i.toString()),this.linkedWorkItems.removeAll((e=>!!e.data&&e.data.id===i))}))}updateAvailableWorkItemsForFilter(e){const t=this.baseAvailableWorkItems.some((t=>e===t.id)),s=parseInt(e);isNaN(s)||t?(this.linkedWorkItemsHasIdBasedItem&&this.availableWorkItems.splice(0,1),this.linkedWorkItemsHasIdBasedItem=!1):(0,G.getLinkedWorkItemsService)(this.pageContext).getWorkItem(s,this.project.name).then((e=>{const t=(0,J.workItemToListBoxItem)(this.pageContext,e);this.availableWorkItems.splice(0,this.linkedWorkItemsHasIdBasedItem?1:0,t),this.linkedWorkItemsHasIdBasedItem=!0})).catch((()=>{this.linkedWorkItemsHasIdBasedItem&&this.availableWorkItems.splice(0,1),this.linkedWorkItemsHasIdBasedItem=!1}))}getLinkedWorkItemPromise(e,t,s){return(0,G.getLinkedWorkItemsService)(this.pageContext).getLinkedPullRequestWorkItemIds(t,s)}}const i="ILinkedWorkItemsPullRequestDetailViewService";t[e].getLinkedWorkItemsPullRequestDetailViewService=function(e){return e.getService(i)},s.Services.add(i,{serviceFactory:r})}("LinkedWorkItemsPullRequestDetailViewService"),function(e){t[e]={};class s extends h.VssComponent{constructor(){super(...arguments),this.transformDescriptionBeforeCompletion=e=>{const t=(0,te.getLinkedWorkItemsPullRequestDetailViewService)(this.context.pageContext);return this.readyPromise||(this.readyPromise=new Promise((e=>{const{pullRequestId:s,repository:r}=this.props,i=t.getLinkedWorkItems(r.project.id,r.id,s).ready;i.value?e():i.subscribe((t=>{t&&e()}))}))),this.readyPromise.then((()=>{const s=t.getLinkedWorkItemIds();if(s.size>0){const t=[];s.forEach((e=>{t.push(`#${e}`)})),e.description=(0,i.format)(j.DescriptionWithRelatedWorkItems,e.description,t.join(", "))}}))}}componentDidMount(){this.props.addCompletionTransformer(this.transformDescriptionBeforeCompletion)}render(){return null}}t[e].LinkedWorkItemsPullRequestCompletion=s,h.Components.add("WIT.LinkedWorkItemsPullRequestCompletion",s)}("ComponentsLinkedWorkItemsPullRequestCompletion"),function(e){t[e]={};class s extends h.VssComponent{constructor(e,t){super(e),this.errorMessage=new S.ObservableValue(""),this.headerCommandBarItems=[],this.headerRef=c.createRef(),this.selection=new V.DropdownSelection,this.showDropdown=new S.ObservableValue(!1),this.text=new S.ObservableValue(""),this.renderDataComponent=()=>{const{pullRequestId:e,repository:t}=this.props,s=(0,te.getLinkedWorkItemsPullRequestDetailViewService)(this.context.pageContext);return c.createElement("div",{className:"flex-column rhythm-vertical-8"},c.createElement(U.Header,{className:"no-padding flex-grow",commandBarItems:this.headerCommandBarItems,ref:this.headerRef,title:j.WorkItems}),c.createElement(B.Observer,{errorMessage:this.errorMessage},(e=>e.errorMessage?c.createElement(F.MessageCard,{onDismiss:()=>this.errorMessage.value="",severity:"Error"},e.errorMessage):null)),c.createElement(B.Observer,{showDropdown:this.showDropdown},(e=>e.showDropdown?c.createElement(_.ControlledLinkedWorkItemsDropdown,{excludedSearchIds:s.getLinkedWorkItemIds(),focusOnMount:!0,onBlur:()=>this.showDropdown.value=!1,onTextChanged:this.onTextChanged,onValueChanged:this.onValueChanged,selection:this.selection,text:this.text,workItems:s.getAvailableWorkItems()}):null)),c.createElement(X.LinkedWorkItemsTable,{className:"linked-wit-pr-details",expanded:!1,itemProvider:s.getLinkedWorkItems(t.project.id,t.id,e),onActivate:(e,t)=>{e.defaultPrevented||(0,f.onClickFPS)(this.context.pageContext,t.data.linkProps.href,!0,e)},onRemoveItem:this.onRemoveWorkItem,readonly:this.readonly,renderNoItemsContent:()=>this.readonly?c.createElement("div",{className:"repos-pr-no-items-well"},j.NoWorkItems):c.createElement("div",{className:"repos-pr-no-items-well cursor-pointer",onClick:this.showWorkItemsDropdown,onKeyPress:e=>{13!==e.which&&32!==e.which||this.showWorkItemsDropdown()},role:"button",tabIndex:0},j.NoWorkItems)}))},this.renderLoadingHeader=()=>c.createElement("div",{className:"flex-row rhythm-horizontal-8"},c.createElement(U.Header,{className:"no-padding flex-grow",commandBarItems:this.headerCommandBarItems,title:j.WorkItems})),this.onRemoveWorkItem=e=>{const{repository:t,pullRequestId:s}=this.props;e.data&&(0,te.getLinkedWorkItemsPullRequestDetailViewService)(this.context.pageContext).removeLinkedWorkItem(e.data,t.project.id,t.id,s).then((()=>{var e;null===(e=this.headerRef.current)||void 0===e||e.focus({commandBarItemId:"add-work-item"})})).catch((()=>{var t;return this.errorMessage.value=(0,i.format)(j.FailedToRemoveWorkItem,null===(t=e.data)||void 0===t?void 0:t.id)}))},this.onTextChanged=(e,t)=>{this.text.value=t,(0,te.getLinkedWorkItemsPullRequestDetailViewService)(this.context.pageContext).updateAvailableWorkItemsForFilter(t)},this.onValueChanged=e=>{const{repository:t,pullRequestId:s}=this.props;this.selection.value=[],e&&e.data&&(0,te.getLinkedWorkItemsPullRequestDetailViewService)(this.context.pageContext).addLinkedWorkItem(e.data,t.project.id,t.id,s).catch((()=>{var t;return this.errorMessage.value=(0,i.format)(j.FailedToAddWorkItem,null===(t=e.data)||void 0===t?void 0:t.id)}))},this.showWorkItemsDropdown=()=>{this.showDropdown.value=!0,(0,te.getLinkedWorkItemsPullRequestDetailViewService)(this.context.pageContext).hydrateAvailableWorkItems()},this.readonly=!(0,O.userHasClaim)(t.pageContext,"member"),this.readonly||this.headerCommandBarItems.push({ariaLabel:j.LinkWorkItem,hideDropdownIcon:!0,iconProps:{iconName:"Add"},id:"add-work-item",onActivate:this.showWorkItemsDropdown,tooltipProps:{text:j.LinkWorkItem}})}render(){const{pullRequestId:e,repository:t}=this.props,s=(0,te.getLinkedWorkItemsPullRequestDetailViewService)(this.context.pageContext);return c.createElement("div",{className:"flex-column rhythm-vertical-8"},c.createElement(B.ReadyableArrayObserver,{data:s.getLinkedWorkItems(t.project.id,t.id,e),dataComponent:this.renderDataComponent,loadingComponent:this.renderLoadingHeader,zeroDataComponent:this.renderDataComponent}))}}t[e].LinkedWorkItemsPullRequestDetails=s,h.Components.add("WIT.LinkedWorkItemsPullRequestDetails",s)}("ComponentsLinkedWorkItemsPullRequestDetails"),function(e){se=t[e]={};class r extends Z.LinkedWorkItemsBaseDetailViewService{getLinkedWorkItems(e,t,s){return super.getLinkedWorkItems(e,t,s)}getLinkedWorkItemPromise(e,t,s){return(0,G.getLinkedWorkItemsService)(this.pageContext).getLinkedShelvesetWorkItemIds(s)}}const i="ILinkedWorkItemsShelvesetDetailViewService";t[e].getLinkedWorkItemsShelvesetDetailViewService=function(e){return e.getService(i)},s.Services.add(i,{serviceFactory:r})}("LinkedWorkItemsShelvesetDetailViewService"),function(e){t[e]={};class s extends h.VssComponent{constructor(){super(...arguments),this.renderDataComponent=()=>{const e=(0,se.getLinkedWorkItemsShelvesetDetailViewService)(this.context.pageContext);return c.createElement(P.Card,{className:"bolt-table-card",titleProps:{text:j.WorkItems}},c.createElement(X.LinkedWorkItemsTable,{expanded:!0,itemProvider:e.getLinkedWorkItems("","",this.props.shelvesetName),onActivate:(e,t)=>{e.defaultPrevented||(0,f.onClickFPS)(this.context.pageContext,t.data.linkProps.href,!0,e)}}))}}render(){const e=(0,se.getLinkedWorkItemsShelvesetDetailViewService)(this.context.pageContext);return c.createElement("div",{className:"flex-column rhythm-vertical-8"},c.createElement(B.ReadyableArrayObserver,{data:e.getLinkedWorkItems("","",this.props.shelvesetName),dataComponent:this.renderDataComponent}))}}t[e].LinkedWorkItemsShelvesetDetails=s,h.Components.add("WIT.LinkedWorkItemsShelvesetDetails",s)}("ComponentsLinkedWorkItemsShelvesetDetails")}),["Resources","RestClient/WitBatchRestClient","RestClient/Git","Util/Artifact","LinkedWorkItemsService","Components/WorkItemIcon","Components/ControlledLinkedWorkItemsDropdown","Util/Data","LinkedWorkItemsBaseDetailViewService","LinkedWorkItemsChangesetDetailViewService","Components/WorkItemState","Components/LinkedWorkItemsTable","Components/LinkedWorkItemsChangesetDetails","Components/LinkedWorkItemsDropdown","Components/LinkedWorkItemsCheckinChanges","Components/LinkedWorkItemsCommitChanges","LinkedWorkItemsCommitDetailViewService","Components/LinkedWorkItemsCommitDetails","Components/LinkedWorkItemsCreateBranch","Components/LinkedWorkItemsCreatePullRequest","LinkedWorkItemsPullRequestDetailViewService","Components/LinkedWorkItemsPullRequestCompletion","Components/LinkedWorkItemsPullRequestDetails","LinkedWorkItemsShelvesetDetailViewService","Components/LinkedWorkItemsShelvesetDetails"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-work-web.wit-linked-work-dropdown-content"}}));