"use strict";define("VSS/Features/MarkdownEditor",["require","exports","react","VSS/Core/Observable","VSS/Core/TimerManagement","VSS/Features/Markdown/MarkdownRendererComponent","VSSUI/Util","VSS/Platform/Layout","VSSUI/FormItem","VSSUI/Icon","VSSUI/Link","VSSUI/Observer","VSSUI/TextField","VSS/Features/PlatformUI/ContributedMenu","VSSUI/HeaderCommandBar"],(function(e,t,n,o,r,s,i,a,l,m,d,c,u,g,h){var p,S,b,x,T,C,f,w;p=t.Resources={},t.Resources.BoldTooltipText="Bold (Ctrl + B)",t.Resources.BulletedListText="Bulleted List",t.Resources.CodeTooltipText="Code",t.Resources.EditorTabText="Editor",t.Resources.Header1Text="Header 1",t.Resources.Header2Text="Header 2",t.Resources.Header3Text="Header 3",t.Resources.HeaderText="Header",t.Resources.ItalicTooltipText="Italic (Ctrl + I)",t.Resources.LinkTooltipText="Link (Ctrl + K)",t.Resources.LinkWorkItemsMessage="Link work items.",t.Resources.MarkdownSupportedMessage="Markdown supported.",t.Resources.NumberedListText="Numbered List",t.Resources.PreviewTabText="Preview",t.Resources.TaskListText="Task List",function(e){function n(e,t){const n=e.slice(0,t+1).search(/\S+$/),o=e.slice(t).search(/\s/);let r,s;return r=n<0?t:n,s=o<0?e.length:o+t,r=Math.min(Math.max(0,r),e.length),s=Math.min(Math.max(0,s),e.length),{start:r,end:s}}function o(e,t,n){for(;t<n&&/\s/.test(e[t]);)t++;for(;n>t&&/\s/.test(e[n-1]);)n--;return{end:n,start:t}}S=t.FormattingCommon={},t.FormattingCommon.newLineChar="\n",function(e){e.Bold="**",e.Italic="_",e.Header1="# ",e.Header2="## ",e.Header3="### ",e.BulletedList="- ",e.NumberedList="1. ",e.TaskList="- [ ] ",e.Code="`",e.CodeBlock=t.FormattingCommon.newLineChar+"```"+t.FormattingCommon.newLineChar}(t.FormattingCommon.MarkdownSigns||(t.FormattingCommon.MarkdownSigns={})),t.FormattingCommon.insertText=function(e,t){const n=e.selectionStart||0,o=e.selectionEnd||0;return{finalSelectionEnd:n+(t=t||e.text.substring(n,o)).length,finalSelectionStart:n+t.length,finalText:e.text.substring(0,n)+t+e.text.substring(o),insertSelectionEnd:o,insertSelectionStart:n,insertText:t}},t.FormattingCommon.insertSignAtLineStart=function(e,n,o=[]){const{text:r=""}=e;let s=Math.min(e.selectionStart||0,r.length);const i=Math.min(e.selectionEnd||0,r.length);s=r.substring(0,s).lastIndexOf(t.FormattingCommon.newLineChar)+1;const a=r.substring(s,i).split(t.FormattingCommon.newLineChar).map((e=>{if(!e&&s!==i)return e;const t=o.filter((t=>0===e.indexOf(t)))[0];return 0===e.indexOf(n)?e.substring(n.length):t?n+e.substring(t.length):n+e})),l=r.substring(0,s),m=r.substring(i),d=a.join(t.FormattingCommon.newLineChar),c=l.length+d.length;return{insertSelectionEnd:i,insertSelectionStart:s,insertText:d,finalSelectionEnd:c,finalSelectionStart:c,finalText:l+d+m}},t.FormattingCommon.wrapWithSign=function(e,t,r=t){const{text:s=""}=e;let i=Math.min(e.selectionStart||0,s.length),a=Math.min(e.selectionEnd||0,s.length),l=i;const m=t.length,d=a>i;if(d){const e=o(s,i,a);i=e.start,a=e.end,i-m>=0&&s.substr(i-m,m)===t&&(i-=m),s.substr(a,m)===t&&(a+=m)}else{const e=n(s,i);i=e.start,a=e.end}const c=s.substring(0,i),u=s.substring(i,a),g=s.substring(a);let h;return t===u.substr(0,m)&&r===u.substr(u.length-m)?(h=u.substr(m,u.length-2*m),l-=m,d?a-=2*m:(i-=m,a-=m)):(h=t+u+r,l+=m,i+=m,a+=m),d||(i=a=l),{insertSelectionEnd:c.length+u.length,insertSelectionStart:c.length,insertText:h,finalSelectionEnd:a,finalSelectionStart:i,finalText:c+h+g}},t.FormattingCommon.expandCursorToWord=n,t.FormattingCommon.getTrimmedSelectionRange=o,t.FormattingCommon.applyTextFormatting=function(e,t){t&&(t.then?t.then((t=>{t&&e.applyFormatting(t)}),(t=>e.showError(t))):e.applyFormatting(t))}}(),b=t.FormattingLink={},t.FormattingLink.wrapWithLinkSign=function(e){const{text:t=""}=e;let n=Math.min(e.selectionStart||0,t.length),o=Math.min(e.selectionEnd||0,t.length),r=o>n;if(r){const e=(0,S.getTrimmedSelectionRange)(t,n,o);n=e.start,o=e.end}else{const e=(0,S.expandCursorToWord)(t,n);n=e.start,o=e.end,r=o>n}const s=t.substring(0,n),i=t.substring(n,o),a=t.substring(o);let l,m;r?(l=`[${t.substring(n,o)}](`,m=")"):(l="[",m="]()");const d=l+m,c=s.length+l.length;return{insertSelectionEnd:s.length+i.length,insertSelectionStart:s.length,insertText:d,finalSelectionEnd:c,finalSelectionStart:c,finalText:s+d+a}},t.CommandsShortcut={},t.CommandsShortcut.Bold={formatText:(e,t)=>{if(t.ctrlKey&&66===t.which)return(0,S.wrapWithSign)(e,S.MarkdownSigns.Bold)},id:"bold"},t.CommandsShortcut.Italic={formatText:(e,t)=>{if(t.ctrlKey&&73===t.which)return(0,S.wrapWithSign)(e,S.MarkdownSigns.Italic)},id:"italic"},t.CommandsShortcut.Link={formatText:(e,t)=>{if(t.ctrlKey&&75===t.which)return(0,b.wrapWithLinkSign)(e)},id:"link"},t.CommandsShortcut.shortcutCommands=[t.CommandsShortcut.Bold,t.CommandsShortcut.Italic,t.CommandsShortcut.Link],x=t.FormattingCode={},t.FormattingCode.wrapWithCodeSign=function(e){const{text:t=""}=e,n=Math.min(e.selectionStart||0,t.length),o=Math.min(e.selectionEnd||0,t.length),r=t.substring(n,o).trim().indexOf(S.newLineChar)>=0?S.MarkdownSigns.CodeBlock:S.MarkdownSigns.Code;return(0,S.wrapWithSign)(e,r)},function(e){t.CommandsToolbar={},t.CommandsToolbar.Header1={id:"header-1",formatText:e=>(0,S.insertSignAtLineStart)(e,S.MarkdownSigns.Header1,[S.MarkdownSigns.Header2,S.MarkdownSigns.Header3]),text:p.Header1Text},t.CommandsToolbar.Header2={id:"header-2",formatText:e=>(0,S.insertSignAtLineStart)(e,S.MarkdownSigns.Header2,[S.MarkdownSigns.Header1,S.MarkdownSigns.Header3]),text:p.Header2Text},t.CommandsToolbar.Header3={id:"header-3",formatText:e=>(0,S.insertSignAtLineStart)(e,S.MarkdownSigns.Header3,[S.MarkdownSigns.Header1,S.MarkdownSigns.Header2]),text:p.Header3Text};const n={id:"header",iconProps:{iconName:"EditStyle"},order:10,tooltipProps:{text:p.HeaderText},subMenuProps:{id:"header-menu",items:[t.CommandsToolbar.Header1,t.CommandsToolbar.Header2,t.CommandsToolbar.Header3]}};t.CommandsToolbar.Bold={formatText:e=>(0,S.wrapWithSign)(e,S.MarkdownSigns.Bold),iconProps:{iconName:"SemiboldWeight"},id:"bold",order:20,tooltipProps:{text:p.BoldTooltipText}},t.CommandsToolbar.Italic={formatText:e=>(0,S.wrapWithSign)(e,S.MarkdownSigns.Italic),iconProps:{iconName:"Italic"},id:"italic",order:30,tooltipProps:{text:p.ItalicTooltipText}},t.CommandsToolbar.Code={formatText:x.wrapWithCodeSign,iconProps:{iconName:"Embed"},id:"code",order:40,tooltipProps:{text:p.CodeTooltipText}},t.CommandsToolbar.Link={formatText:b.wrapWithLinkSign,iconProps:{iconName:"Link"},id:"link",order:50,tooltipProps:{text:p.LinkTooltipText}},t.CommandsToolbar.BulletedList={formatText:e=>(0,S.insertSignAtLineStart)(e,S.MarkdownSigns.BulletedList,[S.MarkdownSigns.NumberedList,S.MarkdownSigns.TaskList]),iconProps:{iconName:"BulletedList"},id:"bulleted-list",order:60,tooltipProps:{text:p.BulletedListText}},t.CommandsToolbar.NumberedList={formatText:e=>(0,S.insertSignAtLineStart)(e,S.MarkdownSigns.NumberedList,[S.MarkdownSigns.BulletedList,S.MarkdownSigns.TaskList]),iconProps:{iconName:"NumberedList"},id:"numbered-list",order:70,tooltipProps:{text:p.NumberedListText}},t.CommandsToolbar.TaskList={formatText:e=>(0,S.insertSignAtLineStart)(e,S.MarkdownSigns.TaskList,[S.MarkdownSigns.BulletedList,S.MarkdownSigns.NumberedList]),iconProps:{iconName:"CheckList"},id:"task-list",order:80,tooltipProps:{text:p.TaskListText}},t.CommandsToolbar.toolbarCommands=[n,t.CommandsToolbar.Bold,t.CommandsToolbar.Italic,t.CommandsToolbar.Code,t.CommandsToolbar.Link,t.CommandsToolbar.BulletedList,t.CommandsToolbar.NumberedList,t.CommandsToolbar.TaskList]}(),function(e){T=t[e]={};t[e].MarkdownPreview=e=>{const{className:t,linkClickHandler:a,onInitialRender:l,options:m,refreshThrottleMs:d,value:c}=e,[u,g]=n.useState(e.setContentOnInitialRender?c:""),h=new r.TimerManagement,p=d?n.useCallback(h.throttle(g,d,{trailing:!0}),[]):g;return n.useEffect((()=>(o.ObservableLike.isObservable(c)?(c.subscribe(p),g(c.value)):p(c),()=>{o.ObservableLike.isObservable(c)&&c.unsubscribe(p)})),[c]),u?n.createElement(s.MarkdownRendererComponent,{className:(0,i.css)("markdown-editor-preview",t),linkClickHandler:a,onInitialRender:l,rawContent:u.trim(),options:m}):null}}("ComponentsMarkdownPreview"),C=t.UtilsBrowser={},t.UtilsBrowser.browserSupportsInsertText=function(){return document.queryCommandSupported("insertText")&&!function(){const e=window.navigator.userAgent.toLowerCase();return!!/mozilla.*rv:([\d+.]+)/i.exec(navigator.userAgent)&&-1===e.indexOf("trident")}()},function(e){f=t[e]={};class r extends a.VssComponent{constructor(e,t){super(e,t),this.textFieldRef=n.createRef(),this.onChange=(e,t)=>{this.props.onChange&&this.props.onChange(t),this.showError(this.getWarningToShow(t))},this.getWarningToShow=e=>{const{isShowWarning:t,warningText:n}=this.props;return t&&t(e)&&n?{message:n,name:n}:null},this.onKeyDown=e=>{const{shortcutCommands:t=[]}=this.props;let n;if(t.length>0){const o=this.getFormattingArgs();for(const r of t)if(n=o&&r.formatText&&r.formatText(o,e),n)break}n?((0,S.applyTextFormatting)(this,n),e.preventDefault(),e.stopPropagation()):this.props.onKeyDown&&this.props.onKeyDown(e)},this.onPaste=e=>{this.props.onPaste&&this.props.onPaste(e,this)},this.state={}}applyFormatting(e){const t=this.textFieldRef.current;t&&(t.focus(),(0,C.browserSupportsInsertText)()?(t.setSelectionRange(e.insertSelectionStart,e.insertSelectionEnd),document.execCommand("insertText",!1,e.insertText)):this.props.onChange&&this.props.onChange(e.finalText),this.setState({selection:{end:e.finalSelectionEnd,start:e.finalSelectionStart}}))}getFormattingArgs(){const e=this.textFieldRef.current;if(e){const t=o.ObservableLike.getValue(this.props.value)||"",n=e.selectionStart;return{selectionEnd:e.selectionEnd,selectionStart:n,text:t}}}showError(e){const{onError:t}=this.props;t&&t(e)}render(){const{formItemClassName:e,error:t,messageText:o}=this.props,r=n.createElement("div",{className:"flex-row"},n.createElement("div",{className:"flex flex-center rhythm-horizontal-4 flex-grow"},n.createElement(m.Icon,{iconName:"Info"}),n.createElement(d.Link,{href:"http://go.microsoft.com/fwlink/?LinkId=823918",target:"_blank",underline:!0},p.MarkdownSupportedMessage),o&&n.createElement("span",null,o)),this.props.showInfoLinkForWorkItemLinking&&n.createElement("div",{className:"flex flex-center rhythm-horizontal-4"},n.createElement(m.Icon,{iconName:"Info"}),n.createElement(d.Link,{href:"http://aka.ms/linktoworkitems",target:"_blank"},p.LinkWorkItemsMessage)));return n.createElement(c.Observer,{error:t},(t=>n.createElement(n.Fragment,null,n.createElement(l.FormItem,{className:e,error:!!t.error,message:t.error?t.error.message:r},n.createElement(u.TextField,Object.assign({autoAdjustHeight:!0,multiline:!0},this.props,{onChange:this.onChange,onKeyDown:this.onKeyDown,onPaste:this.onPaste,ref:this.textFieldRef}))))))}componentDidUpdate(){const{selection:e}=this.state;this.textFieldRef.current&&e&&this.textFieldRef.current.setSelectionRange(e.start,e.end)}}t[e].MarkdownTextField=r}("ComponentsMarkdownTextField"),function(e){w=t[e]={};t[e].MarkdownToolbar=e=>{const{className:t,contributionContext:r,contributionId:s,getTextSource:l}=e,m=new o.ObservableCollection;if(s){const e=(0,a.useComponentContext)().pageContext;m.push((0,g.getMenuItems)(e,s,r))}const d=e=>{const t=l&&l();if(t&&e.formatText){const n=t.getFormattingArgs(),o=n&&e.formatText(n,(e=>t.showError(e)));(0,S.applyTextFormatting)(t,o)}},u=e=>{if((e=>{!e.onActivate&&e.formatText&&(e.onActivate=d)})(e),e.subMenuProps&&e.subMenuProps.items){const t=[];for(const n of o.ObservableLike.getValue(e.subMenuProps.items)||[]){const e=Object.assign({},n);n.subMenuProps&&(e.subMenuProps=Object.assign({},n.subMenuProps)),u(e),t.push(e)}e.subMenuProps.items=t}};return n.createElement(c.Observer,{contributedItems:m},(o=>{const r=o.contributedItems.sort(((e,t)=>(e.rank||Number.MAX_VALUE)-(t.rank||Number.MAX_VALUE))),s=[...void 0!==e.commands&&null!==e.commands?e.commands.sort(((e,t)=>(e.order||Number.MAX_VALUE)-(t.order||Number.MAX_VALUE))):[],...r].map((e=>{var t;const n=Object.assign(Object.assign({},e),{ariaLabel:e.text||(null===(t=e.tooltipProps)||void 0===t?void 0:t.text),className:"no-margin",important:!0,subtle:!0,text:void 0,tooltipProps:e.tooltipProps||{text:e.text}});return e.subMenuProps&&(n.subMenuProps=Object.assign({},e.subMenuProps)),u(n),n}));return n.createElement(h.HeaderCommandBar,{className:(0,i.css)(t,"markdown-toolbar flex-row flex-grow flex-wrap rhythm-horizontal-8 no-margin"),items:s})}))}}("ComponentsMarkdownToolbar"),t.Components={},__exportStar(T,t.Components),__exportStar(f,t.Components),__exportStar(w,t.Components)}),["Resources","Formatting/Common","Formatting/Link","Commands/Shortcut","Formatting/Code","Commands/Toolbar","Components/MarkdownPreview","Utils/Browser","Components/MarkdownTextField","Components/MarkdownToolbar","Components"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-features.markdown-editor-content"}}));