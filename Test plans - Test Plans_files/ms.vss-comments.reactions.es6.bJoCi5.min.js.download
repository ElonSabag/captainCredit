"use strict";define("Comments/Reactions",["require","exports","react","VSS/Platform/Layout","VSSUI/Button","VSSUI/Callout","VSSUI/Util","VSS/Core/Util/String","VSSUI/FocusZone"],(function(e,t,o,n,a,r,s,i,c){var l,u,d,m;l=t.Resources={},t.Resources.AddYourReaction="Add your reaction",t.Resources.ReactionAdditionalUsersCount="+{0} users",t.Resources.ReactionUserListHeaderPlural="Users with {0} reaction",t.Resources.ReactionUserListHeaderSingular="User with {0} reaction",t.Resources.RemoveReaction="Remove your {0} reaction",t.Resources.AddReaction="Add {0} reaction",t.Resources.MoreThan99="99+",t.Resources.ThumbsUp="+1",t.Resources.ThumbsDown="-1",t.Resources.PartyPopper="Hooray",t.Resources.RedHeart="Heart",t.Resources.SmilingFace="Laugh",t.Resources.ConfoundedFace="Upset",u=t.Constants={},t.Constants.ReactionTypeToEmojiMap={0:{encodedValue:"&#x1F44D;",description:l.ThumbsUp},1:{encodedValue:"&#x1F44E;",description:l.ThumbsDown},3:{encodedValue:"&#x1F389;",description:l.PartyPopper},2:{encodedValue:"&#x2764;",description:l.RedHeart},4:{encodedValue:"&#x1F603;",description:l.SmilingFace},5:{encodedValue:"&#x1F616;",description:l.ConfoundedFace}},function(e){d=t[e]={};class i extends o.PureComponent{constructor(){super(...arguments),this._onRenderReactionDropdown=(e,t,n,i,c,l,d)=>{const{commentId:m,onAddReaction:p,onDeleteReaction:R,reactionTypeToInfoMap:S}=this.props,h=Object.keys(u.ReactionTypeToEmojiMap).map(((t,n,r)=>{const i=Number(t),c=u.ReactionTypeToEmojiMap[i],l=S[i];return o.createElement(a.Button,{key:t,className:"reaction-button-item",onClick:()=>{e.collapse(),l&&l.isCurrentUserEngaged?R(m,i):p(m,i)},onMouseDown:(0,s.isSafari)()?e=>{e.preventDefault()}:void 0,tooltipProps:{text:c.description},excludeTabStop:n>0,role:"menuitem",ariaPosInSet:n+1,ariaSetSize:r.length,ariaLabel:c.description},o.createElement("span",{dangerouslySetInnerHTML:{__html:c.encodedValue}}))})),g=()=>{e.collapse()};return h.length>0?o.createElement(r.Callout,{anchorElement:n,anchorOffset:i,anchorOrigin:c,anchorPoint:l,calloutOrigin:d,onDismiss:g,className:"reaction-selection-container",role:"menu",focuszoneProps:{direction:1,focusOnMount:!0,circularNavigation:!0,preprocessKeyStroke:this._preprocessKeyStroke},blurDismiss:!0,contentShadow:!0,escDismiss:!0},h):o.createElement(o.Fragment,null)},this._preprocessKeyStroke=e=>(e.defaultPrevented||9!==e.which||e.preventDefault(),1)}render(){const{readonly:e,className:t,onAddReactionButtonClick:r,onSelectionDismiss:s,onFocus:i,onBlur:c,excludeTabStop:u,ariaPosInSet:d,ariaSetSize:m}=this.props;return e?o.createElement(o.Fragment,null):o.createElement(a.ExpandableButton,{className:(0,n.css)("comment-reaction-button",t),iconProps:{iconName:"AddReaction"},tooltipProps:{text:l.AddYourReaction},onExpand:r,onCollapse:s,onFocus:i,onBlur:c,renderCallout:this._onRenderReactionDropdown,excludeTabStop:u,role:"menuitem",ariaPosInSet:d,ariaSetSize:m,ariaLabel:l.AddYourReaction,hideDropdownIcon:!0,subtle:!0})}}t[e].CommentReactionSelector=i,n.VssComponent.register("comment-reaction-selector",i)}("ComponentsCommentReactionSelector"),function(e){m=t[e]={};class r extends o.PureComponent{constructor(){super(...arguments),this._onAddReactionFromSelector=(e,t)=>{this.props.onAddReaction(e,t,!1)},this._onDeleteReactionFromSelector=(e,t)=>{this.props.onDeleteReaction(e,t,!1)}}render(){const{commentId:e,readonly:t,reactionTypeToInfoMap:a,onAddReactionButtonClick:s}=this.props,i=this._getButtons();if(i.length>0){const l=i.length+(t?0:1);return o.createElement("div",null,o.createElement(c.FocusZone,{direction:1},o.createElement("div",{className:"reaction-status-container",role:"menubar"},i,o.createElement(d.CommentReactionSelector,{className:(0,n.css)(r.ReactionStatusButton,"reaction-status-new-selector-btn"),readonly:t,commentId:e,onAddReactionButtonClick:s,onAddReaction:this._onAddReactionFromSelector,onDeleteReaction:this._onDeleteReactionFromSelector,reactionTypeToInfoMap:a,ariaPosInSet:l,ariaSetSize:l,excludeTabStop:!0}))))}return o.createElement(o.Fragment,null)}_getButtons(){const{readonly:e,reactionTypeToInfoMap:t}=this.props,s=[],c=Object.keys(t).map((e=>Number(e))).filter((e=>{const o=t[e];return!!o&&o.totalCount>0})),d=c.length+(e?0:1);let m=1;for(const p of c){const{totalCount:c,isCurrentUserEngaged:R}=t[p],S=u.ReactionTypeToEmojiMap[p],h=c>99?l.MoreThan99:c.toString();s.push(o.createElement(a.Button,{key:p,className:(0,n.css)(r.ReactionStatusButton,e&&"reaction-status-button-readonly",R&&"reaction-status-user-engaged"),tooltipProps:e?void 0:this._getTooltip(p,c,S),ariaLabel:i.format(R?l.RemoveReaction:l.AddReaction,S.description),onClick:e?void 0:this._onReactionClick.bind(this,p,R),excludeTabStop:s.length>0,role:"menuitem",ariaPosInSet:m++,ariaSetSize:d},o.createElement("span",{className:"reaction-status-info-container"},o.createElement("span",{dangerouslySetInnerHTML:{__html:S.encodedValue}}),o.createElement("span",null,h))))}return s}_onReactionClick(e,t){const{commentId:o,onAddReaction:n,onDeleteReaction:a}=this.props;t?a(o,e,!0):n(o,e,!0)}_getTooltip(e,t,o){return{renderContent:this._onRenderButtonTooltipContent.bind(this,e,t,o),showOnFocus:!0}}_onRenderButtonTooltipContent(e,t,n){const{commentId:a,onGetRecentlyReactedUsers:r,reactionTypeToInfoMap:s}=this.props,c=Object.keys(s||{}).reduce(((e,t)=>{const o=parseInt(t);return e[o]=s[o].engagedUsers.map((e=>e.identityDisplayName)),e}),{}),u=c[e];let d=[];if(u&&u.length>0){d=u.slice(0,t).map(((e,t)=>o.createElement("li",{key:t},e)));const e=t-10;e>0&&d.push(o.createElement("li",{className:"userlist-item",key:"nmoreusers"},i.format(l.ReactionAdditionalUsersCount,e)))}else r(a,e,100);return d.length>0?o.createElement("div",{className:"userlist-tooltip"},o.createElement("h3",null,i.format(d.length>1?l.ReactionUserListHeaderPlural:l.ReactionUserListHeaderSingular,n.description)),o.createElement("ul",{className:"user-list"},d)):o.createElement(o.Fragment,null)}}t[e].CommentReactionStatusBar=r,r.ReactionStatusButton="reaction-status-button",n.VssComponent.register("comment-reaction-statusbar",r)}("ComponentsCommentReactionStatusBar"),t.Reactions={},__exportStar(d,t.Reactions),__exportStar(m,t.Reactions),function(e){function o(e){const t=Object.keys(u.ReactionTypeToEmojiMap).reduce(((e,t)=>(e[Number(t)]={totalCount:0,isCurrentUserEngaged:!1,engagedUsers:[]},e)),{});return(e||[]).forEach((e=>{if(e){const o={totalCount:e.count,isCurrentUserEngaged:e.isCurrentUserEngaged,engagedUsers:[]};t[e.type]=o}})),t}t.Util={},t.Util.createReactionsMap=function(e){return o(e)},t.Util.reactionsToReactionMap=o}()}),["Resources","Constants","Components/CommentReactionSelector","Components/CommentReactionStatusBar","Reactions","Util"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-comments.reactions"}}));