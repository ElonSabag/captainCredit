"use strict";!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("turndown",t):(e="undefined"!=typeof globalThis?globalThis:e||self).TurndownService=t()}(this,(function(){function e(e,t){return Array(t+1).join(e)}var t=["ADDRESS","ARTICLE","ASIDE","AUDIO","BLOCKQUOTE","BODY","CANVAS","CENTER","DD","DIR","DIV","DL","DT","FIELDSET","FIGCAPTION","FIGURE","FOOTER","FORM","FRAMESET","H1","H2","H3","H4","H5","H6","HEADER","HGROUP","HR","HTML","ISINDEX","LI","MAIN","MENU","NAV","NOFRAMES","NOSCRIPT","OL","OUTPUT","P","PRE","SECTION","TABLE","TBODY","TD","TFOOT","TH","THEAD","TR","UL"];function o(e){return a(e,t)}var i=["AREA","BASE","BR","COL","COMMAND","EMBED","HR","IMG","INPUT","KEYGEN","LINK","META","PARAM","SOURCE","TRACK","WBR"];function n(e){return a(e,i)}var r=["A","TABLE","THEAD","TBODY","TFOOT","TH","TD","IFRAME","SCRIPT","AUDIO","VIDEO"];function a(e,t){return t.indexOf(e.nodeName)>=0}function s(e,t){return e.getElementsByTagName&&t.some((function(t){return e.getElementsByTagName(t).length}))}var l={};function m(e){return e?e.replace(/(\n+\s*)+/g,"\n"):""}function c(e){for(var t in this.options=e,this._keep=[],this._remove=[],this.blankRule={replacement:e.blankReplacement},this.keepReplacement=e.keepReplacement,this.defaultRule={replacement:e.defaultReplacement},this.array=[],e.rules)this.array.push(e.rules[t])}function d(e,t,o){for(var i=0;i<e.length;i++){var n=e[i];if(u(n,t,o))return n}}function u(e,t,o){var i=e.filter;if("string"==typeof i){if(i===t.nodeName.toLowerCase())return!0}else if(Array.isArray(i)){if(i.indexOf(t.nodeName.toLowerCase())>-1)return!0}else{if("function"!=typeof i)throw new TypeError("`filter` needs to be a string, array, or function");if(i.call(e,t,o))return!0}}function h(e){var t=e.nextSibling||e.parentNode;return e.parentNode.removeChild(e),t}function p(e,t,o){return e&&e.parentNode===t||o(t)?t.nextSibling||t.parentNode:t.firstChild||t.nextSibling||t.parentNode}l.paragraph={filter:"p",replacement:function(e){return"\n\n"+e+"\n\n"}},l.lineBreak={filter:"br",replacement:function(e,t,o){return o.br+"\n"}},l.heading={filter:["h1","h2","h3","h4","h5","h6"],replacement:function(t,o,i){var n=Number(o.nodeName.charAt(1));return"setext"===i.headingStyle&&n<3?"\n\n"+t+"\n"+e(1===n?"=":"-",t.length)+"\n\n":"\n\n"+e("#",n)+" "+t+"\n\n"}},l.blockquote={filter:"blockquote",replacement:function(e){return"\n\n"+(e=(e=e.replace(/^\n+|\n+$/g,"")).replace(/^/gm,"> "))+"\n\n"}},l.list={filter:["ul","ol"],replacement:function(e,t){var o=t.parentNode;return"LI"===o.nodeName&&o.lastElementChild===t?"\n"+e:"\n\n"+e+"\n\n"}},l.listItem={filter:"li",replacement:function(e,t,o){e=e.replace(/^\n+/,"").replace(/\n+$/,"\n").replace(/\n/gm,"\n    ");var i=o.bulletListMarker+"   ",n=t.parentNode;if("OL"===n.nodeName){var r=n.getAttribute("start"),a=Array.prototype.indexOf.call(n.children,t);i=(r?Number(r)+a:a+1)+".  "}return i+e+(t.nextSibling&&!/\n$/.test(e)?"\n":"")}},l.indentedCodeBlock={filter:function(e,t){return"indented"===t.codeBlockStyle&&"PRE"===e.nodeName&&e.firstChild&&"CODE"===e.firstChild.nodeName},replacement:function(e,t,o){return"\n\n    "+t.firstChild.textContent.replace(/\n/g,"\n    ")+"\n\n"}},l.fencedCodeBlock={filter:function(e,t){return"fenced"===t.codeBlockStyle&&"PRE"===e.nodeName&&e.firstChild&&"CODE"===e.firstChild.nodeName},replacement:function(t,o,i){for(var n,r=((o.firstChild.getAttribute("class")||"").match(/language-(\S+)/)||[null,""])[1],a=o.firstChild.textContent,s=i.fence.charAt(0),l=3,m=new RegExp("^"+s+"{3,}","gm");n=m.exec(a);)n[0].length>=l&&(l=n[0].length+1);var c=e(s,l);return"\n\n"+c+r+"\n"+a.replace(/\n$/,"")+"\n"+c+"\n\n"}},l.horizontalRule={filter:"hr",replacement:function(e,t,o){return"\n\n"+o.hr+"\n\n"}},l.inlineLink={filter:function(e,t){return"inlined"===t.linkStyle&&"A"===e.nodeName&&e.getAttribute("href")},replacement:function(e,t){var o=t.getAttribute("href"),i=m(t.getAttribute("title"));return i&&(i=' "'+i+'"'),"["+e+"]("+o+i+")"}},l.referenceLink={filter:function(e,t){return"referenced"===t.linkStyle&&"A"===e.nodeName&&e.getAttribute("href")},replacement:function(e,t,o){var i,n,r=t.getAttribute("href"),a=m(t.getAttribute("title"));switch(a&&(a=' "'+a+'"'),o.linkReferenceStyle){case"collapsed":i="["+e+"][]",n="["+e+"]: "+r+a;break;case"shortcut":i="["+e+"]",n="["+e+"]: "+r+a;break;default:var s=this.references.length+1;i="["+e+"]["+s+"]",n="["+s+"]: "+r+a}return this.references.push(n),i},references:[],append:function(e){var t="";return this.references.length&&(t="\n\n"+this.references.join("\n")+"\n\n",this.references=[]),t}},l.emphasis={filter:["em","i"],replacement:function(e,t,o){return e.trim()?o.emDelimiter+e+o.emDelimiter:""}},l.strong={filter:["strong","b"],replacement:function(e,t,o){return e.trim()?o.strongDelimiter+e+o.strongDelimiter:""}},l.code={filter:function(e){var t=e.previousSibling||e.nextSibling,o="PRE"===e.parentNode.nodeName&&!t;return"CODE"===e.nodeName&&!o},replacement:function(e){if(!e)return"";e=e.replace(/\r?\n|\r/g," ");for(var t=/^`|^ .*?[^ ].* $|`$/.test(e)?" ":"",o="`",i=e.match(/`+/gm)||[];-1!==i.indexOf(o);)o+="`";return o+t+e+t+o}},l.image={filter:"img",replacement:function(e,t){var o=m(t.getAttribute("alt")),i=t.getAttribute("src")||"",n=m(t.getAttribute("title"));return i?"!["+o+"]("+i+(n?' "'+n+'"':"")+")":""}},c.prototype={add:function(e,t){this.array.unshift(t)},keep:function(e){this._keep.unshift({filter:e,replacement:this.keepReplacement})},remove:function(e){this._remove.unshift({filter:e,replacement:function(){return""}})},forNode:function(e){return e.isBlank?this.blankRule:(t=d(this.array,e,this.options))||(t=d(this._keep,e,this.options))||(t=d(this._remove,e,this.options))?t:this.defaultRule;var t},forEach:function(e){for(var t=0;t<this.array.length;t++)e(this.array[t],t)}};var g="undefined"!=typeof window?window:{};var k,v,f=function(){var e=g.DOMParser,t=!1;try{(new e).parseFromString("","text/html")&&(t=!0)}catch(e){}return t}()?g.DOMParser:(k=function(){},function(){var e=!1;try{document.implementation.createHTMLDocument("").open()}catch(t){window.ActiveXObject&&(e=!0)}return e}()?k.prototype.parseFromString=function(e){var t=new window.ActiveXObject("htmlfile");return t.designMode="on",t.open(),t.write(e),t.close(),t}:k.prototype.parseFromString=function(e){var t=document.implementation.createHTMLDocument("");return t.open(),t.write(e),t.close(),t},k);function I(e,t){var i;"string"==typeof e?i=(v=v||new f).parseFromString('<x-turndown id="turndown-root">'+e+"</x-turndown>","text/html").getElementById("turndown-root"):i=e.cloneNode(!0);return function(e){var t=e.element,o=e.isBlock,i=e.isVoid,n=e.isPre||function(e){return"PRE"===e.nodeName};if(t.firstChild&&!n(t)){for(var r=null,a=!1,s=null,l=p(s,t,n);l!==t;){if(3===l.nodeType||4===l.nodeType){var m=l.data.replace(/[ \r\n\t]+/g," ");if(r&&!/ $/.test(r.data)||a||" "!==m[0]||(m=m.substr(1)),!m){l=h(l);continue}l.data=m,r=l}else{if(1!==l.nodeType){l=h(l);continue}o(l)||"BR"===l.nodeName?(r&&(r.data=r.data.replace(/ $/,"")),r=null,a=!1):i(l)||n(l)?(r=null,a=!0):r&&(a=!1)}var c=p(s,l,n);s=l,l=c}r&&(r.data=r.data.replace(/ $/,""),r.data||h(r))}}({element:i,isBlock:o,isVoid:n,isPre:t.preformattedCode?w:null}),i}function w(e){return"PRE"===e.nodeName||"CODE"===e.nodeName}function y(e,t){return e.isBlock=o(e),e.isCode="CODE"===e.nodeName||e.parentNode.isCode,e.isBlank=function(e){return!n(e)&&!function(e){return a(e,r)}(e)&&/^\s*$/i.test(e.textContent)&&!function(e){return s(e,i)}(e)&&!function(e){return s(e,r)}(e)}(e),e.flankingWhitespace=function(e,t){if(e.isBlock||t.preformattedCode&&e.isCode)return{leading:"",trailing:""};var o=(i=e.textContent,n=i.match(/^(([ \t\r\n]*)(\s*))[\s\S]*?((\s*?)([ \t\r\n]*))$/),{leading:n[1],leadingAscii:n[2],leadingNonAscii:n[3],trailing:n[4],trailingNonAscii:n[5],trailingAscii:n[6]});var i,n;o.leadingAscii&&C("left",e,t)&&(o.leading=o.leadingNonAscii);o.trailingAscii&&C("right",e,t)&&(o.trailing=o.trailingNonAscii);return{leading:o.leading,trailing:o.trailing}}(e,t),e}function C(e,t,i){var n,r,a;return"left"===e?(n=t.previousSibling,r=/ $/):(n=t.nextSibling,r=/^ /),n&&(3===n.nodeType?a=r.test(n.nodeValue):i.preformattedCode&&"CODE"===n.nodeName?a=!1:1!==n.nodeType||o(n)||(a=r.test(n.textContent))),a}var b=Array.prototype.reduce,E=[[/\\/g,"\\\\"],[/\*/g,"\\*"],[/^-/g,"\\-"],[/^\+ /g,"\\+ "],[/^(=+)/g,"\\$1"],[/^(#{1,6}) /g,"\\$1 "],[/`/g,"\\`"],[/^~~~/g,"\\~~~"],[/\[/g,"\\["],[/\]/g,"\\]"],[/^>/g,"\\>"],[/_/g,"\\_"],[/^(\d+)\. /g,"$1\\. "]];function T(e){if(!(this instanceof T))return new T(e);var t={rules:l,headingStyle:"setext",hr:"* * *",bulletListMarker:"*",codeBlockStyle:"indented",fence:"```",emDelimiter:"_",strongDelimiter:"**",linkStyle:"inlined",linkReferenceStyle:"full",br:"  ",preformattedCode:!1,blankReplacement:function(e,t){return t.isBlock?"\n\n":""},keepReplacement:function(e,t){return t.isBlock?"\n\n"+t.outerHTML+"\n\n":t.outerHTML},defaultReplacement:function(e,t){return t.isBlock?"\n\n"+e+"\n\n":e}};this.options=function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var i in o)o.hasOwnProperty(i)&&(e[i]=o[i])}return e}({},t,e),this.rules=new c(this.options)}function S(e){var t=this;return b.call(e.childNodes,(function(e,o){var i="";return 3===(o=new y(o,t.options)).nodeType?i=o.isCode?o.nodeValue:t.escape(o.nodeValue):1===o.nodeType&&(i=D.call(t,o)),x(e,i)}),"")}function N(e){var t=this;return this.rules.forEach((function(o){"function"==typeof o.append&&(e=x(e,o.append(t.options)))})),e.replace(/^[\t\r\n]+/,"").replace(/[\t\r\n\s]+$/,"")}function D(e){var t=this.rules.forNode(e),o=S.call(this,e),i=e.flankingWhitespace;return(i.leading||i.trailing)&&(o=o.trim()),i.leading+t.replacement(o,e,this.options)+i.trailing}function x(e,t){var o=function(e){for(var t=e.length;t>0&&"\n"===e[t-1];)t--;return e.substring(0,t)}(e),i=t.replace(/^\n*/,""),n=Math.max(e.length-o.length,t.length-i.length);return o+"\n\n".substring(0,n)+i}return T.prototype={turndown:function(e){if(!function(e){return null!=e&&("string"==typeof e||e.nodeType&&(1===e.nodeType||9===e.nodeType||11===e.nodeType))}(e))throw new TypeError(e+" is not a string, or an element/document/fragment node.");if(""===e)return"";var t=S.call(this,new I(e,this.options));return N.call(this,t)},use:function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++)this.use(e[t]);else{if("function"!=typeof e)throw new TypeError("plugin must be a Function or an Array of Functions");e(this)}return this},addRule:function(e,t){return this.rules.add(e,t),this},keep:function(e){return this.rules.keep(e),this},remove:function(e){return this.rules.remove(e),this},escape:function(e){return E.reduce((function(e,t){return e.replace(t[0],t[1])}),e)}},T})),define("Wit/WorkItemForm",["require","exports","react","VSS/Platform/Layout","VSS/Platform/Location","Wit/Clients/Wit/RestClient/WorkItemTracking","VSS/Platform/Util/Url","VSS/Core/Util/String","VSSUI/Button","VSSUI/Icon","VSSUI/Observer","VSSUI/TooltipEx","VSSUI/Util","VSSUI/Dialog","VSSUI/TextField","VSSUI/EditableDropdown","VSSUI/Utilities/DropdownSelection","VSSUI/Utilities/GroupedItemProvider","Wit/WorkItemLinksRegistration/Constants","Wit/WorkItemLinksRegistration/LinkUtils","Wit/WorkItemLinksRegistration/registerLinkTypeService","Wit/Common/Generated/Constants","Wit/WorkItemModel/WorkItem/Links","VSS/Core/Observable","VSSUI/Components/FormItem/FormItem","VSSUI/Panel","Wit/Common/Utils/WorkItemUtils/LinkTypeFilter","Mention/MarkdownWithAutocomplete/Components","VSSUI/Persona","VSSUI/Pill","Wit/HtmlEditor/Components/HtmlPreview","Wit/Identity/Utilities/WorkItemIdentityHelper","VSSUI/List","VSSUI/Utilities/Provider","VSS/Platform/Context","VSSUI/Menu","VSSUI/Ago","VSSUI/Link","VSSUI/Spinner","VSSUI/Table","Wit/Common/DateUtils","VSSUI/Callout","VSSUI/ZeroData","VSSUI/Clipboard","Tfs/Platform/Page","Comments/Reactions/Util","Mention/Common/DisplayNameStorageKeyTranslationService","VSS/Features/Identities/PersonaDetailsProvider","VSS/Platform/Feature","Wit/Common/Constants/FeatureFlags","Wit/WorkItemModel/Utils","xss","VSS/Platform/Util/Serialization","Mention/Common/Util","turndown","VSSUI/MessageCard","Comments/Item/Components/CommentItem","Wit/HtmlEditor/Utils/Mention","Wit/HtmlEditor/Utils/WorkItemLinks","Comments/Common/Resources","Comments/Editor/Components/CommentEditor","VSS/Platform/Components/Format/Format","Wit/HtmlEditor/Components/HtmlEditor","Wit/WorkItemFormMarkdown/WorkItemFormMarkdownEditor","Wit/WorkItemFormMarkdown/WorkItemFormMarkdownToolbar","Wit/WorkItemModel/Services/IWorkItemEventService","Wit/Common/Extensions","VSS/Features/Identities/IdentityService","Wit/UI/Components/WorkItemTypeIcon/index","Wit/UI/Services/WorkItemTypeIconMetadataService","Wit/Common/WorkItemDialogs/Components/WorkItemFormDialog","Wit/WorkItemLinksRegistration/Components/index","VSSUI/FormItem","Wit/WorkItemLinksRegistration/BaseRegisteredLinkTypeService","VSSUI/TreeEx","VSSUI/Utilities/TreeItemProvider","Wit/Common/WorkItemLinksService/CompositeComparer","VSSUI/VssIcon","VSSUI/ConditionalChildren","Wit/WorkItemModel/OM/index","Wit/Common/Utils/WorkItemUtils/extractInfoFromControlMetadata","VSS/Legacy/Legacy","Mention/Autocomplete/AutocompleteUtility","roosterjs-react","Test/TestPlansHubRefresh/TestCaseWorkItemControls/AssociatedAutomation/Component/AssociatedAutomationControl","Test/TestPlansHubRefresh/TestCaseWorkItemControls/TestSteps/Component/TestStepsControl","VSS/Core/TimerManagement","VSS/Features/Identities/IdentityPickerProvider","VSS/Platform/String","VSSUI/Components/DatePicker/DatePicker","VSSUI/Components/Toggle/Toggle","VSSUI/Dropdown","VSSUI/IdentityPicker","VSS/Platform/Util/Number","Wit/Common/WorkItemControls/AreaPathDropdown","Wit/Common/WorkItemControls/IterationDropdown","Wit/Deployment/Components/Deployment","Wit/HtmlEditor/Plugins/MentionPlugin","Wit/WorkItemModel/RuleEngine/ServerDefaultValue","Wit/WorkItemModel/WorkItem/FieldUtils","Wit/WorkItemModel/WorkItem/LegacyWorkItem","Notifications/Common/Services/FollowsService","VSSUI/Checkbox","VSSUI/RadioButton","VSS/Features/PlatformUI/ContributedMenu","VSS/Features/PlatformUI/MessageDialog","VSS/Platform/FPS","VSSUI/HeaderCommandBar","VSSUI/SplitButton","Wit/Common/Utils/WorkItemUtils/CommonWorkItemActions","Wit/Common/WorkItemDialogs/Components/ChangeTypeDialog","Wit/Common/WorkItemDialogs/Components/CopyWorkItemDialog","Wit/Common/WorkItemDialogs/Components/DeleteDialog","Wit/Common/WorkItemDialogs/Components/EditTemplateDialog","Wit/Common/WorkItemDialogs/Components/EmailWorkItemsDialog","Wit/Common/WorkItemDialogs/Components/MoveToProjectDialog","Wit/Messages/BoardsMessagesService","VSSUI/ListBox","VSS/Core/Util/Accessibility","VSSUI/FocusOrMouseWithin","Wit/UI/ComponentProviders/index","Wit/UI/DataProviders/index","VSSUI/Utilities/Date","VSS/Features/Markdown/MarkdownRendererComponent","Wit/WorkItemLinksRegistration/resolveArtifacts","VSSUI/Utilities/Filter","VSSUI/FilterBar","VSSUI/TextFilterBarItem","VSSUI/Intersection","VSSUI/Splitter","VSS/Platform/RestClient/Contributions","VSSUI/Header","VSSUI/Surface","VSSUI/Tabs","Wit/Common/WorkItemControls/NodeUtils","Wit/Common/WorkItemTypesService/IWorkItemTypesService","Wit/Common/Utilities/Iterator","Wit/LinkedWorkItemsDropdown/Components/LinkedWorkItemsDropdown","react-dom","VSS/Platform/Telemetry","VSS/Platform/UserClaims","VSSUI/Page","Wit/Common/BulkUpdateUtils/TagUtils","Wit/Messages/Components/BoardsMessages"],(function(e,t,o,i,n,r,a,s,l,m,c,d,u,h,p,g,k,v,f,I,w,y,C,b,E,T,S,N,D,x,F,L,R,A,W,P,U,V,O,H,M,B,j,z,_,G,$,K,q,Z,X,Y,J,Q,ee,te,oe,ie,ne,re,ae,se,le,me,ce,de,ue,he,pe,ge,ke,ve,fe,Ie,we,ye,Ce,be,Ee,Te,Se,Ne,De,xe,Fe,Le,Re,Ae,We,Pe,Ue,Ve,Oe,He,Me,Be,je,ze,_e,Ge,$e,Ke,qe,Ze,Xe,Ye,Je,Qe,et,tt,ot,it,nt,rt,at,st,lt,mt,ct,dt,ut,ht,pt,gt,kt,vt,ft,It,wt,yt,Ct,bt,Et,Tt,St,Nt,Dt,xt,Ft,Lt,Rt,At,Wt,Pt){var Ut,Vt,Ot,Ht,Mt,Bt,jt,zt,_t,Gt,$t,Kt,qt,Zt,Xt,Yt,Jt,Qt,eo,to,oo,io,no,ro,ao,so,lo,mo,co,uo,ho,po,go,ko,vo,fo,Io,wo,yo,Co,bo,Eo,To,So,No,Do,xo,Fo,Lo,Ro,Ao,Wo,Po,Uo,Vo,Oo,Ho,Mo,Bo,jo,zo,_o,Go,$o,Ko,qo,Zo,Xo,Yo,Jo,Qo,ei,ti,oi,ii,ni,ri,ai,si,li,mi,ci,di,ui,hi,pi,gi,ki,vi,fi,Ii,wi,yi,Ci,bi,Ei,Ti,Si,Ni,Di;Ut=t.Resources={},t.Resources.Details="Details",t.Resources.DiscussionLabel="Discussion",t.Resources.HtmlFieldPlaceholder="Click to add {0}.",t.Resources.InviteToComment="Add a comment. Use hash symbol to link a work item, exclamation mark to link a pull request, or at symbol to mention a person.",t.Resources.ShowMoreCommentsLink="Show more",t.Resources.ShowMoreCommentsDetail="({0} of {1})",t.Resources.WorkItemDiscussionAddComment="Add a comment. Use # to link a work item, @ to mention a person, or ! to link a pull request.",t.Resources.WorkItemFormIsReadonly="Work item form is readonly",t.Resources.FieldNameTooltip="[Field Name: {0}]",t.Resources.InvalidTabOrGroup="{0} contains invalid fields.",t.Resources.InvalidControl="Field {0} is invalid",t.Resources.InsertImageInvalidFileType="TF400116 Unsupported file type.  Valid file types are: {0}.",t.Resources.Attachments="Attachments",t.Resources.AddAttachment="Add attachment",t.Resources.AttachmentsZeroData="No attachments have been added",t.Resources.AttachmentsGridView="Click to toggle to Attachments Grid View",t.Resources.AttachmentsThumbnailView="Click to toggle to Attachments Thumbnail View",t.Resources.AttachmentNameColumn="Name",t.Resources.AttachmentSizeColumn="Size",t.Resources.AttachmentDateAddedColumn="Date Added",t.Resources.AttachmentCommentsColumn="Comments",t.Resources.EditComment="Edit comment",t.Resources.EditLink="Edit link",t.Resources.DownloadAttachment="Download attachment",t.Resources.DeleteAttachment="Delete attachment",t.Resources.PreviewAttachment="Preview attachment",t.Resources.CopyAttachemntURL="Copy attachment link",t.Resources.AttachmentNoPreview="It looks like this file doesn't have a preview we can show you.",t.Resources.ConfirmDeleteAttachmentPrompt="Are you sure you want to delete {0}?",t.Resources.ConfirmDeleteAttachment="Delete",t.Resources.CancelDeleteAttachment="Cancel",t.Resources.CommentFieldLabel="Comment",t.Resources.ConfirmEditComment="Save",t.Resources.CancelEditComment="Cancel",t.Resources.HideDarkThemeFormat="Hide text formatting in dark theme",t.Resources.HTMLVideoSupport="Your browser does not support embedded HTML video",t.Resources.AttachmentOverSizeLimit="Attachment over size limit",t.Resources.AttachmentsOverSizeLimit="Attachments over size limit",t.Resources.CancelUpload="Cancel upload",t.Resources.UploadRemainingFiles="Upload remaining files",t.Resources.FileOverSizeLimit="{0} can't be uploaded because it exceeds our {1} file size limit.",t.Resources.FilesOverSizeLimit="The following files can't be uploaded because they exceed our {0} file size limit:",t.Resources.ShowDarkThemeFormat="Show text formatting in dark theme",t.Resources.UploadFilesHeader="Upload Files",t.Resources.UploadFilesInstructions="Drag and drop your files here.",t.Resources.AttachmentUploadError="Attachment(s) failed to upload",t.Resources.AttachmentUploadPermissionsError="You do not have permission to attach files to work items in the current area path.",t.Resources.FilesUploadError="An error occurred while uploading of the following files: {0}",t.Resources.Links="Links",t.Resources.Link="Link",t.Resources.AddLink="Add link",t.Resources.AddLinkToExistingItemButtonLabel="Existing item",t.Resources.AddLinkToNewItemButtonLabel="New item",t.Resources.LinksZeroData="No links have been added",t.Resources.LinkDescriptionColumn="Link",t.Resources.LinkStateColumn="State",t.Resources.LinkLatestUpdateColumn="Latest Update",t.Resources.LinkCommentsColumn="Comments",t.Resources.LinkTypeLabel="Link type:",t.Resources.LinkCommentLabel="Comment:",t.Resources.LinkCommentPlaceholder="Enter a comment",t.Resources.ConfirmAddLink="Add link",t.Resources.CancelAddLink="Cancel",t.Resources.LinkOriginLabel="You are adding a link from:",t.Resources.LinkOriginMultipleLabel="{0} items",t.Resources.DeleteLink="Delete link",t.Resources.PlaceholderNewWorkItemTitle="New {0}",t.Resources.LinksShowMore="Show more",t.Resources.LinksShownOfTotal="({0} of {1})",t.Resources.LinksNotShown="Not shown: {0}",t.Resources.AddLinkToExistingParent="Add an existing work item as a parent",t.Resources.AddLinkToExistingDevelopmentItem="Link an Azure Repos {0}, {1} or {2} to see the status of your development. You can also {3} to get started.",t.Resources.AddLinkToExistingCommit="commit",t.Resources.AddLinkToExistingPullRequest="pull request",t.Resources.AddLinkToExistingBranch="branch",t.Resources.AddLinkToNewBranch="create a branch",t.Resources.WorkItemsToLinkLabel="Work items to link:",t.Resources.HyperlinkAddressLabel="Address:",t.Resources.TitleLabel="Title",t.Resources.TypeLabel="Work Item Type",t.Resources.TopologyDependencyTooltip="This is a directional link that can be created between any set of work items, but can not create closed loops.",t.Resources.TopologyTreeForwardTooltip="This is a directional link that creates a one-to-many relationship. Once this link is created, no more links of this type can be added to this work item.",t.Resources.TopologyTreeReverseTooltip="This is a directional link that creates a one-to-many relationship. Once this link is created, no more links of this type can be added to the linked items.",t.Resources.TopologyDirectedNetworkTooltip="This is a directional link that can be created between any set of work items.",t.Resources.TopologyNetworkTooltip="This is a non-directional link that can be created between any set of work items.",t.Resources.TopologyValidationWorkItemNotFound="Work item {0} does not exist or you do not have permission to access it.",t.Resources.TopologyValidationForbiddenMultipleLinks="A work item can only have one link of this type. Remove the existing link and try again.",t.Resources.TopologyValidationLinkToSelf="You cannot link a work item to itself.",t.Resources.TopologyValidationDuplicate="A {0} link to work item from {1} to  {2} already exists.",t.Resources.TopologyValidationForbiddenCircularReference="Adding a {0} link between work items {1} and {2} would result in a circular relationship. To create this link, evaluate the existing links, and remove one of the other links in the cycle.",t.Resources.TopologyValidationOneToManyViolation="Work item {0} already has a {1} link so a new one cannot be added.",t.Resources.GitHubIntegrationMessage="Learn more about GitHub integration with Azure Boards.",t.Resources.GitHubPullRequestDescription="Pull Request",t.Resources.GitHubPullRequestUrlLabel="GitHub pull request URL:",t.Resources.GitHubPullRequestUrlPlaceholder="Enter GitHub pull request URL",t.Resources.GitHubCommitDescription="Commit",t.Resources.GitHubCommitUrlLabel="GitHub commit URL:",t.Resources.GitHubCommitUrlPlaceholder="Enter GitHub commit URL",t.Resources.GitHubIssueDescription="Issue",t.Resources.GitHubIssueUrlLabel="GitHub issue URL:",t.Resources.GitHubIssueUrlPlaceholder="Enter GitHub issue URL",t.Resources.InvalidGitHubItemUrl="The {0} URL cannot be resolved. Please check the URL and try again.",t.Resources.MissingGitHubItemUrl="GitHub {0} URL is required.",t.Resources.RemoteWorkItemUrlLabel="Remote work item URL:",t.Resources.RemoteWorkItemUrlPlaceholder="Enter remote work item URL",t.Resources.InvalidRemoteWorkItemUrl="Remote workitem URL is not valid.",t.Resources.MissingRemoteWorkItemUrl="Remote workitem URL is required.",t.Resources.History="History",t.Resources.StateGraph="State Graph",t.Resources.HistoryZeroStateText="No history has been added",t.Resources.HistoryControlViaTemplate="{0} (via {1})",t.Resources.MovedToState="Moved to state {0}",t.Resources.Today="Today",t.Resources.Yesterday="Yesterday",t.Resources.LastWeek="Last Week",t.Resources.LastNDays="Last {0} days",t.Resources.Older="Older",t.Resources.HistoryLinkDiffErrorLoadingDetails="Error loading link details. Click to retry",t.Resources.UpdateIconUserTooltip="Assigned To changed",t.Resources.UpdateIconStateTooltip="Set to {0} state",t.Resources.UpdateIconCommentTooltip="Comment added",t.Resources.UpdateIconAttachmentTooltip="Attachment added",t.Resources.UpdateIconTagTooltip="Tags changed",t.Resources.UpdateIconLinkTooltip="Link added",t.Resources.Made1Change="{0} {1}",t.Resources.Made2Changes="{0} {1} and {2}",t.Resources.Made3Changes="{0} {1}, {2}, and {3}",t.Resources.MadeMoreChanges="{0} {1}, {2}, {3}, and made other changes",t.Resources.CreatedTheWorkItem="created the {0}",t.Resources.RestoredTheWorkItem="restored the work item",t.Resources.DeletedTheWorkItem="deleted the work item",t.Resources.ChangedFieldFromOldToNew="changed {0} from {1} to {2}",t.Resources.ChangedFieldToNew="changed {0} to {1}",t.Resources.ChangedField="changed {0}",t.Resources.AddedAnAttachment="added an attachment",t.Resources.DeletedAnAttachment="deleted an attachment",t.Resources.AddedALink="added a link",t.Resources.AddedALinkOfType="added {0} link",t.Resources.DeletedALink="deleted a link",t.Resources.DeletedALinkOfType="deleted {0} link",t.Resources.AddedAComment="added a comment",t.Resources.EditedAComment="edited a comment",t.Resources.DeletedAComment="deleted a comment",t.Resources.AssignedPerson="assigned {0}",t.Resources.UnassignedPerson="unassigned {0}",t.Resources.MadeFieldChanges="made field changes",t.Resources.Actions="Actions",t.Resources.AddTag="Add Tag",t.Resources.AssignedToChanged="Assigned To Changed",t.Resources.Area="Area",t.Resources.BackToWorkItems="Back to Work Items",t.Resources.Cancel="Cancel",t.Resources.Capture="Capture...",t.Resources.ChangeType="Change type...",t.Resources.Close="Close",t.Resources.CollapseSectionLabel="Collapse {0} section",t.Resources.CommentCount="{0} Comments",t.Resources.ConfirmWorkItemRefresh="You have unsaved changes to this work item which will be lost. Are you sure you want to refresh this work item?",t.Resources.ConfirmWorkItemRevert="You have unsaved changes to this work item which will be lost. Are you sure you want to revert your changes to the work item?",t.Resources.CopyWorkItem="Create copy of work item...",t.Resources.Custom="Custom",t.Resources.CustomNotificationDescription="You will only be notified for the events selected from the list below or when you are @mentioned in this work item.",t.Resources.Customize="Customize",t.Resources.DashboardAdd="Add to dashboard",t.Resources.Delete="Delete",t.Resources.Discard="Discard",t.Resources.EmailWorkItem="Email work item",t.Resources.EnterTitle="Enter title",t.Resources.ErrorLoadingWorkItem="Error loading work item.",t.Resources.ExpandSectionLabel="Expand {0} section",t.Resources.FalseString="False",t.Resources.Follow="Follow",t.Resources.Following="Following",t.Resources.Fullscreen="Fullscreen",t.Resources.Iteration="Iteration",t.Resources.IterationChanged="Iteration Changed",t.Resources.KeyboardShortcuts="Keyboard shortcuts",t.Resources.MaximizeSectionLabel="Maximize {0} section",t.Resources.MoreSaveOptions="More save options",t.Resources.MoveTeamProject="Move to team project",t.Resources.NewBranch="New branch...",t.Resources.NewLinkedWorkItem="New linked work item",t.Resources.NewWorkItem="New {0}",t.Resources.NextWorkItem="Next work item",t.Resources.NotSubscribed="Not Subscribed",t.Resources.NotSubscribedDescription="Only receive notifications from this work item when you have been @mentioned.",t.Resources.NoResultsFoundText="No results found",t.Resources.NotificationSettings="Notification settings",t.Resources.OneComment="1 Comment",t.Resources.PreviousWorkItem="Previous work item",t.Resources.Reason="Reason",t.Resources.ReadonlyFieldLockTooltip="{0} is read-only",t.Resources.Refresh="Refresh",t.Resources.RequestFeedback="Request feedback",t.Resources.RestoreSectionLabel="Restore {0} section",t.Resources.Revert="Revert",t.Resources.RevertChanges="Revert Changes",t.Resources.Save="Save",t.Resources.SaveAndClose="Save and Close",t.Resources.SelectedWorkItem="{0} of {1}",t.Resources.ServerError="Server error",t.Resources.SortByNameAsc="Sort by {0} ascending",t.Resources.SortByNameDesc="Sort by {0} descending",t.Resources.State="State",t.Resources.StateChanged="State Changed",t.Resources.StateTransitionAriaLabel="Transition {0}, to state: {1}, reason for transition: {2}, changed by {3} on {4}.",t.Resources.Subscribed="Subscribed",t.Resources.SubscribedDescription="Receive all notifications from this work item.",t.Resources.Suggestions="Suggestions",t.Resources.Templates="Templates",t.Resources.TitleFieldAriaLabel="Title field",t.Resources.ToggleFilter="Toggle filter",t.Resources.TrueString="True",t.Resources.Unassigned="Unassigned",t.Resources.UpdatedBy="Updated by {0}:",t.Resources.WorkItemFormKeyboardShortcutGroup="Work Item Form",t.Resources.WorkItems="Work Items",t.Resources.InvalidWorkItemId="Unable to retrieve work item info for work item id {0}.",t.Resources.InvalidWorkItemType="Unable to retrieve type info for type {0}.",t.Resources.ProjectInfoFailure="There was an issue retrieving the project info. Please refresh and try again.",t.Resources.FailedToParseLabelXML="There was an issue parsing the XML of a control. Please check that the XML has valid syntax: {0}",t.Resources.InvalidFieldError="Definition for field '{0}' cannot be found.",t.Resources.StateControlMissingError="System control 'System.State' was not provided in the form data. Ensure that the field has a control associated with it.",t.Resources.SystemControlMissingError="System control {0} was not provided in the form data. Ensure that the field has a control associated with it or is in the 'Replaces' attribute.",t.Resources.AssignWorkItemToMeShortcut="Assign work item to me",t.Resources.GoToDiscussionShortcut="Go to discussion",t.Resources.GoToNextFormGroupShortcut="Move to next form group",t.Resources.GoToPreviousFormGroupShortcut="Move to previous form group",t.Resources.SaveChanges="Save Changes",t.Resources.CopyWorkItemTitleShortcut="Copy work item title",t.Resources.MoveToLeftTabShortcut="Move to left tab",t.Resources.MoveToRightTabShortcut="Move to right tab",t.Resources.FilterDropdownUpdatedBy="Updated by",t.Resources.FilterDropdownFields="Fields",t.Resources.FilterDropdownAttachmentFieldLabel="Attachment",t.Resources.FilterDropdownCommentFieldLabel="Comment",t.Resources.FilterDropdownLinkFieldLabel="Link",t.Resources.FetchErrorRefreshPage="Something went wrong while syncing work item. You will need to restart and discard your changes.",t.Resources.NoProjectSpecifiedMessage="No project is available",t.Resources.GitHubZeroDataText="Link a GitHub {0} or {1} to see the status of your development. {2}",t.Resources.GitHubZeroDataTextLearnMore="Learn more",t.Resources.GitHubZeroDataCommitLinkTypeText="commit",t.Resources.GitHubZeroDataPullRequestTypeText="pull request",t.Resources.GitHubAzureBoardsDocUrl="https://aka.ms/azureboardsgithub/devctrl",t.Resources.WorkItemCommentConvertToMarkdown="We support markdown, you can {0}.",t.Resources.WorkItemCommentConvertToMarkdownLinkText="convert this comment",t.Resources.LabelConvert="Convert",t.Resources.LabelCancel="Cancel",t.Resources.ConvertedCommentTitle="Preview of converted comment",t.Resources.CommentConverting="Converting comment...",t.Resources.CommentConvertingError="An error occurred during the comment converting. Please try again later.",Vt=t[Ni="AttachmentsAttachmentActions"]={},t[Ni].curryAttachmentActions=function(e,t){const o={};for(const i of Object.keys(t))t[i]&&(o[i]=()=>t[i](e));return o},function(e){Ot=t[e]={},t[e].ControlDefaultOptionsContext=o.createContext({showChromeBorder:!1,showEmptyReadOnlyFields:!1})}("CommonHooksControlDefaultOptionsContext"),function(e){function a(){const i=(0,o.useContext)(t[e].WorkItemFormPageContext).workItem;if(!i)throw new Error("useWorkItem can only be used inside a WorkItemFormPageContextProvider");return i}Ht=t[e]={},t[e].WorkItemFormPageContext=(0,o.createContext)({focusDiscussion:!1,pageContext:null,updateFocusDiscussion:()=>{},workItem:null}),t[e].WorkItemFormPageContextProvider=t[e].WorkItemFormPageContext.Provider,t[e].useWorkItem=a,t[e].useAssetLocation=function(e){const t=(0,i.usePageContext)();return(0,n.getAssetLocation)(t,e)||""},t[e].useWorkItemTrackingRestClient=function(){const e=(0,i.usePageContext)();return(0,r.getWorkItemTrackingClient)(e)},t[e].useFieldMetadata=function(e){const t=a().getFieldLookup();return void 0===e?t:t[e]}}("CommonHooksWorkItemFormPageContext"),Mt=t.CommonHooksuseSet={},t.CommonHooksuseSet.useSet=function(e){const[t,i]=(0,o.useState)(null!=e?e:new Set);return[(0,o.useCallback)((e=>t.has(e)),[t]),(0,o.useCallback)((e=>{const o=new Set(t);o.add(e),i(o)}),[t]),(0,o.useCallback)((e=>{const o=new Set(t);o.delete(e),i(o)}),[t])]},Bt=t.CommonHooksindex={},__exportStar(Ot,t.CommonHooksindex),__exportStar(Ht,t.CommonHooksindex),__exportStar(Mt,t.CommonHooksindex),function(e){jt=t[e]={};let n;async function s(e,t,o){if(!n){const t=(0,r.getWorkItemTrackingClient)(e);n=t.getRootPath()}const i=await n;let s=(0,a.replaceRouteValues)("/{project}/_apis/wit/attachments/{id}",{project:t,id:o.FilePath});return i.length>0&&"/"===i[i.length-1]&&(s=s.substr(1)),i+s}t[e].useAttachmentUri=function(e){const[t,n]=(0,o.useState)(),r=(0,Bt.useWorkItem)().project.guid,a=(0,i.usePageContext)();return(0,o.useEffect)((()=>{n(void 0),s(a,r,e).then(n)}),[a,e]),t},t[e].getAttachmentUri=s}("AttachmentsuseAttachmentUri"),function(e){zt=t[e]={};const o=["png","jpg","svg","bpm","gif","webp"],i=["mp4","webm"],n=["pdf"],r=["sql","java","jsp","jar","asp","aspx","css","scss","sass","less","html","htm","xhtml","js","jsx","cs","vb","cpp","cxx","c++","hpp","hxx","h","f#","ts","tsx","py","md","rs","rb","xml","c","php","swift","tex","json","yml","yaml","sbl","asm","d","f","for","go","m","p","pas","r","bat","sh","pl","awk","cmd","lua","sln","proj","txt","log","wiql"];function a(e){var t;return null===(t=null==e?void 0:e.split(".").pop())||void 0===t?void 0:t.toLowerCase()}t[e].getAttachmentPreviewType=function(e){const t=a(e);if(t)return o.includes(t)?"Image":i.includes(t)?"Video":n.includes(t)?"PDF":r.includes(t)?"Text":void 0},t[e].getAttachmentIconName=function(e){switch(a(e)){case"zip":case"7z":case"pkg":case"rar":case"rpm":case"gz":case"z":case"tar":return"ZipFolder";case"png":case"jpg":case"bmp":case"gif":case"ico":case"jpeg":case"ai":case"psd":case"svg":case"tif":case"tiff":case"webp":return"FileImage";case"mp3":case"aif":case"mid":case"midi":case"mpa":case"ogg":case"wav":case"wma":case"wpl":return"HeadsetSolid";case"mp4":case"avi":case"flv":case"m4v":case"mkv":case"mov":case"mpg":case"mpeg":case"wmv":case"webm":return"Video";case"email":case"eml":case"emlx":case"msg":return"Mail";case"ttf":case"fnt":case"otf":return"FontSize";case"docx":case"doc":case"odt":case"rtf":return"WordDocument";case"pptx":case"ppt":case"pps":case"odp":return"PowerPointDocument";case"xlsx":case"xlsm":case"ods":case"xls":case"csv":return"ExcelDocument";case"pdb":return"FilePDB";case"pdf":return"PDF";case"sql":case"wiql":return"FileSQL";case"java":case"jsp":case"jar":return"FileJAVA";case"asp":case"aspx":return"FileASPX";case"CSS":return"FileCSS";case"scss":case"sass":return"FileSass";case"less":return"FileLess";case"html":case"htm":case"xhtml":return"FileHTML";case"js":case"jsx":return"JavaScriptLanguage";case"cs":return"CSharpLanguage";case"vb":return"VisualBasicLanguage";case"cpp":case"cxx":case"c++":case"hpp":case"hxx":case"h":return"CPlusPlusLanguage";case"f#":return"FSharpLanguage";case"ts":case"tsx":return"TypeScriptLanguage";case"py":return"PythonLanguage";case"md":return"MarkDownLanguage";case"rs":return"RustLanguage";case"rb":return"RubyGemsLogo";case"xml":case"c":case"php":case"swift":case"tex":case"json":case"yml":case"yaml":case"sbl":case"asm":case"d":case"f":case"for":case"go":case"m":case"p":case"pas":case"r":return"FileCode";case"bat":case"sh":case"pl":case"awk":case"cmd":case"lua":return"Script";case"sln":case"proj":return"FileTypeSolution";default:return"TextDocument"}},t[e].formatFileSize=function(e){return null==e?"":`${Math.ceil(e/1024)}K`},t[e].downloadAttachment=async function(e,t,o){var i,n;const r=await(0,jt.getAttachmentUri)(e,t.project.guid,o),a=document.createElement("a");a.href=r,a.download=null!==(n=null!==(i=o.OriginalName)&&void 0!==i?i:o.FilePath)&&void 0!==n?n:"",a.click()}}("AttachmentsAttachmentUtils"),function(e){_t=t[e]={};const n="WorkItemForm/CollapsedSections";function r({autoFocusFullScreenButton:n,label:r,collapsed:a,disabled:h,hasHtmlControl:p,tooltipText:g,iconProps:k,fullScreen:v,onFullScreen:f,onRestore:I,onToggleCollapsed:w,children:y}){const C=(0,s.format)(a?Ut.ExpandSectionLabel:Ut.CollapseSectionLabel,r),b=(0,s.format)(Ut.MaximizeSectionLabel,r),E=(0,s.format)(Ut.RestoreSectionLabel,r),T=o.useRef(o.createRef()),[S,N]=(0,o.useState)(!1);(0,o.useEffect)((()=>{n&&S&&T.current.current&&(T.current.current.focus(),N(!1))}),[n,S,T.current]);const D=(0,i.useService)("IVssThemeService"),[x,F]=(0,o.useState)(!1),L=x?Ut.HideDarkThemeFormat:Ut.ShowDarkThemeFormat;return o.createElement(c.Observer,{themeService:D},(()=>{const i=D.getCurrentTheme().isDark;return o.createElement("div",{className:(0,u.css)(t[e].collapsibleSectionClassName,h&&"disabled",p&&!x&&i&&"work-item-form-section-dark-theme-override")},o.createElement("div",{className:"work-item-form-collapsible-header margin-bottom-4 flex-row justify-space-between",onClick:w},o.createElement("span",{className:"font-size-ml font-weight-semibold","aria-level":2,role:"heading"},g?o.createElement(d.Tooltip,{className:"work-item-form-control-tooltip",text:g},o.createElement("div",null,r)):r,o.createElement(c.Observer,{iconProps:k},(e=>e.iconProps?o.createElement(m.Icon,Object.assign({},e.iconProps)):null))),o.createElement("div",{className:"work-item-form-section-controls"},v&&!h&&!!I&&o.createElement(l.Button,{autoFocus:!0,ariaLabel:E,subtle:!0,iconProps:{iconName:"BackToWindow"},onClick:e=>{e.stopPropagation(),I()}}),!v&&!h&&!!f&&o.createElement(l.Button,{ref:T.current,ariaLabel:b,className:"work-item-form-toggle",subtle:!0,iconProps:{iconName:"FullScreen"},onClick:e=>{e.stopPropagation(),f(),N(!0)}}),!v&&!h&&o.createElement(l.Button,{ariaExpanded:!a,ariaLabel:C,className:(0,u.css)(t[e].collapseButtonClassName,"work-item-form-toggle",a&&"collapsed"),subtle:!0,iconProps:{iconName:a?"ChevronDown":"ChevronUp"},onClick:e=>{e.stopPropagation(),w()}}),p&&i&&o.createElement(l.Button,{className:"work-item-form-toggle",iconProps:x?{iconName:"Hide2"}:{iconName:"RedEye"},ariaLabel:L,tooltipProps:{text:L},subtle:!0,onClick:e=>{e.stopPropagation(),F((e=>!e))}}))),o.createElement("div",{"aria-hidden":a,className:(0,u.css)("work-item-form-collapsible-section-content",a&&"collapsed")},y))}))}t[e].collapseButtonClassName="work-item-form-toggle-collapse",t[e].collapsibleSectionClassName="work-item-form-collapsible-section",t[e].FullScreenSectionContext=o.createContext({setFullScreenContent:()=>{},fullScreenContent:void 0}),t[e].FullScreenSectionContainer=function({children:i}){const[n,r]=(0,o.useState)();return o.createElement("div",{className:"work-item-form-expanded-section-container v-scroll-auto full-height flex-row"},o.createElement(t[e].FullScreenSectionContext.Provider,{value:{setFullScreenContent:r,fullScreenContent:n}},o.createElement("div",{className:"work-item-from-fullscreen-content full-width padding-8 "+(n?"":"hidden")},n),o.createElement("div",{className:n?"hidden":"scroll-hidden full-width"},i)))},t[e].CollapsibleSection=function({children:a,disabled:s,hasHtmlControl:l,tooltipText:m,iconProps:c,label:d,settingsKey:u}){const{setFullScreenContent:h,fullScreenContent:p}=(0,o.useContext)(t[e].FullScreenSectionContext),[g,k]=(0,o.useState)(!1),v=(0,i.useService)("ISettingsService"),[f,I]=(0,o.useState)((()=>{return!!u&&!!(null===(e=v.getEntry(n,0))||void 0===e?void 0:e[u]);var e})),w=e=>{if(u){const t={[`${n}/${u}`]:e};v.setEntries(t,0)}I(e)},y=(0,o.useContext)(Bt.WorkItemFormPageContext);(0,o.useEffect)((()=>{if(-1===(null==u?void 0:u.indexOf("Discussion-Section")))return;y.focusDiscussion&&(p&&h(void 0),f&&w(!1))}),[y.focusDiscussion]),(0,o.useEffect)((()=>{if(-1!==(null==u?void 0:u.indexOf("Discussion-Section"))&&!f&&!p&&y.focusDiscussion){const e=new Event("wif-focus-discussion");document.dispatchEvent(e)}}));const C=s?void 0:o.createElement(r,{collapsed:!1,disabled:!1,fullScreen:!0,hasHtmlControl:l,tooltipText:m,iconProps:c,label:d,onRestore:()=>{k(!0),h(void 0)},onToggleCollapsed:()=>{}},a);return o.createElement(r,{autoFocusFullScreenButton:g,collapsed:!s&&f,disabled:s,fullScreen:!1,hasHtmlControl:l,tooltipText:m,iconProps:c,label:d,onFullScreen:()=>{k(!1),h(C)},onToggleCollapsed:s?()=>{}:()=>w(!f)},a)}}("CommonComponentsCollapsibleSection"),function(e){Gt=t[e]={},t[e].EditCommentDialog=function({comment:e,onCommitComment:t,onDismiss:i}){const[n,r]=(0,o.useState)(e);return o.createElement(h.Dialog,{lightDismiss:!0,escDismiss:!0,titleProps:{text:Ut.EditComment},footerButtonProps:[{text:Ut.ConfirmEditComment,onClick:()=>t(n),disabled:e==n,primary:!0},{text:Ut.CancelEditComment,onClick:i}],onDismiss:i},o.createElement(p.TextField,{label:Ut.CommentFieldLabel,value:n,onChange:(e,t)=>r(t)}))}}("CommonComponentsEditCommentDialog"),$t=t.LinksConstants={},t.LinksConstants.LinkTopology={Tree:"Tree",Dependency:"Dependency",DirectedNetwork:"DirectedNetwork",Network:"Network"},function(e){Kt=t[e]={};const n="ms.vss-work-web/new-work-item-form-content/Content/ltv-dependency-fwd.png",r="ms.vss-work-web/new-work-item-form-content/Content/ltv-dependency-rev.png",a="ms.vss-work-web/new-work-item-form-content/Content/ltv-tree-fwd.png",s="ms.vss-work-web/new-work-item-form-content/Content/ltv-tree-rev.png",l="ms.vss-work-web/new-work-item-form-content/Content/ltv-directed-network-fwd.png",m="ms.vss-work-web/new-work-item-form-content/Content/ltv-directed-network-rev.png",c="ms.vss-work-web/new-work-item-form-content/Content/ltv-network.png";t[e].LinkTopologyDiagram=function({workItemLinkTypeEnd:e}){var t;const u=(0,i.useService)("IWorkItemLinksService"),[h,p]=(0,o.useState)();(0,o.useEffect)((()=>{(async()=>{var t;const o=e?await u.getWitLinkTypeEnd(e):void 0;p(null!==(t=function(e){const t=null==e?void 0:e.linkType;if(!t)return;const o=t.reverseEnd.immutableName===(null==e?void 0:e.immutableName);if(t.topology===$t.LinkTopology.Dependency)return o?{assetName:r,tooltip:Ut.TopologyDependencyTooltip}:{assetName:n,tooltip:Ut.TopologyDependencyTooltip};if(t.topology===$t.LinkTopology.Tree)return o?{assetName:s,tooltip:Ut.TopologyTreeReverseTooltip}:{assetName:a,tooltip:Ut.TopologyTreeForwardTooltip};if(t.topology===$t.LinkTopology.DirectedNetwork)return o?{assetName:m,tooltip:Ut.TopologyDirectedNetworkTooltip}:{assetName:l,tooltip:Ut.TopologyDirectedNetworkTooltip};if(t.topology===$t.LinkTopology.Network)return{assetName:c,tooltip:Ut.TopologyNetworkTooltip};return}(o))&&void 0!==t?t:{assetName:void 0,tooltip:void 0})})()}),[e]);const g=(0,Bt.useAssetLocation)(null!==(t=null==h?void 0:h.assetName)&&void 0!==t?t:"");return o.createElement(d.Tooltip,{text:null==h?void 0:h.tooltip},o.createElement("img",{className:"link-topology-diagram margin-top-8",src:g}))}}("LinksControlsLinkTopologyDiagram"),function(e){qt=t[e]={};const n="WorkItemForm/LastSelectedLinkType";t[e].LinkTypeDropdown=function({onLinkTypeChanged:e,linkTypeFilter:t,defaultLinkTypeId:r}){const a=(0,i.useService)("ISettingsService"),s=function(e){const t=(0,i.useService)("IWorkItemLinksService"),n=(0,i.useService)(w.ILinkTypeRegistryId),[r,a]=(0,o.useState)();return(0,o.useEffect)((()=>{t.getLinkTypes().then((async o=>{const i=o.find((e=>e.name===f.RegisteredLinkTypeNames.Related)),r=[];for(const t of o)n.hasLinkTypeForm(t.toolId,t.name)&&e(t.name,"",t.toolId)&&t.name!==(null==i?void 0:i.name)&&r.push({id:t.name,text:(0,I.getLinkTypeDisplayName)(t.name),groupId:(0,I.getToolDisplayName)(t.toolId),registeredLinkType:t});if(i){const o=await t.getWitLinkTypes();for(const t of o)e(f.RegisteredLinkTypeNames.Related,t.forwardEnd.immutableName,f.ToolIds.WorkItemTracking)&&r.push({id:t.forwardEnd.immutableName,text:t.forwardEnd.name,groupId:(0,I.getToolDisplayName)(f.ToolIds.WorkItemTracking,t.isRemote),registeredLinkType:i,workItemLinkType:t,workItemLinkTypeEnd:t.forwardEnd}),t.isDirectional&&e(f.RegisteredLinkTypeNames.Related,t.reverseEnd.immutableName,f.ToolIds.WorkItemTracking)&&r.push({id:t.reverseEnd.immutableName,text:t.reverseEnd.name,groupId:(0,I.getToolDisplayName)(f.ToolIds.WorkItemTracking,t.isRemote),registeredLinkType:i,workItemLinkType:t,workItemLinkTypeEnd:t.reverseEnd})}const s=Array.from(new Set(r.map((e=>e.groupId)))).map((e=>({id:e,text:e}))).sort(((e,t)=>e.text.localeCompare(t.text))),l=r.sort(((e,t)=>e.text.localeCompare(t.text))),m=new v.GroupedItemProvider(l,s,!0);a(m)}))}),[e]),r}(t),l=(0,o.useRef)(new k.DropdownSelection),m=t=>{if(t){const o={[`${n}/ItemId`]:t.id};a.setEntries(o,0),e(t)}};return(0,o.useEffect)((()=>{var e;if(!s||0===s.length)return;const t=s.value,o=null!=r?r:null===(e=a.getEntry(n,0))||void 0===e?void 0:e.ItemId,i=t.findIndex((e=>e.id===o));if(i>-1)return l.current.select(i),void m(t[i]);if(0===l.current.selectedCount)for(let e=0;e<t.length;e++){const o=t[e];if(o.registeredLinkType)return l.current.select(e),void m(o)}}),[s,r]),s?o.createElement(g.EditableDropdown,{items:null!=s?s:[],selection:l.current,onValueChange:m}):null}}("LinksControlsLinkTypeDropdown"),function(e){Zt=t[e]={},t[e].resolveWorkItemArtifacts=async function(e,t,o){var i;const n=e.filter((e=>!!e.ID)).map((e=>e.ID));if(0===n.length)return[];const r=t.getService("IWorkItemLinksService"),a=t.getService("IVssLocationService"),s=t.getService("IWorkItemModelService"),l=null!==(i=await s.getWorkItems(n,void 0,void 0,void 0,void 0,o).catch((()=>[])))&&void 0!==i?i:[];return Promise.all(l.map((async function(t){var o,i;const n=e.find((e=>e.ID===t.id)),s=n.LinkType?await r.getWitLinkTypeEnd(n.LinkType):void 0,l=t.getFieldValueByName(y.CoreFieldRefNames.AssignedTo,void 0,void 0,!0),m=null!==(o=null==l?void 0:l.identityRef)&&void 0!==o?o:l;return{linkIdentifier:n,icons:[{project:t.project.guid,workItemTypeName:t.getFieldValueByName(y.CoreFieldRefNames.WorkItemType)},m],id:t.id,displayId:""+t.id,title:t.getFieldValueByName(y.CoreFieldRefNames.Title),state:t.getFieldValueByName(y.CoreFieldRefNames.State),tool:f.ToolIds.WorkItemTracking,linkTypeDisplayName:null!==(i=null==s?void 0:s.name)&&void 0!==i?i:f.RegisteredLinkTypeNames.Related,registeredLinkType:f.RegisteredLinkTypeNames.Related,witLinkTypeEnd:null==s?void 0:s.immutableName,updateDate:t.getFieldValueByName(y.CoreFieldRefNames.ChangedDate),uri:a.routeUrl("ms.vss-work-web.new-work-item-form-route",{project:t.project.name,id:""+t.id}),additionalData:{workItem:t}}})))}}("LinksWorkItemresolveWorkItemArtifacts"),function(e){Xt=t[e]={};t[e].WorkItemLinkTopologyValidator=class{constructor(e,t,o,i,n){this.workItemService=e.getService("IWorkItemModelService"),this.origins=t,this.workItemLinkTypeEnd=o,this.targetIds=i,this.messages=new Set,this.validationPromise=null,this.ignoredLinks=null!=n?n:{}}async validate(){var e;if(!this.validationPromise){const t=null!==(e=await this.workItemService.getWorkItems(this.targetIds))&&void 0!==e?e:[],o=this.targetIds.filter((e=>!t.find((t=>t.id===e))));for(const e of o)this.messages.add((0,s.format)(Ut.TopologyValidationWorkItemNotFound,e));this.targets=t;for(const e of this.origins)this.validateOrigin(e);this.validationPromise=Promise.resolve(Array.from(this.messages))}return this.validationPromise}validateOrigin(e){if(this.violatesOneToMany())this.messages.add(Ut.TopologyValidationForbiddenMultipleLinks);else for(const t of this.targets)this.validateNewLink(e,t)}validateNewLink(e,t){if(this.isLinkToSelf(e,t))this.messages.add(Ut.TopologyValidationLinkToSelf);else{for(const o of this.getLinks(e))this.validateConflictsWithExistingOriginLink(e,o,t);for(const o of this.getLinks(t))this.validateConflictsWithExistingTargetLink(e,t,o)}}validateConflictsWithExistingOriginLink(e,t,o){if(this.isDuplicate(t,o))return void this.messages.add((0,s.format)(Ut.TopologyValidationDuplicate,this.workItemLinkTypeEnd.name,e.id,o.id));this.workItemLinkTypeEnd.linkType&&this.violatesOneToMany(t)&&this.messages.add((0,s.format)(Ut.TopologyValidationOneToManyViolation,e.id,this.workItemLinkTypeEnd.name))}validateConflictsWithExistingTargetLink(e,t,o){if(this.addsForbiddenCircularReference(e,o)&&this.messages.add((0,s.format)(Ut.TopologyValidationForbiddenCircularReference,this.workItemLinkTypeEnd.name,e.id,t.id)),this.addsSecondParentToTarget(e,o)){const e=this.workItemLinkTypeEnd.linkType.reverseEnd;this.messages.add((0,s.format)(Ut.TopologyValidationOneToManyViolation,t.id,e.name))}}isLinkToSelf(e,t){return e.id===t.id}isDuplicate(e,t){return e instanceof C.WorkItemLink&&e.getWitLinkTypeEndId()===this.workItemLinkTypeEnd.id&&e.getTargetId()===t.id}violatesOneToMany(e){const t=this.workItemLinkTypeEnd.linkType;return e?!!t&&t.isOneToMany&&!this.workItemLinkTypeEnd.isForwardLink&&e.getWitLinkTypeEndId()===this.workItemLinkTypeEnd.id:!!t&&t.isOneToMany&&!this.workItemLinkTypeEnd.isForwardLink&&this.targetIds.length>1}addsForbiddenCircularReference(e,t){const o=this.workItemLinkTypeEnd.linkType;return!!o&&o.isNonCircular&&t instanceof C.WorkItemLink&&t.getWitLinkTypeEndId()===this.workItemLinkTypeEnd.id&&t.getTargetId()===e.id}addsSecondParentToTarget(e,t){const o=this.workItemLinkTypeEnd.linkType;if(!o)return!1;const i=o.reverseEnd;return o.topology===$t.LinkTopology.Tree&&this.workItemLinkTypeEnd.isForwardLink&&t instanceof C.WorkItemLink&&t.getWitLinkTypeEndId()===i.id&&t.getTargetId()!==e.id}getLinks(e){let t=e.getLinks();const o=this.ignoredLinks[e.id];return o&&(t=t.filter((e=>!o.includes(e)))),t=this.filterByReversedIgnoredLinks(t,e),t}filterByReversedIgnoredLinks(e,t){const o=[];for(const i of e){if(!i.linkData.ID)continue;const e=this.ignoredLinks[i.linkData.ID];(null==e?void 0:e.some((e=>e.linkData.ID===t.id)))||o.push(i)}return o}}}("LinksWorkItemWorkItemLinkTopologyValidator"),function(e){Yt=t[e]={},t[e].EditWorkItemLinkDialog=function({comment:e,onEditLink:t,onDismiss:n,linkIdentifier:r,workItem:a}){const s=(0,i.usePageContext)(),l=(0,i.useService)("IWorkItemLinksService"),[m,c]=(0,b.useObservable)(e),[d,u]=(0,o.useState)(),[g,k]=(0,o.useState)([]),[v,I]=(0,o.useState)(!1),w=(0,o.useMemo)((()=>(0,S.getRelatedWorkNewLinkTypeFilter)([a])),[a]),y=(0,o.useMemo)((()=>a.getLinks().find((e=>e.linkData.FilePath===(null==r?void 0:r.FilePath)&&e.linkData.ID===(null==r?void 0:r.ID)))),[a,r]),C=(0,o.useMemo)((()=>r.ID),[a,r]),N=(0,o.useMemo)((()=>(null==y?void 0:y.getWitLinkTypeEndId())!==(null==d?void 0:d.id)),[d,y]);(0,o.useEffect)((()=>{(async()=>{const e=await l.getWitLinkTypeEnd(null==y?void 0:y.getWitLinkTypeEndId());u(e)})()}),[y]),(0,o.useEffect)((()=>{(async()=>{if(!d||!C||!y)return;if(!N)return void I(!1);const e=await new Xt.WorkItemLinkTopologyValidator(s,[a],d,[C],{[a.id]:[y]}).validate();k(e),I(e.length>0)})()}),[d,a,s]);const D=(0,o.useCallback)((async()=>{if(!d||!C||!y)return;let e;if(N){const t={ID:C,tool:f.ToolIds.WorkItemTracking,FldID:f.LinkTypeFieldIds.WorkItem,LinkType:d.id};e=(await(0,Zt.resolveWorkItemArtifacts)([t],s)).map((e=>Object.assign(Object.assign({},e),{linkIdentifier:Object.assign(Object.assign({},e.linkIdentifier),{Comment:m.value}),registeredLinkType:f.RegisteredLinkTypeNames.Related,witLinkTypeEnd:d.immutableName,linkTypeDisplayName:d.name})))}t({comment:m.value,removeLink:N,linksToAdd:e})}),[m,t,d,C,y,N]);return o.createElement(h.Dialog,{className:"add-link-dialog",titleProps:{text:Ut.EditLink},onDismiss:n},o.createElement("div",{className:"link-type-field margin-bottom-8"},o.createElement(E.FormItem,{label:Ut.LinkTypeLabel},o.createElement(qt.LinkTypeDropdown,{linkTypeFilter:w,defaultLinkTypeId:null==d?void 0:d.immutableName,onLinkTypeChanged:e=>{u(e.workItemLinkTypeEnd)}}))),o.createElement("div",{className:"link-type-specific-content margin-bottom-8"},o.createElement("div",{className:"work-item-link-form"},o.createElement(Kt.LinkTopologyDiagram,{workItemLinkTypeEnd:null==d?void 0:d.immutableName}),0===g.length?null:o.createElement("div",{className:"work-item-link-form-errors flex-column padding-vertical-4 padding-horizontal-8 margin-top-8"},g.map(((e,t)=>o.createElement("div",{className:"padding-vertical-4",key:t},e)))))),o.createElement("div",{className:"comment-field"},o.createElement(E.FormItem,{label:Ut.LinkCommentLabel},o.createElement(p.TextField,{placeholder:Ut.LinkCommentPlaceholder,value:m,onChange:(e,t)=>{c(t)}}))),o.createElement(T.PanelFooter,{buttonProps:[{primary:!0,text:Ut.Save,onClick:D,disabled:v},{text:Ut.Cancel,onClick:n}]}))}}("CommonComponentsEditWorkItemLinkDialog"),function(e){Jt=t[e]={},t[e].FieldName=function({refName:e}){const t=(0,Bt.useFieldMetadata)(e);return o.createElement(o.Fragment,null,null==t?void 0:t.name)}}("CommonComponentsFieldName"),function(e){Qt=t[e]={};t[e].WorkItemFormCommentPreview=e=>o.createElement(N.MarkdownPreviewWithAutocomplete,Object.assign({refreshThrottleMs:500},e,{options:Object.assign({html:!0,breaks:!0},e.options),value:e.content}))}("DetailsWorkItemFormCommentPreview"),function(e){eo=t[e]={},t[e].StateCircle=function({state:e,color:t,workItem:i,className:n,role:r,hideIfUnknownState:a,tooltipProps:s}){let l;try{l=(0,Bt.useWorkItem)()}catch(e){l=void 0}const m=null==(i=null!=i?i:l)?void 0:i.getTypeData(),c=(0,o.useMemo)((()=>null!=t?t:function(e,t){var o,i;for(const n of null!==(i=null===(o=null==t?void 0:t.rules)||void 0===o?void 0:o.stateColors)&&void 0!==i?i:[])if(n.name===e)return`#${n.color}`;return}(e,m)),[e,t,m]);return!c&&a?null:o.createElement(d.Tooltip,Object.assign({},s),o.createElement("div",{role:r,className:`state-circle ${n}`,style:{background:c}}))}}("CommonComponentsStateCircle"),function(e){function n({fieldValue:e}){const t=(0,i.usePageContext)();if("string"!=typeof e&&!(0,L.isIdentityRef)(e)&&!(0,L.isWorkItemIdentityRef)(e))return null;const n=(0,L.isWorkItemIdentityRef)(e)?e.identityRef:(0,L.isIdentityRef)(e)?(0,L.convertWorkItemIdentityRefFromFieldValue)(t,e.displayName).identityRef:(0,L.convertWorkItemIdentityRefFromFieldValue)(t,e).identityRef,r=(0,L.stripIdPartFromDisplayName)(n.displayName);return o.createElement("div",{className:"inline-flex-row flex-baseline"},o.createElement(D.Persona,{className:"icon-margin",size:16,identity:n}),o.createElement("div",null,r))}to=t[e]={},t[e].FieldValue=function({fieldValue:e,refName:t}){const i=(0,Bt.useFieldMetadata)(t);if(null==e)return null;if(t===y.CoreFieldRefNames.State&&"string"==typeof e)return o.createElement("span",null,o.createElement(eo.StateCircle,{className:"icon-margin",state:e,role:"presentation"}),e);if(t===y.CoreFieldRefNames.Tags&&"string"==typeof e){const t=e.split(";").map((e=>e.trim()));return o.createElement("span",{className:"inline-flex-row"},t.map(((e,t)=>o.createElement(x.Pill,{key:t,size:0},e))))}return(null==i?void 0:i.type)!==y.FieldType.Html&&(null==i?void 0:i.type)!==y.FieldType.History||"string"!=typeof e?"string"==typeof e||"number"==typeof e?o.createElement("span",null,e):"boolean"==typeof e?o.createElement("span",null,e?"True":"False"):e instanceof Date?o.createElement("span",null,(0,s.dateToString)(e)):(null==i?void 0:i.isIdentity)?o.createElement(n,{fieldValue:e}):o.createElement("span",null,"Field ",t," has value ",JSON.stringify(e)," that is not yet supported"):o.createElement(F.HtmlPreview,{rawHtml:e})},t[e].CommentFieldValue=function({fieldValue:e,refName:t,commentFormat:i}){const n=(0,Bt.useFieldMetadata)(t);return null==e?null:(null==n?void 0:n.type)!==y.FieldType.Html&&(null==n?void 0:n.type)!==y.FieldType.History||"string"!=typeof e?o.createElement("span",null,"Comment field ",t," has value ",JSON.stringify(e)," and format ",JSON.stringify(i)," that is not yet supported"):0===i?o.createElement(Qt.WorkItemFormCommentPreview,{content:e,className:"comment-content"}):o.createElement(F.HtmlPreview,{rawHtml:e})}}("CommonComponentsFieldValue"),function(e){oo=t[e]={};class i{constructor(e,t){this.key=e,this.label=t}}function n({label:e,expanded:t,onToggle:i,listItemProps:n}){return o.createElement(R.ListItem,Object.assign({},n),o.createElement("div",{className:"partitioned-list-divider padding-8",onClick:i},o.createElement(m.Icon,{className:"icon-margin",iconName:t?"ChevronDown":"ChevronRight"}),e))}t[e].PartitionedList=function(e){var{items:t,getPartition:r,renderRow:a}=e,s=__rest(e,["items","getPartition","renderRow"]);const[l,m]=(0,o.useState)(new A.ArrayItemProvider([])),[c,d,u]=(0,Bt.useSet)();return(0,o.useEffect)((()=>{const e=new Map,o=new Map;for(const i of t){const t=r(i);o.has(t.key)||o.set(t.key,t),e.has(t.key)||e.set(t.key,[]),e.get(t.key).push(i)}const n=[...o.values()].sort(((e,t)=>e.order-t.order));let a=[];for(const t of n){const o=new i(t.key,t.label),n=e.get(t.key).map((e=>Object.assign(Object.assign({},e),{collapsed:c(t.key),partitionKey:t.key})));a=[...a,o,...n]}m(new A.ArrayItemProvider(a))}),[t,r,c]),o.createElement(R.List,Object.assign({},s,{itemProvider:l,renderRow:(e,t,r)=>t instanceof i?o.createElement(n,{key:`partition-divider-${t.key}`,listItemProps:{index:e,details:r},label:t.label,expanded:!c(t.key),onToggle:()=>{c(t.key)?u(t.key):d(t.key)}}):t.collapsed?null:a(e,t,r),onFocus:(e,t)=>{var o;t.data instanceof i||null===(o=s.onFocus)||void 0===o||o.call(s,e,t)},onSelect:(e,t)=>{var o;t.data instanceof i||null===(o=s.onSelect)||void 0===o||o.call(s,e,t)},onActivate:(e,t)=>{var o;const n=t.data;n instanceof i?c(n.key)?u(n.key):d(n.key):null===(o=s.onActivate)||void 0===o||o.call(s,e,t)}}))}}("CommonComponentsPartitionedList"),function(e){io=t[e]={},__exportStar(_t,t[e]),__exportStar(Gt,t[e]),__exportStar(Yt,t[e]),__exportStar(Jt,t[e]),__exportStar(to,t[e]),__exportStar(oo,t[e]),__exportStar(eo,t[e])}("CommonComponentsindex"),no=t.CommonServicesIWorkItemFormCommentService={},ro=t.CommonServicesIWorkItemFormService={},function(e){ao=t[e]={},t[e].ConfirmSkippingOversizedAttachmentsDialog=function({oversidedAttachmentNames:e,maxFileSize:t,onUploadRemaining:i,onCancelUpload:n}){if(0===e.length)return null;const r=i?[{text:Ut.UploadRemainingFiles,onClick:i,primary:!0},{text:Ut.CancelUpload,onClick:n}]:[{text:Ut.CancelUpload,onClick:n,primary:!0}];return o.createElement(h.Dialog,{className:"confirm-skipping-oversized-attachments-dialog",titleProps:{text:e.length>1?Ut.AttachmentsOverSizeLimit:Ut.AttachmentOverSizeLimit},onDismiss:n,footerButtonProps:r},e.length>1?o.createElement(o.Fragment,null,o.createElement("div",null,(0,s.format)(Ut.FilesOverSizeLimit,(0,zt.formatFileSize)(t))),o.createElement("ul",{className:"oversized-attachments-list"},e.map(((e,t)=>o.createElement("li",{key:t},e))))):o.createElement("div",null,(0,s.format)(Ut.FileOverSizeLimit,e[0],(0,zt.formatFileSize)(t))))}}("AttachmentsDialogsConfirmSkippingOversizedAttachmentsDialog"),function(e){so=t.CommonServicesWorkItemFormAttachmentsService={};class i extends W.VssService{constructor(){super(...arguments),this.maxAttachmentSize=4194304}async _serviceStart(e){super._serviceStart(e),this.witClient=(0,r.getWorkItemTrackingClient)(e),this.modelService=e.getService("IWorkItemModelService"),this.layoutManager=e.getService("IVssLayoutManager"),this.attachmentsByWorkItem=new Map,this.placeholdersByFileByWorkItem=new Map;const t=null==e?void 0:e.getService("IVssContributionService"),o=await(null==t?void 0:t.getDataAsync("ms.vss-work-web.work-item-common-configuration-data-provider"));o&&(this.maxAttachmentSize=o.maxAttachmentSize)}getAttachmentsObservable(e){if(!this.attachmentsByWorkItem.has(e.id)){const t=new b.ObservableArray(this.getAttachments(e));this.attachmentsByWorkItem.set(e.id,t)}return this.attachmentsByWorkItem.get(e.id)}setAttachments(e,t){this.attachmentsByWorkItem.has(e.id)?this.attachmentsByWorkItem.get(e.id).value=t:this.attachmentsByWorkItem.set(e.id,new b.ObservableArray(t))}getAttachments(e){const t=e.getLinks().filter((e=>e instanceof C.Attachment&&!e.isRemoved())).map((e=>e.linkData));return this.setAttachments(e,t),t}editComment(e,t,o){const i=e.getLinks().find((e=>e instanceof C.Attachment&&e.linkData.FilePath===t.FilePath));i&&(i.setComment(o),e.evaluateDirty(),this.getAttachments(e))}deleteAttachment(e,t){const o=e.getLinks().find((e=>e instanceof C.Attachment&&e.linkData.FilePath===t.FilePath));o&&(e.removeLinks([o],!0),this.getAttachments(e))}async attachFiles(e,t){if(e.isReadOnly())return void this.showErrorDialog(Ut.AttachmentUploadPermissionsError);const o=[],i=[];for(const e of t)e.size>this.maxAttachmentSize?o.push(e.name):i.push(e);if(o.length>0&&!await this.confirmSkippingOversizedAttachments(o))return;const n=e.getFieldValueById(y.DalFields.AreaPathId),r=[];let a=!1;await Promise.all(i.map((async t=>{this.createPlaceholder(e,t);try{const o=await this.witClient.createAttachment(await t.arrayBuffer(),e.project.guid,t.name,"Simple",n);this.onAttachmentCreated(e,t,o)}catch(o){r.push(t.name),this.removePlaceholder(e,t),403===Number(o.status)&&(a=!0)}}))),a?this.showErrorDialog(Ut.AttachmentUploadPermissionsError):r.length>0&&this.showErrorDialog((0,s.format)(Ut.FilesUploadError,r.join(", ")))}showErrorDialog(e){this.pageContext.getService("IVssLayoutManager").renderCallout((t=>o.createElement(h.Dialog,{onDismiss:t,titleProps:{text:Ut.AttachmentUploadError},showCloseButton:!0},e)))}createPlaceholder(e,t){const o={FldID:f.LinkTypeFieldIds.Attachment,OriginalName:t.name,Length:t.size};this.placeholdersByFileByWorkItem.has(e.id)||this.placeholdersByFileByWorkItem.set(e.id,new Map),this.placeholdersByFileByWorkItem.get(e.id).set(t,o),this.attachmentsByWorkItem.has(e.id)?this.attachmentsByWorkItem.get(e.id).push(o):this.setAttachments(e,[o])}getPlaceholder(e,t){var o;return null===(o=this.placeholdersByFileByWorkItem.get(e.id))||void 0===o?void 0:o.get(t)}replacePlaceholder(e,t,o){const i=this.getPlaceholder(e,t);if(!i)return;if(this.placeholdersByFileByWorkItem.get(e.id).delete(t),!this.attachmentsByWorkItem.has(e.id))return;const n=this.attachmentsByWorkItem.get(e.id),r=n.value.indexOf(i);r>=0?n.splice(r,1,o):n.push(o)}removePlaceholder(e,t){const o=this.getPlaceholder(e,t);if(!o)return;if(this.placeholdersByFileByWorkItem.get(e.id).delete(t),!this.attachmentsByWorkItem.has(e.id))return;const i=this.attachmentsByWorkItem.get(e.id),n=i.value.indexOf(o);n>=0&&i.splice(n,1)}confirmSkippingOversizedAttachments(e){return new Promise((t=>this.layoutManager.renderCallout((i=>o.createElement(ao.ConfirmSkippingOversizedAttachmentsDialog,{oversidedAttachmentNames:e,maxFileSize:this.maxAttachmentSize,onCancelUpload:()=>{t(!1),i()},onUploadRemaining:()=>{t(!0),i()}})))))}onAttachmentCreated(e,t,o){const i=C.Attachment.create(t.name,o.id,t.size,"");this.replacePlaceholder(e,t,i.linkData),e.addLinks([i]),this.placeholdersByFileByWorkItem.has(e.id)&&0!==this.placeholdersByFileByWorkItem.get(e.id).size||this.getAttachments(e)}}W.Services.add("IWorkItemFormAttachmentsService",{serviceFactory:i})}(),t.CommonServicesindex={},__exportStar(no,t.CommonServicesindex),__exportStar(ro,t.CommonServicesindex),__exportStar(so,t.CommonServicesindex),function(e){lo=t[e]={},t[e].AttachmentMoreButton=function({className:e,onEditComment:t,onPreviewAttachment:i,onDownloadAttachment:n,onDeleteAttachment:r,onCopyAttachmentUrl:a}){const s=(0,o.useMemo)((()=>{let e={menuProps:{id:"attachment-menu",items:[]}};t&&e.menuProps.items.push({id:"edit-comment",groupKey:"attachment-actions",iconProps:{iconName:"Edit"},text:Ut.EditComment,onActivate:t});const o=[{id:"preview-attachment",groupKey:"attachment-actions",iconProps:{iconName:"Preview"},text:Ut.PreviewAttachment,onActivate:i},{id:"copy-attachment-url",groupKey:"attachment-actions",iconProps:{iconName:"Copy"},text:Ut.CopyAttachemntURL,onActivate:a},{id:"download-attachment",groupKey:"attachment-actions",iconProps:{iconName:"Download"},text:Ut.DownloadAttachment,onActivate:n}];return e.menuProps.items.push(...o),r&&e.menuProps.items.push({id:"delete-attachment",groupKey:"attachment-actions",iconProps:{iconName:"Delete"},text:Ut.DeleteAttachment,onActivate:r}),e}),[t,i,a,n,r]);return o.createElement(P.MoreButton,{className:e,hideDropdownIcon:!0,subtle:!0,contextualMenuProps:s})}}("AttachmentsAttachmentMoreButton"),function(e){function i(e,t,o,i){i.width.value=o}mo=t[e]={},t[e].AttachmentsGrid=function({attachments:e,onEditComment:t,onDownloadAttachment:r,onDeleteAttachment:a,onPreviewAttachment:s,onCopyAttachmentUrl:l}){const c=t=>e.value=t,d=(0,o.useMemo)((()=>{return e={onEditComment:t,onDownloadAttachment:r,onDeleteAttachment:a,onPreviewAttachment:s,onCopyAttachmentUrl:l},[{id:"OriginalName",name:Ut.AttachmentNameColumn,readonly:!0,sortProps:{},renderCell:(t,i,n,r)=>{var a;const s=(0,Vt.curryAttachmentActions)(r,e),l=null!==(a=r.OriginalName)&&void 0!==a?a:"";return o.createElement(H.SimpleTableCell,{ariaRowIndex:t,columnIndex:i,key:i,tableColumn:n},o.createElement("div",{className:"attachment-name-cell flex-row flex-center justify-space-between"},o.createElement("div",{className:"flex-row text-ellipsis"},r.FilePath?o.createElement(m.Icon,{iconName:(0,zt.getAttachmentIconName)(l),className:"icon-margin",ariaHidden:!0}):o.createElement(O.Spinner,{className:"icon-margin",size:"small"}),o.createElement(V.Link,{className:"text-ellipsis",onClick:()=>{var e;return null===(e=s.onPreviewAttachment)||void 0===e?void 0:e.call(s)}},l)),o.createElement(lo.AttachmentMoreButton,Object.assign({className:"attachment-more-button"},s))))},width:new b.ObservableValue(-3/8),onSize:i},{id:"Length",name:Ut.AttachmentSizeColumn,readonly:!0,sortProps:{},renderCell:(e,t,o,i)=>(0,H.renderSimpleCellValue)(t,o,(0,zt.formatFileSize)(i.Length),e),width:new b.ObservableValue(-1/8),onSize:i},{id:"AddedDate",name:Ut.AttachmentDateAddedColumn,readonly:!0,sortProps:{},renderCell:(e,t,i,n)=>o.createElement(H.SimpleTableCell,{ariaRowIndex:e,columnIndex:t,key:t,tableColumn:i},n.AddedDate&&o.createElement(U.Ago,{date:(0,M.getDateInUserTimeZone)(n.AddedDate),currentDate:(0,M.getDateInUserTimeZone)(),tooltipTimeFormat:M.tooltipTimeFormat})),width:new b.ObservableValue(-1/8),onSize:i},{id:"Comment",name:Ut.AttachmentCommentsColumn,readonly:!0,sortProps:{},renderCell:H.renderSimpleCell,width:new b.ObservableValue(-3/8),onSize:i}];var e}),[t,r,a,s,l]),u=(0,o.useMemo)((()=>{return t=e,o=c,i=d,new H.ColumnSorting(((e,r,a)=>{(0,H.sortItems)(e,r,n,i,t.value),o(t.value)}));var t,o,i}),[d]);return o.createElement(H.Table,{className:"work-item-attachments-grid",behaviors:[u],columns:d,itemProvider:e})};const n=[(e,t)=>r(e.OriginalName,t.OriginalName),(e,t)=>{var o,i;return(null!==(o=e.Length)&&void 0!==o?o:0)-(null!==(i=t.Length)&&void 0!==i?i:0)},(e,t)=>{var o,i,n,r;return(null!==(i=null===(o=e.AddedDate)||void 0===o?void 0:o.getTime())&&void 0!==i?i:0)-(null!==(r=null===(n=t.AddedDate)||void 0===n?void 0:n.getTime())&&void 0!==r?r:0)},(e,t)=>r(e.Comment,t.Comment)];function r(e,t){return e||t?e?t?e.localeCompare(t):-1:1:0}}("AttachmentsAttachmentsGrid"),function(e){co=t[e]={};const n="WorkItemForm/AttachmentsViewType";t[e].AttachmentsViewToggle=function({className:e,viewType:t,onViewTypeChanged:r}){const a=(0,i.useService)("ISettingsService");(0,o.useEffect)((()=>{var e;const t=null===(e=a.getEntry(n,0))||void 0===e?void 0:e.ViewType;"grid"!==t&&"thumbnail"!==t||r(t)}),[]);const s=e=>{const t={[`${n}/ViewType`]:e};a.setEntries(t,0),r(e)};return o.createElement("span",{className:`attachments-view-toggle ${e}`},o.createElement(l.Button,{subtle:!0,className:"grid"===t?"toggle-button-active":"",iconProps:{iconName:"BulletedListText",size:"large"},onClick:()=>s("grid"),disabled:"grid"===t,tooltipProps:{text:Ut.AttachmentsGridView}}),o.createElement(l.Button,{subtle:!0,className:"thumbnail"===t?"toggle-button-active":"",iconProps:{iconName:"GridViewSmall",size:"large"},onClick:()=>s("thumbnail"),disabled:"thumbnail"===t,tooltipProps:{text:Ut.AttachmentsThumbnailView}}))}}("AttachmentsAttachmentsViewToggle"),function(e){function n(e){var{attachment:t}=e,i=__rest(e,["attachment"]);const[n,s]=(0,o.useState)(!1);return o.createElement("div",{className:"attachment-thumbnail-card",onDoubleClick:i.onPreviewAttachment,onMouseEnter:()=>s(!0),onMouseLeave:()=>s(!1)},o.createElement(r,{className:"attachment-thumbnail",attachment:t}),o.createElement("div",{className:"attachment-thumbnail-details"},o.createElement("div",{className:"attachment-thumbnail-file-name"},t.OriginalName),o.createElement(a,{className:"attachment-thumbnail-attacher",attachment:t})),n&&o.createElement(lo.AttachmentMoreButton,Object.assign({},i)))}function r({className:e,attachment:t}){var i,n;const r=(0,zt.getAttachmentPreviewType)(null!==(i=t.OriginalName)&&void 0!==i?i:""),a=(0,jt.useAttachmentUri)(t);return o.createElement("div",{className:e},t.FilePath?"Image"===r?o.createElement("img",{className:"attachment-thumbnail-image",src:a}):o.createElement(m.Icon,{className:"attachment-thumbnail-icon font-size-xxxl",iconName:(0,zt.getAttachmentIconName)(null!==(n=t.OriginalName)&&void 0!==n?n:"")}):o.createElement(O.Spinner,null))}function a({className:e,attachment:t}){const[n,r]=(0,o.useState)(void 0),[a,m]=(0,o.useState)(void 0),c=(0,Bt.useWorkItem)(),d=(0,i.useService)("IWorkItemFormService");return(0,o.useEffect)((()=>{d.getHistoryData(c.id,c.project.guid).then((e=>{var o,i;for(const n of e)for(const e of null!==(i=null===(o=n.relations)||void 0===o?void 0:o.added)&&void 0!==i?i:[])if(e.attributes.name===t.OriginalName)return r(n.revisedBy),void m(n.revisedDate)}))}),[t.OriginalName]),o.createElement("div",{className:`${e} flex-row`},n?o.createElement(D.Persona,{identity:n,size:32}):o.createElement(s,{size:32}),o.createElement("div",{className:"attacher-label flex-grow font-size"},o.createElement("div",{className:"attacher-name font-weight-semibold"},n?n.displayName:o.createElement(l,{width:130})),o.createElement("div",{className:"attach-date"},t.AddedDate?o.createElement(U.Ago,{date:(0,M.getDateInUserTimeZone)(t.AddedDate),currentDate:(0,M.getDateInUserTimeZone)(),tooltipTimeFormat:M.tooltipTimeFormat}):o.createElement(l,{width:80}))))}function s({size:e}){return o.createElement("div",{className:"shimmer",style:{width:e,height:e,borderRadius:e/2}})}function l({width:e}){return o.createElement("div",{className:"shimmer shimmer-line margin-bottom-4",style:{height:12,width:e}})}uo=t[e]={},t[e].AttachmentThumbnails=function(e){var{attachments:t}=e,i=__rest(e,["attachments"]);return o.createElement("div",{className:"flex-row flex-wrap"},o.createElement(c.Observer,{attachments:t},(({attachments:e})=>e.map((e=>{const t=(0,Vt.curryAttachmentActions)(e,i);return o.createElement(n,Object.assign({key:e.FilePath,attachment:e},t))})))))}}("AttachmentsAttachmentThumbnails"),function(e){function i({attachment:e}){var t;const i=(0,Bt.useWorkItemTrackingRestClient)(),[n,r]=m(),[a,s]=(0,o.useState)(null);(0,o.useEffect)((()=>{i.getAttachmentContent(e.FilePath).then((e=>{const t=new TextDecoder("utf-8").decode(e);s(t),r()}))}),[e]);const l=null!==(t=null==a?void 0:a.split("\n").length)&&void 0!==t?t:0,c=Array.from({length:l}).map(((e,t)=>t+1));return o.createElement("div",{className:"text-attachment-preview flex-row"},o.createElement("span",{className:"line-numbers"},c.map((e=>o.createElement("div",{key:`line-number-${e}`},e)))),o.createElement("pre",null,o.createElement("code",null,a)),n&&o.createElement(O.Spinner,null))}function n({attachment:e}){const[t,i]=m(),n=(0,jt.useAttachmentUri)(e);return o.createElement(o.Fragment,null,n&&o.createElement("img",{src:n,className:"image-attachment-preview",onLoad:i}),t&&o.createElement(O.Spinner,null))}function r({attachment:e}){const[t,i]=m(),n=(0,jt.useAttachmentUri)(e);return o.createElement(o.Fragment,null,o.createElement("video",{className:"attachment-preview-media",controls:!0,onCanPlay:i,src:n},Ut.HTMLVideoSupport),t&&o.createElement(O.Spinner,null))}function a({attachment:e}){const[t,i]=m(),n=`${(0,jt.useAttachmentUri)(e)}?fileName=${e.OriginalName}&download=false#toolbar=0`;return o.createElement(o.Fragment,null,o.createElement("object",{data:n,className:"attachment-preview-window-content",type:"application/pdf",onLoad:i},o.createElement("iframe",{src:n,className:"attachment-preview-window-content",onLoad:i})),t&&o.createElement(O.Spinner,null))}function s({onDownloadClick:e}){(0,Bt.useAssetLocation)("ms.vss-work-web/new-work-item-form-content/Content/preview-unavailable.svg");return o.createElement("div",{className:"attachment-preview-unavailable"},o.createElement(j.ZeroData,{iconProps:{iconName:"FileBug"},imageAltText:Ut.AttachmentNoPreview,primaryText:Ut.AttachmentNoPreview,actionText:Ut.DownloadAttachment,actionType:0,onActionClick:e}))}function m(){const[e,t]=(0,o.useState)(!0),[i,n]=(0,o.useState)(!0);(0,o.useEffect)((()=>{setTimeout((()=>n(!1)),200)}),[]);return[e&&!i,(0,o.useCallback)((()=>t(!1)),[])]}ho=t[e]={},t[e].AttachmentPreview=function({attachment:e,onEditComment:t,onDismiss:m,onDeleteAttachment:c,onDownloadAttachment:d,onNext:u,onPrevious:h}){const p=(0,o.useRef)(null),g=(0,o.useCallback)((e=>{e.target===p.current&&m()}),[m]),k=(0,o.useMemo)((()=>{if(!e.OriginalName)return null;switch((0,zt.getAttachmentPreviewType)(e.OriginalName)){case"Text":return o.createElement(i,{attachment:e});case"Image":return o.createElement(n,{attachment:e});case"Video":return o.createElement(r,{attachment:e});case"PDF":return o.createElement(a,{attachment:e});default:return o.createElement(s,{onDownloadClick:()=>d(e)})}}),[e]);return o.createElement(B.Callout,{modal:!0,className:"attachment-preview-modal-backdrop",onDismiss:m},o.createElement("header",{className:"attachment-preview-header flex-row flex-center justify-space-between"},o.createElement("span",{className:"margin-horizontal-20"},e.OriginalName),o.createElement("span",null,t&&o.createElement(l.Button,{subtle:!0,text:Ut.EditComment,onClick:()=>t(e),iconProps:{iconName:"Edit"}}),o.createElement(l.Button,{subtle:!0,text:Ut.DownloadAttachment,onClick:()=>d(e),iconProps:{iconName:"Download"}}),c&&o.createElement(l.Button,{subtle:!0,text:Ut.Delete,onClick:()=>c(e),iconProps:{iconName:"Delete"}}),o.createElement(l.Button,{subtle:!0,onClick:m,iconProps:{iconName:"Clear"}}))),o.createElement("section",{className:"attachment-preview-content-area flex-row",onClick:g,ref:e=>p.current=e},o.createElement(l.Button,{subtle:!0,className:"previous-button",iconProps:{iconName:"ChevronLeft"},onClick:h}),o.createElement("div",{className:"attachment-preview-content"},k),o.createElement(l.Button,{subtle:!0,className:"next-button",iconProps:{iconName:"ChevronRight"},onClick:u})))}}("AttachmentsDialogsAttachmentPreview"),function(e){po=t[e]={},t[e].DeleteAttachmentDialog=function({attachmentName:e,onConfirmDelete:t,onDismiss:i}){return o.createElement(h.Dialog,{lightDismiss:!0,escDismiss:!0,titleProps:{text:Ut.DeleteAttachment},footerButtonProps:[{text:Ut.ConfirmDeleteAttachment,onClick:t,primary:!0},{text:Ut.CancelDeleteAttachment,onClick:i}],onDismiss:i},(0,s.format)(Ut.ConfirmDeleteAttachmentPrompt,e))}}("AttachmentsDialogsDeleteAttachmentDialog"),function(e){go=t[e]={},t[e].AttachmentsTab=function(e){return o.createElement("div",{className:"work-item-form-tab full-width"},o.createElement(io.CollapsibleSection,{label:Ut.Attachments},o.createElement(i,Object.assign({},e))))};class i extends o.Component{constructor(e,t){if(super(e),!t.pageContext||null===t.workItem)throw new Error("WorkItemFormPageContext can only be used inside a WorkItemFormPageContextProvider");this.context=t,this._workItem=t.workItem,this._isWorkItemReadOnly=this._workItem.isReadOnly(),this._attachmentsService=t.pageContext.getService("IWorkItemFormAttachmentsService"),this._fileInputRef=o.createRef(),this.state={viewType:"grid",previewingIndex:-1,editingIndex:-1,deletingIndex:-1},this._attachments=this._attachmentsService.getAttachmentsObservable(this._workItem)}onAddAttachment(){var e;null===(e=this._fileInputRef.current)||void 0===e||e.click()}onCommitComment(e,t){this._attachmentsService.editComment(this._workItem,e,t),this.setState({editingIndex:-1})}onPreviewAttachment(e){this.setState({previewingIndex:this._attachments.value.findIndex((t=>t.FilePath===e.FilePath))})}previewNextAttachment(){if(this.state.previewingIndex<0)return;const e=(this.state.previewingIndex+1)%this._attachments.value.length;this.setState({previewingIndex:e})}previewPreviousAttachment(){if(this.state.previewingIndex<0)return;const e=this.state.previewingIndex>0?this.state.previewingIndex-1:this._attachments.value.length-1;this.setState({previewingIndex:e})}onEditComment(e){this.setState({editingIndex:this._attachments.value.findIndex((t=>t.FilePath===e.FilePath))})}onDownloadAttachment(e){this.context.pageContext&&this.context.workItem&&(0,zt.downloadAttachment)(this.context.pageContext,this.context.workItem,e)}onDeleteAttachment(e){this.setState({deletingIndex:this._attachments.value.findIndex((t=>t.FilePath===e.FilePath))})}onConfirmDelete(e){this._attachmentsService.deleteAttachment(this._workItem,e),this.setState({deletingIndex:-1,previewingIndex:-1})}onCopyAttachmentUrl(e){var t,i;if(!(null===(t=this.context)||void 0===t?void 0:t.pageContext)||!(null===(i=this.context)||void 0===i?void 0:i.workItem))return"";(0,jt.getAttachmentUri)(this.context.pageContext,this.context.workItem.project.guid,e).then((t=>{var i,n;const r=null!==(n=null!==(i=e.OriginalName)&&void 0!==i?i:e.FilePath)&&void 0!==n?n:"";t+=`?fileName=${r}&download=true`;const a=o.createElement(V.Link,{href:t,download:r},r);(0,z.copyToClipboard)(a)}))}render(){return o.createElement(o.Fragment,null,o.createElement("input",{ref:this._fileInputRef,type:"file",multiple:!0,style:{display:"none"},onChange:e=>{const t=e.target.files;t&&t.length&&this._attachmentsService.attachFiles(this._workItem,Array.from(t))}}),o.createElement(c.Observer,{attachments:this._attachments},(({attachments:e})=>o.createElement(o.Fragment,null,0===e.length?this.renderZeroData():this.renderMainContent(),this.renderDialogs(e)))))}renderZeroData(){const e={iconProps:{iconName:"Attach"},imageAltText:Ut.AttachmentsZeroData,secondaryText:Ut.AttachmentsZeroData};return this._isWorkItemReadOnly||(e.actionText=Ut.AddAttachment,e.actionType=0,e.onActionClick=()=>this.onAddAttachment()),o.createElement(j.ZeroData,Object.assign({},e))}renderMainContent(){const e={onPreviewAttachment:e=>this.onPreviewAttachment(e),onDownloadAttachment:e=>this.onDownloadAttachment(e),onCopyAttachmentUrl:e=>this.onCopyAttachmentUrl(e)};return this._isWorkItemReadOnly||(e.onDeleteAttachment=e=>this.onDeleteAttachment(e),e.onEditComment=e=>this.onEditComment(e)),o.createElement(o.Fragment,null,o.createElement("div",{className:"flex-row justify-space-between"},o.createElement(l.Button,{className:"add-attachment-button",subtle:!0,disabled:this._isWorkItemReadOnly,text:Ut.AddAttachment,iconProps:{iconName:"Add"},onClick:()=>this.onAddAttachment()}),o.createElement(co.AttachmentsViewToggle,{className:"flex-self-end",viewType:this.state.viewType,onViewTypeChanged:e=>this.setState({viewType:e})})),"grid"===this.state.viewType?o.createElement(mo.AttachmentsGrid,Object.assign({attachments:this._attachments},e)):o.createElement(uo.AttachmentThumbnails,Object.assign({attachments:this._attachments},e)))}renderDialogs(e){var t,i;return o.createElement(o.Fragment,null,this.state.previewingIndex>-1&&o.createElement(ho.AttachmentPreview,{attachment:e[this.state.previewingIndex],onEditComment:this._isWorkItemReadOnly?void 0:e=>this.onEditComment(e),onDeleteAttachment:this._isWorkItemReadOnly?void 0:e=>this.onDeleteAttachment(e),onDownloadAttachment:e=>this.onDownloadAttachment(e),onDismiss:()=>this.setState({previewingIndex:-1}),onPrevious:()=>this.previewPreviousAttachment(),onNext:()=>this.previewNextAttachment()}),this.state.editingIndex>-1&&o.createElement(io.EditCommentDialog,{comment:null!==(t=e[this.state.editingIndex].Comment)&&void 0!==t?t:"",onCommitComment:t=>this.onCommitComment(e[this.state.editingIndex],t),onDismiss:()=>this.setState({editingIndex:-1})}),this.state.deletingIndex>-1&&o.createElement(po.DeleteAttachmentDialog,{attachmentName:null!==(i=e[this.state.deletingIndex].OriginalName)&&void 0!==i?i:"",onConfirmDelete:()=>this.onConfirmDelete(e[this.state.deletingIndex]),onDismiss:()=>this.setState({deletingIndex:-1})}))}}t[e].AttachmentsSection=i,i.contextType=Bt.WorkItemFormPageContext}("AttachmentsAttachmentsTab"),ko=t.Attachmentsindex={},__exportStar(go,t.Attachmentsindex),vo=t.CommonHtmlUtils={},t.CommonHtmlUtils.htmlDecode=function(e){const t=document.createElement("textarea");return t.innerHTML=e,t.value},function(e){fo=t.CommonImageUploader={};const o=["jpg","jpeg","png","bmp","gif","tif","tiff"],i={"image/jpg":"jpg","image/jpeg":"jpg","image/png":"png","image/bmp":"bmp","image/gif":"gif","image/tif":"tif","image/tiff":"tif"};function n(e){return new RegExp("^.*("+o.join("|")+")$").test(e.toLowerCase())}function a(){return(0,s.format)(Ut.InsertImageInvalidFileType,o.join(", "))}t.CommonImageUploader.ImageUploader=class{constructor(e,t){this._pageContext=e,this._workItem=t}async upload(e,t){var o,s;if(!e||!n(e.type)){const e=a();return alert(e),Promise.reject(e)}const l=(0,r.getWorkItemTrackingClient)(this._pageContext),m=t?void 0:this._workItem.getFieldValueById(y.DalFields.AreaPathId),c=("function"==typeof e.slice&&e.size,null!==(s=null!==(o=e.name)&&void 0!==o?o:"image."+i[e.type])&&void 0!==s?s:"png"),d=l.createAttachment(e,this._workItem.project.guid,c,"Simple",m);this._workItem.addPromiseToWait(d);return(await d).url}},t.CommonImageUploader.isValidFileType=n,t.CommonImageUploader.getInvalidFileTypeMessage=a}(),function(e){Io=t.CommonRoutingUtils={};const o="ms.vss-work-web.new-work-item-form-route";t.CommonRoutingUtils.getWorkItemFormTitle=function(e){var t,o;return e?(t=e.getCaption({includeDirtyModifier:!0}),(o=e.getTitle())&&o.length>128&&(o=o.substr(0,128)+"..."),`${t} ${o}`):""},t.CommonRoutingUtils.getWorkItemEditUrl=function(e,t){var i,r;const a={project:(null===(r=null===(i=(0,_.getTFSPageData)(e))||void 0===i?void 0:i.project)||void 0===r?void 0:r.name)||"",id:t};return(0,n.routeUrl)(e,o,a)},t.CommonRoutingUtils.isNewWorkItemFormRoute=function(e){return e.getService("IVssNavigationService").getCurrentRoute().routeId===o},t.CommonRoutingUtils.getWorkItemHubUrl=function(e){var t,o;const i={project:(null===(o=null===(t=(0,_.getTFSPageData)(e))||void 0===t?void 0:t.project)||void 0===o?void 0:o.name)||""};return(0,n.routeUrl)(e,"ms.vss-work-web.new-work-items-hub-view-route",i)}}(),function(e){t.CommonServicesWorkItemFormCommentService={};class o extends W.VssService{constructor(){super(...arguments),this.internalWorkItemData={},this.observableComments={},this.alwaysEmpty=new b.ReadyableObservableArray([],!0)}_serviceStart(e){super._serviceStart(e),this.witRestClient=(0,r.getWorkItemTrackingClient)(e),this.workItemFormService=e.getService("IWorkItemFormService"),this.displayNameTranslationService=e.getService("display-name-storage-key-translation-service"),this.personaDetailsProvider=new K.PersonaDetailsProvider(e)}getObservable(e){var t;return e.isNew()?this.alwaysEmpty:(this.internalWorkItemData[e.id]||(this.internalWorkItemData[e.id]={},this.internalWorkItemData[e.id].lastRevisionSeen=null===(t=e.revision)||void 0===t?void 0:t.value),this.observableComments[e.id]||(this.observableComments[e.id]=new b.ReadyableObservableArray([],!1)),this.observableComments[e.id])}resetCommentsData(e){var t;e.isNew()||(this.internalWorkItemData[e.id]={lastRevisionSeen:null===(t=e.revision)||void 0===t?void 0:t.value})}async getComments(e,t){var o;if(e.isNew())return;const i=this.getObservable(e);let n=!1;this.internalWorkItemData[e.id]&&this.internalWorkItemData[e.id].lastRevisionSeen&&this.internalWorkItemData[e.id].lastRevisionSeen!=e.revision.value&&(n=!0,this.resetCommentsData(e));const r=this.internalWorkItemData[e.id].totalComments;if(this.commentPromise)return this.commentPromise;if(void 0===i.value||n||i.value&&t>i.length&&(void 0===r||i.length<r)){const r=null!==(o=i.length)&&void 0!==o?o:0,a=this.witRestClient.getComments(e.project.guid,e.id,t-(n?0:r),this.internalWorkItemData[e.id].continuationToken,!1,-17,2);this.commentPromise=a,i.ready.value=!1;const s=await a;let l=null;if((0,q.isFeatureFlagEnabled)(this.pageContext,Z.FeatureFlags.IsMarkdownDiscussionEnabled,!1)){l=[];for(let e of s.comments){if(e.mentions)for(let t of e.mentions){if(this.displayNameTranslationService.isStorageKeyAlreadyAdded(t.targetId))continue;const e=await this.personaDetailsProvider.getEntityFromUniqueAttribute(t.targetId);if(!e)continue;const o=this.displayNameTranslationService.getIdentityId(e);this.displayNameTranslationService.addDisplayNameAndStorageKey(o,t.targetId)}e.text=await(0,$.translateStorageKeysToDisplayNames)(this.pageContext,e.text),l.push({comment:e,reactionPromises:{},reactions:(0,G.createReactionsMap)(e.reactions)})}}else l=s.comments.map((e=>({comment:e,reactionPromises:{},reactions:(0,G.createReactionsMap)(e.reactions)})));return!i.value||n?i.value=l:i.push(...l),this.internalWorkItemData[e.id].continuationToken=s.continuationToken,this.internalWorkItemData[e.id].totalComments=s.totalCount,this.commentPromise=void 0,void(i.ready.value=!0)}}async syncCommentReactions(e,t){const o=this.getObservable(e),i=o.value.findIndex((e=>e.comment.id===t));if(-1===i)return;const n=await this.witRestClient.getCommentReactions(e.project.guid,e.id,t);o.change(i,Object.assign(Object.assign({},o.value[i]),{reactions:(0,G.reactionsToReactionMap)(n)}))}getTotalCommentsInWorkItem(e){return e.isNew()?0:this.internalWorkItemData[e.id].totalComments}async addComment(e,t){const o=(0,q.isFeatureFlagEnabled)(this.pageContext,Z.FeatureFlags.IsMarkdownDiscussionEnabled,!1)?0:1,i={text:0==o?(0,Y.filterXSS)(t,X.htmlSanitizerPreserveMentionOptions):t};this.workItemFormService.resetHistoryData();return this.witRestClient.addWorkItemComment(i,e.project.guid,e.id,o)}async deleteComment(e,t){await this.witRestClient.deleteComment(e.project.guid,e.id,t),this.workItemFormService.resetHistoryData()}async updateComment(e,t,o,i){const n={text:0==i?(0,Y.filterXSS)(o,X.htmlSanitizerPreserveMentionOptions):o},r=await this.witRestClient.updateWorkItemComment(n,e.project.guid,e.id,t,null!=i?i:1);return this.workItemFormService.resetHistoryData(),r}async getRecentlyReactedUsers(e,t,o,i){var n;const r=this.observableComments[e.id],a=null===(n=null==r?void 0:r.value)||void 0===n?void 0:n.find((e=>e.comment.id===t)),s=null==a?void 0:a.reactions[o];if(s&&0===s.engagedUsers.length&&!(null==a?void 0:a.reactionPromises[o])){const n=this.witRestClient.getEngagedUsers(e.project.guid,e.id,t,o,i);a.reactionPromises[o]=n;const l=await n;s.engagedUsers=l.map((e=>({identityId:e.id,identityDisplayName:e.displayName}))),r.value=r.value}}_resetEngagedUsers(e,t,o){var i;const n=this.observableComments[e.id],r=null===(i=null==n?void 0:n.value)||void 0===i?void 0:i.find((e=>e.comment.id===t));if(r){r.reactionPromises[o]=void 0;const e=(0,G.createReactionsMap)(r.comment.reactions);r.reactions[o]=e[o]}}async createCommentReaction(e,t,o){var i,n;const r=o,a=this.getObservable(e);await this.witRestClient.createCommentReaction(e.project.guid,e.id,t,r);const s=null===(n=null===(i=a.value)||void 0===i?void 0:i.find((e=>e.comment.id==t)))||void 0===n?void 0:n.comment;if(s)if(s.reactions){const e=s.reactions.find((e=>e.type===r));e?(e.count++,e.isCurrentUserEngaged=!0):(s.reactions||(s.reactions=[]),s.reactions.push({commentId:s.id,count:1,isCurrentUserEngaged:!0,type:r,_links:void 0,url:""}))}else s.reactions=[{commentId:s.id,count:1,isCurrentUserEngaged:!0,type:r,_links:void 0,url:""}];this._resetEngagedUsers(e,t,r)}async deleteCommentReaction(e,t,o){var i,n;const r=o,a=this.getObservable(e);await this.witRestClient.deleteCommentReaction(e.project.guid,e.id,t,r);const s=null===(n=null===(i=a.value)||void 0===i?void 0:i.find((e=>e.comment.id==t)))||void 0===n?void 0:n.comment;if(s){const e=s.reactions.find((e=>e.type===r));e&&(e.count--,e.isCurrentUserEngaged=!1)}this._resetEngagedUsers(e,t,r)}}W.Services.add("IWorkItemFormCommentService",{serviceFactory:o})}(),function(e){t.CommonServicesWorkItemFormService={};class o extends W.VssService{constructor(){super(...arguments),this.workItemHistoryPromise=new b.ObservableValue(void 0)}_serviceStart(e){this.contributionService=e.getService("IVssContributionService"),this.pageContext=e}getWorkItemFormLayout(e){const t=e.rules.form;if(!t)throw new Error("Work item form layout not found");const o=(0,J.deserializeVssJsonObject)(String(t))||void 0;if(!o)throw new Error("Could not deserialize work item form layout");return o}resetHistoryData(){this.workItemHistoryPromise.value=void 0}getHistoryData(e,t){if(!this.workItemHistoryPromise.value||!this.historyPromiseWorkItemId||this.historyPromiseWorkItemId!==e){const o={Id:e,ProjectId:t};this.historyPromiseWorkItemId=e,this.workItemHistoryPromise.value=this.contributionService.getDataAsync("ms.vss-work-web.work-item-form-history-data-provider",o,!0).then((e=>null!=e?e:[]))}return this.workItemHistoryPromise.value}getTagsData(e){if(!this.workItemTagsPromise){const t={projectScope:e};this.workItemTagsPromise=this.contributionService.getDataAsync("ms.vss-work-web.work-item-tag-suggestions-data-provider",t,!0).then((e=>e||[]))}return this.workItemTagsPromise}}W.Services.add("IWorkItemFormService",{serviceFactory:o})}(),function(e){wo=t[e]={};function o(e,t){return e.getService("IVssPageService").getData().isHosted?(0,Q.useStorageKeysInMentions)(e)?t.displayName:null!=t.signInAddress?t.signInAddress:t.displayName:"Group"===t.entityType?`[${t.scopeName}]\\${t.samAccountName}`:`${t.scopeName}\\${t.samAccountName}`}t[e].createHtmlMention=function(e,t){if(!t||!t.displayName)return"";const i=t.displayName;let n,r,a;(0,Q.useStorageKeysInMentions)(e)?(n="2.0",r=t.localId,a="#"):(n="1.0",a=`mailto:${o(e,t)}`,t&&"Group"===t.entityType&&t.localId&&(r="id:"+t.localId));let s="version:"+n;r&&(s+=","+r);const l=document.createElement("a");return l.setAttribute("href",a),l.setAttribute("data-vss-mention",s),l.text="@"+i,l.outerHTML+"&nbsp;"},t[e].getIdentityId=o}("DetailsDiscussionMentionUtils"),function(e){yo=t[e]={};t[e].MarkdownConversionPreviewDialog=function({commentToConvert:e}){var t,i;const[n,r]=o.useState(),[a,s]=o.useState(!1),l=null===(t=e.value)||void 0===t?void 0:t.htmlComment;return o.useEffect((()=>{const e=async()=>{if(l){r(void 0),s(!1);try{const e=await(e=>new Promise(((t,o)=>{var i,n;try{const o=document.createElement("div");o.innerHTML=e;const r=o.querySelectorAll("a[data-vss-mention]");for(let e=0;e<r.length;++e){const t=r[e];let o=null;const a=t.getAttribute("href"),s=t.innerHTML;if(null==a?void 0:a.match(/^.*\/pullrequest\/[0-9]+$/gi)){const e=a.split("/").pop();o=e?document.createTextNode(`!${e}`):null}if(null==s?void 0:s.match(/^#[0-9]+$/gi)){const e=s.substring(1);o=e?document.createTextNode(`#${e}`):null}if(null==s?void 0:s.match(/^@.+$/gi)){const e=null===(i=t.getAttribute("data-vss-mention"))||void 0===i?void 0:i.split(",").pop();o=e?document.createTextNode(`@<${e}>`):null}o&&(null===(n=t.parentElement)||void 0===n||n.insertBefore(o,t),t.remove())}t(o.innerHTML)}catch(e){o(e)}})))(l),t=await(e=>new Promise(((t,o)=>{try{t((new ee).turndown(e))}catch(e){o(e)}})))(e);r(t)}catch(e){s(!0)}}else r(void 0)};setTimeout((()=>e()),0)}),[l]),(null===(i=e.value)||void 0===i?void 0:i.htmlComment)?o.createElement(h.Dialog,{titleProps:{text:Ut.ConvertedCommentTitle},onDismiss:()=>{e.value=void 0},footerButtonProps:[{text:Ut.LabelCancel,onClick:()=>{e.value=void 0}},{text:Ut.LabelConvert,primary:!0,disabled:void 0===n,onClick:()=>{e.value={markdownComment:n,htmlComment:e.value.htmlComment}}}],calloutContentClassName:"markdown-conversion-preview-dialog-callout-content"},void 0!==n?o.createElement(Qt.WorkItemFormCommentPreview,{content:n,refreshThrottleMs:void 0,setContentOnInitialRender:!0}):a?o.createElement(te.MessageCard,{severity:"Error"},Ut.CommentConvertingError):o.createElement(O.Spinner,{size:"small",label:Ut.CommentConverting})):null}}("CommonComponentsMarkdownConversionPreviewDialog"),function(e){Co=t[e]={};t[e].WorkItemFormHistoricalComment=e=>{var t;const n="wit-historical-comment-"+e.comment.id+"-"+e.comment.version;return o.createElement(oe.CommentItem,{artifactInfo:e.artifactInfo,canEdit:e.canEdit,className:(0,u.css)("displayed-comment",(0,q.isFeatureFlagEnabled)(e.pageContext,Z.FeatureFlags.IsMarkdownDiscussionEnabled,!1)&&"depth-8 markdown-discussion-comment"),comment:e.comment,baseUrl:e.baseUrl,isEditing:!1,isReactionsEnabled:!0,key:n,onAddReaction:(t,o,i)=>{e.createCommentReaction(t,o)},onCancelEdit:(t,o)=>{e.cancelEdit(t,o)},onConfirmDelete:(t,o)=>{o&&e.deleteComment(t)},onDeleteReaction:(t,o,i)=>{e.deleteCommentReaction(t,o)},onGetRecentlyReactedUsers:(t,o,i)=>{e.getRecentlyReactedUsers(t,o,i)},onPostRenderContent:(t,o)=>{(0,ne.makeAllWorkItemHyperlinksClickable)(o,e.pageContext),(0,ie.convertRawMentionsToRichPreviews)(o,e.pageContext)},onRenderCommentBody:0==(null===(t=e.comment.format)||void 0===t?void 0:t.value)?e=>o.createElement(i,{content:e}):void 0,onStartEdit:t=>{e.startEdit(t)},onUpdate:(t,o,i)=>{e.update(t,o,i)},onRenderPersona:t=>e.renderPersona(t),readonly:!1,reactionTypeToInfoMap:e.commentWithReactions.reactions,viewerContentClassName:"h-scroll-auto",tooltipTimeFormat:M.tooltipTimeFormat,currentDate:(0,M.getDateInUserTimeZone)()})};const i=e=>o.useMemo((()=>{const t=(0,vo.htmlDecode)(e.content);return o.createElement(Qt.WorkItemFormCommentPreview,{content:t,className:"comment-content"})}),[e.content])}("DetailsWorkItemFormHistoricalComment"),function(e){bo=t[e]={};class i extends o.Component{constructor(e,t){if(super(e),this.editingCommentId=new b.ObservableValue(void 0),this.editingCommentContent=new b.ObservableValue(""),this.editingCommentFormat=new b.ObservableValue(void 0),this.editingCommentError=new b.ObservableValue(null),this.commentsToShow=50,this.newCommentContent=new b.ObservableValue(""),this.newCommentError=new b.ObservableValue(null),this.commentToConvert=new b.ObservableValue(void 0),this.renderPersona=e=>o.createElement(D.Persona,{className:"margin-8",identity:e,size:this.isMarkdownDiscussionEnabled()?24:40,personaProvider:this.personaDetailsProvider}),this.onNewWorkItemSave=()=>{this.forceUpdate(),this.workItem.revision.unsubscribe(this.onNewWorkItemSave)},this.onWorkItemSave=()=>{this.newCommentEditor&&!this.workItem.getFieldUpdates()[y.DalFields.HistoryId]&&(this.newCommentEditor.setContent(""),this.newCommentContent.value="",this.editingCommentContent.value="",this.setState({isNewCommentEmpty:!0,isNewCommentActive:!1,isNewCommentSaving:!1})),this.updateComments()},this.renderNewCommentButtons=()=>o.createElement(c.Observer,{workItemInfoText:this.workItem.infoText},(e=>o.createElement("div",{className:"comment-message-button-area"},o.createElement(l.Button,{ariaLabel:re.Cancel,className:"editor-cancel-button",onClick:this.onCancelCommentClick,disabled:this.state.isNewCommentSaving,text:re.Cancel}),o.createElement(l.Button,{ariaLabel:Ut.Save,onClick:this.onSaveCommentClick,disabled:e.workItemInfoText.invalid||this.state.isNewCommentEmpty||this.state.isNewCommentSaving,primary:!0,text:Ut.Save})))),this.onSaveCommentClick=()=>{var e;const t=this.newCommentEditor.getValue();this.setState({isNewCommentSaving:!0}),null===(e=this.newCommentEditor)||void 0===e||e.setEnabled(!1),this.addComment(t)},this.onCancelCommentClick=()=>{var e;this.userChangedValue(""),null===(e=this.newCommentEditor)||void 0===e||e.setContent(""),this.newCommentContent.value="",this.setState({isNewCommentEmpty:!0,isNewCommentActive:!1})},this.getCommentPreview=(e,t)=>this.isMarkdownDiscussionEnabled()&&o.createElement(c.Observer,{commentContent:e,commentFormat:t},(e=>0===(null==t?void 0:t.value)?o.createElement(Qt.WorkItemFormCommentPreview,{className:"markdown-preview",content:e.commentContent}):null)),this.startEdit=e=>{this.editingCommentId.value=e,this.editingCommentContent.value=""},this.cancelEdit=(e,t)=>{this.editingCommentId.value=void 0,this.editingCommentContent.value=""},this.update=(e,t,o,i)=>{const n=(0,$.translateDisplayNamesToStorageKeys)(this._pageContext,t);this.workItemFormCommentService.updateComment(this.workItem,e,n,null==i?void 0:i.value).then((()=>{this.editingCommentId.value=void 0,this.editingCommentContent.value="",this.workItem.revision.value++})).catch((e=>{this.workItem.setError(e)}))},this.getRecentlyReactedUsers=(e,t,o)=>{this.workItemFormCommentService.getRecentlyReactedUsers(this.workItem,e,t,o)},this.deleteComment=e=>{this.workItemFormCommentService.deleteComment(this.workItem,e).then((()=>{this.workItem.revision.value++})).catch((e=>{this.workItem.setError(e)}))},this.createCommentReaction=(e,t)=>{this.workItemFormCommentService.createCommentReaction(this.workItem,e,t).then((()=>{this.forceUpdate()}))},this.deleteCommentReaction=(e,t)=>{this.workItemFormCommentService.deleteCommentReaction(this.workItem,e,t).then((()=>{this.forceUpdate()}))},this.focusAndScrollToDiscussion=()=>{this.context.focusDiscussion&&this.newCommentEditor&&this.newCommentDiv&&"hidden"!==window.getComputedStyle(this.newCommentDiv).visibility&&-1===this.newCommentDiv.className.indexOf("fullscreen-enabled")&&(this.newCommentEditor.focus(),this.newCommentDiv.scrollIntoView(!0),this.context.updateFocusDiscussion(!1))},this.onNewCommentBlur=()=>{const e=this.newCommentEditor.getValue();this.setState({isNewCommentActive:null!=e&&""!==e})},this.createMarkdownMention=e=>`@<${e}> `,this.getMentionString=(e,t)=>{if(this.isMarkdownDiscussionEnabled()){const o=this.displayNameTranslationService.getIdentityId(e);return this.createMarkdownMention(this.displayNameTranslationService.addDisplayNameAndStorageKey(o,t))}return(0,wo.createHtmlMention)(this._pageContext,e)},this.onNewCommentFocus=async()=>{var e,t;if(this.setState({isNewCommentActive:!0}),(0,q.isFeatureFlagEnabled)(this._pageContext,"WebAccess.WorkItemTracking.MentionsReplyAll",!1)){const o=this.workItemFormCommentService.getObservable(this.workItem).value;if(o.length){const i=o[0].comment,n=null!==(e=i.mentions)&&void 0!==e?e:[],r=new Set,a=[];for(const e of n)"Person"===e.artifactType&&(r.has(e.targetId)||a.push(e));const l=i.createdBy,m=this._pageContext.getService("IVssPageService").getData().user;if(a.length>0&&l&&m&&this.newCommentEditor){const e=this.newCommentEditor.isEmpty(),o=l.displayName,i=l.id,n=a.some((e=>e.targetId.toUpperCase()===m.id.toUpperCase()));if(e&&n&&o&&i&&i!==s.EmptyGuidString){const e=await this.personaDetailsProvider.getEntityFromUniqueAttribute(i);let o=this.getMentionString(e,i);for(const e of a){if(e.targetId.toUpperCase()===i.toUpperCase()||e.targetId.toUpperCase()===m.id.toUpperCase())continue;const t=await this.personaDetailsProvider.getEntityFromUniqueAttribute(e.targetId);o+=this.getMentionString(t,e.targetId)}this.newCommentEditor.isEmpty()&&(this.newCommentEditor.setContent(o),this.newCommentEditor.selectAll(),null===(t=window.getSelection())||void 0===t||t.collapseToEnd())}}}}},!t.pageContext||null===t.workItem)throw new Error("WorkItemFormPageContext can only be used inside a WorkItemFormPageContextProvider");this._pageContext=t.pageContext,this.workItem=t.workItem,this.workItemFormCommentService=t.pageContext.getService("IWorkItemFormCommentService"),this.displayNameTranslationService=t.pageContext.getService("display-name-storage-key-translation-service"),this.sectionSettingsKey=`${this.workItem.getFieldByName(y.CoreFieldRefNames.WorkItemType)}/Discussion-Section`,this.personaDetailsProvider=new K.PersonaDetailsProvider(t.pageContext),this.state={isNewCommentEmpty:!0,isNewCommentActive:!1,isNewCommentSaving:!1},this.workItemEventService=t.pageContext.getService("IWorkItemEventService")}getWorkItemUrl(){if(!this.workItem.isNew()){const e="ms.vss-work-web.new-work-item-form-route",t={project:this.workItem.project.name||"",id:this.workItem.id.toString()};return(0,n.routeUrl)(this._pageContext,e,t)}}componentDidMount(){if(this.workItem.isNew()?this.workItem.revision.subscribe(this.onNewWorkItemSave):this.workItemFormCommentService.getComments(this.workItem,this.commentsToShow),this.workItem.revision.subscribe(this.onWorkItemSave),document.addEventListener("wif-focus-discussion",this.focusAndScrollToDiscussion),this.workItemEventService.subscribe((({workItem:e})=>this.processWorkItemReset(e)),de.IWorkItemEventType.WorkItemReset),this.isMarkdownDiscussionEnabled()){const e=this.workItem.getFieldUpdates()[y.DalFields.HistoryId];e&&(this.newCommentContent.value=e,this.setState({isNewCommentEmpty:!1}))}}processWorkItemReset(e){var t;e&&this.workItem&&e.id===this.workItem.id&&this.newCommentEditor&&(null===(t=this.newCommentEditor)||void 0===t||t.setContent(""),this.newCommentContent.value="",this.editingCommentContent.value="",this.setState({isNewCommentEmpty:!0,isNewCommentActive:!1,isNewCommentSaving:!1}))}componentWillUnmount(){document.removeEventListener("wif-focus-discussion",this.focusAndScrollToDiscussion),this.workItem.revision.unsubscribe(this.onWorkItemSave),this.workItem.revision.unsubscribe(this.onNewWorkItemSave),this.workItemEventService.unsubscribe((({workItem:e})=>this.processWorkItemReset(e)),de.IWorkItemEventType.WorkItemReset)}getNewCommentEditor(e,t,i,n){const r=this.workItem.getFieldUpdates()[y.DalFields.HistoryId];let a=this.isCommentPermissionCheckEnabled()&&this.newCommentEditor?this.newCommentEditor.getValue():"";r&&(a=r);const s=`wit-${e}${this.workItem.revision.value}`;return o.createElement("div",{className:(0,u.css)("comment-editor",e)},this.isMarkdownDiscussionEnabled()?o.createElement(c.Observer,{newCommentError:this.newCommentError},(r=>o.createElement(o.Fragment,null,o.createElement(me.WorkItemFormMarkdownEditorMemoized,{key:s,className:(0,u.css)("markdown-editor",e),value:this.newCommentContent,placeholder:Ut.WorkItemDiscussionAddComment,ariaLabel:Ut.DiscussionLabel,onChange:e=>{this.newCommentContent.value=e,i(e,!0)},ref:n,onFocus:this.onNewCommentFocus,onBlur:this.onNewCommentBlur,uploadImage:e=>t.upload(e,this.isCommentPermissionCheckEnabled()),error:r.newCommentError,onError:e=>this.newCommentError.value=e}),o.createElement("div",{className:"flex-row flex-wrap toolbal-area"},o.createElement(ce.WorkItemFormMarkdownToolbar,{pageContext:this._pageContext,getTextSource:()=>this.newCommentEditor,uploadImage:e=>t.upload(e,this.isCommentPermissionCheckEnabled()),hide:!this.state.isNewCommentActive,debounceHideMs:100}),this.isNewCommentButtonsAvailable()&&this.renderNewCommentButtons())))):o.createElement(o.Fragment,null,o.createElement(le.HtmlEditor,{className:e,key:s,ariaLabel:Ut.DiscussionLabel,placeholder:Ut.WorkItemDiscussionAddComment,htmlContent:a,helpText:Ut.InviteToComment,onChange:e=>{this.newCommentContent.value=e,i(e,!1)},onFocus:this.onNewCommentFocus,onBlur:this.onNewCommentBlur,ref:n,telemetryContext:{controlName:"HtmlEditor"},showChromeBorder:!0,uploadImageHandler:e=>t.upload(e,this.isCommentPermissionCheckEnabled())}),this.isNewCommentButtonsAvailable()&&this.renderNewCommentButtons()),this.getCommentPreview(this.newCommentContent,new b.ObservableValue(this.isMarkdownDiscussionEnabled()?0:1)))}isHtmlEmpty(e){if(!e)return!0;if(e.length>=100)return!1;const t=(new DOMParser).parseFromString(e,"text/html").documentElement.textContent;return 0===(null==t?void 0:t.trim().length)}render(){const{wide:e,width:t}=this.props,i=this._pageContext.getService("IVssPageService").getData().user,n=new fo.ImageUploader(this._pageContext,this.workItem),r=this.workItemFormCommentService.getObservable(this.workItem);return o.createElement("div",{className:(0,u.css)("wit-discussion-group inline-flex-column",e&&"wide"),style:{width:`${t}%`}},o.createElement(io.CollapsibleSection,{key:"wit-discussion-group",label:Ut.DiscussionLabel,settingsKey:this.sectionSettingsKey},o.createElement(c.Observer,{commentToConvert:this.commentToConvert},(e=>e.commentToConvert&&!e.commentToConvert.markdownComment?o.createElement(yo.MarkdownConversionPreviewDialog,{commentToConvert:this.commentToConvert}):null)),this.isNewCommentAvailable()&&o.createElement("div",{className:(0,u.css)("flex-row",this.isMarkdownDiscussionEnabled()&&"depth-8 markdown-discussion-comment",!this.isMarkdownDiscussionEnabled()&&"html-discussion-comment")},this.renderPersona(i),o.createElement(io.FullScreenSectionContext.Consumer,null,(({fullScreenContent:e})=>o.createElement("div",{key:"new-comment-observer",className:(0,u.css)("new-comment-div flex-column",e&&"fullscreen-enabled"),ref:e=>this.newCommentDiv=e},o.createElement(c.Observer,{watermark:this.workItem.revision},(()=>this.getNewCommentEditor("enter-new-comment",n,((e,t)=>{const o=t?!e||0===e.trim().length:this.isHtmlEmpty(e),i=!e;if(o){this.workItem.getFieldUpdates()[y.DalFields.HistoryId]&&this.userChangedValue("")}else this.userChangedValue(e);this.state.isNewCommentActive!==i&&this.state.isNewCommentEmpty===o||this.setState({isNewCommentEmpty:o,isNewCommentActive:!i})}),(e=>{e&&(this.newCommentEditor=e)})))))))),!this.workItem.isNew()&&o.createElement(c.Observer,{key:"historical-comments-observer",comments:r,editingCommentId:this.editingCommentId},(e=>{let t=e.comments.map((t=>{const r=t.comment,a={id:r.id,createdDate:r.createdDate,createdBy:r.createdBy,createdOnBehalfDate:r.createdOnBehalfDate,createdOnBehalfOf:r.createdOnBehalfOf,modifiedDate:r.modifiedDate,text:r.text,version:r.version,isDeleted:!1,reactions:[],format:new b.ObservableValue(r.format)},s="wit-historical-comment-"+a.id+"-"+a.version;if(void 0!==this.editingCommentId.value&&a.id==e.editingCommentId)return o.createElement("div",{className:(0,u.css)("flex-row",this.isMarkdownDiscussionEnabled()&&"depth-8 markdown-discussion-comment"),key:s},this.renderPersona(i),this.renderCommentEditor(s,a,n));{const r=location.origin+this.getWorkItemUrl();let l=a.createdBy.id===i.id&&!e.editingCommentId;this.isCommentPermissionCheckEnabled()&&(l=l&&this.workItem.isCommentingAvailable);const m={artifactKind:"workitemcomment",artifactId:""+a.id,projectId:this.workItem.project.guid};return o.createElement(Co.WorkItemFormHistoricalComment,{artifactInfo:m,canEdit:l,comment:a,baseUrl:r,key:s,imageUploader:n,commentWithReactions:t,pageContext:this._pageContext,renderPersona:this.renderPersona,createCommentReaction:this.createCommentReaction,cancelEdit:this.cancelEdit,deleteComment:this.deleteComment,deleteCommentReaction:this.deleteCommentReaction,startEdit:this.startEdit,update:this.update,getRecentlyReactedUsers:this.getRecentlyReactedUsers})}}));return t.push(this.renderShowMoreLink()),t})),!this.workItem.isNew()&&o.createElement(c.Observer,{ready:r.ready},(e=>e.ready?o.createElement(o.Fragment,null):o.createElement(O.Spinner,null)))))}isNewCommentAvailable(){return this.isCommentPermissionCheckEnabled()?this.workItem.isCommentingAvailable:!this.workItem.isReadOnly()}isCommentPermissionCheckEnabled(){return(0,q.isFeatureFlagEnabled)(this._pageContext,Z.FeatureFlags.UseSaveCommentsPermission,!1)}isMarkdownDiscussionEnabled(){return(0,q.isFeatureFlagEnabled)(this._pageContext,Z.FeatureFlags.IsMarkdownDiscussionEnabled,!1)}isNewCommentButtonsAvailable(){return this.isCommentPermissionCheckEnabled()&&this.workItem.isCommentingAvailable&&this.state.isNewCommentActive&&!this.workItem.isNew()}setMarkdownCommentEditor(e){this.markdownCommentEditor=e}renderCommentEditor(e,t,i){var n,r;return 0===(null===(n=t.format)||void 0===n?void 0:n.value)&&this.isMarkdownDiscussionEnabled()?this.editingCommentContent.value=(0,vo.htmlDecode)(t.text):this.editingCommentContent.value=t.text,this.editingCommentFormat.value=null===(r=t.format)||void 0===r?void 0:r.value,o.createElement("div",{className:"comment-wrapper"},o.createElement(ae.CommentEditor,{key:e+"-edit",className:"displayed-comment",comment:t,originalText:t.text,onCancelEdit:(e,t)=>{this.cancelEdit(e,t)},onUpdate:(e,o,i)=>{this.update(e,o,i,t.format)},infoMessage:this.isMarkdownDiscussionEnabled()&&o.createElement(c.Observer,{commentFormat:t.format},(e=>1===e.commentFormat?o.createElement(se.FormatComponent,{format:Ut.WorkItemCommentConvertToMarkdown},[o.createElement(V.Link,{key:"convert-to-markdown-key",onClick:()=>{this.commentToConvert.value={htmlComment:this.editingCommentContent.value};const e=o=>{void 0!==(null==o?void 0:o.markdownComment)&&(t.format.value=0,this.editingCommentContent.value=o.markdownComment),this.commentToConvert.unsubscribe(e)};this.commentToConvert.subscribe(e)}},Ut.WorkItemCommentConvertToMarkdownLinkText)]):o.createElement(ce.WorkItemFormMarkdownToolbar,{pageContext:this._pageContext,getTextSource:()=>this.markdownCommentEditor,uploadImage:e=>i.upload(e,this.isCommentPermissionCheckEnabled())}))),onRenderEditor:n=>{const r=o.createElement(le.HtmlEditor,{key:e+"-edit-html",className:"edit-comment",htmlContent:n.comment.text,helpText:Ut.InviteToComment,onChange:n.onChange,telemetryContext:{controlName:"HtmlEditor"},showChromeBorder:!0,editOnlyMode:!0,uploadImageHandler:e=>i.upload(e,this.isCommentPermissionCheckEnabled()),ref:e=>{n.ref(e)}});return this.isMarkdownDiscussionEnabled()?o.createElement(c.Observer,{commentFormat:t.format},(t=>0==t.commentFormat?o.createElement(c.Observer,{editingCommentError:this.editingCommentError},(t=>o.createElement(me.WorkItemFormMarkdownEditorMemoized,{key:e+"-edit-markdown",className:"edit-comment markdown-editor",value:this.editingCommentContent,placeholder:Ut.InviteToComment,ariaLabel:Ut.InviteToComment,onChange:e=>{this.editingCommentContent.value=e,n.onChange(e)},ref:e=>{n.ref(e),this.setMarkdownCommentEditor(e)},uploadImage:e=>i.upload(e,this.isCommentPermissionCheckEnabled()),error:t.editingCommentError,onError:e=>this.editingCommentError.value=e}))):r)):r}}),this.getCommentPreview(this.editingCommentContent,t.format))}renderShowMoreLink(){var e,t;const i=this.workItemFormCommentService.getObservable(this.workItem),n=null!==(t=null===(e=i.value)||void 0===e?void 0:e.length)&&void 0!==t?t:0,r=this.workItemFormCommentService.getTotalCommentsInWorkItem(this.workItem);return n<r&&i.ready?o.createElement("span",null,o.createElement(V.Link,{key:n+"-"+r,onClick:()=>{this.onClickShowMore()}},Ut.ShowMoreCommentsLink)," "+(0,s.format)(Ut.ShowMoreCommentsDetail,n,r)):null}onClickShowMore(){this.commentsToShow+=50,this.workItemFormCommentService.getComments(this.workItem,this.commentsToShow)}async addComment(e){var t,o;try{let i=e;this.isMarkdownDiscussionEnabled()&&(i=(0,$.translateDisplayNamesToStorageKeys)(this._pageContext,e)),await this.workItemFormCommentService.addComment(this.workItem,i),this.workItem.revision.value++,this.userChangedValue(""),null===(t=this.newCommentEditor)||void 0===t||t.setContent(""),this.newCommentContent.value="",this.setState({isNewCommentActive:!1})}catch(e){this.workItem.setError(e)}finally{this.setState({isNewCommentSaving:!1}),null===(o=this.newCommentEditor)||void 0===o||o.setEnabled(!0)}}userChangedValue(e){this.workItem.setFieldValueById(y.CoreField.History,e,{checkIsCommentingAvailable:this.isCommentPermissionCheckEnabled()})}updateComments(){this.workItemFormCommentService.getComments(this.workItem,this.commentsToShow).catch((e=>{this.workItem.infoText.value={text:Ut.FetchErrorRefreshPage,invalid:!0},console.error(e.message)}))}}t[e].WorkItemFormDiscussionGroup=i,i.contextType=Bt.WorkItemFormPageContext}("DetailsWorkItemFormDiscussionGroup"),function(e){Eo=t[e]={};function n(e,t,o){if(null==t?void 0:t.onLoaded){const o={id:e.id,isNew:e.isNew(),isReadOnly:e.isReadOnly()};t.onLoaded(o)}o&&o(e,t)}t[e].WorkItemFormExtensionHost=function({contributionId:e,context:t,onLoaded:r,skipRender:a}){const s=(0,Ht.useWorkItem)(),l={slowWarningDurationMs:3e4,maxHandshakeDurationMs:2e4,resizeOptions:ue.ResizeOptions.FixedWidth};return o.createElement(i.WrappedComponent,{key:e,dependencies:["ms.vss-web.legacy-content","ms.vss-web.legacy-vss-ui-content"],wrappedType:"legacy",wrappedProps:{componentType:"vssLegacyContributionContentHost",modules:["VSSPreview/Providers/ContentHost"],wrappedProps:{className:"flex-grow",context:t||{},contribution:e,contributionHostBehavior:l,onLoaded:e=>n(s,e,r),expectRegisteredInstance:!0,skipRender:a}}})},t[e].getRegisteredInstance=async function(e,t,o,i){try{const r=e.getService("ILegacyPlatformService"),[a]=await r.requireModules(["VSS/Contributions/Controls"]),s=await a.getBackgroundHost(o),l=await s.getRegisteredInstance(o,i);return n(t,l),l}catch(e){return void console.log(e)}}}("DetailsWorkItemFormExtensionHost"),function(e){function n({identity:e}){const t=(0,i.usePageContext)(),[n,r]=(0,o.useState)(e);return(0,o.useEffect)((()=>{var o;if(e!==n&&r(e),e.imageUrl)return;t.getService(he.VssIdentityServiceName).searchIdentitiesAsync(null!==(o=e.email)&&void 0!==o?o:e.displayName).then((e=>{1===e.length&&r(e[0])}))}),[e]),o.createElement(D.Persona,{className:"icon-margin",size:16,identity:n})}To=t[e]={},t[e].ArtifactLinkIcon=function({iconDescriptor:e}){const t=(0,i.usePageContext)();if(function(e){if(!e)return!1;const t=e;return"string"==typeof t.iconName||"function"==typeof t.render}(e))return o.createElement(m.Icon,Object.assign({className:"icon-margin",size:"medium"},e));if(function(e){if(!e)return!1;const t=e;return"string"==typeof t.project&&"string"==typeof t.workItemTypeName}(e)){const i=(0,ge.getIconDataObservable)(e.project,e.workItemTypeName,t);return o.createElement(pe.WorkItemTypeIcon,{className:"icon-margin",size:0,data:i})}return function(e){if(!e)return!1;const t=e;return"string"==typeof t.color&&"string"==typeof t.icon&&"string"==typeof t.workItemTypeName}(e)?o.createElement(pe.WorkItemTypeIcon,{className:"icon-margin",size:0,data:e}):function(e){if(!e)return!1;const t=e;return"string"==typeof t.displayName&&"string"==typeof t.id}(e)?o.createElement(n,{identity:e}):null}}("LinksControlsArtifactLinkIcon"),function(e){So=t[e]={},t[e].ArtifactLink=function({artifactData:e,showDetails:t,className:n}){const r=(0,i.useService)("IVssLayoutManager"),a=(0,o.useCallback)(((e,t)=>{const i=t.registeredLinkType===f.RegisteredLinkTypeNames.Related,n=t.id;i&&"number"==typeof n&&!e.ctrlKey&&(e.stopPropagation(),e.preventDefault(),r.renderCallout((e=>o.createElement(ke.WorkItemFormDialog,{workItemId:n,onDismiss:e}))))}),[r]);return o.createElement("div",{className:`artifact-link-container white-space-nowrap ${n}`},o.createElement("div",{className:"flex-row flex-center artifact-link"},e.icons.map(((e,t)=>o.createElement(To.ArtifactLinkIcon,{key:""+t,iconDescriptor:e}))),o.createElement("div",{className:"artifact-link-id secondary-text margin-right-4"},e.displayId),""===e.uri||"#"===e.uri?o.createElement("span",{className:"artifact-link-link h-scroll-hidden text-ellipsis"},e.title):o.createElement(V.Link,{className:"artifact-link-link h-scroll-hidden text-ellipsis",href:e.uri,onClick:t=>a(t,e),target:e.registeredLinkType!==f.RegisteredLinkTypeNames.Related?"_blank":void 0},e.title)),t&&o.createElement("div",{className:"artifact-details margin-left-16 flex-row flex-center"},o.createElement("span",{className:"padding-right-8 text-ellipsis"},o.createElement(ve.LinkTypeUpdateDate,{link:e})),o.createElement("span",{className:"text-ellipsis"},o.createElement(ve.LinkTypeState,{link:e}))))}}("LinksControlsArtifactLink"),function(e){No=t[e]={};function n({originWorkItems:e,onDismiss:t,onAddLinks:i,onNewLinksAdded:n,linkTypeFilter:a,linkableWorkItemTypeFilter:s,isLinkToNewItem:l}){const[m,d]=(0,b.useObservable)(""),[u,g]=(0,b.useObservable)("*"),[k,v]=(0,b.useObservable)(""),[I,w]=(0,b.useObservable)(void 0),[y,C]=(0,b.useObservable)([]),E=(0,b.useDerivedObservable)(y,(e=>0===e.length),[]),[S,N]=(0,b.useObservable)(void 0),D=(0,b.useDerivedObservable)(S,(e=>!e),[]),x=(0,o.useCallback)((async()=>{const e=y.value.map((e=>{var t,o,i;return Object.assign(Object.assign({},e),{linkIdentifier:Object.assign(Object.assign({},e.linkIdentifier),{Comment:m.value}),registeredLinkType:k.value,witLinkTypeEnd:null===(t=I.value)||void 0===t?void 0:t.immutableName,linkTypeDisplayName:null!==(i=null===(o=I.value)||void 0===o?void 0:o.name)&&void 0!==i?i:k.value})}));i(e)}),[]),F=(0,o.useCallback)((()=>{var e,t,o;let i;i=I.value.isForwardLink?(null===(e=I.value.linkType)||void 0===e?void 0:e.reverseEnd.name)||(null===(t=I.value.oppositeEnd)||void 0===t?void 0:t.name)||"":(null===(o=I.value.linkType)||void 0===o?void 0:o.forwardEnd.name)||"",n({newWorkItemData:S.value,linkTypeName:i,comment:m.value})}),[]);return o.createElement(h.Dialog,{className:"add-link-dialog",titleProps:{text:Ut.AddLink},onDismiss:t},o.createElement(r,{originWorkItems:e}),o.createElement("div",{className:"link-type-field margin-bottom-8"},o.createElement(fe.FormItem,{label:Ut.LinkTypeLabel},o.createElement(qt.LinkTypeDropdown,{linkTypeFilter:a,onLinkTypeChanged:e=>{var t,o,i;e.registeredLinkType.name===k.value&&e.registeredLinkType.toolId===u.value&&(null===(t=e.workItemLinkTypeEnd)||void 0===t?void 0:t.immutableName)===(null===(o=I.value)||void 0===o?void 0:o.immutableName)||(v(e.registeredLinkType.name),g((null===(i=e.workItemLinkType)||void 0===i?void 0:i.isRemote)?f.ToolIds.RemoteWorkItemTracking:e.registeredLinkType.toolId),w(e.workItemLinkTypeEnd),C([]))}}))),o.createElement(c.Observer,{tool:u,linkTypeName:k,linkTypeEnd:I},(({tool:t,linkTypeName:i,linkTypeEnd:n})=>o.createElement("div",{className:"link-type-specific-content margin-bottom-8"},o.createElement(ve.LinkTypeForm,{tool:t,originWorkItems:e,onArtifactsUpdated:C,onNewArtifactsUpdated:N,linkType:i,workItemLinkTypeEnd:null==n?void 0:n.immutableName,isNew:l,linkableWorkItemTypeFilter:s})))),o.createElement("div",{className:"comment-field"},o.createElement(fe.FormItem,{label:Ut.LinkCommentLabel},o.createElement(p.TextField,{placeholder:Ut.LinkCommentPlaceholder,value:m,onChange:(e,t)=>{d(t)}}))),o.createElement(c.Observer,{addLinkDisabled:E,addNewLinkDisabled:D},(({addLinkDisabled:e,addNewLinkDisabled:i})=>o.createElement(T.PanelFooter,{buttonProps:[{primary:!0,text:Ut.ConfirmAddLink,onClick:l?F:x,disabled:e&&i},{text:Ut.CancelAddLink,onClick:t}]}))))}function r({originWorkItems:e}){const[t,i]=(0,b.useObservable)(!1),n=new b.ObservableArray(e.map((e=>{var t,o,i;return{icons:[{project:e.getFieldValueByName(y.CoreFieldRefNames.TeamProject),workItemTypeName:e.getFieldValueByName(y.CoreFieldRefNames.WorkItemType)},null===(t=e.getFieldValueByName(y.CoreFieldRefNames.AssignedTo))||void 0===t?void 0:t.identityRef],id:e.getFieldValueByName(y.CoreFieldRefNames.Id),displayId:null!==(i=null===(o=e.getFieldValueByName(y.CoreFieldRefNames.Id))||void 0===o?void 0:o.toString())&&void 0!==i?i:"",title:e.getFieldValueByName(y.CoreFieldRefNames.Title)||(0,s.format)(Ut.PlaceholderNewWorkItemTitle,e.getFieldValueByName(y.CoreFieldRefNames.WorkItemType)),state:e.getFieldValueByName(y.CoreFieldRefNames.State),updateDate:e.getFieldValueByName(y.CoreFieldRefNames.AuthorizedDate),tool:f.ToolIds.WorkItemTracking,linkTypeDisplayName:"",registeredLinkType:"",uri:"",additionalData:{workItem:e}}})));const r=o.createRef(),l=(0,s.format)(Ut.LinkOriginMultipleLabel,e.length);return o.createElement("div",{className:"origin-work-items"},o.createElement("div",null,Ut.LinkOriginLabel),o.createElement("div",{className:"padding-vertical-16 padding-left-16"},1===e.length&&o.createElement(So.ArtifactLink,{showDetails:!0,artifactData:n.value[0]}),e.length>1&&o.createElement("div",{className:"inline-flex-row"},o.createElement(m.Icon,{className:"icon-margin",iconName:"POI",size:"large"}),o.createElement("span",{className:"margin-right-8"},l),e.length<10&&o.createElement(o.Fragment,null,o.createElement("span",{className:"scroll-hidden icon-margin link-icon-padding",ref:r},o.createElement(m.Icon,{iconName:"Info",size:"medium",tooltipProps:{text:l},className:"show-summary-icon",ariaLabel:l,tabIndex:0,onClick:()=>i(!0)})),o.createElement(c.Observer,{calloutOpen:t},(e=>e.calloutOpen&&r.current?o.createElement(B.Callout,{anchorElement:r.current,anchorOrigin:{horizontal:"start",vertical:"end"},contentShadow:!0,lightDismiss:!0,onDismiss:()=>i(!1)},o.createElement("div",{className:"padding-16"},o.createElement(R.List,{itemProvider:n,renderRow:a}))):null))))))}function a(e,t,i){return o.createElement(R.ListItem,{details:i,index:e},o.createElement(So.ArtifactLink,{showDetails:!0,key:t.displayId,artifactData:t}))}t[e].AddLinkDialog=n,i.Components.add("add-link-dialog",n)}("LinksDialogsAddLinkDialog"),function(e){Do=t[e]={};t[e].GitHubLinkForm=function({linkType:e,onArtifactsUpdated:t,pageContext:i,getDisplayDataForGitHubUrl:n}){const[r,l]=(0,b.useObservable)(!1),[d,u]=(0,b.useObservable)(""),[h,g]=(0,b.useObservable)(void 0),[k,v]=(0,b.useObservable)(void 0),I=(0,Bt.useWorkItem)(),w=(0,o.useCallback)((e=>{g(e),v(void 0),t([])}),[t]),y=function(e){switch(e){case f.RegisteredLinkTypeNames.GitHubPullRequestLinkType:return{itemTypeDescription:Ut.GitHubPullRequestDescription,label:Ut.GitHubPullRequestUrlLabel,placeholder:Ut.GitHubPullRequestUrlPlaceholder};case f.RegisteredLinkTypeNames.GitHubCommitLinkType:return{itemTypeDescription:Ut.GitHubCommitDescription,label:Ut.GitHubCommitUrlLabel,placeholder:Ut.GitHubCommitUrlPlaceholder};case f.RegisteredLinkTypeNames.GitHubIssueLinkType:return{itemTypeDescription:Ut.GitHubIssueDescription,label:Ut.GitHubIssueUrlLabel,placeholder:Ut.GitHubIssueUrlPlaceholder};default:return}}(e);if(!y)return o.createElement("div",null,"Unsupported link type ",e);const{itemTypeDescription:C,label:E,placeholder:T}=y;return(0,b.useDebouncedSubscription)(d,200,(async e=>{if(v(void 0),t([]),!(0,a.isUrlValid)(e))return void w((0,s.format)(Ut.MissingGitHubItemUrl,C));let o;l(!0);try{o=await n(e,I.id,i)}catch(e){return w(e.message),void l(!1)}e===d.value&&(l(!1),o?(v(o),t([o]),h.value&&g(void 0)):w((0,s.format)(Ut.InvalidGitHubItemUrl,C)))}),[C]),o.createElement(o.Fragment,null,o.createElement("div",{className:"github-link-form-more-info margin-bottom-8 padding-vertical-8 padding-horizontal-16"},o.createElement(m.Icon,{className:"icon-margin",iconName:"Info"}),o.createElement("a",{href:"https://aka.ms/azureboardsgithub/linkdialog",target:"_blank"},Ut.GitHubIntegrationMessage)),o.createElement(c.Observer,{error:h},(({error:e})=>o.createElement(fe.FormItem,{label:E,error:!!e,message:e},o.createElement(p.TextField,{value:d,placeholder:T,onChange:(e,t)=>{u(t)}})))),o.createElement(c.Observer,{newLink:k,loading:r},(({newLink:e,loading:t})=>t?o.createElement("div",{className:"padding-16 flex-row justify-center"},o.createElement(O.Spinner,null)):e?o.createElement("div",{className:"padding-16"},e&&o.createElement(So.ArtifactLink,{showDetails:!0,artifactData:e})):null)))}}("LinksGitHubGitHubLinkForm"),function(e){xo=t[e]={},function(e){e[e.Unknown=0]="Unknown",e[e.PullRequest=1]="PullRequest",e[e.Commit=2]="Commit",e[e.Issue=3]="Issue"}(t[e].ExternalArtifactType||(t[e].ExternalArtifactType={}))}("LinksGitHubGitHubDataProviderContracts"),function(e){Fo=t[e]={},t[e].IGitHubLinkTypeServiceId="github-link-type-service";class i extends Ie.BaseRegisteredLinkTypeService{getToolId(){return f.ToolIds.GitHub}renderLinkTypeForm(e,t,i){return o.createElement(Do.GitHubLinkForm,{linkType:i,pageContext:this.pageContext,onArtifactsUpdated:t,getDisplayDataForGitHubUrl:n})}resolveArtifacts(e,t){return[this.resolveGitHubDisplayData(e,t)]}async resolveGitHubDisplayData(e,t){const o=e.map(s),i={identifiers:o.filter((e=>!!e)),urls:[],workItemId:t},n=await r(i,this.pageContext);return n?n.map((t=>{const i=o.findIndex((e=>(null==e?void 0:e.numberOrSHA)===t.numberOrSHA&&e.repoInternalId===t.repoInternalId)),n=e[i];return l(t,Object.assign(Object.assign({},n),{OriginalName:c(t.itemType)}))})):[]}}async function n(e,t,o){var i;const n={urls:[e],workItemId:t},a=null===(i=await r(n,o,!0))||void 0===i?void 0:i[0];if(!a)return;if(a.errorMessage)throw new Error(a.errorMessage);var s;return l(a,{tool:f.ToolIds.GitHub,FldID:f.LinkTypeFieldIds.ExternalLink,OriginalName:c(a.itemType),FilePath:(s=a,`vstfs:///GitHub/${m(s.itemType)}/${s.repoInternalId}%2F${s.numberOrSHA}`)})}async function r(e,t,o){var i;const n=t.getService("IVssContributionService"),r=await n.getDataAsync("ms.vss-work-web.github-link-data-provider",e);if(o){if(!r){const e=n.getDataProviderExceptions()["ms.vss-work-web.github-link-data-provider"];if(e)throw new Error(e.message)}if(null===(i=r)||void 0===i?void 0:i.errorMessage)throw new Error(r.errorMessage)}return null==r?void 0:r.resolvedLinkItems}t[e].getDevelopmentZeroDataExperienceSettings=async function(e){return e.getService("IVssContributionService").getDataAsync("ms.vss-work-web.development-zerodata-settings-data-provider")};const a=/^vstfs:\/\/\/GitHub\/(?<rawItemType>[A-Za-z]+)\/(?<repoInternalId>[a-zA-Z0-9\-]+)%2F(?<numberOrSHA>[a-zA-Z0-9]+)$/i;function s(e){var t;const o=a.exec(null!==(t=e.FilePath)&&void 0!==t?t:"");if(null===o)return;const{rawItemType:i,repoInternalId:n,numberOrSHA:r}=o.groups,s=function(e){switch(e){case"PullRequest":return xo.ExternalArtifactType.PullRequest;case"Commit":return xo.ExternalArtifactType.Commit;case"Issue":return xo.ExternalArtifactType.Issue;default:return xo.ExternalArtifactType.Unknown}}(i);return{itemType:s,repoInternalId:n,numberOrSHA:r}}function l(e,t){return{linkIdentifier:t,icons:d(e.itemType),id:e.numberOrSHA,displayId:h(e.numberOrSHA),title:e.title,state:e.state,tool:f.ToolIds.GitHub,linkTypeDisplayName:(0,I.getLinkTypeDisplayName)(t.OriginalName),registeredLinkType:t.OriginalName,updateDate:e.date,uri:e.url}}function m(e){switch(e){case xo.ExternalArtifactType.PullRequest:return"PullRequest";case xo.ExternalArtifactType.Commit:return"Commit";case xo.ExternalArtifactType.Issue:return"Issue";default:return"Unknown"}}function c(e){switch(e){case xo.ExternalArtifactType.PullRequest:return f.RegisteredLinkTypeNames.GitHubPullRequestLinkType;case xo.ExternalArtifactType.Commit:return f.RegisteredLinkTypeNames.GitHubCommitLinkType;case xo.ExternalArtifactType.Issue:return f.RegisteredLinkTypeNames.GitHubIssueLinkType;case xo.ExternalArtifactType.Unknown:default:return""}}function d(e){switch(e){case xo.ExternalArtifactType.PullRequest:return[{iconName:"GitHubLogo"},{iconName:"BranchPullRequest"}];case xo.ExternalArtifactType.Commit:return[{iconName:"GitHubLogo"},{iconName:"BranchCommit"}];case xo.ExternalArtifactType.Issue:return[{iconName:"GitHubLogo"},{iconName:"WorkItem"}];case xo.ExternalArtifactType.Unknown:default:return[{iconName:"GitHubLogo"}]}}const u=/^[0-9]+$/;function h(e){return e.length>7&&!u.test(e)?e.substr(0,7):e}W.Services.add(t[e].IGitHubLinkTypeServiceId,{serviceFactory:i})}("LinksGitHubGitHubLinkTypeService"),function(e){Lo=t[e]={},t[e].AddLinkButton=function({primary:e,isNewItemLinkDisabled:t,onLinkToExistingItem:i,onLinkToNewItem:n,linkTypeFilter:r}){if(!r(f.RegisteredLinkTypeNames.Related))return o.createElement(l.Button,{subtle:!0,text:Ut.AddLink,onClick:i});const a={menuProps:{id:"add-link-menu",items:[{id:"existing-item",groupKey:"add-link-actions",iconProps:{iconName:"Link"},text:Ut.AddLinkToExistingItemButtonLabel,onActivate:i},{id:"new-item",groupKey:"add-link-actions",iconProps:{iconName:"Edit"},text:Ut.AddLinkToNewItemButtonLabel,onActivate:n,disabled:t}]}};return o.createElement(P.MenuButton,{primary:e,subtle:!e,text:Ut.AddLink,contextualMenuProps:a})}}("LinksControlsAddLinkButton"),function(e){Ro=t[e]={},t[e].ArtifactLinkPlaceholder=function({className:e,showIcon:t,showDetails:i}){return o.createElement("div",{className:`artifact-link-placeholder flex-column margin-bottom-8 ${e}`},o.createElement("div",{className:"flex-row flex-center margin-bottom-4"},t&&o.createElement("div",{className:"shimmer shimmer-circle-small icon-margin"}),o.createElement("div",{className:"link-title-placeholder shimmer shimmer-line"})),i&&o.createElement("div",{className:"flex-row flex-center margin-bottom-4 margin-left-16"},o.createElement("div",{className:"link-date-placeholder shimmer shimmer-line icon-margin"}),o.createElement("div",{className:"link-state-placeholder shimmer shimmer-line"})))}}("LinksControlsArtifactLinkPlaceholder"),function(e){function n({children:e,onRemove:t}){return o.createElement("div",{className:"removable-item-container full-width"},e,o.createElement("div",{className:"remove-item-button padding-8"},o.createElement(l.Button,{subtle:!0,onClick:t,iconProps:{iconName:"ChromeClose",size:"small"},tooltipProps:{text:Ut.DeleteLink}})))}Ao=t[e]={},t[e].CompactLinksList=function({links:e,onDeleteLink:t}){const r=(0,i.useService)("IWorkItemLinksService"),[a,s]=function(e,t){var o;const i=e.filter((e=>!!e)),n=e.filter((e=>!e)),r=[];for(const e of i){const t=null!==(o=e.witLinkTypeEnd)&&void 0!==o?o:e.registeredLinkType,i=r.find((e=>e.linkType===t));i?i.links.push(e):r.push({linkType:t,linkTypeDisplayName:e.linkTypeDisplayName,links:[e]})}const a=t.makeLinkComparer((e=>e.linkType));return r.sort(a.getComparer()),[r,n]}(e,r);return o.createElement("div",{className:"compact-links-list"},a.map((e=>o.createElement("div",{className:"link-type-group",key:`link-type-[${e.linkType}]-group`},o.createElement("div",{className:"link-type-name padding-bottom-8"},e.linkTypeDisplayName),o.createElement("div",{className:"link-type-links"},e.links.map((e=>o.createElement(n,{key:`link=[${e.id}_${e.uri}_${e.linkIdentifier.ExtID}]`,onRemove:()=>t(e.linkIdentifier)},o.createElement(So.ArtifactLink,{className:"artifact-link padding-bottom-8",artifactData:e,showDetails:!0})))))))),s.length>0&&o.createElement("div",{className:"link-type-group",key:"link-type-[placeholder]-group"},o.createElement("div",{className:"link-type-links"},s.map(((e,t)=>o.createElement(Ro.ArtifactLinkPlaceholder,{key:t,className:"padding-bottom-8",showIcon:!0,showDetails:!0}))))))}}("LinksControlsCompactLinksList"),function(e){var i;Wo=t[e]={},function(e){e[e.EditComment=0]="EditComment",e[e.EditLink=1]="EditLink"}(i=t[e].LinksMoreEditAction||(t[e].LinksMoreEditAction={})),t[e].LinksMoreButton=function({className:e,onEditLink:t,onDeleteLink:n,editAction:r}){const a=(0,o.useMemo)((()=>({menuProps:{id:"attachment-menu",items:[{id:r===i.EditComment?"edit-comment":"edit-link",groupKey:"link-actions",iconProps:{iconName:"Edit"},text:r===i.EditComment?Ut.EditComment:Ut.EditLink,onActivate:t},{id:"delete-link",groupKey:"link-actions",iconProps:{iconName:"Delete"},text:Ut.DeleteLink,onActivate:n}]}})),[t,n,r]);return o.createElement(P.MoreButton,{className:e,hideDropdownIcon:!0,subtle:!0,contextualMenuProps:a})}}("LinksControlsLinksMoreButton"),function(e){Po=t[e]={};const i="System.Links.Comment",n=[y.CoreFieldRefNames.State,y.CoreFieldRefNames.ChangedDate,i];class r{constructor(e,t,o){this.linkType=e,this.witLinkTypeEnd=t,this.displayName=o}}class a{constructor(e,t,o){this.id=e,this.displayName=t,this.iconName=o}}class l{}function c(e,t,o,i){i.width.value=o}function d(e,t){var o,n;switch(e){case y.CoreFieldRefNames.State:return Ut.LinkStateColumn;case y.CoreFieldRefNames.ChangedDate:return Ut.LinkLatestUpdateColumn;case i:return Ut.LinkCommentsColumn;default:return null!==(n=null===(o=t.getFieldByName(e))||void 0===o?void 0:o.fieldDefinition.name)&&void 0!==n?n:e}}function u({columnIndex:e,column:t,treeItem:i,columnName:n}){const s=i.underlyingItem.data;return o.createElement(H.SimpleTableCell,{className:t.className,tableColumn:t,columnIndex:e},s instanceof r||s instanceof a?null:s instanceof l?o.createElement(Ro.ArtifactLinkPlaceholder,null):o.createElement(h,{item:s,columnName:n}))}function h({columnName:e,item:t}){var n,r;switch(e){case y.CoreFieldRefNames.State:return o.createElement(ve.LinkTypeState,{link:t});case y.CoreFieldRefNames.ChangedDate:return o.createElement(ve.LinkTypeUpdateDate,{link:t});case i:return o.createElement(o.Fragment,null,t.linkIdentifier.Comment);default:return"object"==typeof(null===(n=t.additionalData)||void 0===n?void 0:n.workItem)?o.createElement(io.FieldValue,{refName:e,fieldValue:(null===(r=t.additionalData)||void 0===r?void 0:r.workItem).getFieldValueByName(e)}):null}}t[e].LinksGrid=function({links:e,onEditLink:t,onDeleteLink:i,columns:h}){const[g,k]=(0,o.useState)(0),[v,I]=(0,o.useState)(0),w=(0,Bt.useWorkItem)(),y=function(e,t,o){const i=p[t],n=0===o?1:-1,s=[...e].sort(((e,t)=>n*i(e,t))),m=[];for(const e of s){if(!e){m.push({data:new l});continue}let t=m.find((t=>t.data instanceof r&&t.data.linkType===e.registeredLinkType&&t.data.witLinkTypeEnd===e.witLinkTypeEnd));if(t||(t={data:new r(e.registeredLinkType,e.witLinkTypeEnd,e.linkTypeDisplayName),expanded:!0,childItems:[]},m.push(t)),!e.group){t.childItems.push({data:e});continue}let o=t.childItems.find((t=>t.data instanceof a&&t.data.id===e.group.id));o||(o={data:new a(e.group.id,e.group.displayName,e.group.iconName),expanded:!0,childItems:[]},t.childItems.push(o)),o.childItems.push({data:e})}return m.sort((0,Ce.sortByStringValue)((e=>(null==e?void 0:e.data).displayName))),new ye.TreeItemProvider(m)}(e,g,v),C=(0,o.useMemo)((()=>function(e,t,i,n,h,p){return[{id:"description",name:Ut.LinkDescriptionColumn,readonly:!0,hierarchical:!0,sortProps:{ariaLabelAscending:(0,s.format)(Ut.SortByNameAsc,Ut.LinkDescriptionColumn),ariaLabelDescending:(0,s.format)(Ut.SortByNameDesc,Ut.LinkDescriptionColumn),sortOrder:0===h?p:void 0},renderCell:(e,t,s,c,d)=>{const u=c.underlyingItem.data;return o.createElement(we.ExpandableTreeCell,{className:s.className,key:t,columnIndex:t,treeItem:c,treeColumn:s},u instanceof r?u.displayName:u instanceof a?o.createElement("div",{className:"artifact-link-cell flex-row"},o.createElement(m.Icon,{className:"icon-margin",iconName:u.iconName}),u.displayName):u instanceof l?o.createElement("div",{className:"artifact-link-cell margin-left-16"},o.createElement(Ro.ArtifactLinkPlaceholder,{showIcon:!0})):o.createElement("div",{className:"artifact-link-cell flex-row flex-center justify-space-between text-ellipsis"},o.createElement(So.ArtifactLink,{artifactData:u}),o.createElement(Wo.LinksMoreButton,{className:"work-item-links-more-button",onEditLink:()=>i(u.linkIdentifier),onDeleteLink:()=>n(u.linkIdentifier),editAction:u.linkIdentifier.FldID===f.LinkTypeFieldIds.WorkItem?Wo.LinksMoreEditAction.EditLink:Wo.LinksMoreEditAction.EditComment})))},width:new b.ObservableValue(-3/8),onSize:c},...e.map(((e,i)=>({id:e,name:d(e,t),readonly:!0,sortProps:{ariaLabelAscending:(0,s.format)(Ut.SortByNameAsc,d(e,t)),ariaLabelDescending:(0,s.format)(Ut.SortByNameDesc,d(e,t)),sortOrder:h-1===i?p:void 0},renderCell:(t,i,n,r)=>o.createElement(u,{column:n,columnIndex:i,columnName:e,key:`links-${t}-${i}`,treeItem:r}),width:new b.ObservableValue(-1/8),onSize:c})))]}(null!=h?h:n,w,t,i,g,v)),[h,w,t,i,g,v]),E=(0,o.useMemo)((()=>function(e,t){return new H.ColumnSorting(((o,i)=>{e(o),t(i)}))}(k,I)),[]);return o.createElement(we.Tree,{className:"work-item-links-grid",behaviors:[E],columns:C,itemProvider:y,onToggle:(e,t)=>{y.toggle(t.underlyingItem)}})};const p=[(e,t)=>(0,Ce.sortByStringValue)((e=>null==e?void 0:e.title))(e,t),(e,t)=>(0,Ce.sortByStringValue)((e=>null==e?void 0:e.state))(e,t),(e,t)=>(0,Ce.sortByNumberValue)((e=>{var t,o;return null!==(o=null===(t=null==e?void 0:e.updateDate)||void 0===t?void 0:t.getTime())&&void 0!==o?o:0}))(e,t),(e,t)=>(0,Ce.sortByStringValue)((e=>null==e?void 0:e.linkIdentifier.Comment))(e,t)]}("LinksControlsLinksGrid"),function(e){function n({openAddLinksDialog:e}){const t=(0,i.usePageContext)(),n=(0,Bt.useWorkItem)(),r=(0,Bt.useAssetLocation)("ms.vss-code-web/common-content/Nav-Code.png");return o.createElement("div",{className:"links-control-zero-state flex-row flex-center"},o.createElement("img",{"aria-hidden":!0,className:"development-zero-state-image",src:r}),o.createElement(se.FormatComponent,{format:Ut.AddLinkToExistingDevelopmentItem},[o.createElement(V.Link,{key:"commit-link-dialog",onClick:()=>e(S.commitLinkTypeFilter)},Ut.AddLinkToExistingCommit),o.createElement(V.Link,{key:"pull-request-link-dialog",onClick:()=>e(S.pullRequestLinkTypeFilter)},Ut.AddLinkToExistingPullRequest),o.createElement(V.Link,{key:"branch-link-dialog",onClick:()=>e(S.branchLinkTypeFilter)},Ut.AddLinkToExistingBranch),o.createElement(V.Link,{key:"new-branch-link-dialog",onClick:()=>function(e,t){e.getService("IVssContributionService").executeCommandEx("ms.vss-code-web.tags-version-dialog-actions-command",{dependencies:["ms.vss-code-web.version-dialogs-content","ms.vss-code-web.versioncontrol-viewmodel-data-provider"],serviceName:"IVersionDialogActionsService",methodName:"createBranch"},{initialWorkItemIds:[t],allowChangingRepository:!0})}(t,n.id)},Ut.AddLinkToNewBranch)]))}function r({openAddLinksDialog:e}){return o.createElement("div",{className:"links-control-zero-state"},o.createElement(V.Link,{onClick:()=>e(S.parentLinkTypeFilter)},Ut.AddLinkToExistingParent))}function a({openAddLinksDialog:e}){return o.createElement("div",{className:"links-control-zero-state github flex-row flex-center"},o.createElement(be.VssIcon,{className:"zero-data-icon",iconName:"GitHubLogo",iconType:0}),o.createElement(se.FormatComponent,{format:Ut.GitHubZeroDataText},[o.createElement(V.Link,{key:"github-commit-link-dialog",onClick:()=>e(S.githubCommitLinkTypeFilter)},Ut.GitHubZeroDataCommitLinkTypeText),o.createElement(V.Link,{key:"github-pull-request-link-dialog",onClick:()=>e(S.githubPullRequestLinkTypeFilter)},Ut.GitHubZeroDataPullRequestTypeText),o.createElement(V.Link,{key:"github-learn-more-link",href:Ut.GitHubAzureBoardsDocUrl,target:"_blank"},Ut.GitHubZeroDataTextLearnMore)]))}Uo=t[e]={},t[e].LinksZeroState=function({zeroDataExperience:e,openAddLinksDialog:t,linkTypeFilter:i,type:s}){return"Development"===e?"zeroGitHubLinks"===s?o.createElement(a,{openAddLinksDialog:t}):o.createElement(n,{openAddLinksDialog:t}):"RelatedWork"===e?o.createElement(r,{openAddLinksDialog:t}):o.createElement(j.ZeroData,{iconProps:{iconName:"Link"},imageAltText:Ut.LinksZeroData,secondaryText:Ut.LinksZeroData,renderAction:()=>o.createElement(Lo.AddLinkButton,{primary:!0,onLinkToExistingItem:()=>t(i),onLinkToNewItem:()=>t(S.newLinksFilter),linkTypeFilter:i})})}}("LinksControlsLinksZeroState"),function(e){Vo=t[e]={};function n({counts:e,onShowMore:t}){return o.createElement(c.Observer,{counts:e},(({counts:e})=>e.shown===e.total?null:o.createElement("div",{className:"flex-column"},o.createElement("div",{className:"flex-row"},o.createElement(V.Link,{onClick:t},Ut.LinksShowMore),o.createElement("div",{className:"margin-left-4"},(0,s.format)(Ut.LinksShownOfTotal,e.shown,e.total))),o.createElement("div",null,(0,s.format)(Ut.LinksNotShown,Object.entries(e.notShown).map((([e,t])=>`${e} (${t})`)).join(", "))))))}t[e].LinksControl=function({compact:e,columns:t,linkTypeFilter:r,linkableWorkItemTypeFilter:a,zeroDataExperience:s,showZeroDataExperience:l}){const m=(0,Bt.useWorkItem)(),d=(0,i.usePageContext)(),u=(0,i.useService)("IWorkItemModelService"),h=(0,i.useService)("IVssLayoutManager"),p=(0,i.useService)("IWorkItemLinksService"),[g,k]=(0,o.useState)(e?6:Number.MAX_SAFE_INTEGER),v=p.getObservableLinkData(m,{linkTypeFilter:r,maxLinkCount:g,zeroDataExperience:s}),I=p.getObservableLinkCounts(m,{linkTypeFilter:r,maxLinkCount:g,zeroDataExperience:s}),[w,E]=(0,b.useObservable)(!1),[T,N]=(0,b.useObservable)((()=>r)),[D,x]=(0,b.useObservable)(null),[F,L]=(0,b.useObservable)(m.isNew()),[R,A]=(0,o.useState)(m.id),[W,P]=(0,o.useState)(!1);o.useEffect((()=>{if(F.value){const e=()=>{const e=m.isNew();F.value!==e&&L(e),m.id!==R&&0===R&&A(m.id)};return m.saving.subscribe(e),()=>m.saving.unsubscribe(e)}}),[]),o.useEffect((()=>{(0,Fo.getDevelopmentZeroDataExperienceSettings)(d).then((e=>{(null==e?void 0:e.showGitHubZeroDataExperience)&&P(!0)}))}),[]);const U=(0,o.useCallback)((e=>{N((()=>e)),E(!0)}),[]),V=(0,o.useCallback)((e=>{const t=e.map((e=>C.Link.createFromLinkData(e.linkIdentifier)));m.addLinks(t,!0),E(!1),p.refreshLinkData(m)}),[m]),O=(0,o.useCallback)((async e=>{var t,i,n;const r=null!==(n=null===(i=null===(t=(0,_.getTFSPageData)(d))||void 0===t?void 0:t.project)||void 0===i?void 0:i.id)&&void 0!==n?n:m.project.guid;if(!r)throw new Error(Ut.NoProjectSpecifiedMessage);const a=await u.createWorkItem(e.newWorkItemData.typeData,r);a.addLinks([await C.WorkItemLink.create(d,e.linkTypeName,m.id,e.comment)],!0),a.setFieldValueByName(y.CoreFieldRefNames.Title,e.newWorkItemData.title),a.setFieldValueByName(y.CoreFieldRefNames.AreaId,m.getFieldValueByName(y.CoreFieldRefNames.AreaId)),a.setFieldValueByName(y.CoreFieldRefNames.IterationId,m.getFieldValueByName(y.CoreFieldRefNames.IterationId)),h.renderCallout((e=>o.createElement(ke.WorkItemFormDialog,{workItem:a,onDismiss:()=>{E(!1),e()},onSaveComplete:async()=>{await m.refreshNewLinks(),p.refreshLinkData(m)}})))}),[m]),H=(0,o.useCallback)((e=>m.getLinks().find((t=>t.linkData.FilePath===(null==e?void 0:e.FilePath)&&t.linkData.ID===(null==e?void 0:e.ID)&&t.linkData.LinkType===(null==e?void 0:e.LinkType)))),[m]),M=(0,o.useCallback)((e=>{if(!D.value)return;const t=H(D.value);t&&(D.value.Comment=e,t.setComment(e),m.evaluateDirty(),x(null),p.refreshLinkData(m))}),[m]),B=(0,o.useCallback)((e=>{const t=H(e);t&&(m.removeLinks([t],!0),p.refreshLinkData(m))}),[m]),j=o.createElement(c.Observer,{newLinkTypeFilter:T},(e=>o.createElement(o.Fragment,null,o.createElement(Ee.ConditionalChildren,{renderChildren:w},o.createElement(No.AddLinkDialog,{originWorkItems:[m],linkTypeFilter:e.newLinkTypeFilter,linkableWorkItemTypeFilter:a,onAddLinks:V,onNewLinksAdded:O,onDismiss:()=>E(!1),isLinkToNewItem:e.newLinkTypeFilter===S.newLinksFilter})),o.createElement(c.Observer,{linkIdentifier:D},(({linkIdentifier:e})=>{var t,i;return e?e.FldID!==f.LinkTypeFieldIds.WorkItem?o.createElement(io.EditCommentDialog,{comment:null!==(t=e.Comment)&&void 0!==t?t:"",onCommitComment:M,onDismiss:()=>x(null)}):o.createElement(Yt.EditWorkItemLinkDialog,{comment:null!==(i=e.Comment)&&void 0!==i?i:"",onEditLink:({comment:t,linksToAdd:o,removeLink:i})=>{i||M(t),i&&B(e),o&&o.length>0&&V(o),x(null)},onDismiss:()=>x(null),linkIdentifier:e,workItem:m}):null})))));return o.createElement(c.Observer,{links:v,isWorkItemNew:F},(({links:i,isWorkItemNew:a})=>{const m=[];return 0===i.length?("Development"===s&&W&&m.push(o.createElement(Uo.LinksZeroState,{key:"zeroGitHubLinks",zeroDataExperience:s,openAddLinksDialog:U,linkTypeFilter:r,type:"zeroGitHubLinks"})),m.push(o.createElement(Uo.LinksZeroState,{key:"zeroLinks",zeroDataExperience:s,openAddLinksDialog:U,linkTypeFilter:r}))):(l&&"RelatedWork"===s&&!i.some((e=>(null==e?void 0:e.linkTypeDisplayName)===Te.RegisteredWorkItemLinkTypeNames.Parent))&&m.push(o.createElement(Uo.LinksZeroState,{key:"noParent",zeroDataExperience:s,openAddLinksDialog:U,linkTypeFilter:r})),e?m.push(o.createElement(o.Fragment,{key:"compact"},o.createElement(Ao.CompactLinksList,{links:i,onDeleteLink:B}),o.createElement(n,{counts:I,onShowMore:()=>k(2*g)}))):m.push(o.createElement(Po.LinksGrid,{key:"notCompact",links:i,onEditLink:e=>x(e),onDeleteLink:B,columns:t}))),o.createElement(o.Fragment,null,o.createElement(Lo.AddLinkButton,{onLinkToExistingItem:()=>U(r),onLinkToNewItem:()=>U(S.newLinksFilter),linkTypeFilter:r,isNewItemLinkDisabled:a}),m,j)}))}}("LinksControlsLinksControl"),Oo=t.LinksLinksTab={},t.LinksLinksTab.LinksTab=function(){const e=function(){const e=(0,Bt.useWorkItem)();return(0,o.useMemo)((()=>(0,S.getDefaultLinkTypeFilter)(e)),[e])}(),t=function(){const e=(0,Bt.useWorkItem)();return(0,o.useMemo)((()=>(0,S.getDefaultLinkableWorkItemTypeFilter)([e])),[e])}();return o.createElement("div",{className:"work-item-form-tab full-width"},o.createElement(io.CollapsibleSection,{label:Ut.Links},o.createElement(Vo.LinksControl,{compact:!1,linkTypeFilter:e,linkableWorkItemTypeFilter:t,showZeroDataExperience:!1})))},function(e){Ho=t[e]={},t[e].WorkItemDetailsLinksControl=function({control:e}){const t=function(e){if(!i.has(e)){const t=(0,Se.extractInfoFromControlMetadata)(e),{allowedLinkTypes:o,allowedWitLinkTypeEnds:n,allowedWorkItemTypes:r}=t,a=__rest(t,["allowedLinkTypes","allowedWitLinkTypeEnds","allowedWorkItemTypes"]),s=(0,S.getLinkTypeFilterForControl)(e),l=(0,S.getLinkableWorkItemTypeFilterForControl)(e),m=Object.assign(Object.assign({},a),{linkTypeFilter:s,linkableWorkItemTypeFilter:l,showZeroDataExperience:!0});i.set(e,m)}return i.get(e)}(e.metadata);return o.createElement(Vo.LinksControl,Object.assign({},t))};const i=new Map}("LinksWorkItemDetailsLinksControl"),Mo=t.Linksindex={},__exportStar(Oo,t.Linksindex),__exportStar(Ho,t.Linksindex),__exportStar(So,t.Linksindex),function(e){Bo=t[e]={},t[e].WorkItemFieldSubscriber=function({asIdentityRef:e,fieldId:t,onUpdate:i,original:n}){const r=(0,Bt.useWorkItem)();return(0,o.useEffect)((()=>{const o=()=>{i(r.getFieldValueById(t,n,!1,e))};return r.getFieldWatermark().subscribe(o,t.toString()),r.getFieldWatermark().subscribe(o,Te.WorkItemWatermarkAllAction),()=>{r.getFieldWatermark().unsubscribe(o,t.toString()),r.getFieldWatermark().unsubscribe(o,Te.WorkItemWatermarkAllAction)}}),[t,i,n]),null},t[e].MultiWorkItemFieldSubscriber=function({fieldIds:e,onUpdate:t}){const i=(0,Bt.useWorkItem)();return(0,o.useEffect)((()=>(e.forEach((e=>{i.getFieldWatermark().subscribe(t,e.toString())})),i.getFieldWatermark().subscribe(t,Te.WorkItemWatermarkAllAction),()=>{e.forEach((e=>{i.getFieldWatermark().unsubscribe(t,e.toString())})),i.getFieldWatermark().unsubscribe(t,Te.WorkItemWatermarkAllAction)})),[e,t]),null}}("CommonComponentsWorkItemFieldSubscriber"),function(e){jo=t[e]={},t[e].LegacyWorkItemFormControl=function(e){return o.createElement(c.Observer,{key:e.wrappedType+"-observer",linkTypes:e.linkTypeEnds},(()=>void 0!==e.linkTypeEnds.value?o.createElement(Ne.LegacyComponent,{modules:[e.module],wrappedType:e.wrappedType,workItem:e.legacyWorkItem(),linkTypeEnds:e.linkTypeEnds.value}):o.createElement(O.Spinner,{key:e.wrappedType+"-spinner"})))}}("DetailsLegacyWorkItemFormControl"),function(e){function o(e){const t={url:r(e.getAttribute("UrlRoot")||"",e.getAttribute("UrlPath")||""),params:[]};return e.childNodes&&e.childNodes.length&&e.childNodes.forEach((e=>{var o;"Param"===e.nodeName&&(o=parseInt(e.getAttribute("Index")||"",10),isNaN(o)||(t.params[o]={value:e.getAttribute("Value")||"",original:"Original"===e.getAttribute("Type")}))})),t}function i(e,t){var i=[];e.childNodes&&e.childNodes.length&&e.childNodes.forEach((e=>{var t,n;i.push((n={},(t=e).childNodes&&t.childNodes.length&&t.childNodes.forEach((e=>{var t;"Link"===e.nodeName?n.link=o(e):n.content=null!==(t=e.nodeValue)&&void 0!==t?t:void 0})),n))})),t.labelData=i}function n(e,t){var i=e.childNodes;t.allowScript="true"===e.getAttribute("AllowScript"),t.reloadOnParamChange="false"!==e.getAttribute("ReloadOnParamChange"),i.forEach((e=>{switch(e.nodeName){case"Link":t.link=o(e);break;case"Content":t.content=e.textContent}}))}function r(e,t){return e&&(e=e.trim()),t&&(t=t.trim()),e||t?e?t?"/"===e.charAt(e.length-1)&&"/"===t.charAt(0)?e+t.substring(1,t.length):"/"===e.charAt(e.length-1)||"/"===t.charAt(0)?e+t:e+"/"+t:e:t:""}zo=t[e]={},t[e].readControlXMLData=function(e){let t;try{t=(new window.DOMParser).parseFromString(e,"text/xml")}catch(t){return void console.error((0,s.format)(Ut.FailedToParseLabelXML,e))}const r={labelData:[]},a=t.childNodes;return a&&a.length&&a.forEach((e=>{switch(e.nodeName){case"Link":r.labelData=[{link:o(e)}];break;case"LabelText":i(e,r);break;case"WebpageControlOptions":n(e,r)}})),r},t[e].readLabelTextOptions=i,t[e].readWebPageControlOptions=n,t[e].combineUrl=r}("DetailsXMLControlUtils"),function(e){_o=t[e]={};class i extends o.Component{constructor(e,t){if(super(e),this.allowedValues=new b.ObservableArray([]),this.allowedValuesListboxItems=new b.ObservableArray([]),this.dropdown=new k.DropdownSelection,this._linkTypeEnds=new b.ObservableValue(void 0),this.controlledValue=new b.ObservableValue(void 0),this.htmlControlRef=o.createRef(),this.readonly=new b.ObservableValue(!1),this._datePickerManualEditingOptions=new b.ObservableValue(void 0),this.reformatUserInputOfNumericTextControl=(e,t)=>{var o,i;const n=null===(o=this.controlledValue.value)||void 0===o?void 0:o.toString(),r=null===(i=this.parseNumber(null!=n?n:t))||void 0===i?void 0:i.toString();r&&this.isNumericInputValid(r)&&(this.controlledValue.value=r,this.userChangedValue(r))},this.onAllowedValuesChange=()=>{this.allowedValuesListboxItems.value=this.allowedValues.value.map((e=>({text:e,id:e})))},this.onDateChange=e=>{let t=e;const o=this.controlledValue.value instanceof Date?new Date(this.controlledValue.value.getTime()):this.rememberedValue;if("string"==typeof e)if(e){const i=e.trim().replace(/\./g,":");let n=(0,We.parseShortTimeString)(i);n||(n=(0,M.parseDateString)(i,!0)),(e=n)?(null==o||o.setHours(e.getHours()),null==o||o.setMinutes(e.getMinutes()),t=(0,M.getDateInClientTimeZone)(o)):t="invalid",this.rememberedValue=null!=o?o:e,e=o}else null==o||o.setHours(0),null==o||o.setMinutes(0),t=e=o;else o&&e?(e.setHours(o.getHours()),e.setMinutes(o.getMinutes()),t=(0,M.getDateInClientTimeZone)(e)):e&&(t=(0,M.getDateInClientTimeZone)(e));this.userChangedValue(t),this.controlledValue.value=e},!t.pageContext||null===t.workItem)throw new Error("WorkItemFormPageContext can only be used inside a WorkItemFormPageContextProvider");this._pageContext=t.pageContext,this.workItem=t.workItem;const i=this.workItem.getFieldByName(e.control.id);if(i){this.field=i,this.fieldDef=i.fieldDefinition,this.fieldDef.isIdentity&&this.fieldDef.type===y.FieldType.String&&(this.identityPickerProvider=new Ae.PeoplePickerProvider(t.pageContext));let o=this.workItem.getFieldValueById(this.fieldDef.id,!1,!1,this.fieldDef.isIdentity&&this.fieldDef.type===y.FieldType.String);this.readonly.value=!r(e.control,i),"string"==typeof o&&(this.fieldDef.type!==y.FieldType.Html?(o=xe.HtmlSanitizer.sanitizeHtml((0,De.htmlEncode)(o),ze.MentionPlugin.SanitizeHtmlOptions),o=(0,Ge.htmlDecode)(o)):o=xe.HtmlSanitizer.sanitizeHtml(o,ze.MentionPlugin.SanitizeHtmlOptions)),o instanceof Date&&(o=(0,M.getDateInUserTimeZone)(o)),this.updateControlledFieldValue(o),this.timeInputEnabled=!(0,q.isFeatureFlagEnabled)(this._pageContext,Z.FeatureFlags.TimeInputDisabled,!1)}if(e.control.controlType===y.WellKnownControlNames.AssociatedAutomationControl||e.control.controlType===y.WellKnownControlNames.TestStepsControl){this._pageContext.getService("IWorkItemLinksService").getWitLinkTypeEnds().then((e=>{this._linkTypeEnds.value=e}))}this.updateAllowedValues(),this._timerManagement=new Re.TimerManagement,this._debounceOnChange=this._timerManagement.debounce((e=>this.onDateChange(e)),250),this._datePickerManualEditingOptions.value={datePickerType:1},this._debounceReformatUserInputOfNumericTextControl=this._timerManagement.debounce(this.reformatUserInputOfNumericTextControl,750)}componentDidMount(){var e,t;this.updateAllowedValues(),null===(t=null===(e=this.field)||void 0===e?void 0:e.allowedValues)||void 0===t||t.subscribe(this.updateAllowedValues)}componentWillUnmount(){var e,t;null===(t=null===(e=this.field)||void 0===e?void 0:e.allowedValues)||void 0===t||t.unsubscribe(this.updateAllowedValues)}componentDidUpdate(){this.updateAllowedValues()}render(){const e=this.props.control;if(e.isContribution&&!e.contribution.showOnDeletedWorkItem&&this.workItem.isDeleted())return o.createElement(o.Fragment,null);const t=[];return this.field&&t.push([o.createElement(Bo.WorkItemFieldSubscriber,{asIdentityRef:this.fieldDef.isIdentity&&this.fieldDef.type===y.FieldType.String,key:`wif-${this.field.fieldDefinition.name}-subscriber`,fieldId:this.field.fieldDefinition.id,onUpdate:t=>{this.updateAllowedValues(),this.updateControlledFieldValue(t,!0),this.readonly.value=!r(e,this.field)}})]),o.createElement("div",{className:"work-item-form-control-wrapper"},t,o.createElement(c.Observer,{readonly:this.readonly},(()=>this.renderControl())))}renderControl(){var e,t;const i=this.props.control;if(i.isContribution)return this.renderExtensionControl();if(i.controlType===y.WellKnownControlNames.LinksControl)return o.createElement(Mo.WorkItemDetailsLinksControl,{control:i});if(i.controlType===y.WellKnownControlNames.AssociatedAutomationControl)return this.renderAssociatedAutomationControl();if(!this.fieldDef)return i.controlType===y.WellKnownControlNames.DeploymentsControl?o.createElement(je.Deployment,{workItemId:this.workItem.id,projectName:null!==(t=null===(e=this.workItem.project)||void 0===e?void 0:e.name)&&void 0!==t?t:"Project",onRegisterWorkItemListener:e=>this.props.onExtensionLoaded(this.workItem,e)}):i.controlType===y.WellKnownControlNames.LabelControl?this.renderLabelControl():i.controlType===y.WellKnownControlNames.WebpageControl?this.renderWebpageControl():this.renderUnknownControlPlaceholder();if(this.field&&(0,Ge.fieldHasList)(this.field))return this.renderDropdownControl();switch(i.controlType){case y.WellKnownControlNames.HtmlControl:return this.renderHtmlControl();case y.WellKnownControlNames.FieldControl:return this.fieldDef.isIdentity&&this.fieldDef.type===y.FieldType.String?this.renderIdentityControl():this.fieldDef.type===y.FieldType.Boolean?this.renderBooleanControl():(0,Ge.isNumericField)(this.fieldDef.type)?this.renderNumericTextControl():this.renderTextControl();case y.WellKnownControlNames.DateControl:return this.renderDateControl(this.timeInputEnabled);case y.WellKnownControlNames.TestStepsControl:return this.renderTestStepsControl();case y.WellKnownControlNames.ClassificationControl:return this.renderClassificationControl();default:return this.renderUnknownControlPlaceholder()}}getLegacyWorkItem(){return this.legacyWorkItem&&this.legacyWorkItem.rev==this.workItem.revision.value&&this.legacyWorkItem.id==this.workItem.id||(this.legacyWorkItem=new $e.LegacyWorkItem(this._pageContext,this.workItem,this._linkTypeEnds.value)),this.legacyWorkItem}updateControlledFieldValue(e,t){var o;let i=e;if(e instanceof _e.ServerDefaultValue&&(i=e.value),t&&e instanceof Date&&(i=(0,M.getDateInUserTimeZone)(e)),this.field&&(0,Ge.fieldHasList)(this.field))if(this.controlledValue.value=""+(null!==(o=(0,Ge.convertFieldValueToInternal)(i,this.field.fieldDefinition.type).value)&&void 0!==o?o:""),this.isEmpty())this.dropdown.clear();else{const e=this.allowedValues.value.findIndex((e=>e===this.controlledValue.value));e>=0&&this.dropdown.selectable(e)&&this.dropdown.select(e)}else(0,Ge.isNumericField)(this.fieldDef.type)?this.controlledValue.value=(null!=i?i:"")+"":this.controlledValue.value=i}parseNumber(e){if(void 0!==e&&""!==e.trim())return(0,He.parseFloatLocale)(e)}isNumericInputValid(e,t){const o=t?t(e):e;if(!o||""===o.trim())return!0;return!isNaN(o-0)}renderUnknownControlPlaceholder(){return o.createElement("div",null,JSON.stringify(this.props.control,null,2))}renderTextControl(){const{control:e,controlKey:t}=this.props;return o.createElement(n,{control:e,empty:this.isEmpty(),field:this.field,readonly:this.readonly.value,workItem:this.workItem},o.createElement(p.TextField,{key:t,ariaLabelledBy:e.label,className:"work-item-form-control flex-column",containerClassName:"work-item-form-control-value-parent",inputId:a(e.label),inputType:"text",disabled:this.readonly.value,value:this.controlledValue,onChange:(e,t)=>{this.controlledValue.value=t,this.userChangedValue(t)},width:"auto"}))}renderNumericTextControl(){const{control:e,controlKey:t}=this.props;return o.createElement(n,{control:e,empty:this.isEmpty(),field:this.field,readonly:this.readonly.value,workItem:this.workItem},o.createElement(p.TextField,{key:t,ariaLabelledBy:e.label,className:"work-item-form-control flex-column",containerClassName:"work-item-form-control-value-parent",inputId:a(e.label),inputType:"text",disabled:this.readonly.value,value:this.controlledValue,onChange:(e,t)=>{this.isNumericInputValid(t,(e=>{var t;return null===(t=this.parseNumber(e))||void 0===t?void 0:t.toString()}))&&(this.controlledValue.value=t,this.userChangedValue(t,{valueParser:e=>this.parseNumber(e)})),this._debounceReformatUserInputOfNumericTextControl(e,t)},rows:4,width:"auto"}))}renderDropdownControl(){const{controlKey:e,control:t}=this.props;return o.createElement(c.Observer,{allowedValues:{observableValue:this.allowedValues,filter:this.onAllowedValuesChange}},(()=>{var i,r;return o.createElement(n,{control:t,empty:this.isEmpty(),field:this.field,readonly:this.readonly.value,workItem:this.workItem},o.createElement(g.EditableDropdown,{key:e,className:"flex-grow work-item-form-control",allowTextSelection:!0,ariaLabelledBy:t.label,disabled:this.readonly.value,inputId:a(t.label),items:this.allowedValuesListboxItems,onValueChange:e=>{this.controlledValue.value=null==e?void 0:e.text,this.userChangedValue(null==e?void 0:e.text)},renderExpandable:e=>o.createElement(Ve.DropdownExpandableTextField,Object.assign({},e)),selectedText:this.controlledValue,selection:this.dropdown,allowFreeform:!(null===(i=this.field.lists)||void 0===i?void 0:i.allowedValues)||(null===(r=this.field.lists)||void 0===r?void 0:r.allowExistingValue)}))}))}updateAllowedValues(){if(!(this.allowedValues.value.length||this.field&&(0,Ge.fieldHasList)(this.field)))return;const e=(0,Ge.getAllowedFieldValues)(this.field,this.workItem);this.areAllowedValuesUnchanged(e)||(this.allowedValues.value=e.value,this.onAllowedValuesChange())}areAllowedValuesUnchanged(e){if(this.allowedValues===e)return!0;if(this.allowedValues.length!==e.length)return!1;let t=-1;for(const o of this.allowedValues.value)if(o!==e.value[++t])return!1;return!0}renderBooleanControl(){const e=this.props.control;return o.createElement(n,{control:e,empty:!1,field:this.field,readonly:this.readonly.value,workItem:this.workItem},o.createElement(c.Observer,{controlledValue:this.controlledValue},(({controlledValue:e})=>o.createElement(Ue.Toggle,{checked:e,className:"work-item-form-control",disabled:this.readonly.value,text:e?Ut.TrueString:Ut.FalseString,onChange:(e,t)=>{this.controlledValue.value=t,this.userChangedValue(t)}}))))}renderDateControl(e){const{control:t,controlKey:i}=this.props;return o.createElement(n,{control:t,empty:this.isEmpty(),field:this.field,readonly:this.readonly.value,workItem:this.workItem},o.createElement(Pe.DatePicker,{key:i,ariaLabelledBy:t.label,disabled:this.readonly.value,className:"work-item-form-control",containerClassName:(0,u.css)("work-item-form-control-value-parent",e&&"date"),inputId:a(t.label),showClear:!0,value:this.controlledValue,onChange:this.onDateChange}),e&&o.createElement(Pe.DatePicker,{key:i+"-time",ariaLabelledBy:t.label,disabled:this.readonly.value,className:"work-item-form-control",containerClassName:"work-item-form-control-value-parent time",inputId:a(t.label),showClear:!0,value:this.controlledValue,onChange:this.onDateChange,debounceOnChange:this._debounceOnChange,manualEditingOptions:this._datePickerManualEditingOptions}))}renderIdentityControl(){const{control:e,controlKey:t}=this.props;return o.createElement(n,{control:e,empty:this.isEmpty(),field:this.field,readonly:this.readonly.value,workItem:this.workItem},o.createElement(Oe.IdentityPickerDropdown,{ariaLabelledBy:e.label,className:"work-item-form-control",key:t,disabled:this.readonly.value,inputId:a(e.label),onChange:e=>{this.controlledValue.value=e;const t=e?(0,L.convertIIdentityToWorkItemIdentityRef)(this._pageContext,e):void 0;this.userChangedValue((0,L.convertPotentialIdentityRefFromFieldValue)(this._pageContext,t),{eagerIdentityValidation:!0})},pickerProvider:this.identityPickerProvider,value:this.controlledValue}))}renderHtmlControl(){const e=new fo.ImageUploader(this._pageContext,this.workItem),t=this.props.control;return o.createElement(n,{noLabel:!0,control:t,empty:this.isEmpty(),field:this.field,readonly:this.readonly.value,workItem:this.workItem},o.createElement(le.HtmlEditor,{ariaLabel:t.label,className:"work-item-form-control",htmlContent:this.controlledValue.value||"",onChange:e=>{this.controlledValue.value!==e&&(this.controlledValue.value=e,this.userChangedValue(e))},placeholder:(0,s.format)(Ut.HtmlFieldPlaceholder,t.label),readonly:this.readonly.value,ref:this.htmlControlRef,telemetryContext:{controlName:"HtmlEditor"},uploadImageHandler:t=>e.upload(t)}))}renderExtensionControl(){const{control:e}=this.props;return o.createElement(n,{control:e,height:e.contribution.height,field:this.field,readonly:this.readonly.value,workItem:this.workItem,resizable:!0},o.createElement(Eo.WorkItemFormExtensionHost,{contributionId:e.contribution.contributionId,context:{witInputs:e.contribution.inputs},onLoaded:this.props.onExtensionLoaded}))}renderTestStepsControl(){return(0,q.isFeatureEnabled)(this._pageContext,"ms.vss-test-web.nwp-test-steps-control-feature",!1)?o.createElement(Le.TestStepsControl,{workItem:this.workItem}):o.createElement(jo.LegacyWorkItemFormControl,{module:"TestManagement/Scripts/Shared/TestStepsProxy",wrappedType:"test-steps-proxy",legacyWorkItem:()=>this.getLegacyWorkItem(),linkTypeEnds:this._linkTypeEnds})}renderAssociatedAutomationControl(){return(0,q.isFeatureFlagEnabled)(this._pageContext,"WebAccess.TestManagement.EnableNwpAssociatedAutomationControl",!1)?o.createElement(Fe.AssociatedAutomationControl,{workItem:this.workItem}):o.createElement(jo.LegacyWorkItemFormControl,{module:"TestManagement/Scripts/Shared/AssociatedAutomationProxy",wrappedType:"associated-automation-proxy",legacyWorkItem:()=>this.getLegacyWorkItem(),linkTypeEnds:this._linkTypeEnds})}renderLabelControl(){const e=(0,zo.readControlXMLData)(this.props.control.metadata),t=[];return e&&e.labelData.forEach(((e,i)=>{e.link&&e.content?t.push(o.createElement("a",{key:`label-control-${i}`,href:e.link.url,target:"_blank"},e.content)):e.content&&t.push(o.createElement("span",{key:`label-control-${i}`},e.content))})),o.createElement("div",{className:"font-size secondary-text"},t)}renderWebpageControl(){const e=(0,zo.readControlXMLData)(this.props.control.metadata);return e?(this.props.control.height?e.height=this.props.control.height:this.props.groupLength>1?e.height=200:e.height=300,o.createElement(Ne.LegacyComponent,{modules:["WorkItemTracking/SharedScripts/WebPageControlProxy"],wrappedType:"webpage-control-proxy",workItem:this.getLegacyWorkItem(),options:e})):o.createElement("div",null)}renderClassificationControl(){const{controlKey:e,control:t}=this.props,i={ariaLabelledBy:t.label,className:(0,u.css)("flex-grow work-item-control-control",this.readonly.value&&"readOnly"),disabled:this.readonly.value,inputId:a(t.label),placeHolder:t.watermark,key:e,selectedText:this.controlledValue,onValueChange:e=>{this.controlledValue.value=null==e?void 0:e.text,this.userChangedValue(null==e?void 0:e.text)}};return o.createElement(n,{control:t,empty:this.isEmpty(),field:this.field,readonly:this.readonly.value,workItem:this.workItem},this.field.fieldDefinition.id==y.DalFields.AreaPathId&&o.createElement(Me.AreaPathDropdown,Object.assign({},i)),this.field.fieldDefinition.id==y.DalFields.IterationPathId&&o.createElement(Be.IterationDropdown,Object.assign({},i)))}userChangedValue(e,t){let o;if((0,Ge.isNumericField)(this.fieldDef.type))if(""===(null==e?void 0:e.trim()))e=void 0;else{if(o=(null==t?void 0:t.valueParser)?t.valueParser(e)-0:e-0,isNaN(o))return void setTimeout((()=>this.updateControlledFieldValue(this.workItem.getFieldValueById(this.fieldDef.id))),0);this.fieldDef.type===y.FieldType.Integer&&(o=Math.floor(o))}const i={};(null==t?void 0:t.eagerIdentityValidation)&&(i.fireIdentityEagerValidation=!0),this.workItem.setFieldValueById(this.fieldDef.id,null!=o?o:e,i)}isEmpty(){return void 0===this.controlledValue.value||""===this.controlledValue.value}}function n({control:e,empty:t,field:i,height:n,children:r,noLabel:l,readonly:h,workItem:p,resizable:g}){let k=e.label;const v=o.createRef(),[f,I]=(0,b.useObservable)(n);if(o.useEffect((()=>{var e;g&&(null===(e=v.current)||void 0===e||e.addEventListener(ue.EXTENSION_HOST_RESIZED,(e=>{I(e.detail.height),e.stopPropagation()})))}),[]),i){k=(0,s.format)(Ut.FieldNameTooltip,i.fieldDefinition.name);const e=p.getTypeData().rules.fieldHelpTexts[i.fieldDefinition.id];e&&(k=e+"\n"+k)}return o.createElement(Bt.ControlDefaultOptionsContext.Consumer,null,(n=>o.createElement("div",{className:(0,u.css)("flex-column",!n.showEmptyReadOnlyFields&&h&&t&&"hidden")},!l&&e.label&&o.createElement("div",{className:"flex-row"},o.createElement(d.Tooltip,{className:"work-item-form-control-tooltip",text:k},o.createElement("label",{className:"workitemcontrol-label",htmlFor:(0,u.getSafeId)(a(e.label)),id:(0,u.getSafeId)(e.label)},e.label)),o.createElement(c.Observer,{infoText:p.infoText},(()=>o.createElement(Ee.ConditionalChildren,{renderChildren:!!i&&!(0,Ge.isFieldValid)(i)},o.createElement(m.Icon,{ariaLabel:(0,s.format)(Ut.InvalidControl,e.label),className:"padding-left-4 error-text",key:"invalid-control-icon",iconName:"AlertSolid"}))))),o.createElement(c.Observer,{height:f},(e=>o.createElement("div",{ref:v,className:(0,u.css)("work-item-form-control-content",n.showChromeBorder&&"show-border"),style:e.height?{height:e.height}:void 0},o.createElement(Ee.ConditionalChildren,{renderChildren:h},o.createElement(m.Icon,{className:"flex-column work-item-form-readonly-lock-icon",key:"readonly-icon",iconName:"Lock",tooltipProps:{text:(0,s.format)(Ut.ReadonlyFieldLockTooltip,null==i?void 0:i.fieldDefinition.name)}})),r))))))}function r(e,t){return!e.readonly&&(0,Ge.isEditable)(t)}function a(e){return`${e}-input`}t[e].WorkItemFormControl=i,i.contextType=Bt.WorkItemFormPageContext}("DetailsWorkItemFormControl"),function(e){function i(e,t){const o=t.getFieldLookup();return e.controls.some((e=>{const i=o[e.id],n=i?t.fieldMapById[i.id]:void 0;return n&&!(0,Ge.isFieldValid)(n)}))}Go=t[e]={},t[e].WorkItemFormGroup=function({keyPrefix:e,group:t,onExtensionLoaded:n}){const r=t=>e+"."+t.id,a=(0,Ht.useWorkItem)(),l=(0,b.useDerivedObservable)(a.infoText,(()=>i(t,a)?{ariaLabel:(0,s.format)(Ut.InvalidTabOrGroup,t.label),className:"padding-left-4 error-text font-size-m",iconName:"AlertSolid",key:"invalid-control-icon"}:void 0),[t]),m=t.controls.find((e=>e.controlType===y.WellKnownControlNames.HtmlControl)),c=!!m;let d;if(m&&void 0!==m.id){const e=a.fieldMap[m.id.toUpperCase()];if(e){d=(0,s.format)(Ut.FieldNameTooltip,e.fieldDefinition.name);const t=a.getTypeData().rules.fieldHelpTexts[e.fieldDefinition.id];t&&(d=t+"\n"+d)}}return o.createElement("div",{className:"flex-column work-item-form-group"},o.createElement(io.CollapsibleSection,{key:e,label:t.label,hasHtmlControl:c,tooltipText:d,iconProps:l,settingsKey:e},t.isContribution?o.createElement(Eo.WorkItemFormExtensionHost,{contributionId:t.contribution.contributionId,onLoaded:n}):t.controls.filter((e=>e.visible)).map((e=>o.createElement(_o.WorkItemFormControl,{key:r(e),controlKey:r(e)+".",control:e,groupLength:t.controls.length,onExtensionLoaded:n})))))},t[e].isGroupInvalid=i}("DetailsWorkItemFormGroup"),function(e){$o=t[e]={},t[e].WorkItemFormSection=function({onExtensionLoaded:e,keyPrefix:t,section:i,wide:n,width:r}){return o.createElement("div",{className:(0,u.css)("inline-flex-column work-item-form-section padding-horizontal-8",n&&"wide"),key:t,style:{width:`${r}%`}},i.groups.filter((e=>e.visible&&(e.controls.some((e=>e.visible))||e.isContribution))).map((i=>o.createElement(Go.WorkItemFormGroup,{key:t+"."+i.id,keyPrefix:i.id,group:i,onExtensionLoaded:e}))))}}("DetailsWorkItemFormSection"),function(e){Ko=t[e]={},t[e].WorkItemFormTab=function({includeDiscussion:e,onExtensionLoaded:t,page:i}){const n=i.sections.filter((e=>e.groups.length>0&&e.groups.some((e=>e.visible)))),r=1===i.layoutMode,a=n.length+(r?1:0),s=r?2:1,[l,m]=(0,o.useState)(a);(0,o.useEffect)((()=>(window.addEventListener("resize",c),c(),()=>window.removeEventListener("resize",c))));const c=()=>{const e=document.querySelector(".work-item-form-tab");e&&m(Math.min(Math.floor(e.clientWidth/256),a))};if(i.isContribution)return o.createElement(Eo.WorkItemFormExtensionHost,{contributionId:i.contribution.contributionId,onLoaded:t});if(e){const e=n[0],i=(l-s)/l*100;return o.createElement("div",{className:"work-item-form-tab full-width"},o.createElement($o.WorkItemFormSection,{onExtensionLoaded:t,key:e.id+"-form-section",keyPrefix:e.id,section:e,wide:r,width:100/l*s}),o.createElement("div",{className:"other-form-sections",style:{width:`${i||100}%`}},n.map(((e,i)=>0!==i&&o.createElement($o.WorkItemFormSection,{onExtensionLoaded:t,key:e.id+"-form-section",keyPrefix:e.id,section:e,wide:!1,width:100/(l-s)})))),o.createElement(bo.WorkItemFormDiscussionGroup,{wide:r,width:100/l*s}))}return o.createElement("div",{className:"work-item-form-tab full-width"},n.map(((e,i)=>o.createElement($o.WorkItemFormSection,{onExtensionLoaded:t,key:e.id+"-form-section",keyPrefix:e.id,section:e,wide:r&&0===i,width:100/l*(0===i?s:1)}))))}}("DetailsWorkItemFormTab"),qo=t.Detailsindex={},__exportStar(Ko,t.Detailsindex),function(e){var i;Zo=t[e]={},function(e){e.All="All",e.Custom="Custom",e.None="None"}(i=t[e].FollowType||(t[e].FollowType={}));class n extends o.Component{constructor(e,t){if(super(e),this._handleSelect=e=>{e===i.Custom?this.setState({selectedSubscriptionType:e}):e!==i.All&&e!==i.None||(this.customOptions.clear(),this.setState({selectedSubscriptionType:e}))},this._handleCheckbox=(e,t)=>{this.state.selectedSubscriptionType===i.Custom&&(t?this.customOptions.add(e):this.customOptions.delete(e),this.forceUpdate())},this._handleSave=async()=>{if(this.originalFollowType!==i.None&&await this.followsService.unfollow(Ke.KnownArtifactTypes.WorkItem,this.workItemId),this.state.selectedSubscriptionType!==i.None){let e;this.state.selectedSubscriptionType===i.Custom&&(e=JSON.stringify({fieldFilters:[...this.customOptions]})),await this.followsService.follow(Ke.KnownArtifactTypes.WorkItem,this.workItemId,e)}this.props.onDismiss(this.state.selectedSubscriptionType!==i.None)},!t.pageContext||null===t.workItem)throw new Error("WorkItemFormPageContext can only be used inside a WorkItemFormPageContextProvider");this.followsService=t.pageContext.getService("IFollowsService"),this.state={loading:!0,selectedSubscriptionType:i.None},this.customOptions=new Set,this.workItemId=t.workItem.getUniqueId().toString()}async componentDidMount(){const e=await this.followsService.getSubscription(Ke.KnownArtifactTypes.WorkItem,this.workItemId),t={loading:!1,selectedSubscriptionType:i.None};null!=e&&(-1!=e.description.indexOf("fieldFilters")?(t.selectedSubscriptionType=i.Custom,JSON.parse(e.description).fieldFilters.forEach((e=>{this.customOptions.add(e)}))):t.selectedSubscriptionType=i.All),this.originalFollowType=t.selectedSubscriptionType,this.originalCustomOptions=new Set(this.customOptions),this.setState(t)}render(){return o.createElement(h.Dialog,{footerButtonProps:[{text:Ut.Save,primary:!0,onClick:this._handleSave,disabled:this._isSaveDisabled()},{text:Ut.Cancel,onClick:()=>this.props.onDismiss()}],onDismiss:this.props.onDismiss,overlay:this.state.loading?{}:void 0,titleProps:{text:Ut.NotificationSettings}},o.createElement(Ze.RadioButtonGroup,{onSelect:this._handleSelect,selectedButtonId:this.state.selectedSubscriptionType},o.createElement("div",{className:"flex-column flex-grow rhythm-vertical-8"},o.createElement(Ze.RadioButton,{ariaDescribedBy:"notification-not-subscribed-description",className:"font-weight-semibold",id:"None",text:Ut.NotSubscribed}),o.createElement("div",{className:"notification-options-radio-description",id:"notification-not-subscribed-description"},Ut.NotSubscribedDescription),o.createElement(Ze.RadioButton,{ariaDescribedBy:"notification-subscribed-description",className:"font-weight-semibold",id:"All",text:Ut.Subscribed}),o.createElement("div",{className:"notification-options-radio-description",id:"notification-subscribed-description"},Ut.SubscribedDescription),o.createElement(Ze.RadioButton,{ariaDescribedBy:"notification-custom-description",className:"font-weight-semibold",id:"Custom",text:Ut.Custom}),o.createElement("div",{className:"notification-options-radio-description",id:"notification-custom-description"},Ut.CustomNotificationDescription),o.createElement("div",{className:"rhythm-vertical-8 flex-column custom-checkbox"},o.createElement(qe.Checkbox,{checked:this.customOptions.has(y.CoreFieldRefNames.State),className:"notification-options-custom-checkbox",disabled:this.state.selectedSubscriptionType!=i.Custom,label:Ut.StateChanged,onChange:(e,t)=>{this._handleCheckbox(y.CoreFieldRefNames.State,t)}}),o.createElement(qe.Checkbox,{checked:this.customOptions.has(y.CoreFieldRefNames.AssignedTo),className:"notification-options-custom-checkbox",disabled:this.state.selectedSubscriptionType!=i.Custom,label:Ut.AssignedToChanged,onChange:(e,t)=>{this._handleCheckbox(y.CoreFieldRefNames.AssignedTo,t)}}),o.createElement(qe.Checkbox,{checked:this.customOptions.has(y.CoreFieldRefNames.IterationPath),className:"notification-options-custom-checkbox",disabled:this.state.selectedSubscriptionType!=i.Custom,label:Ut.IterationChanged,onChange:(e,t)=>{this._handleCheckbox(y.CoreFieldRefNames.IterationPath,t)}})))))}_isSaveDisabled(){if(this.state.selectedSubscriptionType===this.originalFollowType){if(this.originalFollowType===i.Custom&&this.customOptions.size===this.originalCustomOptions.size&&[...this.customOptions].every((e=>this.originalCustomOptions.has(e))))return!0;if(this.state.selectedSubscriptionType!==i.Custom)return!0}return this.state.selectedSubscriptionType===i.Custom&&!this.customOptions.size}}t[e].WorkItemNotificationSettingsDialog=n,n.contextType=Bt.WorkItemFormPageContext}("HeaderWorkItemNotificationSettingsDialog"),function(e){Xo=t[e]={};const i="WorkItemForm/SavePreference";var r;!function(e){e[e.Save=0]="Save",e[e.SaveAndClose=1]="SaveAndClose"}(r||(r={}));class a extends o.Component{constructor(e,t){if(super(e),this.expandableRef=o.createRef(),this.workItemPermissions=new b.ObservableValue(void 0),this.isFollowing=new b.ObservableValue(!1),this.nameDataDictionary={},this.contributedItemContext={},this.contributedMenuItems=new b.ObservableCollection,this.setContributedItemContext=async e=>{if(this.contributedItemContext={closeWorkItemFormDialogDelegate:this.onDeleteItem,saveErrorCallback:t=>{if(e.pageContext){(0,lt.getBoardsMessagesService)(e.pageContext).showMessage((0,lt.getErrorMessage)(t))}},currentProjectGuid:this.workItem.project.guid,currentProjectName:this.workItem.project.name,hideDelete:this.workItem.id<0||this.workItem.isDeleted(),movedToNewProject:this.workItem.getFieldValueByName(y.CoreFieldRefNames.TeamProject,!0)!==this.workItem.project.name,workItemAvailable:this.workItem.id>0,workItemId:this.workItem.id,workItemTypeName:this.workItem.getTypeData().name},e.pageContext){const t=e.pageContext.getService("ILegacyPlatformService"),o=(await t.requireModules(["Presentation/Scripts/TFS/TFS.Host.TfsContext"]))[0];this.contributedItemContext.tfsContext=o.TfsContext.getDefault()}this.onDirtyUpdate()},this.onDirtyUpdate=()=>{this.contributedItemContext.workItemDirty=this.workItem.dirty.value},this.onItemSaved=()=>{this.resetHistoryData(),this.updateNamedDataDictionary(),(0,Io.isNewWorkItemFormRoute)(this.context.pageContext)&&!this.props.onDismiss&&this.context.pageContext.getService("IVssHistoryService").replaceState(void 0,(0,Io.getWorkItemEditUrl)(this.context.pageContext,this.workItem.getUniqueId().toString()))},this.onDeleteItem=()=>{var e,t;null===(t=(e=this.props).onDelete)||void 0===t||t.call(e),this.props.onDismiss?this.props.onDismiss():(0,Io.isNewWorkItemFormRoute)(this.context.pageContext)&&(0,Je.FastPageSwitch)(this.context.pageContext,(0,Io.getWorkItemHubUrl)(this.context.pageContext),!1)},this.resetHistoryData=()=>{var e;null===(e=this.context.pageContext)||void 0===e||e.getService("IWorkItemFormService").resetHistoryData()},this.openDialog=e=>{this.context.pageContext.getService("IVssLayoutManager").renderCallout((t=>e(t)))},this.setSavePreference=e=>{var t,o,n;(null===(o=null===(t=this.settingService)||void 0===t?void 0:t.getEntry(i,0))||void 0===o?void 0:o.preference)!==e&&(null===(n=this.settingService)||void 0===n||n.setEntries({[`${i}/preference`]:e},0))},!t.pageContext||null===t.workItem)throw new Error("WorkItemFormPageContext can only be used inside a WorkItemFormPageContextProvider");this.workItem=t.workItem,this.projectData=(0,_.getTFSProject)(t.pageContext),this.updateNamedDataDictionary(),this.setContributedItemContext(t),this.contributedMenuItems.push((0,Xe.getMenuItems)(t.pageContext,"ms.vss-work-web.work-item-context-menu",this.contributedItemContext,void 0,!0)),this.contributedMenuItems.push((0,Xe.getMenuItems)(t.pageContext,"ms.vss-work-web.work-item-context-menu-owp",this.contributedItemContext,void 0,!0)),this.contributedMenuItems.push((0,Xe.getMenuItems)(t.pageContext,"ms.vss-work-web.work-item-toolbar-menu",this.contributedItemContext,void 0,!0)),this.settingService=t.pageContext.getService("ISettingsService")}render(){return o.createElement(c.Observer,{contributedMenuItems:this.contributedMenuItems,dirty:this.workItem.dirty,infoText:this.workItem.infoText,isFollowing:this.isFollowing,permissions:this.workItemPermissions,saving:this.workItem.saving},(e=>{const[t,i]=this.getCommandBarItems(e.dirty,e.infoText,e.isFollowing,e.permissions,e.saving,e.contributedMenuItems);return o.createElement(Qe.HeaderCommandBar,{className:"work-item-header-command-bar flex-row flex-grow flex-self-start",items:t,buttonCount:i})}))}componentDidMount(){if(this.context.pageContext){this.context.pageContext.getService("IVssContributionService").getDataAsync("ms.vss-work-web.work-item-permissions-data-provider").then((e=>{e&&(this.workItemPermissions.value=e)}));this.context.pageContext.getService("IFollowsService").isFollowing(Ke.KnownArtifactTypes.WorkItem,this.workItem.getUniqueId().toString()).then((e=>this.isFollowing.value=e))}this.workItem.dirty.subscribe(this.onDirtyUpdate)}componentWillUnmount(){this.workItem.dirty.unsubscribe(this.onDirtyUpdate)}getCommandBarItems(e,t,a,s,m,c){var d,u,h,p,g;const k=this.workItem.isDeleted(),v=this.workItem.isReadOnly(),f=this.workItem.isNew(),{onDismiss:I}=this.props,w=this.context.pageContext.getService("IMailConfigurationService").isEnabled()&&!this.workItem.isNew(),b=[];let E=0;const T=()=>{this.props.onSave(this.onItemSaved,this.resetHistoryData)};if(I||v){if(!v){const n={disabled:!e||t.invalid||m,iconProps:{iconName:"Save"},id:"save",text:Ut.Save},a={disabled:!e||t.invalid||m,id:"save-and-close",text:Ut.SaveAndClose,iconProps:{iconName:"Save"}},s=()=>{T(),this.setSavePreference(r.Save)},l=()=>this.props.onSave((()=>{this.resetHistoryData(),I&&I(),this.setSavePreference(r.SaveAndClose)}),this.resetHistoryData);b.push({id:"save-dialog",className:"flex-noshrink",groupKey:"core",isPrimary:!0,rank:10,subMenuProps:{id:"save-submenu",items:[Object.assign(Object.assign({},n),{onActivate:s}),Object.assign(Object.assign({},a),{onActivate:l})]},text:"Save...",renderButton:c=>{var d,u;let h,p;return(null===(u=null===(d=this.settingService)||void 0===d?void 0:d.getEntry(i,0))||void 0===u?void 0:u.preference)===r.Save?(h=Object.assign(Object.assign({},n),{onClick:s}),p=Object.assign(Object.assign({},a),{onActivate:l})):(h=Object.assign(Object.assign({},a),{onClick:l}),p=Object.assign(Object.assign({},n),{onActivate:s})),o.createElement(et.SplitButton,{buttonProps:h,className:c.className,disabled:!e||t.invalid||m,key:"save-dialog-split-button",menuButtonProps:{ariaLabel:Ut.MoreSaveOptions,contextualMenuProps:{menuProps:{id:"save-options",items:[p]}}},primary:!0})}}),E++}}else b.push({disabled:!e||t.invalid||m,groupKey:"core",iconProps:{iconName:"Save"},id:"save",isPrimary:!0,rank:10,text:Ut.Save,onActivate:T}),E++;if(w){const e=async()=>{const e=this.context.pageContext.getService("IFollowsService");a?await e.unfollow(Ke.KnownArtifactTypes.WorkItem,this.workItem.getUniqueId().toString()):await e.follow(Ke.KnownArtifactTypes.WorkItem,this.workItem.getUniqueId().toString()),this.isFollowing.value=!a},t=e=>o.createElement(Bt.WorkItemFormPageContext.Provider,{value:this.context},o.createElement(Zo.WorkItemNotificationSettingsDialog,{onDismiss:t=>{void 0!==t&&(this.isFollowing.value=t),e()}}));b.push({id:"follow",className:"flex-noshrink",groupKey:"core",rank:20,subMenuProps:{id:"follow-menu",items:[{id:"follow",iconProps:{iconName:"View"},text:a?"Unfollow":Ut.Follow,onActivate:()=>{e()}},{id:"follow-options",iconProps:{iconName:"Settings"},text:Ut.NotificationSettings,onActivate:()=>{this.openDialog(t)}}]},text:a?Ut.Following:"Not Following",renderButton:i=>o.createElement(et.SplitButton,{buttonProps:{id:"follow",text:a?Ut.Following:Ut.Follow,iconProps:{iconName:"View"},onClick:e},className:i.className,key:"follow-split-button",expandableRef:this.expandableRef,menuButtonProps:{ariaLabel:Ut.NotificationSettings,contextualMenuProps:{menuProps:{id:"follow-options",items:[]}},iconProps:{iconName:"Settings"}},renderCallout:()=>t((()=>this.expandableRef.current&&this.expandableRef.current.collapse()))})}),E++}if(!k&&(b.push({ariaLabel:Ut.Refresh,disabled:f,groupKey:"core",iconProps:{iconName:"Refresh"},id:"refresh",rank:30,renderButton:e=>o.createElement(l.Button,Object.assign({},e,{key:"refresh",text:void 0})),subtle:!0,text:Ut.Refresh,tooltipProps:{text:Ut.Refresh},onActivate:()=>{const t=this.context.pageContext.getService("IWorkItemLinksService"),o=(0,S.getDefaultLinkTypeFilter)(this.workItem),i=Number.MAX_SAFE_INTEGER,n=this.context.pageContext.getService("IWorkItemModelService"),r=async()=>{await n.refreshWorkItemLinks(this.workItem),this.workItem.refresh().catch((e=>alert(e))),t.refreshLinkData(this.workItem,{linkTypeFilter:o,maxLinkCount:i,ignoreArtifactCache:!0}),this.props.onRefreshed()};e?(0,Ye.showMessageDialog)(this.context.pageContext,{message:Ut.ConfirmWorkItemRefresh,onClose:e=>e&&r()}):r()}}),E++,!v)){if(b.push({ariaLabel:Ut.RevertChanges,disabled:f||!e,groupKey:"core",iconProps:{iconName:"Undo"},id:"revert",rank:40,renderButton:e=>o.createElement(l.Button,Object.assign({},e,{key:"revert",text:void 0})),subtle:!0,text:Ut.RevertChanges,tooltipProps:{text:Ut.RevertChanges},onActivate:()=>{(0,Ye.showMessageDialog)(this.context.pageContext,{message:Ut.ConfirmWorkItemRevert,okButtonProps:{text:Ut.Revert},onClose:e=>{e&&(this.workItem.reset(),this.props.onReset())}})}}),E++,b.push({disabled:f,id:"new-linked-item",text:Ut.NewLinkedWorkItem,iconProps:{iconName:"WorkItem"},groupKey:"core",rank:100,onActivate:()=>{this.openDialog((e=>{const t=this.context.pageContext.getService("IVssLayoutManager");return o.createElement(No.AddLinkDialog,{originWorkItems:[this.workItem],linkTypeFilter:S.newLinksFilter,linkableWorkItemTypeFilter:(0,S.getDefaultLinkableWorkItemTypeFilter)([this.workItem]),onNewLinksAdded:async i=>{var n,r,a;const s=null!==(a=null===(r=null===(n=(0,_.getTFSPageData)(this.context.pageContext))||void 0===n?void 0:n.project)||void 0===r?void 0:r.id)&&void 0!==a?a:this.workItem.project.guid;if(!s)throw new Error(Ut.NoProjectSpecifiedMessage);const l=this.context.pageContext.getService("IWorkItemModelService"),m=await l.createWorkItem(i.newWorkItemData.typeData,s);m.addLinks([await C.WorkItemLink.create(this.context.pageContext,i.linkTypeName,this.workItem.id,i.comment)]),m.setFieldValueByName(y.CoreFieldRefNames.Title,i.newWorkItemData.title),t.renderCallout((t=>o.createElement(ke.WorkItemFormDialog,{workItem:m,onDismiss:()=>{t(),e()}})))},onAddLinks:()=>{},onDismiss:e,isLinkToNewItem:!0})}))}},{disabled:f,id:"change-type",text:Ut.ChangeType,iconProps:{iconName:"Switch"},groupKey:"core",rank:110,onActivate:()=>{this.openDialog((e=>o.createElement(ot.ChangeTypeDialog,{onDismiss:e,selectedItems:[this.nameDataDictionary],workItemProjectId:this.workItem.project.guid})))}},{disabled:f||e,id:"move-team-project",text:Ut.MoveTeamProject,iconProps:{iconName:"Assign"},groupKey:"core",rank:120,onActivate:()=>{this.openDialog((e=>o.createElement(st.MoveToProjectDialog,{onDismiss:e,selectedItems:[this.nameDataDictionary]})))}},{disabled:f,id:"copy",text:Ut.CopyWorkItem,iconProps:{iconName:"Copy"},groupKey:"core",rank:130,onActivate:()=>this.openDialog((e=>o.createElement(it.CopyWorkItemDialog,{selectedItem:this.nameDataDictionary,onDismiss:e})))},{disabled:f||m,id:"email",text:Ut.EmailWorkItem,iconProps:{iconName:"Mail"},groupKey:"core",rank:140,onActivate:()=>{const e=[y.CoreFieldRefNames.Id,y.CoreFieldRefNames.WorkItemType,y.CoreFieldRefNames.Title,y.CoreFieldRefNames.AssignedTo,y.CoreFieldRefNames.State,y.CoreFieldRefNames.Tags],t=e.map((e=>{var t;return null===(t=this.workItem.getFieldByName(e))||void 0===t?void 0:t.fieldDefinition.name})).filter((e=>e));this.openDialog((i=>o.createElement(at.EmailWorkItemsDialog,{columnFieldNames:t,referenceFieldNames:e,onDismiss:i,selectedItems:[this.nameDataDictionary],workItemProjectId:this.workItem.project.guid})))}}),!this.isCrossProjectItem()){const e=this.context.pageContext.getService("ITfsPageService").getHorizontalNavigationTeamData(),t={};this.workItem.fields.forEach((e=>{const o=e.fieldDefinition.referenceName;t[o]=this.workItem.getFieldValueByName(o)}));const o=(0,rt.getTemplateMenuItem)(this.context.pageContext,[t],this.openDialog,null!==(u=null===(d=this.projectData)||void 0===d?void 0:d.id)&&void 0!==u?u:"",e);o.rank=170,b.push(o)}(0,q.isFeatureFlagEnabled)(this.context.pageContext,"WebAccess.Process.Hierarchy")&&b.push({id:"customize",text:Ut.Customize,iconProps:{iconName:"Edit"},groupKey:"customize-group",rank:300,onActivate:()=>{var e,t,o;let i;i=this.workItem.project.process.isInherited?(0,n.routeUrl)(this.context.pageContext,"ms.vss-work-web.work-customization-route",{action:"layout","process-id":this.workItem.project.process.id,"type-id":this.workItem.workItemType.referenceName}):(0,n.routeUrl)(this.context.pageContext,"ms.vss-work-web.work-customization-route",{"launch-wizard":"true","wizard-project-id":null===(e=this.projectData)||void 0===e?void 0:e.id,"wizard-process-id":null!==(o=null===(t=this.workItem.project.process)||void 0===t?void 0:t.id)&&void 0!==o?o:"","wizard-wit-ref-name":this.workItem.workItemType.referenceName,"wizard-project-name":this.workItem.project.name}),window.open(i)}}),f||(b.push({id:"new-branch",text:Ut.NewBranch,iconProps:{iconName:"OpenSource"},groupKey:"repos",onActivate:()=>{this.context.pageContext.getService("IVssContributionService").executeCommandEx("ms.vss-code-web.tags-version-dialog-actions-command",{dependencies:["ms.vss-code-web.version-dialogs-content","ms.vss-code-web.versioncontrol-viewmodel-data-provider"],serviceName:"IVersionDialogActionsService",methodName:"createBranch"},{initialWorkItemIds:[this.workItem.id],allowChangingRepository:!0})},rank:200}),(null===(h=null==s?void 0:s.workItemDeletePermission)||void 0===h?void 0:h.hasPermission)&&!tt.TestItemTypes.includes(this.workItem.getFieldValueByName(y.CoreFieldRefNames.WorkItemType))&&b.push({disabled:f,id:"delete",text:Ut.Delete,iconProps:{iconName:"Delete"},groupKey:"core",rank:160,onActivate:()=>{this.openDialog((e=>o.createElement(nt.DeleteDialog,{onDismiss:e,selectedItems:[this.nameDataDictionary],onDeleteItems:this.onDeleteItem})))}}))}k&&!f&&!v&&s&&((null===(p=s.workItemDestroyPermission)||void 0===p?void 0:p.hasPermission)&&(b.push({id:"destroy",iconProps:{iconName:"Delete"},subtle:!0,important:!0,rank:50}),E++),(null===(g=s.workItemDeletePermission)||void 0===g?void 0:g.hasPermission)&&(b.push({id:"restore",iconProps:{iconName:"Undo"},subtle:!0,important:!0,rank:60}),E++));const N=c.filter(((e,t,o)=>o.findIndex((t=>t.id==e.id))==t)),D=N.find((e=>"test-work-item-delete"===e.id));return D&&(D.iconProps={iconName:"ChromeClose"}),b.push(...N),[b,E]}isCrossProjectItem(){var e;return this.workItem.project.name!==(null===(e=this.projectData)||void 0===e?void 0:e.name)}updateNamedDataDictionary(){const e=this.workItem.getFieldLookup(),t=this.workItem.getFieldData();for(const o in t)e[o]&&(this.nameDataDictionary[e[o].referenceName]=t[o])}}t[e].WorkItemFormHeaderCommandBar=a,a.contextType=Bt.WorkItemFormPageContext}("HeaderWorkItemFormCommandBar"),function(e){Yo=t[e]={};class i extends o.Component{constructor(e,t){if(super(e),this.tagItems=new b.ObservableArray,this.isAddingTags=new b.ObservableValue(!1),this.filteredTags=new b.ObservableArray,this.filteredMRUTags=new b.ObservableArray,this.suggestionListSelection=new R.ListSelection,this.updateTagsFromFieldValue=e=>{this.tagItems.value=e?e.split(";").map((e=>e.trim())):[]},this.areTagsEqual=(e,t)=>0===e.toLowerCase().localeCompare(t.toLowerCase()),this.onTagAdded=e=>{if(e&&""!==(e=e.trim())){let t=!1;if(t=this.tagItems.value.some((t=>this.areTagsEqual(t,e))),!t){this.tagItems.value=[...this.tagItems.value,e],this.workItem.setFieldValueById(y.DalFields.Tags,this.tagItems.value.join("; "));const t=this.filteredTags.value.indexOf(e);-1!==t&&this.filteredTags.splice(t,1);const o=this.filteredMRUTags.value.indexOf(e);-1!==o&&this.filteredMRUTags.splice(o,1)}}},this.onTagRemoved=e=>{var t,o;this.tagItems.value=this.tagItems.value.filter((t=>!this.areTagsEqual(t,e))),this.workItem.setFieldValueById(y.DalFields.Tags,this.tagItems.value.join("; ")),(null===(t=this.originalMRUTagSuggestions)||void 0===t?void 0:t.includes(e))?this.filteredMRUTags.push(e):(null===(o=this.originalTagSuggestions)||void 0===o?void 0:o.includes(e))&&this.filteredTags.push(e)},this.addTagButtonClicked=async()=>{if(!this.originalTagSuggestions){const e=this.context.pageContext.getService("IWorkItemFormService"),t=await e.getTagsData(this.workItem.project.guid),o=this.context.pageContext.getService("IWorkItemModelService"),i=await o.getTagsMRU();this.originalTagSuggestions=t.slice(),this.originalMRUTagSuggestions=i.slice(),this.tagItems.length&&this.tagItems.value.forEach((e=>{const o=t.indexOf(e);-1!==o&&t.splice(o,1);const n=i.indexOf(e);-1!==n&&i.splice(n,1)})),i.length&&i.forEach((e=>{const o=t.indexOf(e);t.splice(o,1)})),this.filteredTags.value=t.slice(0,201),this.filteredMRUTags.value=i}this.isAddingTags.value=!0},this.filterTagSuggestions=e=>{if(this.originalTagSuggestions){const t=[];for(const o of this.originalTagSuggestions)if(o.toLocaleLowerCase().startsWith(e.toLocaleLowerCase())&&(t.push(o),t.length>=200))break;this.filteredTags.value=t}if(this.originalMRUTagSuggestions){const t=[];this.originalMRUTagSuggestions.forEach((o=>{o.startsWith(e)&&t.push(o)})),this.filteredMRUTags.value=t}},!t.pageContext||null===t.workItem)throw new Error("WorkItemFormPageContext can only be used inside a WorkItemFormPageContextProvider");this.workItem=t.workItem;const o=this.workItem.getFieldValueById(y.DalFields.Tags);this.updateTagsFromFieldValue(o)}render(){const e=[o.createElement(Bo.WorkItemFieldSubscriber,{key:"wif-tag-subscriber",fieldId:y.DalFields.Tags,onUpdate:this.updateTagsFromFieldValue})];return o.createElement("div",{className:"work-item-tag-picker inline-flex-row flex-grow flex-center flex-wrap padding-right-4"},e,o.createElement(c.Observer,{tagItems:this.tagItems,isAddingTags:this.isAddingTags},(e=>{const t=e.tagItems.map((e=>o.createElement(x.Pill,{className:"margin-bottom-4",key:e,onRemoveClick:()=>this.onTagRemoved(e),size:0},e)));return!(0,Ge.isReadOnly)(this.workItem.getFieldById(y.DalFields.Tags))&&t.push(e.isAddingTags?o.createElement(n,{key:"work-item-tag-picker-input",onBlur:e=>{this.onTagAdded(e),this.isAddingTags.value=!1,this.suggestionListSelection.clear()},onFilterChanged:this.filterTagSuggestions,onTagAdded:this.onTagAdded,suggestionSelection:this.suggestionListSelection,filteredTags:this.filteredTags,filteredMRUTags:this.filteredMRUTags}):o.createElement(l.Button,{key:"work-item-tag-add-button",ariaLabel:Ut.AddTag,className:(0,u.css)("no-padding",!!this.tagItems.length&&"margin-bottom-4"),iconProps:this.tagItems.length?{iconName:"Add"}:void 0,onClick:this.addTagButtonClicked,text:this.tagItems.length?void 0:Ut.AddTag,tooltipProps:{text:Ut.AddTag}})),t})))}}function n(e){const[t,i]=(0,b.useObservable)(""),[n,r]=(0,b.useObservable)(null),[a,s]=(0,b.useObservableArray)([]),l=(0,o.useRef)(null),m=()=>{e.suggestionSelection.clearUnselectable();const t=[];e.filteredMRUTags.length&&(t.push({className:"wif-tag-picker-header padding-4",id:"suggestions-header",text:Ut.Suggestions,type:2},...e.filteredMRUTags.value.map((e=>({className:"wif-tag-picker-suggestion padding-4",id:`${e}-mru-suggestion`,text:e})))),e.suggestionSelection.addUnselectable(0)),e.filteredMRUTags.length&&e.filteredTags.length&&(t.push({className:"wif-tag-picker-divider padding-4",id:"mru-divider",type:3}),e.suggestionSelection.addUnselectable(e.filteredMRUTags.length+1)),e.filteredTags.length&&t.push(...e.filteredTags.value.map((e=>({className:"wif-tag-picker-suggestion padding-4",id:`${e}-suggestion`,text:e})))),s(t)};(0,o.useEffect)((()=>{const t=()=>{m()},o=()=>{const t=a.length-1;if(e.suggestionSelection.value[0]&&e.suggestionSelection.value[0].beginIndex>t&&e.suggestionSelection.select(Math.min(t,e.suggestionSelection.value[0].beginIndex)),e.suggestionSelection.value[0]&&!e.suggestionSelection.selectable(e.suggestionSelection.value[0].beginIndex))for(let o=e.suggestionSelection.value[0].beginIndex+1;o<=t;o++)e.suggestionSelection.selectable(o)&&e.suggestionSelection.select(o)};return e.filteredTags.subscribe(t),e.filteredMRUTags.subscribe(t),a.subscribe(o),m(),()=>{e.filteredTags.unsubscribe(t),e.filteredMRUTags.unsubscribe(t),a.unsubscribe(o)}}),[]);return o.createElement(o.Fragment,null,o.createElement(p.TextField,{autoFocus:!0,onBlur:()=>e.onBlur(t.value),onChange:(t,o)=>{i(o),e.onFilterChanged(o)},onKeyDown:o=>{var r;const s=o.which,m=a.length-1,c=t=>{var o;null===(o=l.current)||void 0===o||o.scrollIntoView(t,{block:"nearest"}),e.suggestionSelection.select(t)};switch(s){case 9:case 13:let s=t.value;e.suggestionSelection.value[0]&&(s=null!==(r=a.value[e.suggestionSelection.value[0].beginIndex].text)&&void 0!==r?r:t.value),d=s,e.onTagAdded(d),i(""),n.value=n.value;break;case 38:if(e.suggestionSelection.value&&e.suggestionSelection.value[0]){for(let t=e.suggestionSelection.value[0].beginIndex-1;t>=0;t--)if(e.suggestionSelection.selectable(t)){c(t),o.preventDefault();break}}else for(let t=0;t<=m;t++)if(e.suggestionSelection.selectable(t)){c(t),o.preventDefault();break}o.preventDefault();break;case 40:if(e.suggestionSelection.value&&e.suggestionSelection.value[0]){for(let t=e.suggestionSelection.value[0].beginIndex+1;t<=m;t++)if(e.suggestionSelection.selectable(t)){c(t),o.preventDefault();break}}else for(let t=0;t<=m;t++)if(e.suggestionSelection.selectable(t)){c(t),o.preventDefault();break}o.preventDefault()}var d},ref:e=>r(e),value:t}),o.createElement(c.Observer,{filteredSuggestionsList:a,tagsTextField:n},(t=>{var n;return t.tagsTextField&&t.filteredSuggestionsList.length?o.createElement(B.Callout,{anchorElement:null!==(n=t.tagsTextField.inputElement.current)&&void 0!==n?n:void 0,anchorOrigin:{horizontal:"start",vertical:"end"},calloutOrigin:{horizontal:"start",vertical:"start"},contentClassName:"scroll-hidden",contentShadow:!0,role:"presentation",updateLayout:!0},o.createElement("div",{className:"wif-tag-picker-suggestions",onMouseDown:e=>e.preventDefault()},o.createElement(mt.ListBox,{containerClassName:"h-scroll-hidden",items:t.filteredSuggestionsList,onSelect:(t,o)=>{e.onTagAdded(o.text||""),i("")},ref:l,renderItem:mt.renderListBoxCell,selection:e.suggestionSelection,width:186}))):null})))}t[e].WorkItemTagPicker=i,i.contextType=Bt.WorkItemFormPageContext}("HeaderWorkItemTagPicker"),function(e){Jo=t[e]={};class i extends o.Component{constructor(e,t){var o;if(super(e),this.workItemAssignment=new b.ObservableValue(void 0),this.assignedIdentityResolved=new b.ObservableValue(!1),this.titlePlaceholder=Ut.EnterTitle,this.registerShortcuts=()=>{const e=this.pageContext.getService("IVssKeyboardShortcutService");e.registerShortcut(this.props.shortcutGroupName,{combos:["alt+i"],description:Ut.AssignWorkItemToMeShortcut,globalCombos:["alt+i"],action:()=>{const e=this.pageContext.getService("IVssPageService").getData();if(e){const t={distinctDisplayName:(0,L.getDistinctDisplayName)(e.user.displayName,e.user.uniqueName),identityRef:e.user},o=(0,L.convertWorkItemIdentityRefToIIdentity)(this.pageContext,t);o&&(this.workItemAssignment.value=o,this.workItem.setFieldValueById(y.DalFields.AssignedToId,t))}}}),e.registerShortcut(this.props.shortcutGroupName,{combos:["shift+alt+c"],description:Ut.CopyWorkItemTitleShortcut,globalCombos:["shift+alt+c"],action:()=>{(0,z.copyToClipboard)(this.workItemTitle.value)}})},this.unregisterShortcuts=()=>{const e=this.pageContext.getService("IVssKeyboardShortcutService");e.unRegisterShortcut(this.props.shortcutGroupName,"alt+i"),e.unRegisterShortcut(this.props.shortcutGroupName,"shift+alt+c")},!t.pageContext||null===t.workItem)throw new Error("WorkItemFormPageContext can only be used inside a WorkItemFormPageContextProvider");this.pageContext=t.pageContext,this.workItem=t.workItem,this.workItemTitle=new b.ObservableValue(this.workItem.getFieldValueById(y.DalFields.TitleId)),this.commentCount=new b.ObservableValue(this.workItem.getFieldValueById(y.DalFields.CommentCountId)),this.workItemType=new b.ObservableValue(this.workItem.getTypeData()),this.identityPickerProvider=new Ae.PeoplePickerProvider(this.pageContext);const i=this.workItem.getFieldValueById(y.DalFields.AssignedToId,!1,!1,!0);this.updateIdentityPicker(i),this.workItemTrackingDataProvider=new ht.WorkItemTrackingDataProvider(t.pageContext),e.onDismiss&&(this.isDialogFullscreen=new b.ObservableValue(null!==(o=this.pageContext.getService("ISettingsService").getEntry("WorkItemForm/WifDialog/FullScreen",0))&&void 0!==o&&o));const n=this.props.systemControls.find((e=>e.id===y.CoreFieldRefNames.Title));n&&(this.titlePlaceholder=n.watermark)}componentDidMount(){var e;this.registerShortcuts(),(null===(e=this.workItem.infoText.value)||void 0===e?void 0:e.text)&&(0,ct.announce)(this.workItem.infoText.value.text,!0)}componentWillUnmount(){this.unregisterShortcuts()}getWorkItemSelfLink(){return o.createElement(c.Observer,{dirty:this.workItem.dirty,revision:this.workItem.revision,workItemType:this.workItemType},(()=>{const e=this.workItem.getCaption({excludeTempId:!0,includeDirtyModifier:!0}).toLocaleUpperCase(),t=this.getWorkItemUrl();return o.createElement(o.Fragment,null,o.createElement(ut.WorkItemTypeIconProvider,{dataProvider:this.workItemTrackingDataProvider,dataSource:{projectIdOrName:this.workItem.project.guid,workItemTypeName:this.workItem.getTypeData().name}},(e=>o.createElement(pe.WorkItemTypeIcon,{data:e,className:"icon-margin font-size-m"}))),this.workItem.isNew()||!t?e:o.createElement(V.Link,{href:t,onClick:e=>{var o,i;(0,Je.onClickFPS)(this.context.pageContext,t,!0,e),null===(i=(o=this.props).onDismiss)||void 0===i||i.call(o)}},e))}))}getWorkItemIdDisplay(){return o.createElement(c.Observer,{revision:this.workItem.revision},(()=>this.workItem.isNew()?null:this.workItem.getUniqueId()))}render(){const e=[o.createElement(Bo.WorkItemFieldSubscriber,{key:"wif-title-subscriber",fieldId:y.DalFields.TitleId,onUpdate:e=>this.workItemTitle.value=e}),o.createElement(Bo.WorkItemFieldSubscriber,{key:"wif-assignment-subscriber",fieldId:y.DalFields.AssignedToId,onUpdate:e=>this.updateIdentityPicker(e)}),o.createElement(Bo.WorkItemFieldSubscriber,{key:"wif-comment-count-subscriber",fieldId:y.DalFields.CommentCountId,onUpdate:e=>this.commentCount.value=e,original:!0}),o.createElement(Bo.WorkItemFieldSubscriber,{key:"wif-wi-type-subscriber",fieldId:y.DalFields.WorkItemTypeId,onUpdate:()=>this.workItemType.value=this.workItem.getTypeData()})];return o.createElement("div",{className:"flex-row"},e,o.createElement(c.Observer,{workItemType:this.workItemType},(e=>{var t;return o.createElement("div",{className:"work-item-form-header-type-deco",style:{borderLeftColor:`#${null!==(t=e.workItemType.color)&&void 0!==t?t:"FFFFFF"}`}})})),o.createElement("div",{className:"work-item-form-header flex-column flex-grow padding-bottom-4 padding-left-8"},o.createElement("div",{className:"flex-row flex-center secondary-text body-s padding-vertical-4 padding-right-4"},o.createElement("div",{className:"flex-row flex-noshrink"},this.getWorkItemSelfLink()),o.createElement(c.Observer,{infoText:this.workItem.infoText},(e=>{var t;return(null===(t=e.infoText.text)||void 0===t?void 0:t.length)?(this.isDialogFullscreen||(0,ct.announce)(e.infoText.text,!0),o.createElement("div",{className:(0,u.css)("work-item-form-error-area flex-row flex-center font-size-m padding-left-8 text scroll-hidden",e.infoText.invalid&&"error-text")},o.createElement(m.Icon,{className:"padding-right-4",iconName:"AlertSolid"}),o.createElement(d.Tooltip,{overflowOnly:!0},o.createElement("div",{className:"text-ellipsis"},e.infoText.text)))):null})),o.createElement("div",{className:"flex-grow"}),this.props.onToggleFullscreen&&this.isDialogFullscreen&&o.createElement(c.Observer,{isDialogFullscreen:this.isDialogFullscreen},(e=>o.createElement(l.Button,{ariaLabel:Ut.Fullscreen,iconProps:{iconName:e.isDialogFullscreen?"BackToWindow":"FullScreen"},onClick:()=>{this.isDialogFullscreen.value=!e.isDialogFullscreen,this.props.onToggleFullscreen()},subtle:!0,tooltipProps:{text:Ut.Fullscreen}}))),this.props.onDismiss&&o.createElement(l.Button,{ariaLabel:Ut.Close,iconProps:{iconName:"ChromeClose"},onClick:()=>this.props.onDismiss(),subtle:!0,tooltipProps:{text:Ut.Close}})),o.createElement("div",{className:"flex-row body-xl padding-bottom-4 padding-right-8 flex-center"},this.getWorkItemIdDisplay(),o.createElement(dt.FocusOrMouseWithin,null,(e=>o.createElement("div",{className:"flex-row flex-grow flex-center",onBlur:e.onBlur,onFocus:e.onFocus,onMouseEnter:e.onMouseEnter,onMouseLeave:e.onMouseLeave},o.createElement(p.TextField,{ariaLabel:Ut.TitleFieldAriaLabel,autoFocus:this.workItem.isNew(),className:(0,u.css)("work-item-title-textfield",e.hasFocus||e.hasMouse?void 0:"not-active"),containerClassName:"flex-grow padding-left-8",onChange:(e,t)=>{this.workItemTitle.value=t,this.workItem.setFieldValueById(y.DalFields.TitleId,t),(0,Io.isNewWorkItemFormRoute)(this.context.pageContext)&&!this.props.onDismiss&&(document.title=(0,Io.getWorkItemFormTitle)(this.workItem))},placeholder:this.titlePlaceholder,readOnly:(0,Ge.isReadOnly)(this.workItem.getFieldById(y.DalFields.TitleId)),value:this.workItemTitle}),o.createElement(z.ClipboardButton,{className:(0,u.css)(!e.hasFocus&&!e.hasMouse&&"invisible",this.workItem.isNew()&&"hidden"),getContent:()=>o.createElement(o.Fragment,null,o.createElement(V.Link,{href:this.getWorkItemUrl()},this.workItem.getCaption({excludeTempId:!0})),`: ${this.workItemTitle.value}`)}))))),o.createElement("div",null,o.createElement(Xo.WorkItemFormHeaderCommandBar,{onDelete:this.props.onDelete,onDismiss:this.props.onDismiss,onRefreshed:this.props.onRefreshed,onReset:this.props.onReset,onSave:this.props.onSave}),o.createElement("div",{className:"inline-flex-row"},o.createElement(Ee.ConditionalChildren,{renderChildren:this.assignedIdentityResolved},o.createElement(c.Observer,{assignment:this.workItemAssignment},(()=>{const e=this.workItem.getFieldById(y.DalFields.AssignedToId);return o.createElement(Oe.IdentityPickerDropdown,{ariaLabel:e.fieldDefinition.name,className:"work-item-assignment-dropdown",disabled:(0,Ge.isReadOnly)(e),onChange:e=>{this.workItemAssignment.value=e,this.workItem.setFieldValueById(y.DalFields.AssignedToId,e?(0,L.convertIIdentityToWorkItemIdentityRef)(this.pageContext,e,e.image):void 0,{fireIdentityEagerValidation:!0})},pickerProvider:this.identityPickerProvider,value:this.workItemAssignment})})))),o.createElement(V.Link,{className:"wif-comment-count-link inline-flex-row flex-center flex-noshrink padding-horizontal-8",onClick:this.props.onCommentCountClick},o.createElement(m.Icon,{iconName:"Comment"})," ",o.createElement(c.Observer,{commentCount:this.commentCount},(e=>o.createElement("div",{className:"wif-comment-count-link-text"},1===e.commentCount?Ut.OneComment:(0,s.format)(Ut.CommentCount,e.commentCount))))),o.createElement(Yo.WorkItemTagPicker,null))))}async updateIdentityPicker(e){if(e){const t=(0,L.convertPotentialIdentityRefFromFieldValue)(this.pageContext,e,!0),o=t.id?await this.identityPickerProvider.getEntityFromUniqueAttribute(t.id):this.getIdentityFromInvalidIdentityRef(t);this.workItemAssignment.value=o,this.assignedIdentityResolved.value=!0}else this.workItemAssignment.value=void 0,this.assignedIdentityResolved.value=!0}getIdentityFromInvalidIdentityRef(e){return{entityId:e.id,displayName:e.displayName,image:e.imageUrl}}getWorkItemUrl(){if(!this.workItem.isNew()){const e="ms.vss-work-web.new-work-item-form-route",t={project:this.workItem.project.name||"",id:this.workItem.id.toString()};return(0,n.routeUrl)(this.pageContext,e,t)}}}t[e].WorkItemFormHeader=i,i.contextType=Bt.WorkItemFormPageContext}("HeaderWorkItemFormHeader"),Qo=t.Headerindex={},__exportStar(Jo,t.Headerindex),ei=t.HistoryChangeType={},(Di=t.HistoryChangeType.ChangeType||(t.HistoryChangeType.ChangeType={})).Added="added",Di.Removed="removed",Di.Updated="updated",function(e){ti=t.HistoryHistoryUtils={};const o=new Set([y.CoreFieldRefNames.AreaId,y.CoreFieldRefNames.AuthorizedAs,y.CoreFieldRefNames.AuthorizedDate,y.CoreFieldRefNames.ChangedBy,y.CoreFieldRefNames.ChangedDate,y.CoreFieldRefNames.CommentCount,y.CoreFieldRefNames.CreatedBy,y.CoreFieldRefNames.CreatedDate,y.CoreFieldRefNames.Id,y.CoreFieldRefNames.IterationId,y.CoreFieldRefNames.NodeName,y.CoreFieldRefNames.Rev,y.CoreFieldRefNames.RevisedDate,y.CoreFieldRefNames.Watermark,y.DalFields.AreaLevel1,y.DalFields.AreaLevel2,y.DalFields.AreaLevel3,y.DalFields.AreaLevel4,y.DalFields.AreaLevel5,y.DalFields.AreaLevel6,y.DalFields.AreaLevel7,y.DalFields.IterationLevel1,y.DalFields.IterationLevel2,y.DalFields.IterationLevel3,y.DalFields.IterationLevel4,y.DalFields.IterationLevel5,y.DalFields.IterationLevel6,y.DalFields.IterationLevel7,y.DalFields.PersonID,y.OobFieldRefNames.ActivatedDate,y.OobFieldRefNames.ClosedDate,y.OobFieldRefNames.StateChangeDate,y.OobFieldRefNames.BacklogPriority,y.OobFieldRefNames.ResolvedDate]),i=/^WEF_[A-Za-z0-9]+_/;function n(e){const t=r(e,y.CoreFieldRefNames.State);return"string"==typeof t?t:void 0}function r(e,t){var o,i;return null===(i=null===(o=e.fields)||void 0===o?void 0:o[t])||void 0===i?void 0:i.newValue}function a(e,t){var o,i;return(null===(i=null===(o=e.relations)||void 0===o?void 0:o[t])||void 0===i?void 0:i.filter(l).length)>0}function l(e){return e.rel===y.WorkItemLinkConstants.ATTACHEDLINKTYPE}function m(e,t){var o,i;return(null===(i=null===(o=e.relations)||void 0===o?void 0:o[t])||void 0===i?void 0:i.filter(c).length)>0}function c(e){return!l(e)}t.HistoryHistoryUtils.isStateUpdate=function(e){return!!n(e)},t.HistoryHistoryUtils.getNewState=n,t.HistoryHistoryUtils.getUpdateDate=function(e){const t=r(e,y.CoreFieldRefNames.AuthorizedDate);return t instanceof Date?(0,M.getDateInUserTimeZone)(t):e.revisedDate},t.HistoryHistoryUtils.getNewValueForField=r,t.HistoryHistoryUtils.hasFieldChange=function(e,t){var o;const i=null===(o=e.fields)||void 0===o?void 0:o[t];return!(0,Ge.isEmpty)(null==i?void 0:i.newValue)||!(0,Ge.isEmpty)(null==i?void 0:i.oldValue)},t.HistoryHistoryUtils.isCalculatedField=function(e,t){var n,r;return o.has(e)||o.has(null!==(r=null===(n=t[e])||void 0===n?void 0:n.id)&&void 0!==r?r:"")||i.test(e)},t.HistoryHistoryUtils.hasAttachmentUpdates=function(e){return a(e,"added")||a(e,"removed")},t.HistoryHistoryUtils.hasAttachmentChangesOfType=a,t.HistoryHistoryUtils.isAttachmentUpdate=l,t.HistoryHistoryUtils.hasLinkUpdates=function(e){return m(e,"added")||m(e,"removed")},t.HistoryHistoryUtils.hasLinkChangesOfType=m,t.HistoryHistoryUtils.isLinkUpdate=c,t.HistoryHistoryUtils.getAuthorizedAsIdentity=function(e,t){var o;const i=null===(o=e.fields)||void 0===o?void 0:o[y.CoreFieldRefNames.AuthorizedAs];return(0,L.getIIdentityObject)(t,null==i?void 0:i.newValue.displayName)},t.HistoryHistoryUtils.hasSameNameWithRevisedBy=function(e,t){return!!(null==t?void 0:t.displayName)&&0===(0,s.localeIgnoreCaseComparer)(e.revisedBy.displayName,t.displayName)}}(),function(e){function i({stateUpdate:e,updateIndex:t}){var i;const a=null===(i=e.fields[y.CoreFieldRefNames.State])||void 0===i?void 0:i.newValue,l=function(e,t){var o;const i=t+1,n=null===(o=e.fields[y.CoreFieldRefNames.State])||void 0===o?void 0:o.newValue,r=(0,ti.getNewValueForField)(e,y.CoreFieldRefNames.Reason),a=e.revisedBy.displayName,l=(0,pt.ago)((0,ti.getUpdateDate)(e),0);return(0,s.format)(Ut.StateTransitionAriaLabel,i,n,r,a,l)}(e,t);return o.createElement("div",{"aria-label":l,role:"img",className:"flex-row",tabIndex:0},o.createElement(r,{stateUpdate:e}),o.createElement(n,{newState:a}))}function n({newState:e}){return o.createElement("div",{"aria-hidden":!0,className:"state-node padding-8 white-space-nowrap"},o.createElement(io.StateCircle,{className:"icon-margin",state:e}),e)}function r({stateUpdate:e}){return o.createElement("div",{"aria-hidden":!0,className:"flex-column"},o.createElement("div",{className:"transition-top-label white-space-nowrap font-size"},o.createElement("div",null,o.createElement(l,{stateUpdate:e}))),o.createElement(a,null),o.createElement("div",{className:"transition-bottom-label white-space-nowrap font-size"},o.createElement("div",{className:"flex-row justify-center"},o.createElement(D.Persona,{className:"icon-margin",identity:e.revisedBy,size:16}),e.revisedBy.displayName),o.createElement("div",null,o.createElement(U.Ago,{date:(0,ti.getUpdateDate)(e),currentDate:(0,M.getDateInUserTimeZone)(),tooltipTimeFormat:M.tooltipTimeFormat}))))}function a(){return o.createElement("div",{className:"state-graph-right-arrow"},o.createElement("div",{className:"state-graph-arrow-tail"}),o.createElement("div",{className:"state-graph-arrow-head"}))}function l({stateUpdate:e}){const t=(0,ti.getNewValueForField)(e,y.CoreFieldRefNames.Reason);return t?o.createElement(io.FieldValue,{refName:y.CoreFieldRefNames.Reason,fieldValue:t}):o.createElement("span",null,(0,s.format)(Ut.MovedToState,(0,ti.getNewState)(e)))}oi=t.HistoryStateGraph={},t.HistoryStateGraph.StateGraph=function({stateUpdates:e}){return e.length?o.createElement("div",{className:"work-item-form-history-state-graph flex-row padding-bottom-16"},e.map(((e,t)=>o.createElement(i,{key:`workItem-${e.workItemId}-update-${e.id}`,stateUpdate:e,updateIndex:t})))):null}}(),function(e){ii=t[e]={};const n=/\n+/gm;t[e].SingleLineMarkdownPreview=e=>{const t=(0,i.usePageContext)(),[r,a]=o.useState();return o.useEffect((()=>{(async()=>{if(e.text){const o=e.text.replace(n," "),i=await(0,$.translateStorageKeysToDisplayNames)(t,o);a(i)}})().catch(console.error)}),[e.text]),r?o.createElement(gt.MarkdownRendererComponent,{rawContent:r,className:e.className,options:{validateLink:e=>!1}}):null}}("HistorySingleLineMarkdownPreview"),function(e){ni=t[e]={},t[e].SingleLineComment=function({update:e,className:t}){var i;const n=null===(i=e.commentEdit)||void 0===i?void 0:i.text;return(0,o.useMemo)((()=>{var i;if("string"!=typeof n)return o.createElement("span",{className:t});if(0===(null===(i=e.commentEdit)||void 0===i?void 0:i.format))return o.createElement(ii.SingleLineMarkdownPreview,{text:n,className:t});{const e=document.createRange().createContextualFragment(n),i=[];for(let t=0;t<e.children.length;t++){const o=e.children[t];if(o instanceof HTMLElement&&o.innerText.length>0)for(const e of o.innerText.split("\n"))i.push(e)}return o.createElement("span",{className:t},i.join(" "))}}),[n])}}("HistorySingleLineComment"),function(e){ri=t[e]={},t[e].AttachmentDiff=function({attachment:e,changeType:t}){const n=(0,i.usePageContext)(),r=(0,Bt.useWorkItem)(),a=(0,o.useCallback)((()=>{const t=n.getService("IWorkItemFormAttachmentsService").getAttachments(r).find((t=>t.ExtID===e.attributes.id));t&&(0,zt.downloadAttachment)(n,r,t)}),[e]),s="removed"===t?e.attributes.name:o.createElement(V.Link,{onClick:a},e.attributes.name),l=o.createElement("div",{className:"padding-vertical-4 margin-bottom-8"},o.createElement(m.Icon,{iconName:(0,zt.getAttachmentIconName)(e.attributes.name),className:"icon-margin",ariaHidden:!0}),o.createElement("span",{className:`${t} padding-vertical-4 padding-horizontal-8`},s));return"added"===t?o.createElement("ins",null,l):"removed"===t?o.createElement("del",null,l):o.createElement("div",null,l)}}("HistoryDiffsAttachmentDiff"),function(e){ai=t[e]={};t[e].CommentDiff=e=>{if(!e.text)return null;const t=n(e.text),i=n(e.previousText);return o.createElement("div",{className:"rhythm-vertical-8"},t&&o.createElement(r,null,o.createElement("ins",{className:"comment"},o.createElement(io.CommentFieldValue,{refName:y.CoreFieldRefNames.History,fieldValue:t,commentFormat:e.format}))),i&&o.createElement(r,null,o.createElement("del",{className:"comment"},o.createElement(io.CommentFieldValue,{refName:y.CoreFieldRefNames.History,fieldValue:i,commentFormat:e.format}))))};const n=e=>{const t=(0,i.usePageContext)(),[n,r]=o.useState();return o.useEffect((()=>{(async()=>{if(e){const o=await(0,$.translateStorageKeysToDisplayNames)(t,e);r(o)}})().catch(console.error)}),[e]),n};function r({children:e}){return o.createElement("div",{className:"comment-bubble flex-row flex-center"},o.createElement("div",{className:"comment-bubble-arrow"}),o.createElement("div",{className:"comment-bubble-body padding-16"},e))}}("HistoryDiffsCommentDiff"),function(e){si=t[e]={},t[e].FieldDiff=function({refName:e,fieldUpdate:t}){let i=t.newValue,n=t.oldValue;if(e===y.CoreFieldRefNames.Tags){const e=t.oldValue&&"string"==typeof t.oldValue?t.oldValue.split(";").map((e=>e.trim())):[],o=t.newValue&&"string"==typeof t.newValue?t.newValue.split(";").map((e=>e.trim())):[],r=e.filter((e=>!o.includes(e)));i=o.filter((t=>!e.includes(t))).join(";")||null,n=r.join(";")||null}const r=null!=i?o.createElement("div",{className:"added padding-vertical-4 padding-horizontal-8 margin-horizontal-4 margin-bottom-4"},o.createElement("ins",null,o.createElement(io.FieldValue,{refName:e,fieldValue:i}))):null,a=null!=n?o.createElement("div",{className:"removed padding-vertical-4 padding-horizontal-8 margin-horizontal-4 margin-bottom-4"},o.createElement("del",null,o.createElement(io.FieldValue,{refName:e,fieldValue:n}))):null;return o.createElement("div",{className:"field-diff flex-row padding-vertical-4"},o.createElement("div",{className:"field-name flex-noshrink"},o.createElement(io.FieldName,{refName:e})),o.createElement("div",{className:"flex-row flex-wrap flex-shrink field-value-diff"},r,a))}}("HistoryDiffsFieldDiff"),function(e){li=t[e]={},t[e].HtmlFieldDiff=function({refName:e,fieldUpdate:t}){const i=t.newValue?o.createElement("div",{className:"added html-field-value padding-vertical-4 padding-horizontal-8 margin-bottom-8"},o.createElement("ins",null,o.createElement(io.FieldValue,{refName:e,fieldValue:t.newValue}))):null,n=t.oldValue?o.createElement("div",{className:"removed html-field-value padding-vertical-4 padding-horizontal-8 margin-bottom-8"},o.createElement("del",null,o.createElement(io.FieldValue,{refName:e,fieldValue:t.oldValue}))):null;return o.createElement("div",{className:"html-field-diff"},o.createElement("div",{className:"font-size-ml font-weight-semibold margin-bottom-8"},o.createElement(io.FieldName,{refName:e})),i,n)}}("HistoryDiffsHtmlFieldDiff"),function(e){mi=t[e]={},t[e].LinkDiff=function({link:e,changeType:t}){var n,r;const a=(0,i.usePageContext)(),s=(0,Bt.useWorkItem)(),[l,c]=(0,o.useState)(!1),[d,u]=(0,o.useState)(),h=(0,o.useCallback)((async()=>{c(!0);const t=(await a.getService("IWorkItemLinksService").getLinkIdentifiers(s,{includeDeleted:!0})).find((t=>e.url===t.FilePath||e.url.endsWith(`/_apis/wit/workItems/${t.ID}`)));if(!t)return u(void 0),void c(!1);const o=await(0,kt.resolveArtifact)(t,s.id,a);u(o),c(!1)}),[e]);(0,o.useEffect)((()=>{h()}),[h]);const p=o.createElement("div",{className:"padding-vertical-4 margin-bottom-8 flex-row flex-center"},o.createElement(m.Icon,{iconName:"Link",className:"icon-margin",ariaHidden:!0}),o.createElement("span",{className:"margin-right-16"},null!==(r=null===(n=e.attributes)||void 0===n?void 0:n.name)&&void 0!==r?r:Ut.Link),o.createElement("div",{className:`${t} padding-vertical-4 padding-horizontal-8`},l?o.createElement("div",{className:"link-diff-details-placeholder shimmer shimmer-line"}):d?o.createElement(Mo.ArtifactLink,{artifactData:d}):o.createElement("a",{className:"error-text",href:"#",onClick:e=>{e.preventDefault(),h()},onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),h())},tabIndex:0},Ut.HistoryLinkDiffErrorLoadingDetails)));return"added"===t?o.createElement("ins",null,p):"removed"===t?o.createElement("del",null,p):o.createElement("div",null,p)}}("HistoryDiffsLinkDiff"),function(e){function i(e,t){var o,i,n,r,a,s,l,m,c,d,u,h,p;const g=Object.entries(null!==(o=e.fields)&&void 0!==o?o:{}),k=e.commentEdit?[{key:`workItem-${e.workItemId}-update-${e.id}-comment-${e.commentEdit.commentId}-version-${e.commentEdit.commentVersion}`,text:e.commentEdit.text,previousText:e.commentEdit.previousText,format:e.commentEdit.format}]:[],v=g.filter((([e,o])=>(!(0,Ge.isEmpty)(o.oldValue)||!(0,Ge.isEmpty)(o.newValue))&&(e=>{var o,i;return!(0,ti.isCalculatedField)(e,t)&&(null===(o=t[e])||void 0===o?void 0:o.type)!==y.FieldType.Html&&(null===(i=t[e])||void 0===i?void 0:i.type)!==y.FieldType.History})(e))).map((([t,o])=>({key:`workItem-${e.workItemId}-update-${e.id}-field-${t}`,refName:t,fieldUpdate:o}))),f=g.filter((([e,o])=>(!(0,Ge.isEmpty)(o.oldValue)||!(0,Ge.isEmpty)(o.newValue))&&(e=>{var o;return(null===(o=t[e])||void 0===o?void 0:o.type)===y.FieldType.Html})(e))).map((([t,o])=>({key:`workItem-${e.workItemId}-update-${e.id}-field-${t}`,refName:t,fieldUpdate:o})));return{comments:k,fields:v,htmlFields:f,attachmentUpdates:[...(null!==(n=null===(i=e.relations)||void 0===i?void 0:i.added)&&void 0!==n?n:[]).filter(ti.isAttachmentUpdate).map((t=>({key:`workItem-${e.workItemId}-update-${e.id}-added-attachment-${t.url}`,attachment:t,changeType:ei.ChangeType.Added}))),...(null!==(a=null===(r=e.relations)||void 0===r?void 0:r.updated)&&void 0!==a?a:[]).filter(ti.isAttachmentUpdate).map((t=>({key:`workItem-${e.workItemId}-update-${e.id}-updated-attachment-${t.url}`,attachment:t,changeType:ei.ChangeType.Updated}))),...(null!==(l=null===(s=e.relations)||void 0===s?void 0:s.removed)&&void 0!==l?l:[]).filter(ti.isAttachmentUpdate).map((t=>({key:`workItem-${e.workItemId}-update-${e.id}-removed-attachment-${t.url}`,attachment:t,changeType:ei.ChangeType.Removed})))],linkUpdates:[...(null!==(c=null===(m=e.relations)||void 0===m?void 0:m.added)&&void 0!==c?c:[]).filter(ti.isLinkUpdate).map((t=>({key:`workItem-${e.workItemId}-update-${e.id}-added-link-${t.url}`,link:t,changeType:ei.ChangeType.Added}))),...(null!==(u=null===(d=e.relations)||void 0===d?void 0:d.updated)&&void 0!==u?u:[]).filter(ti.isLinkUpdate).map((t=>({key:`workItem-${e.workItemId}-update-${e.id}-updated-link-${t.url}`,link:t,changeType:ei.ChangeType.Updated}))),...(null!==(p=null===(h=e.relations)||void 0===h?void 0:h.removed)&&void 0!==p?p:[]).filter(ti.isLinkUpdate).map((t=>({key:`workItem-${e.workItemId}-update-${e.id}-removed-link-${t.url}`,link:t,changeType:ei.ChangeType.Removed})))]}}ci=t[e]={},t[e].UpdateDiffs=function({update:e}){const t=(0,Bt.useFieldMetadata)(),{comments:n,fields:r,htmlFields:a,attachmentUpdates:s,linkUpdates:l}=i(e,t);return o.createElement("div",{className:"update-diffs padding-16"},n.length>0&&o.createElement("div",{className:"update-comments"},n.map((e=>o.createElement(ai.CommentDiff,Object.assign({},e))))),r.length>0&&o.createElement("div",{className:"update-field-diffs"},r.map((e=>o.createElement(si.FieldDiff,Object.assign({},e))))),a.length>0&&o.createElement("div",{className:"update-html-field-diffs"},a.map((e=>o.createElement(li.HtmlFieldDiff,Object.assign({},e))))),s.length>0&&o.createElement("div",{className:"update-attachments"},o.createElement("div",{className:"update-diffs-section-header font-size-ml font-weight-semibold margin-bottom-8"},Ut.Attachments),s.map((e=>o.createElement(ri.AttachmentDiff,Object.assign({},e))))),l.length>0&&o.createElement("div",{className:"update-links"},o.createElement("div",{className:"update-diffs-section-header font-size-ml font-weight-semibold margin-bottom-8"},Ut.Links),l.map((e=>o.createElement(mi.LinkDiff,Object.assign({},e))))))},t[e].extractDiffLists=i}("HistoryDiffsUpdateDiffs"),function(e){di=t[e]={};const i="@Me";function n(e){const t=e.uniqueName||e.displayName,i=e.uniqueName?e.displayName:(0,L.stripIdPartFromDisplayName)(e.displayName);return{id:t,text:i,iconProps:{render:()=>o.createElement(D.Persona,{tooltipProps:{text:i},className:"margin-right-4",size:16,identity:e})},tooltipProps:{showOnFocus:!1}}}async function r(e,t,o,i,n){if(0===o.size)return e;const r=await i.getService("IWorkItemLinksService").getLinkIdentifiers(n,{includeDeleted:!0}),l=o.has(Ut.FilterDropdownCommentFieldLabel.toLowerCase()),m=o.has(Ut.FilterDropdownLinkFieldLabel.toLowerCase()),c=o.has(Ut.FilterDropdownAttachmentFieldLabel.toLowerCase()),d=await Promise.all(e.map((async e=>{var d,u,h,p,g,k;if(l&&e.commentEdit&&t){const o=(0,Ge.htmlDecode)(e.commentEdit.text);if((0,s.caseInsensitiveContains)(o,t))return!0}const v=[...null!==(u=null===(d=e.relations)||void 0===d?void 0:d.added)&&void 0!==u?u:[],...null!==(p=null===(h=e.relations)||void 0===h?void 0:h.updated)&&void 0!==p?p:[],...null!==(k=null===(g=e.relations)||void 0===g?void 0:g.removed)&&void 0!==k?k:[]];if(m||c)for(const e of v){if(m&&(0,ti.isLinkUpdate)(e)&&t){const o=r.find((t=>e.url===t.FilePath||e.url.endsWith(`/_apis/wit/workItems/${t.ID}`)));if(o){const e=await(0,kt.resolveArtifact)(o,n.id,i);if(e&&(e.displayId&&(0,s.caseInsensitiveContains)(e.displayId,t)||e.title&&(0,s.caseInsensitiveContains)(e.title,t)))return!0}}if(c&&(0,ti.isAttachmentUpdate)(e)&&t&&e.attributes&&e.attributes.name&&(0,s.caseInsensitiveContains)(e.attributes.name,t))return!0}if(e.fields)for(const[n,r]of Object.entries(e.fields))if(o.has(n)&&t&&(a(r.newValue,t,i)||a(r.oldValue,t,i)))return!0;return!1})));return e.filter(((e,t)=>d[t]))}function a(e,t,o){if(void 0===e)return!1;let i;if((0,L.isIdentityRef)(e)){const t=(0,L.convertWorkItemIdentityRefFromFieldValue)(o,e.displayName).identityRef;i=(0,L.stripIdPartFromDisplayName)(t.displayName)}else i=(0,Ge.htmlDecode)(e.toString());return!!(0,s.caseInsensitiveContains)(i,t)}function l(e,t){var o,i;return(null!==(o=e.text)&&void 0!==o?o:"").localeCompare(null!==(i=t.text)&&void 0!==i?i:"")}t[e].UpdatesFilterBar=function({pageContext:e,showFilter:t,updates:a,setSelectedUpdates:s}){const m=(0,Bt.useWorkItem)(),[c]=(0,o.useState)(new k.DropdownMultiSelection),[d]=(0,o.useState)(new k.DropdownMultiSelection),u=(0,Bt.useFieldMetadata)(),[h]=(0,o.useState)(new vt.Filter),[p]=(0,o.useState)(function(e){const t=new Array,o=new Set;for(const i of e){const e=i.revisedBy;e.uniqueName?(o.has(e.uniqueName)||t.push(n(e)),o.add(e.uniqueName)):e.displayName&&(o.has(e.displayName)||t.push(n(e)),o.add(e.displayName))}return t.sort(l),t.unshift({id:i.toLowerCase(),text:i}),t}(a)),[g]=(0,o.useState)(function(e,t){var o,i;const n=new Array,r=new Set,a=e=>{r.has(e)||n.push({id:e.toLowerCase(),text:e}),r.add(e)};for(const s of e){const e=(0,ci.extractDiffLists)(s,t),l=e.fields.concat(e.htmlFields);for(const e of l){const a=e.refName;r.has(a)||n.push({id:a,text:null!==(i=null===(o=t[a])||void 0===o?void 0:o.name)&&void 0!==i?i:a}),r.add(a)}e.comments.length>0&&a(Ut.FilterDropdownCommentFieldLabel),e.attachmentUpdates.length>0&&a(Ut.FilterDropdownAttachmentFieldLabel),e.linkUpdates.length>0&&a(Ut.FilterDropdownLinkFieldLabel)}return n.sort(l),n}(a,u));return(0,o.useEffect)((()=>{h.subscribe((async()=>{var t,o,n;const l=null!==(t=h.getFilterItemValue("keyword"))&&void 0!==t?t:"",c=new Set(null!==(o=h.getFilterItemValue("updatedBy"))&&void 0!==o?o:[]);let d=new Set(null!==(n=h.getFilterItemValue("updatedFields"))&&void 0!==n?n:[]);if(!l&&0===c.size&&0===d.size)return void s(a);l&&0===d.size&&(d=new Set(g.map((e=>e.id))));let u=function(e,t,o){if(0===t.size)return e;const n=t.has(i.toLowerCase()),r=o.getService("IVssPageService").getData().user;return e.filter((e=>!(!n||r.uniqueName!==e.revisedBy.uniqueName)||(e.revisedBy.uniqueName?t.has(e.revisedBy.uniqueName):t.has(e.revisedBy.displayName))))}(a,c,e);u=function(e,t){if(0===t.size)return e;const o=t.has(Ut.FilterDropdownCommentFieldLabel.toLowerCase()),i=t.has(Ut.FilterDropdownLinkFieldLabel.toLowerCase()),n=t.has(Ut.FilterDropdownAttachmentFieldLabel.toLowerCase()),r=e.filter((e=>{var r,a,s,l,m,c;if(o&&e.commentEdit)return!0;const d=[...null!==(a=null===(r=e.relations)||void 0===r?void 0:r.added)&&void 0!==a?a:[],...null!==(l=null===(s=e.relations)||void 0===s?void 0:s.updated)&&void 0!==l?l:[],...null!==(c=null===(m=e.relations)||void 0===m?void 0:m.removed)&&void 0!==c?c:[]];if(i||n)for(const e of d)if(i&&(0,ti.isLinkUpdate)(e)||n&&(0,ti.isAttachmentUpdate)(e))return!0;if(e.fields)for(const o in e.fields)if(t.has(o))return!0;return!1}));return r}(u,d),u=await async function(e,t,o,i,n){if(!t)return e;let a=e.slice();for(const[e,s]of Object.entries(o))"updatedFields"===e&&(a=await r(a,t,s,i,n));return a}(u,l,{updatedFields:d},e,m),s(u)}),vt.FILTER_CHANGE_EVENT)}),[]),t?o.createElement("div",{className:"flex-grow"},o.createElement(ft.FilterBar,{className:"updates-filter",filter:h},o.createElement(It.KeywordFilterBarItem,{filterItemKey:"keyword"}),o.createElement(Ve.DropdownFilterBarItem,{filterItemKey:"updatedBy",filter:h,items:p,selection:c,placeholder:Ut.FilterDropdownUpdatedBy}),o.createElement(Ve.DropdownFilterBarItem,{filterItemKey:"updatedFields",filter:h,items:g,selection:d,placeholder:Ut.FilterDropdownFields}))):null}}("HistoryUpdatesFilterBar"),function(e){function n(e,t,i){var n,l,m,c,d,u,h,p,g;const k=[];if(1!==e.rev||(0,ti.hasLinkUpdates)(e)){if(function(e,t){var o;return Object.keys(null!==(o=e.fields)&&void 0!==o?o:{}).filter((e=>!(0,ti.isCalculatedField)(e,t)&&e!==y.CoreFieldRefNames.History)).length>0}(e,t)){const i=[];for(const[a,c]of Object.entries(e.fields)){if((0,ti.isCalculatedField)(a,t)||a===y.CoreFieldRefNames.History)continue;const d=null!==(l=null===(n=t[a])||void 0===n?void 0:n.name)&&void 0!==l?l:a,u=`${a}-update-${e.id}`;a!==y.CoreFieldRefNames.IsDeleted?a!==y.CoreFieldRefNames.AssignedTo||!c.newValue&&!c.oldValue?a!==y.CoreFieldRefNames.State?(null===(m=t[a])||void 0===m?void 0:m.type)!==y.FieldType.Html&&a!==y.CoreFieldRefNames.Tags?r(a,c)?i.push({order:1,description:o.createElement(se.FormatComponent,{format:Ut.ChangedFieldFromOldToNew,key:u},d,o.createElement(io.FieldValue,{refName:a,fieldValue:c.oldValue}),o.createElement(io.FieldValue,{refName:a,fieldValue:c.newValue}))}):i.push({order:1,description:void 0!==c.newValue?o.createElement(se.FormatComponent,{format:Ut.ChangedFieldToNew,key:u},d,o.createElement(io.FieldValue,{refName:a,fieldValue:c.newValue})):o.createElement(se.FormatComponent,{format:Ut.ChangedField,key:u},d)}):i.push({order:1,description:(0,s.format)(Ut.ChangedField,d)}):k.push({order:1,description:o.createElement(se.FormatComponent,{format:Ut.ChangedFieldFromOldToNew,key:u},d,o.createElement(io.FieldValue,{refName:a,fieldValue:c.oldValue}),o.createElement(io.FieldValue,{refName:a,fieldValue:c.newValue}))}):k.push({order:1,description:c.newValue?o.createElement(se.FormatComponent,{format:Ut.AssignedPerson,key:u},o.createElement(io.FieldValue,{refName:a,fieldValue:c.newValue})):o.createElement(se.FormatComponent,{format:Ut.UnassignedPerson,key:u},o.createElement(io.FieldValue,{refName:a,fieldValue:c.oldValue}))}):k.push({order:1,description:c.newValue?Ut.DeletedTheWorkItem:Ut.RestoredTheWorkItem})}1===i.length?k.push(i[0]):k.push({order:1,description:Ut.MadeFieldChanges})}}else k.push({order:0,description:o.createElement(se.FormatComponent,{format:Ut.CreatedTheWorkItem,key:`work-item-created-${e.id}`},[i.getFieldValueByName(y.CoreFieldRefNames.WorkItemType)])});if((0,ti.hasAttachmentChangesOfType)(e,ei.ChangeType.Added)&&k.push({order:2,description:Ut.AddedAnAttachment}),(0,ti.hasAttachmentChangesOfType)(e,ei.ChangeType.Removed)&&k.push({order:2,description:Ut.DeletedAnAttachment}),(0,ti.hasLinkChangesOfType)(e,ei.ChangeType.Added)){const t=(0,I.getLinkTypeDisplayName)(null===(u=null===(d=null===(c=e.relations)||void 0===c?void 0:c.added.filter(ti.isLinkUpdate)[0])||void 0===d?void 0:d.attributes)||void 0===u?void 0:u.name);k.push({order:3,description:t?(0,s.format)(Ut.AddedALinkOfType,t):Ut.AddedALink})}if((0,ti.hasLinkChangesOfType)(e,ei.ChangeType.Removed)){const t=(0,I.getLinkTypeDisplayName)(null===(g=null===(p=null===(h=e.relations)||void 0===h?void 0:h.removed.filter(ti.isLinkUpdate)[0])||void 0===p?void 0:p.attributes)||void 0===g?void 0:g.name);k.push({order:3,description:t?(0,s.format)(Ut.DeletedALinkOfType,t):Ut.DeletedALink})}return a(e,ei.ChangeType.Added)&&k.push({order:3,description:Ut.AddedAComment}),a(e,ei.ChangeType.Updated)&&k.push({order:3,description:Ut.EditedAComment}),a(e,ei.ChangeType.Removed)&&k.push({order:3,description:Ut.DeletedAComment}),k.sort(((e,t)=>e.order-t.order)),k.map((e=>e.description))}function r(e,t){return!!t.oldValue&&[y.CoreFieldRefNames.State,y.CoreFieldRefNames.TeamProject,y.CoreFieldRefNames.WorkItemType].includes(e)}function a(e,t){if(!e.commentEdit)return!1;switch(t){case ei.ChangeType.Added:return e.commentEdit.text&&!e.commentEdit.previousText;case ei.ChangeType.Updated:return e.commentEdit.text&&e.commentEdit.previousText;case ei.ChangeType.Removed:return!e.commentEdit.text&&e.commentEdit.previousText}}ui=t[e]={},t[e].UpdateSummary=function({update:e,className:t}){const r=(0,Bt.useWorkItem)(),a=(0,Bt.useFieldMetadata)(),l=(0,i.usePageContext)(),m=(0,o.useMemo)((()=>n(e,a,r)),[e,r]),c=(0,ti.getAuthorizedAsIdentity)(e,l),d=(0,ti.hasSameNameWithRevisedBy)(e,c),u=(0,L.stripIdPartFromDisplayName)(e.revisedBy.displayName),h=c&&!d?(0,s.format)(Ut.HistoryControlViaTemplate,u,c.displayName):u,p=(0,o.useMemo)((()=>{switch(m.length){case 0:return"TODO: how did this happen?";case 1:return o.createElement(se.FormatComponent,{format:Ut.Made1Change},[h,...m]);case 2:return o.createElement(se.FormatComponent,{format:Ut.Made2Changes},[h,...m]);case 3:return o.createElement(se.FormatComponent,{format:Ut.Made3Changes},[h,...m]);default:return o.createElement(se.FormatComponent,{format:Ut.MadeMoreChanges},[h,...m])}}),[e]);return o.createElement("span",{className:t},p)},t[e].hasChanges=function(e,t,o){return n(e,t,o).length>0}}("HistoryUpdateSummary"),function(e){function n({update:e}){const t=(0,i.usePageContext)();return o.createElement("div",{className:"update-details-header flex-row"},o.createElement(D.Persona,{className:"margin-8",identity:e.revisedBy,personaProvider:new K.PersonaDetailsProvider(t),size:40}),o.createElement("span",{className:"flex-column justify-center flex-grow"},o.createElement("div",{className:"flex-row justify-space-between"},function(e,t){const i=(0,ti.getAuthorizedAsIdentity)(e,t),n=(0,ti.hasSameNameWithRevisedBy)(e,i),r=o.createElement("span",{className:"font-weight-heavy",key:`revisedBy-${e.id}`},e.revisedBy.displayName);if(!i||n)return r;const a=o.createElement("span",{className:"font-weight-heavy",key:`authorizedA-${e.id}`},i.displayName);return o.createElement(se.FormatComponent,{format:Ut.HistoryControlViaTemplate},[r,a])}(e,t),o.createElement("span",{className:"update-date font-size"},o.createElement(U.Ago,{date:(0,ti.getUpdateDate)(e),currentDate:(0,M.getDateInUserTimeZone)(),tooltipTimeFormat:M.tooltipTimeFormat}))),o.createElement("div",{className:"flex-row justify-space-between"},o.createElement(ui.UpdateSummary,{update:e}))))}hi=t[e]={},t[e].UpdateDetails=function({update:e}){return o.createElement("div",{className:"update-details flex-column"},o.createElement(n,{update:e}),o.createElement(ci.UpdateDiffs,{update:e}))}}("HistoryUpdateDetails"),function(e){pi=t.HistoryUpdatesList={};function i(e){var{update:t}=e,i=__rest(e,["update"]);return o.createElement(R.ListItem,Object.assign({},i),o.createElement("div",{className:(0,u.css)("update-list-item flex-row",i.isRowSelected&&"selected-row-highlight")},o.createElement(D.Persona,{className:"margin-8",size:32,identity:t.revisedBy}),o.createElement("div",{className:"update-list-item-details flex-grow flex-column justify-center"},o.createElement("div",{className:"flex-row justify-space-between"},o.createElement(ui.UpdateSummary,{className:"update-list-item-ellipsis",update:t}),o.createElement(r,{update:t})),o.createElement("div",{className:"update-list-item-second-line flex-row justify-space-between font-size"},o.createElement(ni.SingleLineComment,{className:"update-list-item-ellipsis",update:t}),o.createElement(U.Ago,{date:(0,ti.getUpdateDate)(t),currentDate:(0,M.getDateInUserTimeZone)(),tooltipTimeFormat:M.tooltipTimeFormat})))))}function r({update:e}){const t=(0,ti.hasFieldChange)(e,y.CoreFieldRefNames.AssignedTo),i=(0,ti.getNewState)(e),n=(0,ti.hasFieldChange)(e,y.CoreFieldRefNames.History),r=(0,ti.hasFieldChange)(e,y.CoreFieldRefNames.Tags),a=(0,ti.hasAttachmentUpdates)(e),l=(0,ti.hasLinkUpdates)(e);return o.createElement("span",null,t&&o.createElement(m.Icon,{className:"icon-margin",iconName:"Contact",tooltipProps:{text:Ut.UpdateIconUserTooltip}}),i&&o.createElement(io.StateCircle,{className:"icon-margin",state:i,tooltipProps:{text:(0,s.format)(Ut.UpdateIconStateTooltip,i)}}),n&&o.createElement(m.Icon,{className:"icon-margin",iconName:"Comment",tooltipProps:{text:Ut.UpdateIconCommentTooltip}}),a&&o.createElement(m.Icon,{className:"icon-margin",iconName:"Attach",tooltipProps:{text:Ut.UpdateIconAttachmentTooltip}}),r&&o.createElement(m.Icon,{className:"icon-margin",iconName:"Tag",tooltipProps:{text:Ut.UpdateIconTagTooltip}}),l&&o.createElement(m.Icon,{className:"icon-margin",iconName:"Link",tooltipProps:{text:Ut.UpdateIconLinkTooltip}}))}t.HistoryUpdatesList.UpdatesList=function({updates:e,pageContext:t}){const[r,a]=(0,o.useState)(null),s=(0,o.useRef)(null),[m,d]=(0,o.useState)(0),[u,p]=(0,o.useState)(0),[g,k]=(0,b.useObservable)(e),[v,f]=(0,o.useState)(!1);return(0,o.useLayoutEffect)((()=>{const e=()=>{var e,t,o;const i=null===(e=s.current)||void 0===e?void 0:e.getBoundingClientRect();if(!i)return;const n=null===(t=document.querySelector(".work-item-form-page"))||void 0===t?void 0:t.getBoundingClientRect();if(!n)return;const r=n.bottom-i.top-20;if(m&&Math.abs(r-m)<2)return;d(r);const a=null===(o=document.querySelector(".updates-filter"))||void 0===o?void 0:o.getBoundingClientRect();if(a){const e=n.bottom-a.top-20;p(e)}};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)})),e.length?o.createElement("div",{className:"flex-row"},o.createElement(yt.Splitter,{className:"full-width",onRenderNearElement:()=>o.createElement("div",{className:"left-side-container"},o.createElement("div",{className:"toggle-button-updates-filter-container"},o.createElement(l.Button,{className:"toggle-button-updates-filter subtle",iconProps:{iconName:"Filter"},onClick:()=>{f(!v)},ariaLabel:Ut.ToggleFilter})),o.createElement(di.UpdatesFilterBar,{pageContext:t,showFilter:v,updates:e,setSelectedUpdates:k}),o.createElement("div",{className:"updates-list-container v-scroll-auto",ref:s,style:{height:m}},o.createElement(wt.Intersection,{rootElement:s.current},o.createElement("div",null,o.createElement(c.Observer,{selectedUpdates:g},(e=>g.value.length>0?o.createElement(io.PartitionedList,{className:"updates-list",items:e.selectedUpdates,getPartition:h,renderRow:(e,t,n)=>o.createElement(i,{index:e,details:n,update:t,isRowSelected:t.id===r}),onSelect:(e,t)=>a(t.data.id)}):o.createElement(j.ZeroData,{className:"updates-zero-data-content",imagePath:(0,n.getAssetLocation)(t,"ms.vss-work-web/new-work-item-form-content/Content/zerodata-no-results-found.svg"),imageAltText:Ut.NoResultsFoundText,secondaryText:Ut.NoResultsFoundText}))))))),onRenderFarElement:()=>{var t;return o.createElement("div",{className:"v-scroll-auto",style:{height:v?u:m}},o.createElement(hi.UpdateDetails,{update:null!==(t=e.find((e=>e.id===r)))&&void 0!==t?t:e[0]}))}})):null};const a=[[Ut.Today,0],[Ut.Yesterday,1],[Ut.LastWeek,7],[(0,s.format)(Ut.LastNDays,30),30]],d=Ut.Older;function h(e){const t=(0,ti.getUpdateDate)(e),o=Date.now();for(const[e,i]of a){const n=new Date(o);if(n.setHours(0,0,0,0),n.setDate(n.getDate()-i),t.getTime()>n.getTime())return{label:e,key:e,order:i}}return{label:d,key:d,order:Number.MAX_SAFE_INTEGER}}}(),gi=t.HistoryHistoryTab={},t.HistoryHistoryTab.HistoryTab=function({pageContext:e}){const t=(0,i.useService)("IWorkItemFormService"),n=(0,Bt.useWorkItem)(),r=(0,Bt.useFieldMetadata)(),[a,s]=(0,o.useState)(),l=(0,o.useMemo)((()=>a?a.filter(ti.isStateUpdate).reverse():[]),[a]),m=(0,i.useIsMounted)();return(0,o.useEffect)((()=>{t.getHistoryData(n.id,n.project.guid).then((e=>{m()&&s(e.filter((e=>(0,ui.hasChanges)(e,r,n))))}))}),[]),a?0===a.length?o.createElement(io.CollapsibleSection,{label:Ut.History},o.createElement(j.ZeroData,{iconProps:{iconName:"History"},imageAltText:Ut.HistoryZeroStateText,secondaryText:Ut.HistoryZeroStateText})):o.createElement("div",{className:"work-item-form-tab full-width"},o.createElement(io.CollapsibleSection,{label:Ut.StateGraph},o.createElement(oi.StateGraph,{stateUpdates:l})),o.createElement(io.CollapsibleSection,{label:Ut.History},o.createElement(pi.UpdatesList,{updates:a,pageContext:e}))):o.createElement(O.Spinner,{className:"flex-grow flex-center justify-center",size:"medium"})},ki=t.Historyindex={},__exportStar(gi,t.Historyindex),function(e){vi=t[e]={},t[e].IRemoteWorkItemServiceId="IRemoteWorkItemService";const o="ms.vss-work-web.remote-workitem-data-provider",i="ms.vss-work-web.remote-workitem-token-data-provider";class n extends W.VssService{_serviceStart(e){super._serviceStart(e)}async getRemoteWorkItemsAndTypes(e,t,i){var n;const r=t.endsWith("/")?t:t+"/",a=await this.getRemoteTokenProvider(),s={contributionIds:[o],context:{properties:{ids:e}}},l=(0,Ct.getContributionsClient)(this.pageContext,{rootPath:r,hostType:4,authTokenProvider:a});try{const e=await l.queryDataProviders(s,"project",i);return null!==(n=e.data[o]["work-items-data"])&&void 0!==n?n:[]}catch(o){return console.error(`Unable to load work items ${e.join(", ")} from host ${t} and project ${i}`),[]}}async getRemoteWorkItemAndHost(e){const t=this.pageContext.getService("IVssContributionService"),o=await t.getDataAsync("ms.vss-work-web.remote-workitem-url-data-provider",{url:e});return null!=o?o:void 0}async getRemoteTokenProvider(){const e=this.pageContext.getService("IAuthenticationService"),t=await this.getRemoteWorkitemToken();return e.getBearerTokenProvider(t.token)}async getRemoteWorkitemToken(){const e=(0,Ct.getContributionsClient)(this.pageContext),t={contributionIds:[i],context:{properties:{ids:[]}}};try{const o=await e.queryDataProviders(t);return o.data[i].remoteWorkItemSessionToken}catch(e){throw console.error(`Authentication error: ${e}`),e}}}W.Services.add(t[e].IRemoteWorkItemServiceId,{serviceFactory:n})}("LinksRemoteWorkItemRemoteWorkItemService"),function(e){fi=t[e]={},t[e].toLinkDisplayData=async function(e,t,o,i){var n;const r=t["work-item-data"],a=t["work-item-type-color-icon"],s=t["work-item-type-state-color"];if(!r||!o)return;const l=function(e){return"work-item-data"in e}(o)?function(e,t){const o=e["work-item-data"];return{tool:f.ToolIds.RemoteWorkItemTracking,ID:o.id,FldID:f.LinkTypeFieldIds.WorkItem,LinkType:t.id,RemoteHostId:e["work-item-host-id"],RemoteHostUrl:e["work-item-host-url"],RemoteHostName:e["work-item-host-name"],RemoteProjectId:e["work-item-project-id"]}}(o,i):o,m=e.getService("IVssLocationService"),c=e.getService("IWorkItemLinksService");i=(null!=i?i:l.LinkType)?await c.getWitLinkTypeEnd(l.LinkType):void 0;const d=""+r.id,u=""+r.fields[y.CoreFieldRefNames.Title],h=""+r.fields[y.CoreFieldRefNames.State],p=""+r.fields[y.CoreFieldRefNames.TeamProject],g=r.fields[y.CoreFieldRefNames.ChangedDate],k=r.fields[y.CoreFieldRefNames.AssignedTo];return{linkIdentifier:l,id:d,displayId:d,title:u,state:h,updateDate:g,tool:f.ToolIds.RemoteWorkItemTracking,linkTypeDisplayName:null!==(n=null==i?void 0:i.name)&&void 0!==n?n:f.RegisteredLinkTypeNames.RemoteWorkItemLink,registeredLinkType:f.RegisteredLinkTypeNames.RemoteWorkItemLink,witLinkTypeEnd:null==i?void 0:i.immutableName,uri:m.routeUrl("ms.vss-work-web.new-work-item-form-route",{project:p,id:d},l.RemoteHostUrl),icons:[a,{displayName:k}],group:{displayName:`${l.RemoteHostName}/${p}`,id:`${l.RemoteHostId}/${l.RemoteProjectId}`,iconName:"CloudUpload"},additionalData:{workItem:r,workItemTypeColorAndIcon:a,workItemStateAndColor:s}}}}("LinksRemoteWorkItemRemoteWorkItemUtils"),function(e){function i(e){var t,o,i,n;return(null===(o=null===(t=e.dataTransfer)||void 0===t?void 0:t.items)||void 0===o?void 0:o.length)>0?Array.from(e.dataTransfer.items).filter((e=>"file"===e.kind)).map((e=>e.getAsFile())):(null===(n=null===(i=e.dataTransfer)||void 0===i?void 0:i.files)||void 0===n?void 0:n.length)>0?Array.from(e.dataTransfer.files):[]}Ii=t[e]={},t[e].FileDropZone=function({onFilesDropped:e,children:t}){const[n,r]=(0,o.useState)(!1);return o.createElement("div",{className:"file-drop-zone-container full-width full-height v-scroll-auto",onDragEnter:e=>{(function(e){return i(e).length>0})(e)&&(r(!0),e.preventDefault(),e.stopPropagation())}},t,o.createElement("div",{className:(0,u.css)("file-drop-zone-frame padding-16 absolute-fill",n&&"active"),onDragLeave:e=>{r(!1)},onDrop:e=>{e.preventDefault(),e.stopPropagation(),r(!1)},onDragOver:e=>{e.preventDefault(),e.stopPropagation()}},o.createElement("div",{className:"file-drop-zone full-width full-height flex-column flex-center justify-center",onDragOver:e=>{e.preventDefault(),e.stopPropagation()},onDrop:t=>{r(!1);const o=i(t);0!==o.length&&(t.preventDefault(),e(o))}},o.createElement(m.Icon,{className:"file-drop-zone-icon font-size-xxxxl padding-bottom-16",iconName:"Upload"}),o.createElement("div",{className:"file-drop-zone-header font-size-xl padding-bottom-16"},Ut.UploadFilesHeader),o.createElement("div",{className:"file-drop-zone-instructions font-size-ml padding-bottom-16"},Ut.UploadFilesInstructions))))}}("AttachmentsFileDropZone"),function(e){wi=t[e]={},t[e].WorkItemFormNavBar=function({onNavigateNext:e,onNavigatePrevious:t,navigationData:n}){const{tabName:r,workItemIds:a,selectedItemIndexInVisibleList:m,selectedIndexScrollTopValue:c}=Object.assign({},n),d=(0,i.usePageContext)();return o.createElement("div",{className:"work-item-form-nav-bar flex-row flex-grow flex-center"},o.createElement(bt.HeaderTitle,{className:"flex-row flex-center padding-right-8"},null!=r?r:Ut.WorkItems," "),o.createElement("div",{className:"form-nav-bar-divider margin-horizontal-8"}),o.createElement(l.Button,{iconProps:{iconName:"Reply"},subtle:!0,text:Ut.BackToWorkItems,onClick:()=>(0,Je.FastPageSwitch)(d,(0,Io.getWorkItemHubUrl)(d),!1)}),void 0!==m&&a&&0!==a.length&&o.createElement("div",{className:"flex-row flex-grow justify-end flex-center"},o.createElement("div",{className:"padding-right-8"},(0,s.format)(Ut.SelectedWorkItem,m+1,a.length)),o.createElement(l.Button,{ariaLabel:Ut.PreviousWorkItem,subtle:!0,iconProps:{iconName:"Up"},onClick:t,disabled:m===c,tooltipProps:{text:Ut.PreviousWorkItem}}),o.createElement(l.Button,{ariaLabel:Ut.NextWorkItem,subtle:!0,iconProps:{iconName:"Down"},onClick:e,disabled:m+1===a.length,tooltipProps:{text:Ut.NextWorkItem}})))}}("HeaderWorkItemFormNavBar"),function(e){yi=t[e]={},t[e].WorkItemFormSubHeader=function(e){const t=(0,Bt.useWorkItem)(),i=t.getFieldValueById(y.DalFields.LastChangedById,!1,!1,!0),r=t.getFieldValueById(y.DalFields.LastChangedDateId),a=e.systemControls.find((e=>e.id===y.CoreFieldRefNames.State));a||console.error(Ut.StateControlMissingError);const l=t=>{const o=e.systemControls.find((e=>e.id===t||e.replacesFieldReferenceName===t));return o||console.error((0,s.format)(Ut.SystemControlMissingError,t)),o},m=l(y.CoreFieldRefNames.Reason),c=l(y.CoreFieldRefNames.AreaPath),d=l(y.CoreFieldRefNames.IterationPath);return o.createElement(Et.Surface,{background:1},o.createElement("div",{className:"work-item-form-subheader flex-row flex-grow flex-wrap padding-vertical-4 padding-horizontal-8"},o.createElement("div",{className:"flex-column padding-left-8"},a&&o.createElement(n,{control:a,workItem:t,shortcutGroupName:e.shortcutGroupName}),m&&o.createElement(n,{control:m,workItem:t,shortcutGroupName:e.shortcutGroupName})),o.createElement("div",{className:"wif-node-dropdowns flex-column flex-grow padding-left-8 padding-vertical-4"},c&&o.createElement(n,{control:c,workItem:t,shortcutGroupName:e.shortcutGroupName}),d&&o.createElement(n,{control:d,workItem:t,shortcutGroupName:e.shortcutGroupName})),o.createElement("div",{className:"flex-column padding-left-8 flex-end flex-grow"},o.createElement("div",{className:"flex-row flex-grow body-s secondary-text"},i&&r?o.createElement(o.Fragment,null,(0,s.format)(Ut.UpdatedBy,"identityRef"in i?i.identityRef.displayName:i.displayName)," ",o.createElement(U.Ago,{date:(0,M.getDateInUserTimeZone)(r),currentDate:(0,M.getDateInUserTimeZone)(),tooltipTimeFormat:M.tooltipTimeFormat})):o.createElement("br",null)),o.createElement(Tt.TabBar,{className:"wif-tabbar flex-self-end",onSelectedTabChanged:t=>e.selectedTabId.value=t,tabSize:"compact"}))))};class n extends i.VssComponent{constructor(e,t){super(e),this.dropdownItems=new b.ObservableArray([]),this.selection=new k.DropdownSelection,this.fieldValue=new b.ObservableValue(""),this.readOnly=new b.ObservableValue(!1),this.selectedNodePath=new b.ObservableValue(""),this.controlRef=o.createRef(),this.labelText=new b.ObservableValue(""),this.refreshAllowedValues=async()=>{if(this.field=this.props.workItem.getFieldByName(this.props.control.id),!this.field)return;this.fieldValue.value=this.props.workItem.getFieldValueById(this.field.fieldDefinition.id);const e=this.context.pageContext.getService("IWorkItemNodeService");let t=[],o=!0;switch(this.field.fieldDefinition.id){case y.DalFields.AreaPathId:o=!1;const i=await e.getAreaPathNodes(this.props.workItem.project.guid);i&&(t=(0,St.convertNodesToListBoxItems)(i));break;case y.DalFields.IterationPathId:o=!1;const n=await e.getIterationNodes(this.props.workItem.project.guid);n&&(t=(0,St.convertNodesToListBoxItems)(n));break;default:t=(0,Ge.getAllowedFieldValues)(this.field,this.props.workItem).value.map((e=>({id:e,text:e})))}const i=this.props.workItem.getFieldValueById(this.field.fieldDefinition.id),n=this.props.workItem.getFieldValueById(this.field.fieldDefinition.id,!0);let r=-1;n||i?(t.length?(r=t.findIndex((e=>{var t;return 0===(null===(t=e.text)||void 0===t?void 0:t.localeCompare(i))})),-1===r&&(r=t.findIndex((e=>{var t;return 0===(null===(t=e.text)||void 0===t?void 0:t.localeCompare(n))})))):(0,Ge.fieldHasList)(this.field)&&(t.push({id:n,text:n}),i!==n&&this.props.workItem.setFieldValueById(this.field.fieldDefinition.id,n),r=0),this.dropdownItems.value=t,o?this.selection.select(-1===r?0:r):void 0!==this.selectedNodePath.value&&0===this.selectedNodePath.value.localeCompare(i)||(this.selectedNodePath.value=i)):this.dropdownItems.value=t,this.readOnly.value=(0,Ge.isReadOnly)(this.field)},this.onValueChange=e=>{var t,o;switch(this.field.fieldDefinition.id){case y.DalFields.AreaPathId:this.props.workItem.setFieldValueById(y.DalFields.AreaIDId,null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.id);break;case y.DalFields.IterationPathId:this.props.workItem.setFieldValueById(y.DalFields.IterationIDId,null===(o=null==e?void 0:e.data)||void 0===o?void 0:o.id);break;default:this.props.workItem.setFieldValueById(this.field.fieldDefinition.id,null==e?void 0:e.text)}},this.context=t,this.field=e.workItem.getFieldByName(e.control.id),this.field||console.error((0,s.format)(Ut.InvalidFieldError,this.props.control.id)),this.refreshAllowedValues()}componentDidMount(){this.labelText.value=this.props.control.label;const e=this.props.control.label.indexOf("&");if(-1!==e){const t=this.props.control.label.charAt(e+1);this.labelText.value=o.createElement("label",{accessKey:t,htmlFor:(0,u.getSafeId)(r(this.props.control.label)),id:(0,u.getSafeId)(this.props.control.label)},this.props.control.label.substring(0,e),o.createElement("span",{className:"wif-label-shortcut-char"},t),this.props.control.label.substring(e+2));this.context.pageContext.getService("IVssKeyboardShortcutService").registerShortcut(this.props.shortcutGroupName,{description:(0,s.format)("Focus {0}",this.props.control.label.replace("&","")),combos:["alt+"+t.toLocaleLowerCase()],globalCombos:["alt+"+t.toLocaleLowerCase()],element:".work-item-form-page",action:()=>{var e;null===(e=this.controlRef.current)||void 0===e||e.focus()}})}}render(){if(!this.field)return null;const e=[o.createElement(Bo.MultiWorkItemFieldSubscriber,{key:`wif-${this.field.fieldDefinition.name}-subscriber`,fieldIds:[this.field.fieldDefinition.id,y.CoreField.TeamProject],onUpdate:this.refreshAllowedValues})];return o.createElement("div",{className:"flex-row flex-grow flex-center"},e,o.createElement(c.Observer,{readOnly:this.readOnly,selection:this.selection,selectedNodePath:this.selectedNodePath},(e=>{var t,i;const n=this.props.workItem.project.guid,a=[];if(!this.props.workItem.isReadOnly()&&e.readOnly&&a.push(o.createElement(m.Icon,{key:"readonly-icon",iconName:"Lock",tooltipProps:{text:(0,s.format)(Ut.ReadonlyFieldLockTooltip,this.field.fieldDefinition.name)}})),this.field.fieldDefinition.id===y.DalFields.StateId&&e.selection.length){const n=null!==(i=null===(t=this.dropdownItems.value[e.selection[0].beginIndex])||void 0===t?void 0:t.text)&&void 0!==i?i:"";a.push(o.createElement(io.StateCircle,{key:"state-circle",state:n}))}const l={ariaLabelledBy:this.props.control.label,className:(0,u.css)("flex-grow work-item-control-control",e.readOnly&&"readOnly"),disabled:e.readOnly,inputId:r(this.props.control.label),placeHolder:this.props.control.watermark},h={items:this.dropdownItems,onValueChange:this.onValueChange};let k=(0,s.format)(Ut.FieldNameTooltip,this.field.fieldDefinition.name);const v=this.props.workItem.getTypeData().rules.fieldHelpTexts[this.field.fieldDefinition.id];let f;switch(v&&(k=v+"\n"+k),this.field.fieldDefinition.id){case y.DalFields.AreaPathId:f=o.createElement(Me.AreaPathDropdown,Object.assign({},l,h,{projectId:n,ref:this.controlRef,selectedText:this.selectedNodePath}));break;case y.DalFields.IterationPathId:f=o.createElement(Be.IterationDropdown,Object.assign({},l,h,{projectId:n,ref:this.controlRef,selectedText:this.selectedNodePath}));break;default:f=(0,Ge.fieldHasList)(this.field)?o.createElement(g.EditableDropdown,Object.assign({},l,h,{allowTextSelection:!0,ref:this.controlRef,renderExpandable:t=>o.createElement(Ve.DropdownExpandableTextField,Object.assign({},t,{disabled:e.readOnly})),selectedText:this.fieldValue})):o.createElement(p.TextField,Object.assign({},l,{value:this.fieldValue,onChange:(e,t)=>this.onValueChange({id:t,text:t}),ref:this.controlRef}))}return o.createElement("div",{className:(0,u.css)("flex-row flex-grow",!this.props.control.visible&&"invisible")},o.createElement(c.Observer,{labelText:this.labelText},(()=>o.createElement(d.Tooltip,{className:"work-item-form-control-tooltip",text:k},o.createElement("div",{className:"work-item-control-label flex-row flex-center body-s padding-right-4 secondary-text"},this.labelText.value)))),o.createElement("div",{className:"work-item-control-before-content flex-row flex-center"},a),f)})))}}function r(e){return`${e}-input`}}("HeaderWorkItemFormSubHeader"),function(e){Ci=t[e]={},t[e].WorkItemTypeDropdown=function({onTypeChanged:e,workItemTypeFilter:t,workItemProjectId:r}){var a,s,l,m;const c=(0,i.usePageContext)(),d=(0,i.useService)("IWorkItemTypesService"),u=null!==(m=null!==(l=null===(s=null===(a=(0,_.getTFSPageData)(c))||void 0===a?void 0:a.project)||void 0===s?void 0:s.id)&&void 0!==l?l:r)&&void 0!==m?m:void 0;if(!u)throw new Error(Ut.NoProjectSpecifiedMessage);const h=function(e,t){const r=(0,i.useService)("IWorkItemTypesService"),[a,s]=(0,o.useState)();return o.useEffect((()=>{r.getWorkItemTypes(e,n).then((async e=>{const o=[];t&&(e=e.filter(t));for(const t of e)o.push({id:t,text:t});return s(new b.ObservableArray(o)),a}))}),[]),a}(u,t);return h?o.createElement(g.EditableDropdown,{items:h,onValueChange:async t=>{if(t){const o=await d.getWorkItemTypeData(u,[t.id]);e(o[0])}}}):null};const n=[Nt.WorkItemCategoryConstants.hidden,Nt.WorkItemCategoryConstants.testPlan,Nt.WorkItemCategoryConstants.testSuite,Nt.WorkItemCategoryConstants.testSharedStep,Nt.WorkItemCategoryConstants.testSharedParameter]}("LinksControlsWorkItemTypeDropdown"),function(e){bi=t[e]={},t[e].RemoteWorkItemLinkForm=function({workItemLinkTypeEndRefName:e,onArtifactsUpdated:t}){const n=(0,i.usePageContext)(),r=(0,o.useMemo)((()=>n.getService(vi.IRemoteWorkItemServiceId)),[]),a=(0,o.useMemo)((()=>n.getService("IWorkItemLinksService")),[]),[s,l]=(0,o.useState)(null),[m,c]=(0,o.useState)(null),[d,u]=(0,b.useObservable)(""),h=(0,o.useMemo)((()=>a.getWitLinkTypeEnd(e)),[e]);return(0,b.useDebouncedSubscription)(d,200,(async o=>{var i;if(!o)return t([]),c(null),void l(Ut.MissingRemoteWorkItemUrl);const a=await r.getRemoteWorkItemAndHost(o);if(o!==d.value)return;if(!a)return t([]),c(null),void l(Ut.InvalidRemoteWorkItemUrl);const s=null===(i=a["work-item-data"])||void 0===i?void 0:i.id,[m]=await r.getRemoteWorkItemsAndTypes([s],a["work-item-host-url"],a["work-item-project-id"]);if(o!==d.value)return;const u=await h;if(!u)return void console.error(`Invalid link type end "${e}"`);const p=await(0,fi.toLinkDisplayData)(n,m,a,u);if(o===d.value){if(!p)return t([]),c(null),void l(Ut.InvalidRemoteWorkItemUrl);t([p]),c(p),l(null)}})),o.createElement(o.Fragment,null,o.createElement(fe.FormItem,{label:Ut.RemoteWorkItemUrlLabel,error:!!s,message:s},o.createElement(p.TextField,{value:d,onChange:(e,t)=>u(t),placeholder:Ut.RemoteWorkItemUrlPlaceholder})),o.createElement(Kt.LinkTopologyDiagram,{workItemLinkTypeEnd:e}),m&&o.createElement("div",{className:"padding-16"},o.createElement(So.ArtifactLink,{showDetails:!0,artifactData:m})))}}("LinksRemoteWorkItemRemoteWorkItemLinkForm"),function(e){t[e]={},t[e].IRemoteWorkItemLinkTypeServiceID="remote-work-item-link-type-service";class i extends Ie.BaseRegisteredLinkTypeService{getToolId(){return f.ToolIds.RemoteWorkItemTracking}renderLinkTypeForm(e,t,i,n,r){return r?o.createElement(bi.RemoteWorkItemLinkForm,{workItemLinkTypeEndRefName:r,onArtifactsUpdated:t}):o.createElement(o.Fragment,null)}renderState(e){var t;const i=null===(t=e.additionalData)||void 0===t?void 0:t.workItemStateAndColor;return i?o.createElement(o.Fragment,null,o.createElement(io.StateCircle,{className:"icon-margin",state:i.name,color:"#"+i.color}),i.name):o.createElement(o.Fragment,null,e.state)}resolveArtifacts(e){const t=this.pageContext.getService(vi.IRemoteWorkItemServiceId);return(0,Dt.mapToArray)(function*(e){const t=new Map;for(const o of e){if(!o.RemoteHostId||!o.RemoteHostUrl||!o.RemoteProjectId)continue;t.has(o.RemoteHostId)||t.set(o.RemoteHostId,new Map);const e=t.get(o.RemoteHostId);e.has(o.RemoteProjectId)||e.set(o.RemoteProjectId,[]);e.get(o.RemoteProjectId).push(o)}for(const[e,o]of t.entries())for(const[t,i]of o.entries()){const o=i[0].RemoteHostUrl;yield{remoteHostId:e,remoteProjectId:t,remoteHostUrl:o,identifiers:i}}return}(e),(async({remoteHostId:e,remoteProjectId:o,remoteHostUrl:i,identifiers:n})=>{const r=await t.getRemoteWorkItemsAndTypes(n.map((e=>e.ID)),i,o);return(await Promise.all(r.map((e=>{const t=n.find((t=>{var o;return t.ID&&t.ID===(null===(o=e["work-item-data"])||void 0===o?void 0:o.id)}));return(0,fi.toLinkDisplayData)(this.pageContext,e,t)})))).filter((e=>!!e))}))}}W.Services.add(t[e].IRemoteWorkItemLinkTypeServiceID,{serviceFactory:i})}("LinksRemoteWorkItemRemoteWorkItemLinkTypeService"),function(e){Ei=t[e]={},t[e].HyperlinkForm=function({linkType:e,onArtifactsUpdated:t}){const[i,n]=(0,o.useState)("");return o.createElement(fe.FormItem,{label:Ut.HyperlinkAddressLabel},o.createElement(p.TextField,{value:i,onChange:(o,i)=>{n(i),t([{linkIdentifier:{tool:f.ToolIds.WorkItemTracking,FldID:f.LinkTypeFieldIds.Hyperlink,FilePath:i},title:i,id:i,uri:i,displayId:i,registeredLinkType:(0,I.getLinkTypeDisplayName)(e),tool:f.ToolIds.WorkItemTracking,linkTypeDisplayName:e,icons:[{iconName:"Link"}]}])}}))}}("LinksWorkItemHyperlinkForm"),function(e){Ti=t[e]={},t[e].NewWorkItemLinkForm=function({onNewArtifactsUpdated:e,workItemLinkTypeEnd:t,linkableWorkItemTypeFilter:i,originWorkItems:n}){var r,a;const s=o.useRef(new b.ObservableValue("")),[l,m]=(0,o.useState)(""),[c,d]=(0,o.useState)();(0,o.useEffect)((()=>{c&&l&&e&&e({title:l,typeData:c})}),[l,c]);const u=null===(a=null===(r=n[0])||void 0===r?void 0:r.project)||void 0===a?void 0:a.guid;return o.createElement("div",{className:"work-item-link-form"},o.createElement(fe.FormItem,{className:"margin-bottom-8",label:Ut.TypeLabel},o.createElement(Ci.WorkItemTypeDropdown,{onTypeChanged:d,workItemTypeFilter:i,workItemProjectId:u})),o.createElement(fe.FormItem,{label:Ut.TitleLabel},o.createElement(p.TextField,{value:s.current,onChange:(e,t)=>{s.current.value=t,l!==t&&m(t)}})),o.createElement(Kt.LinkTopologyDiagram,{workItemLinkTypeEnd:t}))}}("LinksWorkItemNewWorkItemLinkForm"),function(e){Si=t[e]={};const n={addArtifactCompleteListener:()=>{}};t[e].WorkItemLinkForm=function({onArtifactsUpdated:e,linkableWorkItemTypeFilter:t,workItemLinkTypeEnd:r,originWorkItems:a}){var s;const l=(0,i.usePageContext)(),m=(0,i.useService)("IWorkItemLinksService"),[c,d]=(0,o.useState)([]),u=(0,o.useRef)([]),h=(0,o.useRef)(null),p=null!=t?t:(0,S.getDefaultLinkableWorkItemTypeFilter)(a),g=(0,o.useCallback)((e=>p(e.fields[y.CoreFieldRefNames.WorkItemType])),[p]),k=(0,o.useCallback)((async t=>{const o=await m.getWitLinkTypeEnd(r);if(!o)return;const i=await new Xt.WorkItemLinkTopologyValidator(l,a,o,t).validate();if(d(i),i.length>0)return void e([]);const n=Array.from(t).map((e=>({ID:e,tool:f.ToolIds.WorkItemTracking,FldID:f.LinkTypeFieldIds.WorkItem,LinkType:null==o?void 0:o.id}))),s=await(0,Zt.resolveWorkItemArtifacts)(n,l);e(s)}),[r]);(0,o.useEffect)((()=>{var e;null===(e=h.current)||void 0===e||e.removeWorkItems(u.current),k([])}),[r]);const v=null===(s=a[0])||void 0===s?void 0:s.project;let I;return void 0!==v&&(I={id:v.guid,name:v.name}),o.createElement("div",{className:"work-item-link-form"},o.createElement(xt.LinkedWorkItemsDropdown,{withLiveTextSearch:!0,ref:h,artifactChangesContext:n,workItemSuggestionFilter:g,onSelectedWorkItemsChanged:async e=>{const t=Array.from(new Set(e.map((e=>e.id))));u.current=t,k(t)},workItemProjectData:I}),o.createElement(Kt.LinkTopologyDiagram,{workItemLinkTypeEnd:r}),0===c.length?null:o.createElement("div",{className:"work-item-link-form-errors flex-column padding-vertical-4 padding-horizontal-8 margin-top-8"},c.map(((e,t)=>o.createElement("div",{className:"padding-vertical-4",key:t},e)))))}}("LinksWorkItemWorkItemLinkForm"),function(e){t[e]={},t[e].IWorkItemLinkTypeServiceID="work-item-link-type-service";class i extends Ie.BaseRegisteredLinkTypeService{getToolId(){return f.ToolIds.WorkItemTracking}renderLinkTypeForm(e,t,i,n,r,a){return i===f.RegisteredLinkTypeNames.Hyperlink?o.createElement(Ei.HyperlinkForm,{linkType:i,onArtifactsUpdated:t}):o.createElement(Si.WorkItemLinkForm,{linkType:i,onArtifactsUpdated:t,workItemLinkTypeEnd:null!=r?r:"",originWorkItems:n,linkableWorkItemTypeFilter:a})}renderNewLinkTypeForm(e,t,i,n,r,a){return o.createElement(Ti.NewWorkItemLinkForm,{originWorkItems:n,onNewArtifactsUpdated:t,workItemLinkTypeEnd:r,linkableWorkItemTypeFilter:a})}renderState(e){var t,i;return e.state?(null===(t=e.additionalData)||void 0===t?void 0:t.workItem)?o.createElement(o.Fragment,null,o.createElement(io.StateCircle,{className:"icon-margin",state:e.state,workItem:null===(i=e.additionalData)||void 0===i?void 0:i.workItem}),e.state):o.createElement(o.Fragment,null,e.state):null}resolveArtifacts(e){const t=e.filter((e=>e.FldID===f.LinkTypeFieldIds.WorkItem)),o=e.filter((e=>e.FldID===f.LinkTypeFieldIds.Hyperlink));return[(0,Zt.resolveWorkItemArtifacts)(t,this.pageContext,2),n(o)]}}function n(e){return Promise.resolve(e.filter((e=>!!e.FilePath)).map((e=>({tool:f.ToolIds.WorkItemTracking,linkIdentifier:e,id:e.FilePath,displayId:"",title:e.FilePath,icons:[{iconName:"Link"}],linkTypeDisplayName:(0,I.getLinkTypeDisplayName)(f.RegisteredLinkTypeNames.Hyperlink),registeredLinkType:f.RegisteredLinkTypeNames.Hyperlink,uri:(0,X.isRemoved)(e.RemovedDate)?"":e.FilePath}))))}W.Services.add(t[e].IWorkItemLinkTypeServiceID,{serviceFactory:i})}("LinksWorkItemWorkItemLinkTypeService"),function(e){t.WorkItemFormView={};class a extends i.VssComponent{constructor(e,t){super(e,t),this.workItem=new b.ObservableValue(void 0),this.projectId=new b.ObservableValue(void 0),this.linksCount=new b.ObservableValue(0),this.attachmentsCount=new b.ObservableValue(0),this.focusDiscussion=new b.ObservableValue(!1),this.notificationHostInstances=[],this.workItemLoadError=new b.ObservableValue(void 0),this.pageReference=o.createRef(),this.onTabSelectionUpdated=()=>{var e,t;if(this.props.onTabChange){const o=null!==(t=null===(e=this.tabs.value.find((e=>e.id===this.selectedTabId.value)))||void 0===e?void 0:e.id)&&void 0!==t?t:"";this.props.onTabChange(o)}},this.onFieldUpdate=(e,t)=>{this.notificationHostInstances.forEach((e=>{if(e.onFieldChanged&&this.workItem.value){const o={};if(t==Te.WorkItemWatermarkAllAction)this.workItem.value.fields.forEach((e=>{const t=e.fieldDefinition.referenceName;o[t]=this.workItem.value.getFieldValueByName(t)}));else{const e=parseInt(t),i=this.workItem.value.fieldMapById[e].fieldDefinition.referenceName;o[i]=this.workItem.value.getFieldValueById(e)}e.onFieldChanged({id:this.workItem.value.id,changedFields:o})}}))},this.onExtensionLoaded=(e,t)=>{t&&this.notificationHostInstances.push(t)},this.getShortcutGroupName=()=>{var e;return`${Ut.WorkItemFormKeyboardShortcutGroup}${null===(e=this.workItem.value)||void 0===e?void 0:e.id}`},this.onRefreshed=()=>{this.notificationHostInstances.forEach((e=>{e.onRefreshed&&this.workItem.value&&e.onRefreshed({id:this.workItem.value.id})}))},this.onReset=()=>{this.notificationHostInstances.forEach((e=>{e.onReset&&this.workItem.value&&e.onReset({id:this.workItem.value.id})}))},this.updateEditorTitle=()=>{this.workItem.value&&(document.title=(0,Io.getWorkItemFormTitle)(this.workItem.value))},this.onDelete=async()=>{var e,t;if(this.props.onLegacyDelete){const e=this.getLegacyWorkItem();e&&this.props.onLegacyDelete(e)}null===(t=(e=this.props).onDelete)||void 0===t||t.call(e)},this.onDismiss=async()=>{var e,t;if((await this.tryShowSaveDialog()).canDismiss){if(this.props.onLegacyDismiss){const e=this.getLegacyWorkItem();e&&this.props.onLegacyDismiss(e)}null===(t=(e=this.props).onDismiss)||void 0===t||t.call(e)}},this.tryShowSaveDialog=async()=>{var e;const t=(null===(e=this.workItem.value)||void 0===e?void 0:e.manualDirty.value)&&!this.props.ignoreUnsavedChanges?this.unsavedChangesService.showMessage(this.workItem.value,(()=>this.onSave((()=>{this.workItemFormService.resetHistoryData()}),(()=>{this.workItemFormService.resetHistoryData()})))):Promise.resolve(!0);return{canDismiss:await t}},this.updateLinksAndAttachments=()=>{var e,t;const o=null!==(t=null===(e=this.workItem.value)||void 0===e?void 0:e.getLinks())&&void 0!==t?t:[],i=o.filter((e=>0===(0,s.localeIgnoreCaseComparer)(e.baseLinkType,"Attachment"))).length;this.attachmentsCount.value=i,this.linksCount.value=o.length-i,this.workItem.value&&(this.context.pageContext.getService("IWorkItemLinksService").refreshLinkData(this.workItem.value),this.context.pageContext.getService("IWorkItemFormAttachmentsService").getAttachments(this.workItem.value))},this._shouldWorkItemBeUpdated=(e,t)=>!!e&&e.id===t.id&&(t.linkOnlyUpdate||t.isCommentReactionUpdate||e.revision.value<t.revision)&&!e.saving.value&&!e.isDirty(!0,[y.CoreField.History]),this._onWorkItemUpdated=async e=>{const t=this.workItem.value;if(this._shouldWorkItemBeUpdated(t,e))if(e.isCommentReactionUpdate){this.context.pageContext.getService("IWorkItemFormCommentService").syncCommentReactions(t,e.commentId)}else{const o="delete"===e.changeType;try{await t.refresh({isDeleted:o,doNotResetComment:!0,doNotResetIfManuallyDirty:!0})}catch(e){(0,Lt.publishEvent)(this.context.pageContext,Te.WITCustomerIntelligenceArea.WORK_ITEM_TRACKING,Te.WITPerformanceScenario.WORKITEM_SIGNALR_REFRESHERROR,{project:t.project.name,workItemSessionId:t.sessionId,workItemId:t.id,error:e})}(0,Lt.publishEvent)(this.context.pageContext,Te.WITCustomerIntelligenceArea.WORK_ITEM_TRACKING,Te.WITPerformanceScenario.WORKITEM_SIGNALR_REFRESHCOMPLETE,{project:t.project.name,workItemSessionId:t.sessionId,workItemId:t.id})}},this.resetHistoryData=()=>{var e;null===(e=this.context.pageContext)||void 0===e||e.getService("IWorkItemFormService").resetHistoryData()},this.onFocusGroup=e=>{var t,o;let i=0;const n="."+io.collapseButtonClassName,r="."+io.collapsibleSectionClassName,a=Array.prototype.slice.call(document.querySelectorAll(n)),s=null===(t=document.activeElement)||void 0===t?void 0:t.closest(r);if(s){const t=s.querySelector(n),o=a.indexOf(t);i=e?(o+1)%a.length:document.activeElement!==t?o:o>0?o-1:a.length-1}else i=e?0:a.length-1;null===(o=a[i])||void 0===o||o.focus()},this.workItemModelService=t.pageContext.getService("IWorkItemModelService"),this.workItemFormService=t.pageContext.getService("IWorkItemFormService"),this.attachmentsService=t.pageContext.getService("IWorkItemFormAttachmentsService"),this.activeWorkItemService=t.pageContext.getService("ms.vss-work-web.active-work-item-service")}async componentDidMount(){var e,t,o,i,n,r,a,s,l;const m=this.context.pageContext.getService("IVssNavigationService"),c=this.context.pageContext.getService("IVssPerformanceService"),d=this.context.pageContext.getService("IVssContributionService");this.userSettings=d.getData("ms.vss-work-web.work-item-layout-user-settings-data-provider");const u=this.context.pageContext.getService("IWorkItemsHubNavDataService");this.workItemsNavigationData=u.getNavigationData();const h=m.getRouteValues().id;let p=Number(h)?parseInt(h):void 0,g=m.getRouteValues().workItemTypeName;this.unsavedChangesService=this.context.pageContext.getService("IWorkItemFormUnsavedChangesService");let k,v=!0;if("workItemId"in this.props&&(p=this.props.workItemId,k=this.props.shouldRefresh,v=!1),"workItemTypeName"in this.props&&(g=this.props.workItemTypeName,v=!1),"workItem"in this.props&&(v=!1),this.selectedTabId||(this.selectedTabId=new b.ObservableValue("")),"workItem"in this.props)this.workItemType=new b.ObservableValue(this.props.workItem.getTypeData()),this.workItem.value=this.props.workItem,this.selectedTabId.subscribe(this.onTabSelectionUpdated),v&&c.markTimeToInteractive(Te.WorkItemFormPerfConstants.WorkItemFormArea,Te.WorkItemFormPerfConstants.EditWorkItemView);else if(p&&!g)await this.getWorkItemFromId(p),k&&await(null===(e=this.workItem.value)||void 0===e?void 0:e.refresh()),v&&c.markTimeToInteractive(Te.WorkItemFormPerfConstants.WorkItemFormArea,Te.WorkItemFormPerfConstants.EditWorkItemView);else if(g){const e=this.props,o=await this.loadTemplateIfSpecified(null!==(t=null==e?void 0:e.initialValues)&&void 0!==t?t:{});await this.getWorkItemFromType(g,o),v&&c.markTimeToInteractive(Te.WorkItemFormPerfConstants.WorkItemFormArea,Te.WorkItemFormPerfConstants.CreateWorkItemView)}this.activeWorkItemService.setActiveWorkItem(this.workItem.value);const f=d.getContributionIdsByType("ms.vss-work-web.work-item-notifications");for(const e of f)(0,Eo.getRegisteredInstance)(this.context.pageContext,this.workItem.value,e,{}).then((e=>{e&&this.notificationHostInstances.push(e)}));this.shouldUpdateTitle()&&(this.updateEditorTitle(),this.workItem.value.dirty.subscribe(this.updateEditorTitle)),this.updateLinksAndAttachments(),this.registerShortcuts(),!this.props.ignoreUnsavedChanges&&this.workItem.value&&this.unsavedChangesService.register(this.workItem.value),null===(o=this.workItem.value)||void 0===o||o.getFieldWatermark().subscribe(this.onFieldUpdate),this._connectSignalR(),null===(n=(i=this.props).onLoad)||void 0===n||n.call(i,this.workItem.value),null===(a=(r=this.props).onLegacyLoad)||void 0===a||a.call(r,this.getLegacyWorkItem()),null===(l=(s=this.props).onRegisterTryShowSaveDialog)||void 0===l||l.call(s,this.tryShowSaveDialog)}async loadTemplateIfSpecified(e){let t;const o=this.context.pageContext.getService("IVssHistoryService").getState(),i=o.templateId,n=o.ownerId;if(i&&n){const o=(0,r.getWorkItemTrackingClient)(this.context.pageContext),a=(0,_.getTFSProject)(this.context.pageContext),s=await o.getTemplate(a.id,n,i);t=Object.assign(Object.assign({},e),s.fields)}else t=Object.assign({},e);return Object.keys(o).filter((e=>e.startsWith("[")&&e.endsWith("]"))).forEach((e=>{const i=e.substr(1,e.length-2);t[i]=o[e]})),t}async componentDidUpdate(e){var t,o,i,n;const r=this.workItem.value;let a=!1;this.shouldUpdateTitle()&&this.workItem.value.dirty.unsubscribe(this.updateEditorTitle),"workItemId"in this.props&&("workItemId"in e&&this.props.workItemId!==e.workItemId||!("workItemId"in e))?(a=!0,this.workItem.value=void 0,await this.getWorkItemFromId(this.props.workItemId)):"workItem"in this.props&&("workItem"in e&&this.props.workItem!==e.workItem||!("workItem"in e))?(a=!0,this.workItemType=new b.ObservableValue(this.props.workItem.getTypeData()),this.workItem.value=this.props.workItem):"workItemTypeName"in this.props&&("workItemTypeName"in e&&this.props.workItemTypeName!==e.workItemTypeName||!("workItemTypeName"in e))&&(a=!0,this.workItem.value=void 0,await this.getWorkItemFromType(this.props.workItemTypeName,this.props.initialValues)),a&&(this.props.ignoreUnsavedChanges||(r&&this.unsavedChangesService.unregister(r),this.workItem.value&&this.unsavedChangesService.register(this.workItem.value)),r&&this._disconnectSignalR(r.id),this._connectSignalR()),this.shouldUpdateTitle()&&(this.updateEditorTitle(),this.workItem.value.dirty.subscribe(this.updateEditorTitle)),null===(o=(t=this.props).onLoad)||void 0===o||o.call(t,this.workItem.value),null===(n=(i=this.props).onLegacyLoad)||void 0===n||n.call(i,this.getLegacyWorkItem())}componentWillUnmount(){this.workItem.value&&!this.props.ignoreUnsavedChanges&&this.unsavedChangesService.unregister(this.workItem.value),this.workItem.value&&this._disconnectSignalR(this.workItem.value.id),this.unregisterShortcuts(),this.selectedTabId.unsubscribe(this.onTabSelectionUpdated),this.notificationHostInstances.forEach((e=>{e.onUnloaded&&this.workItem.value&&e.onUnloaded({id:this.workItem.value.id})}))}tabIcon(e){return 1===e.pageType?void 0:2===e.pageType?{iconName:"History"}:3===e.pageType?{iconName:"Link"}:{iconName:"Attach"}}renderTab(e,t){return 1===e.pageType?o.createElement(qo.WorkItemFormTab,{page:e,includeDiscussion:t,onExtensionLoaded:this.onExtensionLoaded}):2===e.pageType?o.createElement(ki.HistoryTab,{pageContext:this.context.pageContext}):3===e.pageType?o.createElement(Mo.LinksTab,null):o.createElement(ko.AttachmentsTab,null)}setPagesVisibility(e){for(let t of e){let e=!1;if(t.visible){for(let o of t.sections)for(let t of o.groups){let o=!1;for(let i of t.controls)if(i.visible){o=!0,e=!0;break}t.isContribution&&t.visible&&(e=!0,o=!0),t.visible=o}t.isContribution&&(e=!0),t.visible=e}}}render(){return o.createElement(Et.Surface,{background:0},o.createElement(c.Observer,{focusDiscussion:this.focusDiscussion,workItem:{observableValue:this.workItem,filter:()=>(this.activeWorkItemService.setActiveWorkItem(this.workItem.value),!0)},workItemLoadError:this.workItemLoadError},(e=>e.workItem?o.createElement(Bt.WorkItemFormPageContextProvider,{value:{focusDiscussion:e.focusDiscussion,pageContext:this.context.pageContext,updateFocusDiscussion:e=>{this.focusDiscussion.value=e},workItem:e.workItem}},o.createElement(Bo.WorkItemFieldSubscriber,{key:"wif-wi-type-subscriber",fieldId:y.DalFields.WorkItemTypeId,onUpdate:()=>this.workItemType.value=e.workItem.getTypeData()}),o.createElement(Bo.MultiWorkItemFieldSubscriber,{fieldIds:[y.DalFields.AttachedFiles,y.DalFields.RelatedLinks,y.DalFields.LinkedFiles,y.DalFields.BISURI],onUpdate:()=>this.updateLinksAndAttachments()}),o.createElement(Ii.FileDropZone,{onFilesDropped:t=>e.workItem&&this.attachmentsService.attachFiles(e.workItem,t)},o.createElement(c.Observer,{workItemType:this.workItemType},(t=>{var i;this.tabs=new b.ObservableCollection;const n=this.workItemFormService.getWorkItemFormLayout(t.workItemType);this.setPagesVisibility(n.pages);const r=n.pages.filter((e=>e.visible)),a=r.length>0?r[0].id:"";if(this.tabs.push(r.map((t=>{const i=this.tabIcon(t);return{id:t.id,ariaLabel:t.label,badgeCount:this.getBadgeCount(t),name:i?void 0:t.label,order:t.pageType,iconProps:i,render:()=>this.renderTab(t,t.id===a),renderBadge:1===t.pageType?()=>o.createElement(c.Observer,{infoText:e.workItem.infoText},(()=>t.sections.some((t=>t.groups.some((t=>(0,Go.isGroupInvalid)(t,e.workItem)))))?o.createElement(m.Icon,{ariaLabel:(0,s.format)(Ut.InvalidTabOrGroup,t.label),className:"padding-left-4 error-text",key:"invalid-control-icon",iconName:"AlertSolid"}):null)):void 0}}))),void 0!==this.props.selectedTabId){const e=this.props.selectedTabId;let t;if((0,s.isGuid)(e))t=this.tabs.value.find((t=>t.id===e));else if(t=this.tabs.value.find((t=>t.id===e)),!t&&e.length>0){const o=e.substring(e.lastIndexOf(".")+1);t=this.tabs.value.find((e=>e.id.includes(o)))}t||(t=this.tabs.value[0]),this.selectedTabId&&t.id!==this.selectedTabId.value&&(this.selectedTabId.value=t.id)}this.selectedTabId&&this.tabs.value.some((e=>e.id===this.selectedTabId.value))||(this.selectedTabId=new b.ObservableValue(this.tabs.value[0].id));const l=this.workItemsNavigationData&&(0,Io.isNewWorkItemFormRoute)(this.context.pageContext)&&!this.props.onDismiss;return o.createElement(At.Page,{ref:this.pageReference,className:(0,u.css)(this.props.className,"work-item-form-page flex-grow flex-column v-scroll-hidden form-height"),selectedTabId:this.selectedTabId,tabProviders:this.tabs},o.createElement(Bt.ControlDefaultOptionsContext.Provider,{value:{showChromeBorder:!0===(null===(i=this.userSettings)||void 0===i?void 0:i.fieldChromeBorder),showEmptyReadOnlyFields:!0===n.showEmptyReadOnlyFields}},o.createElement(Pt.BoardsMessages,{className:"boards-message-bar flex-noshrink"}),o.createElement(Ee.ConditionalChildren,{renderChildren:e.workItem.saving},o.createElement("div",{className:"absolute-fill work-item-saving-layer"})),l&&o.createElement(wi.WorkItemFormNavBar,{onNavigateNext:()=>{var e;return void 0!==(null===(e=this.workItemsNavigationData)||void 0===e?void 0:e.selectedItemIndexInVisibleList)&&this.navigateBetweenWorkItems(this.workItemsNavigationData.selectedItemIndexInVisibleList+1)},onNavigatePrevious:()=>{var e;return void 0!==(null===(e=this.workItemsNavigationData)||void 0===e?void 0:e.selectedItemIndexInVisibleList)&&this.navigateBetweenWorkItems(this.workItemsNavigationData.selectedItemIndexInVisibleList-1)},navigationData:this.workItemsNavigationData}),o.createElement(Qo.WorkItemFormHeader,{onDelete:this.props.onDelete||this.props.onLegacyDelete?this.onDelete:void 0,onCommentCountClick:()=>this.onFocusDiscussion(),onDismiss:this.props.onDismiss||this.props.onLegacyDismiss?this.onDismiss:void 0,onRefreshed:this.onRefreshed,onReset:this.onReset,onSave:(e,t)=>this.onSave(e,t),onToggleFullscreen:this.props.onToggleFullscreen,systemControls:n.systemControls,shortcutGroupName:this.getShortcutGroupName()}),o.createElement(yi.WorkItemFormSubHeader,{selectedTabId:this.selectedTabId,systemControls:n.systemControls,shortcutGroupName:this.getShortcutGroupName()}),o.createElement(io.FullScreenSectionContainer,null,o.createElement("div",{className:"work-item-form-page-content page-content page-content-top flex-row flex-grow v-scroll-auto full-height full-width flex-wrap"},o.createElement(Tt.TabContent,{key:"tab:"+this.selectedTabId.value})))))})))):e.workItemLoadError?o.createElement(d,{onDismiss:this.props.onDismiss&&this.onDismiss},o.createElement(j.ZeroData,{primaryText:Ut.ServerError,secondaryText:e.workItemLoadError,imagePath:(0,n.getAssetLocation)(this.context.pageContext,"ms.vss-work-web/new-work-items-hub-content/Illustrations/general-something-wrong-on-server.svg"),imageAltText:Ut.ServerError})):o.createElement(d,{onDismiss:this.props.onDismiss&&this.onDismiss},o.createElement(O.Spinner,{className:"flex-grow"})))))}shouldUpdateTitle(){return this.workItem.value&&(this.props.updateDocumentTitle||(0,Io.isNewWorkItemFormRoute)(this.context.pageContext)&&!this.props.onDismiss)}getLegacyWorkItem(){return this.legacyWorkItem?this.legacyWorkItem:this.workItem.value?new $e.LegacyWorkItem(this.context.pageContext,this.workItem.value,[]):void 0}async getWorkItemFromId(e){try{const t=await this.workItemModelService.getWorkItem(e,{includeHistory:!0});this.workItemType=new b.ObservableValue(t.getTypeData()),this.workItem.value=t}catch(e){e instanceof Error?this.workItemLoadError.value=e.message:(null==e?void 0:e.toString())?this.workItemLoadError.value=e.toString():this.workItemLoadError.value=Ut.ErrorLoadingWorkItem}}async getWorkItemFromType(e,t,o){const i=(0,_.getTFSProject)(this.context.pageContext);if(!i||!i.id)throw Error(Ut.ProjectInfoFailure);this.projectId.value=i.id;const n=await this.workItemModelService.getWorkItemTypeData(this.projectId.value,[e]);if(!n||1!==n.length)throw Error((0,s.format)(Ut.InvalidWorkItemType,e));{const e=await this.workItemModelService.createWorkItem(n[0],this.projectId.value);for(const[o,i]of Object.entries(null!=t?t:{}))e.setFieldValueByName(o,i);(null==t?void 0:t[Wt.AddTagsPseudoRefName])&&(0,Wt.processTagsChanges)(e,{fieldName:Wt.AddTagsPseudoRefName,value:t[Wt.AddTagsPseudoRefName]}),(null==t?void 0:t[Wt.RemoveTagsPseudoRefName])&&(0,Wt.processTagsChanges)(e,{fieldName:Wt.RemoveTagsPseudoRefName,value:t[Wt.RemoveTagsPseudoRefName]}),o&&e.addLinks(o),this.workItemType=new b.ObservableValue(e.getTypeData()),this.workItem.value=e}}onFocusDiscussion(){this.focusDiscussion.value=!0,this.selectedTabId.value=this.tabs.value[0].id}async onSave(e,t){if(this.workItem.value)try{const t=await this.workItem.value.save(void 0,!0),o=this.workItem.value;o&&(this.workItemModelService.addWorkItemToMap(o.id,o),this.props.onSaveComplete&&this.props.onSaveComplete(o,!0));const i=this.getLegacyWorkItem();i&&this.props.onLegacySave&&this.props.onLegacySave(i),e(t),this.notificationHostInstances.forEach((e=>{e.onSaved&&e.onSaved({id:o.id})}))}catch(e){t&&t(e)}}getBadgeCount(e){switch(e.pageType){case 3:return this.linksCount;case 4:return this.attachmentsCount;default:return}}async navigateBetweenWorkItems(e){var t,o,i,n,r,a;let s=null===(o=null===(t=this.workItemsNavigationData)||void 0===t?void 0:t.workItemIds)||void 0===o?void 0:o[e];if(s){const t=this.workItem.value;if((null==t?void 0:t.dirty.value)&&!await this.unsavedChangesService.showMessage())return;this.shouldUpdateTitle()&&t.dirty.unsubscribe(this.updateEditorTitle),t&&this.unsavedChangesService.unregister(t),null==t||t.reset(),this.workItem.value=void 0,this.workItemsNavigationData=Object.assign(Object.assign({},this.workItemsNavigationData),{selectedItemIndexInVisibleList:e,lastTriagedWorkItemId:s}),this.context.pageContext.getService("IWorkItemsHubNavDataService").setNavigationData(this.workItemsNavigationData),await this.getWorkItemFromId(s),t&&this._disconnectSignalR(t.id),this._connectSignalR(),this.updateEditorTitle(),this.workItem.value.dirty.subscribe(this.updateEditorTitle),null===(n=(i=this.props).onLoad)||void 0===n||n.call(i,this.workItem.value),null===(a=(r=this.props).onLegacyLoad)||void 0===a||a.call(r,this.getLegacyWorkItem()),null==t||t.reset()}}async _disconnectSignalR(e){const t=this._tryGetSignalRService();t&&await t.endWatch(e)}async _connectSignalR(){const e=this._tryGetSignalRService();if(!e||!this.workItem.value)return;const t=(0,q.isFeatureFlagEnabled)(this.context.pageContext,"WebAccess.SignalR.AppPool",!1);await e.watch(this.workItem.value.id,this._onWorkItemUpdated,t)}_shouldLoadSignalRService(){return(0,Rt.userHasClaim)(this.context.pageContext,"member")&&!!this.workItem.value&&!this.workItem.value.isDeleted()&&!this.workItem.value.isNew()}_tryGetSignalRService(){return this._shouldLoadSignalRService()?this.context.pageContext.getService("ms.vss-work-web.work-item-signalr-service"):null}registerShortcuts(){var e;const t=this.context.pageContext.getService("IVssKeyboardShortcutService"),o=null!==(e=Ft.findDOMNode(this.pageReference.current))&&void 0!==e?e:void 0,i=o instanceof Text?o.toString():o,n=this.getShortcutGroupName();t.registerShortcut(n,{combos:["mod+shift+,"],description:Ut.MoveToLeftTabShortcut,globalCombos:["mod+shift+,"],action:()=>{const e=this.tabs.value.findIndex((e=>e.id===this.selectedTabId.value));this.selectedTabId.value=this.tabs.value[Math.max(e-1,0)].id}}),t.registerShortcut(n,{combos:["mod+shift+."],description:Ut.MoveToRightTabShortcut,globalCombos:["mod+shift+."],action:()=>{const e=this.tabs.value.findIndex((e=>e.id===this.selectedTabId.value));this.selectedTabId.value=this.tabs.value[Math.min(e+1,this.tabs.length-1)].id}}),t.registerShortcut(n,{combos:["mod+shift+d"],description:Ut.GoToDiscussionShortcut,globalCombos:["mod+shift+d"],action:e=>{this.onFocusDiscussion()}}),t.registerShortcut(n,{combos:["mod+shift+/"],description:Ut.GoToNextFormGroupShortcut,globalCombos:["mod+shift+/"],action:e=>{this.onFocusGroup(!0)}}),t.registerShortcut(n,{combos:["mod+shift+'"],description:Ut.GoToPreviousFormGroupShortcut,globalCombos:["mod+shift+'"],action:e=>{this.onFocusGroup(!1)}}),t.registerShortcut(n,{combos:["mod+s"],description:Ut.SaveChanges,globalCombos:["mod+s"],element:i,action:()=>{!this.workItem.value||this.workItem.value.isReadOnly()||this.workItem.value.saving.value||!this.workItem.value.dirty.value||this.workItem.value.infoText.value.invalid||this.onSave(this.resetHistoryData,this.resetHistoryData)}}),t.registerShortcut(n,{combos:["mod+enter"],description:Ut.SaveAndClose,globalCombos:["mod+enter"],element:i,action:()=>{!this.workItem.value||this.workItem.value.isReadOnly()||this.workItem.value.saving.value||!this.workItem.value.dirty.value||this.workItem.value.infoText.value.invalid||this.onSave((()=>{this.resetHistoryData(),this.props.onDismiss&&this.props.onDismiss()}),this.resetHistoryData)}})}unregisterShortcuts(){const e=this.context.pageContext.getService("IVssKeyboardShortcutService"),t=this.getShortcutGroupName();e.removeShortcutGroup(t)}}function d(e){return o.createElement("div",{className:"full-height full-width flex-column justify-center"},o.createElement("div",{className:"full-width flex-row justify-end"},e.onDismiss&&o.createElement(l.Button,{ariaLabel:Ut.Close,iconProps:{iconName:"ChromeClose"},onClick:()=>e.onDismiss(),subtle:!0,tooltipProps:{text:Ut.Close}})),o.createElement("div",{className:"flex-grow flex-row justify-center"},e.children))}t.WorkItemFormView.WorkItemFormView=a,i.Components.add("work-item-form-view-component",a)}()}),["Resources","Attachments/AttachmentActions","Common/Hooks/ControlDefaultOptionsContext","Common/Hooks/WorkItemFormPageContext","Common/Hooks/useSet","Common/Hooks/index","Attachments/useAttachmentUri","Attachments/AttachmentUtils","Common/Components/CollapsibleSection","Common/Components/EditCommentDialog","Links/Constants","Links/Controls/LinkTopologyDiagram","Links/Controls/LinkTypeDropdown","Links/WorkItem/resolveWorkItemArtifacts","Links/WorkItem/WorkItemLinkTopologyValidator","Common/Components/EditWorkItemLinkDialog","Common/Components/FieldName","Details/WorkItemFormCommentPreview","Common/Components/StateCircle","Common/Components/FieldValue","Common/Components/PartitionedList","Common/Components/index","Common/Services/IWorkItemFormCommentService","Common/Services/IWorkItemFormService","Attachments/Dialogs/ConfirmSkippingOversizedAttachmentsDialog","Common/Services/WorkItemFormAttachmentsService","Common/Services/index","Attachments/AttachmentMoreButton","Attachments/AttachmentsGrid","Attachments/AttachmentsViewToggle","Attachments/AttachmentThumbnails","Attachments/Dialogs/AttachmentPreview","Attachments/Dialogs/DeleteAttachmentDialog","Attachments/AttachmentsTab","Attachments/index","Common/HtmlUtils","Common/ImageUploader","Common/RoutingUtils","Common/Services/WorkItemFormCommentService","Common/Services/WorkItemFormService","Details/DiscussionMentionUtils","Common/Components/MarkdownConversionPreviewDialog","Details/WorkItemFormHistoricalComment","Details/WorkItemFormDiscussionGroup","Details/WorkItemFormExtensionHost","Links/Controls/ArtifactLinkIcon","Links/Controls/ArtifactLink","Links/Dialogs/AddLinkDialog","Links/GitHub/GitHubLinkForm","Links/GitHub/GitHubDataProviderContracts","Links/GitHub/GitHubLinkTypeService","Links/Controls/AddLinkButton","Links/Controls/ArtifactLinkPlaceholder","Links/Controls/CompactLinksList","Links/Controls/LinksMoreButton","Links/Controls/LinksGrid","Links/Controls/LinksZeroState","Links/Controls/LinksControl","Links/LinksTab","Links/WorkItemDetailsLinksControl","Links/index","Common/Components/WorkItemFieldSubscriber","Details/LegacyWorkItemFormControl","Details/XMLControlUtils","Details/WorkItemFormControl","Details/WorkItemFormGroup","Details/WorkItemFormSection","Details/WorkItemFormTab","Details/index","Header/WorkItemNotificationSettingsDialog","Header/WorkItemFormCommandBar","Header/WorkItemTagPicker","Header/WorkItemFormHeader","Header/index","History/ChangeType","History/HistoryUtils","History/StateGraph","History/SingleLineMarkdownPreview","History/SingleLineComment","History/Diffs/AttachmentDiff","History/Diffs/CommentDiff","History/Diffs/FieldDiff","History/Diffs/HtmlFieldDiff","History/Diffs/LinkDiff","History/Diffs/UpdateDiffs","History/UpdatesFilterBar","History/UpdateSummary","History/UpdateDetails","History/UpdatesList","History/HistoryTab","History/index","Links/RemoteWorkItem/RemoteWorkItemService","Links/RemoteWorkItem/RemoteWorkItemUtils","Attachments/FileDropZone","Header/WorkItemFormNavBar","Header/WorkItemFormSubHeader","Links/Controls/WorkItemTypeDropdown","Links/RemoteWorkItem/RemoteWorkItemLinkForm","Links/RemoteWorkItem/RemoteWorkItemLinkTypeService","Links/WorkItem/HyperlinkForm","Links/WorkItem/NewWorkItemLinkForm","Links/WorkItem/WorkItemLinkForm","Links/WorkItem/WorkItemLinkTypeService","WorkItemFormView"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-work-web.new-work-item-form-content"}}));