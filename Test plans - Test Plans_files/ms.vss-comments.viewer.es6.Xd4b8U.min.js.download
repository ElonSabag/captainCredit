"use strict";define("Comments/Viewer",["require","exports","react","xss","xss/PresetOptions","VSS/Core/Observable","VSS/Core/Util/String","VSS/Platform/Layout","VSSUI/Observer","VSSUI/Resources.Core","VSSUI/TooltipEx","VSSUI/Util","VSSUI/Utilities/Date"],(function(e,t,o,n,r,i,a,s,m,c,d,l,p){var h,u;h=t.ResourcesViewer={},t.ResourcesViewer.CommentedFormat="commented {0}",t.ResourcesViewer.CommentedJustNow="just now",t.ResourcesViewer.CommentEditedTag="(edited)",t.ResourcesViewer.CommentEditedTooltip="Edited {0}",function(e){u=t[e]={};const C=["ms.vss-comments.viewer-toolbar"],T=["ms.vss-comments.reactions"],w=Object.assign(Object.assign({},r.superAllowList),{onIgnoreTagAttr:function(e,t,o){if(t.startsWith("class")||t.startsWith("data-vss-mention"))return t+'="'+(0,n.escapeAttrValue)(o)+'"'}});class f extends s.VssComponent{constructor(e,t){super(e,t),this._additionalContentProps={},this._commentContentRef=o.createRef(),this._showDarkThemeFormat=new i.ObservableValue(!1),this._getPermaLink=e=>{const{getPermalink:t,getAnchorId:o=this._getAnchorId}=this.props;return t(o(e))},this._additionalContentProps={[f.CommentIdAttribute]:e.comment.id},this._themeService=this.context.pageContext.getService("IVssThemeService")}render(){const{comment:e,className:t,contentClassName:n,getAnchorId:r=this._getAnchorId,onRenderPersona:i,isReactionsEnabled:s,onRenderCommentBody:u,tooltipTimeFormat:C,currentDate:T}=this.props,w=e.createdOnBehalfDate||e.createdDate,f=e.modifiedDate,v=e.createdOnBehalfOf||e.createdBy,R=e.createdDate.getTime()!==e.modifiedDate.getTime(),S=p.ago(w,void 0,T)===c.JustNow?h.CommentedJustNow:p.ago(w,void 0,T),g=this._getSanitizedText(e),_=location.hash==="#"+e.id&&"highlighted";return o.createElement("div",Object.assign({id:r&&r(e.id),className:(0,l.css)("comment-viewer",t,_)},this._additionalContentProps),o.createElement("div",{className:"comment-header"},o.createElement("div",{className:"comment-header-main"},i&&i(v),o.createElement("span",{className:"user-display-name"},v.displayName),o.createElement(d.Tooltip,{text:p.tooltipString(w)},o.createElement("a",{className:"comment-timestamp",href:"#"+e.id,target:"_blank"},a.format(h.CommentedFormat,S))),R&&o.createElement(d.Tooltip,{text:a.format(h.CommentEditedTooltip,p.tooltipString(f,void 0,C))},o.createElement("span",{className:"comment-timestamp"},"Â ",h.CommentEditedTag))),this._renderToolbar()),o.createElement(m.Observer,{showDarkThemeFormat:this._showDarkThemeFormat,themeService:this._themeService},(t=>{const r=!t.showDarkThemeFormat&&this._themeService.getCurrentTheme().isDark;return u?u(e.text):o.createElement("div",{className:(0,l.css)("comment-content",r&&"comment-content-dark-theme-override",n),ref:this._commentContentRef,dangerouslySetInnerHTML:{__html:g}})})),s&&this._hasReactions()&&this._renderReactionStatusBar())}componentDidMount(){this._updateContent(),location.hash==="#"+this.props.comment.id&&window.setTimeout((()=>{var e,t;return null===(t=null===(e=this._commentContentRef)||void 0===e?void 0:e.current)||void 0===t?void 0:t.scrollIntoView({behavior:"smooth"})}),250)}componentDidUpdate(){this._updateContent()}_renderToolbar(){const{comment:{id:e},baseUrl:t,readonly:n,canEdit:r,editDisabled:i,formatDisabled:a,onStartEdit:m,onConfirmDelete:c,onMoreClick:d,getPermalink:p,isReactionsEnabled:h,reactionTypeToInfoMap:u={},editButtonRef:T,onAddReactionButtonClick:w,onAddReaction:f=l.noop,onDeleteReaction:v=l.noop}=this.props;return o.createElement(s.WrappedComponent,{dependencies:C,wrappedType:"comment-viewer-toolbar",wrappedProps:{commentId:e,baseUrl:t,readonly:n,canEdit:r,editDisabled:i,formatDisabled:a,editButtonRef:T,onStartEdit:m,onConfirmDelete:c,onMoreClick:d,getPermalink:p?this._getPermaLink:void 0,showDarkThemeFormat:this._showDarkThemeFormat,reactionSelectorProps:h?{readonly:n,commentId:e,reactionTypeToInfoMap:u,onAddReactionButtonClick:w,onAddReaction:f,onDeleteReaction:v}:void 0}})}_renderReactionStatusBar(){const{comment:{id:e},readonly:t,reactionTypeToInfoMap:n={},onAddReactionButtonClick:r,onAddReaction:i=l.noop,onDeleteReaction:a=l.noop,onGetRecentlyReactedUsers:m=l.noop}=this.props;return o.createElement("div",{className:"reaction-statusbar-placeholder"},o.createElement(s.WrappedComponent,{dependencies:T,wrappedType:"comment-reaction-statusbar",wrappedProps:{commentId:e,readonly:t,onAddReactionButtonClick:r,onAddReaction:i,onDeleteReaction:a,reactionTypeToInfoMap:n,onGetRecentlyReactedUsers:m}}))}_hasReactions(){const{reactionTypeToInfoMap:e}=this.props;if(!e)return!1;for(const t in e)if(e[t].totalCount>0)return!0;return!1}_getAnchorId(e){return`comment-${e}`}_updateContent(){const e=this._commentContentRef.current;if(e&&e.innerHTML){const{onPostRenderContent:t}=this.props;t&&t(e.innerHTML,e)}}_getSanitizedText(e){return e.renderedText?(0,n.filterXSS)(e.renderedText,w):(0,n.filterXSS)(e.text,w)}}t[e].CommentViewer=f,f.CommentIdAttribute="data-comment-id",s.VssComponent.register("comment-viewer",f)}("ComponentsCommentViewer"),t.CommentViewer={},Object.defineProperty(t.CommentViewer,"CommentViewer",{enumerable:!0,get:function(){return u.CommentViewer}})}),["Resources.Viewer","Components/CommentViewer","CommentViewer"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-comments.viewer"}}));